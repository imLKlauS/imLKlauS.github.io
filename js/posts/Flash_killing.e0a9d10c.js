import{_ as s,u as l,p as o,c as n,w as a,a as e,o as c,g as t,b as p,d as r,e as E,r as y,f as i}from"../../assets/app-dc00d3e4.js";const u=JSON.parse('{"title":"秒杀","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wallhaven-2em38y_1920x1080.png","title":"秒杀","top":182,"author":"imklaus","tags":["Spring Boot","Spring Cloud","token","Redis","Redisson","Schedule","RabbitMQ"],"categories":"Java","date":"2023-04-27T13:43:29.000Z","outline":"deep"},"headers":[{"level":2,"title":"如何设计一个秒杀系统？","slug":"如何设计一个秒杀系统","link":"#如何设计一个秒杀系统","children":[{"level":3,"title":"1 瞬时高并发","slug":"_1-瞬时高并发","link":"#_1-瞬时高并发","children":[]},{"level":3,"title":"2 页面静态化","slug":"_2-页面静态化","link":"#_2-页面静态化","children":[]},{"level":3,"title":"3 秒杀按钮","slug":"_3-秒杀按钮","link":"#_3-秒杀按钮","children":[]},{"level":3,"title":"4 读多写少","slug":"_4-读多写少","link":"#_4-读多写少","children":[]},{"level":3,"title":"5 缓存问题","slug":"_5-缓存问题","link":"#_5-缓存问题","children":[]},{"level":3,"title":"6 库存问题","slug":"_6-库存问题","link":"#_6-库存问题","children":[]},{"level":3,"title":"7 分布式锁","slug":"_7-分布式锁","link":"#_7-分布式锁","children":[]},{"level":3,"title":"8 mq异步处理","slug":"_8-mq异步处理","link":"#_8-mq异步处理","children":[]},{"level":3,"title":"9 如何限流？","slug":"_9-如何限流","link":"#_9-如何限流","children":[]}]},{"level":2,"title":"秒杀系统项目实战","slug":"秒杀系统项目实战","link":"#秒杀系统项目实战","children":[{"level":3,"title":"1 秒杀业务概要","slug":"_1-秒杀业务概要","link":"#_1-秒杀业务概要","children":[]},{"level":3,"title":"2 秒杀流程","slug":"_2-秒杀流程","link":"#_2-秒杀流程","children":[]},{"level":3,"title":"3 秒杀核心业务","slug":"_3-秒杀核心业务","link":"#_3-秒杀核心业务","children":[]},{"level":3,"title":"4 秒杀（高并发）系统关注的问题","slug":"_4-秒杀-高并发-系统关注的问题","link":"#_4-秒杀-高并发-系统关注的问题","children":[]},{"level":3,"title":"5 限流 & 熔断 & 降级","slug":"_5-限流-熔断-降级","link":"#_5-限流-熔断-降级","children":[]}]}],"relativePath":"pages/posts/Flash_killing.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-lastest\\\\imklaus-valaxy-blog\\\\pages\\\\posts\\\\Flash_killing.md","lastUpdated":null}'),d=JSON.parse('{"title":"秒杀","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wallhaven-2em38y_1920x1080.png","title":"秒杀","top":182,"author":"imklaus","tags":["Spring Boot","Spring Cloud","token","Redis","Redisson","Schedule","RabbitMQ"],"categories":"Java","date":"2023-04-27T13:43:29.000Z","outline":"deep"},"headers":[{"level":2,"title":"如何设计一个秒杀系统？","slug":"如何设计一个秒杀系统","link":"#如何设计一个秒杀系统","children":[{"level":3,"title":"1 瞬时高并发","slug":"_1-瞬时高并发","link":"#_1-瞬时高并发","children":[]},{"level":3,"title":"2 页面静态化","slug":"_2-页面静态化","link":"#_2-页面静态化","children":[]},{"level":3,"title":"3 秒杀按钮","slug":"_3-秒杀按钮","link":"#_3-秒杀按钮","children":[]},{"level":3,"title":"4 读多写少","slug":"_4-读多写少","link":"#_4-读多写少","children":[]},{"level":3,"title":"5 缓存问题","slug":"_5-缓存问题","link":"#_5-缓存问题","children":[]},{"level":3,"title":"6 库存问题","slug":"_6-库存问题","link":"#_6-库存问题","children":[]},{"level":3,"title":"7 分布式锁","slug":"_7-分布式锁","link":"#_7-分布式锁","children":[]},{"level":3,"title":"8 mq异步处理","slug":"_8-mq异步处理","link":"#_8-mq异步处理","children":[]},{"level":3,"title":"9 如何限流？","slug":"_9-如何限流","link":"#_9-如何限流","children":[]}]},{"level":2,"title":"秒杀系统项目实战","slug":"秒杀系统项目实战","link":"#秒杀系统项目实战","children":[{"level":3,"title":"1 秒杀业务概要","slug":"_1-秒杀业务概要","link":"#_1-秒杀业务概要","children":[]},{"level":3,"title":"2 秒杀流程","slug":"_2-秒杀流程","link":"#_2-秒杀流程","children":[]},{"level":3,"title":"3 秒杀核心业务","slug":"_3-秒杀核心业务","link":"#_3-秒杀核心业务","children":[]},{"level":3,"title":"4 秒杀（高并发）系统关注的问题","slug":"_4-秒杀-高并发-系统关注的问题","link":"#_4-秒杀-高并发-系统关注的问题","children":[]},{"level":3,"title":"5 限流 & 熔断 & 降级","slug":"_5-限流-熔断-降级","link":"#_5-限流-熔断-降级","children":[]}]}],"relativePath":"pages/posts/Flash_killing.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-lastest\\\\imklaus-valaxy-blog\\\\pages\\\\posts\\\\Flash_killing.md","lastUpdated":null}'),F={name:"pages/posts/Flash_killing.md",data:()=>({data:d,frontmatter:d.frontmatter,$frontmatter:d.frontmatter}),setup(){const s=l();s.meta.frontmatter=Object.assign(s.meta.frontmatter,d.frontmatter),o("pageData",d)}},g=p("ul",null,[p("li",null,[r("秒杀系统笔记： "),p("ul",null,[p("li",null,"1）如何设计一个秒杀系统？ 2）秒杀系统项目实战")])])],-1),D={id:"如何设计一个秒杀系统",tabindex:"-1"},A=p("ul",null,[p("li",null,[p("p",null,"高并发下如何设计秒杀系统？这是一个高频面试题。这个问题看似简单，但是里面的水很深，它考查的是高并发场景下，从前端到后端多方面的知识。")]),p("li",null,[p("p",null,"秒杀一般出现在商城的促销活动中，指定了一定数量（比如：10个）的商品（比如：手机），以极低的价格（比如：0.1元），让大量用户参与活动，但只有极少数用户能够购买成功。这类活动商家绝大部分是不赚钱的，说白了是找个噱头宣传自己。")]),p("li",null,[p("p",null,"虽说秒杀只是一个促销活动，但对技术要求不低。下面给大家总结一下设计秒杀系统需要注意的9个细节。")])],-1),k=p("figure",null,[p("img",{alt:"image-20230429153744600",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429153744600.png"})],-1),m={id:"_1-瞬时高并发",tabindex:"-1"},h=p("ul",null,[p("li",null,[p("p",null,"一般在秒杀时间点（比如：12点）前几分钟，用户并发量才真正突增，达到秒杀时间点时，并发量会达到顶峰。")]),p("li",null,[p("p",null,"但由于这类活动是大量用户抢少量商品的场景，必定会出现狼多肉少的情况，所以其实绝大部分用户秒杀会失败，只有极少部分用户能够成功。")]),p("li",null,[p("p",null,"正常情况下，大部分用户会收到商品已经抢完的提醒，收到该提醒后，他们大概率不会在那个活动页面停留了，如此一来，用户并发量又会急剧下降。所以这个峰值持续的时间其实是非常短的，这样就会出现瞬时高并发的情况，下面用一张图直观的感受一下流量的变化：")])],-1),S=p("figure",null,[p("img",{alt:"image-20230429154129604",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429154129604.png"})],-1),C=p("ul",null,[p("li",null,[r("像这种瞬时高并发的场景，传统的系统很难应对，我们需要设计一套全新的系统。可以从以下几个方面入手： "),p("ol",null,[p("li",null,"页面静态化"),p("li",null,"CDN加速"),p("li",null,"缓存"),p("li",null,"mq异步处理"),p("li",null,"限流"),p("li",null,"分布式锁")])])],-1),b={id:"_2-页面静态化",tabindex:"-1"},B=p("ul",null,[p("li",null,[p("p",null,"活动页面是用户流量的第一入口，所以是并发量最大的地方。")]),p("li",null,[p("p",null,"如果这些流量都能直接访问服务端，恐怕服务端会因为承受不住这么大的压力，而直接挂掉。")])],-1),v=p("figure",null,[p("img",{alt:"image-20230429154425207",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429154425207.png"})],-1),f=p("ul",null,[p("li",null,[r("活动页面绝大多数内容是固定的，比如：商品名称、商品描述、图片等。为了减少不必要的服务端请求，通常情况下，会对活动页面做"),p("code",null,"静态化"),r("处理。用户浏览商品等常规操作，并不会请求到服务端。只有到了秒杀时间点，并且用户主动点了秒杀按钮才允许访问服务端。")])],-1),I=p("figure",null,[p("img",{alt:"image-20230429154505896",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429154505896.png"})],-1),_=p("ul",null,[p("li",null,[p("p",null,"这样能过滤大部分无效请求。")]),p("li",null,[p("p",null,"但只做页面静态化还不够，因为用户分布在全国各地，有些人在北京，有些人在成都，有些人在深圳，地域相差很远，网速各不相同。")]),p("li",null,[p("p",null,"如何才能让用户最快访问到活动页面呢？"),p("ul",null,[p("li",null,"这就需要使用CDN，它的全称是Content Delivery Network，即内容分发网络。")])])],-1),T=p("figure",null,[p("img",{alt:"image-20230429154557367",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429154557367.png"})],-1),L=p("blockquote",null,[p("p",null,"使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。")],-1),x={id:"_3-秒杀按钮",tabindex:"-1"},R=p("ul",null,[p("li",null,[p("p",null,"大部分用户怕错过秒杀时间点，一般会提前进入活动页面。此时看到的秒杀按钮是置灰，不可点击的。只有到了秒杀时间点那一时刻，秒杀按钮才会自动点亮，变成可点击的。")]),p("li",null,[p("p",null,"但此时很多用户已经迫不及待了，通过不停刷新页面，争取在第一时间看到秒杀按钮的点亮。")]),p("li",null,[p("p",null,"从前面得知，该活动页面是静态的。那么我们在静态页面中如何控制秒杀按钮，只在秒杀时间点时才点亮呢？"),p("ul",null,[p("li",null,"没错，使用js文件控制。")])]),p("li",null,[p("p",null,"为了性能考虑，一般会将css、js和图片等静态资源文件提前缓存到CDN上，让用户能够就近访问秒杀页面。")]),p("li",null,[p("p",null,"看到这里，有些聪明的小伙伴，可能会问：CDN上的js文件是如何更新的？"),p("ul",null,[p("li",null,"秒杀开始之前，js标志为false，还有另外一个随机参数。")])])],-1),O=p("figure",null,[p("img",{alt:"image-20230429154759471",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429154759471.png"})],-1),j=p("ul",null,[p("li",null,"当秒杀开始的时候系统会生成一个新的js文件，此时标志为true，并且随机参数生成一个新值，然后同步给CDN。由于有了这个随机参数，CDN不会缓存数据，每次都能从CDN中获取最新的js代码。")],-1),P=p("figure",null,[p("img",{alt:"image-20230429154818790",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429154818790.png"})],-1),K=p("blockquote",null,[p("p",null,"此外，前端还可以加一个定时器，控制比如：10秒之内，只允许发起一次请求。如果用户点击了一次秒杀按钮，则在10秒之内置灰，不允许再次点击，等到过了时间限制，又允许重新点击该按钮。")],-1),q={id:"_4-读多写少",tabindex:"-1"},w=p("ul",null,[p("li",null,[p("p",null,"在秒杀的过程中，系统一般会先查一下库存是否足够，如果足够才允许下单，写数据库。如果不够，则直接返回该商品已经抢完。")]),p("li",null,[p("p",null,"由于大量用户抢少量商品，只有极少部分用户能够抢成功，所以绝大部分用户在秒杀时，库存其实是不足的，系统会直接返回该商品已经抢完。")]),p("li",null,[p("p",null,"这是非常典型的：读多写少 的场景。")])],-1),z=p("figure",null,[p("img",{alt:"image-20230429155156269",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429155156269.png"})],-1),M=p("ul",null,[p("li",null,[p("p",null,"如果有数十万的请求过来，同时通过数据库查缓存是否足够，此时数据库可能会挂掉。因为数据库的连接资源非常有限，比如：mysql，无法同时支持这么多的连接。")]),p("li",null,[p("p",null,"而应该改用缓存，比如：redis。")]),p("li",null,[p("p",null,"即便用了redis，也需要部署多个节点。")])],-1),V=p("figure",null,[p("img",{alt:"image-20230429155327734",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429155327734.png"})],-1),U={id:"_5-缓存问题",tabindex:"-1"},N=p("ul",null,[p("li",null,[p("p",null,"通常情况下，我们需要在redis中保存商品信息，里面包含：商品id、商品名称、规格属性、库存等信息，同时数据库中也要有相关信息，毕竟缓存并不完全可靠。")]),p("li",null,[p("p",null,"用户在点击秒杀按钮，请求秒杀接口的过程中，需要传入的商品id参数，然后服务端需要校验该商品是否合法。")]),p("li",null,[p("p",null,"大致流程如下图所示：")])],-1),H=p("figure",null,[p("img",{alt:"image-20230429155407944",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429155407944.png"})],-1),W=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"根据商品id，先从缓存中查询商品，如果商品存在，则参与秒杀。如果不存在，则需要从数据库中查询商品，如果存在，则将商品信息放入缓存，然后参与秒杀。如果商品不存在，则直接提示失败。")]),p("li",null,[p("p",null,"这个过程表面上看起来是OK的，但是如果深入分析一下会发现一些问题。")])])],-1),X={id:"_5-1-缓存击穿",tabindex:"-1"},J=p("ul",null,[p("li",null,[p("p",null,"比如商品A第一次秒杀时，缓存中是没有数据的，但数据库中有。虽说上面有如果从数据库中查到数据，则放入缓存的逻辑。")]),p("li",null,[p("p",null,"然而，在高并发下，同一时刻会有大量的请求，都在秒杀同一件商品，这些请求同时去查缓存中没有数据，然后又同时访问数据库。结果悲剧了，数据库可能扛不住压力，直接挂掉。")]),p("li",null,[p("p",null,"如何解决这个问题呢？"),p("ul",null,[p("li",null,"这就需要加锁，最好使用分布式锁。")])])],-1),Q=p("figure",null,[p("img",{alt:"image-20230429155613279",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429155613279.png"})],-1),G=p("blockquote",null,[p("ul",null,[p("li",null,"当然，针对这种情况，最好在项目启动之前，先把缓存进行预热。即事先把所有的商品，同步到缓存中，这样商品基本都能直接从缓存中获取到，就不会出现缓存击穿的问题了。"),p("li",null,[r("是不是上面加锁这一步可以不需要了？ "),p("ul",null,[p("li",null,"表面上看起来，确实可以不需要。但如果缓存中设置的过期时间不对，缓存提前过期了，或者缓存被不小心删除了，如果不加速同样可能出现缓存击穿。"),p("li",null,"其实这里加锁，相当于买了一份保险。")])])])],-1),$={id:"_5-2-缓存穿透",tabindex:"-1"},Y=p("ul",null,[p("li",null,[p("p",null,"如果有大量的请求传入的商品id，在缓存中和数据库中都不存在，这些请求不就每次都会穿透过缓存，而直接访问数据库了。")]),p("li",null,[p("p",null,"由于前面已经加了锁，所以即使这里的并发量很大，也不会导致数据库直接挂掉。")]),p("li",null,[p("p",null,"但很显然这些请求的处理性能并不好，有没有更好的解决方案？"),p("ul",null,[p("li",null,"这时可以想到布隆过滤器。")])])],-1),Z=p("figure",null,[p("img",{alt:"image-20230429160015188",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429160015188.png"})],-1),ss=p("ul",null,[p("li",null,[p("p",null,"系统根据商品id，先从布隆过滤器中查询该id是否存在，如果存在则允许从缓存中查询数据，如果不存在，则直接返回失败。")]),p("li",null,[p("p",null,"虽说该方案可以解决缓存穿透问题，但是又会引出另外一个问题：布隆过滤器中的数据如何跟缓存中的数据保持一致？")]),p("li",null,[p("p",null,"这就要求，如果缓存中数据有更新，则要及时同步到布隆过滤器中。如果数据同步失败了，还需要增加重试机制，而且跨数据源，能保证数据的实时一致性吗？"),p("ul",null,[p("li",null,"显然是不行的。")])]),p("li",null,[p("p",null,"所以布隆过滤器绝大部分使用在缓存数据更新很少的场景中。")]),p("li",null,[p("p",null,"如果缓存数据更新非常频繁，又该如何处理呢？")]),p("li",null,[p("p",null,"这时，就需要把不存在的商品id也缓存起来。")])],-1),ls=p("figure",null,[p("img",{alt:"image-20230429160205059",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429160205059.png"})],-1),os=p("blockquote",null,[p("p",null,"下次，再有该商品id的请求过来，则也能从缓存中查到数据，只不过该数据比较特殊，表示商品不存在。需要特别注意的是，这种特殊缓存设置的超时时间应该尽量短一点。")],-1),ns={id:"_6-库存问题",tabindex:"-1"},as=p("ul",null,[p("li",null,[p("p",null,"对于库存问题看似简单，实则里面还是有些东西。")]),p("li",null,[p("p",null,"真正的秒杀商品的场景，不是说扣完库存，就完事了，如果用户在一段时间内，还没完成支付，扣减的库存是要加回去的。")]),p("li",null,[p("p",null,"所以，在这里引出了一个预扣库存的概念，预扣库存的主要流程如下：")])],-1),es=p("figure",null,[p("img",{alt:"image-20230429160545360",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429160545360.png"})],-1),cs=p("blockquote",null,[p("p",null,"扣减库存中除了上面说到的预扣库存和回退库存之外，还需要特别注意的是库存不足和库存超卖问题。")],-1),ts={id:"_6-1-数据库扣减库存",tabindex:"-1"},ps=p("ul",null,[p("li",null,"使用数据库扣减库存，是最简单的实现方案了，假设扣减库存的sql如下：")],-1),rs=p("div",{style:{"max-height":"300px"},class:"language-sql"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"sql"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"update"),p("span",{style:{color:"#E1E4E8"}}," product "),p("span",{style:{color:"#F97583"}},"set"),p("span",{style:{color:"#E1E4E8"}}," stock"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}},"stock"),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"where"),p("span",{style:{color:"#E1E4E8"}}," id"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#79B8FF"}},"123"),p("span",{style:{color:"#E1E4E8"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"update"),p("span",{style:{color:"#24292E"}}," product "),p("span",{style:{color:"#D73A49"}},"set"),p("span",{style:{color:"#24292E"}}," stock"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}},"stock"),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"where"),p("span",{style:{color:"#24292E"}}," id"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#005CC5"}},"123"),p("span",{style:{color:"#24292E"}},";")])])]),p("button",{class:"collapse"})],-1),Es=p("ul",null,[p("li",null,[p("p",null,"这种写法对于扣减库存是没有问题的，但如何控制库存不足的情况下，不让用户操作呢？"),p("ul",null,[p("li",null,[p("p",null,"这就需要在update之前，先查一下库存是否足够了。")]),p("li",null,[p("p",null,"伪代码如下：")])]),p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," stock "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mapper."),p("span",{style:{color:"#B392F0"}},"getStockById"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"123"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(stock "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," count "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mapper."),p("span",{style:{color:"#B392F0"}},"updateStock"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"123"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(count "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#B392F0"}},"addOrder"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"123"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," stock "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mapper."),p("span",{style:{color:"#6F42C1"}},"getStockById"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"123"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(stock "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," count "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mapper."),p("span",{style:{color:"#6F42C1"}},"updateStock"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"123"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(count "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6F42C1"}},"addOrder"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"123"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})])]),p("li",null,[p("p",null,"大家有没有发现这段代码的问题？"),p("ul",null,[p("li",null,[p("p",null,"没错，查询操作和更新操作不是原子性的，会导致在并发的场景下，出现库存超卖的情况。")]),p("li",null,[p("p",null,"有人可能会说，这样好办，加把锁，不就搞定了，比如使用synchronized关键字。")]),p("li",null,[p("p",null,"确实，可以，但是性能不够好。")]),p("li",null,[p("p",null,"还有更优雅的处理方案，即基于数据库的乐观锁，这样会少一次数据库查询，而且能够天然的保证数据操作的原子性。")]),p("li",null,[p("p",null,"只需将上面的sql稍微调整一下：")])]),p("div",{style:{"max-height":"300px"},class:"language-sql"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"sql"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"update"),p("span",{style:{color:"#E1E4E8"}}," product "),p("span",{style:{color:"#F97583"}},"set"),p("span",{style:{color:"#E1E4E8"}}," stock"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}},"stock"),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"where"),p("span",{style:{color:"#E1E4E8"}}," id"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}},"product "),p("span",{style:{color:"#F97583"}},"and"),p("span",{style:{color:"#E1E4E8"}}," stock "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"update"),p("span",{style:{color:"#24292E"}}," product "),p("span",{style:{color:"#D73A49"}},"set"),p("span",{style:{color:"#24292E"}}," stock"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}},"stock"),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"where"),p("span",{style:{color:"#24292E"}}," id"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}},"product "),p("span",{style:{color:"#D73A49"}},"and"),p("span",{style:{color:"#24292E"}}," stock "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},";")])])]),p("button",{class:"collapse"})])])],-1),ys=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"在sql最后加上：stock > 0，就能保证不会出现超卖的情况。")]),p("li",null,[p("p",null,"但需要频繁访问数据库，我们都知道数据库连接是非常昂贵的资源。在高并发的场景下，可能会造成系统雪崩。而且，容易出现多个请求，同时竞争行锁的情况，造成相互等待，从而出现死锁的问题。")])])],-1),is={id:"_6-2-redis扣减库存",tabindex:"-1"},us=p("ul",null,[p("li",null,[r("redis的"),p("code",null,"incr"),r("方法是原子性的，可以用该方法扣减库存。 伪代码如下：")])],-1),ds=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," exist "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisClient."),p("span",{style:{color:"#B392F0"}},"query"),p("span",{style:{color:"#E1E4E8"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(exist) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," stock "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisClient."),p("span",{style:{color:"#B392F0"}},"queryStock"),p("span",{style:{color:"#E1E4E8"}},"(productId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(stock "),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  redisClient."),p("span",{style:{color:"#B392F0"}},"incrby"),p("span",{style:{color:"#E1E4E8"}},"(productId, "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  redisClient."),p("span",{style:{color:"#B392F0"}},"add"),p("span",{style:{color:"#E1E4E8"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," exist "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisClient."),p("span",{style:{color:"#6F42C1"}},"query"),p("span",{style:{color:"#24292E"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(exist) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," stock "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisClient."),p("span",{style:{color:"#6F42C1"}},"queryStock"),p("span",{style:{color:"#24292E"}},"(productId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(stock "),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  redisClient."),p("span",{style:{color:"#6F42C1"}},"incrby"),p("span",{style:{color:"#24292E"}},"(productId, "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  redisClient."),p("span",{style:{color:"#6F42C1"}},"add"),p("span",{style:{color:"#24292E"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")])])]),p("button",{class:"collapse"})],-1),Fs=p("ul",null,[p("li",null,"代码流程如下：")],-1),gs=p("ol",null,[p("li",null,[p("p",null,"先判断该用户有没有秒杀过该商品，如果已经秒杀过，则直接返回-1。")]),p("li",null,[p("p",null,"查询库存，如果库存小于等于0，则直接返回0，表示库存不足。")]),p("li",null,[p("p",null,"如果库存充足，则扣减库存，然后将本次秒杀记录保存起来。然后返回1，表示成功。")])],-1),Ds=p("ul",null,[p("li",null,[p("p",null,"估计很多小伙伴，一开始都会按这样的思路写代码。但如果仔细想想会发现，这段代码有问题。")]),p("li",null,[p("p",null,"有什么问题呢？"),p("ul",null,[p("li",null,[r("如果在高并发下，有多个请求同时查询库存，当时都大于0。由于查询库存和更新库存非原则操作，则会出现库存为负数的情况，即"),p("code",null,"库存超卖"),r("。")])])]),p("li",null,[p("p",null,[r("当然有人可能会说，加个"),p("code",null,"synchronized"),r("不就解决问题？")])]),p("li",null,[p("p",null,"调整后代码如下：")])],-1),As=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," exist "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisClient."),p("span",{style:{color:"#B392F0"}},"query"),p("span",{style:{color:"#E1E4E8"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"   "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(exist) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"   }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"   "),p("span",{style:{color:"#F97583"}},"synchronized"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"this"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," stock "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisClient."),p("span",{style:{color:"#B392F0"}},"queryStock"),p("span",{style:{color:"#E1E4E8"}},"(productId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(stock "),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"         "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       redisClient."),p("span",{style:{color:"#B392F0"}},"incrby"),p("span",{style:{color:"#E1E4E8"}},"(productId, "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       redisClient."),p("span",{style:{color:"#B392F0"}},"add"),p("span",{style:{color:"#E1E4E8"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"   }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," exist "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisClient."),p("span",{style:{color:"#6F42C1"}},"query"),p("span",{style:{color:"#24292E"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"   "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(exist) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"   }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"   "),p("span",{style:{color:"#D73A49"}},"synchronized"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"this"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," stock "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisClient."),p("span",{style:{color:"#6F42C1"}},"queryStock"),p("span",{style:{color:"#24292E"}},"(productId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(stock "),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"         "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       redisClient."),p("span",{style:{color:"#6F42C1"}},"incrby"),p("span",{style:{color:"#24292E"}},"(productId, "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       redisClient."),p("span",{style:{color:"#6F42C1"}},"add"),p("span",{style:{color:"#24292E"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"   }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")])])]),p("button",{class:"collapse"})],-1),ks=p("ul",null,[p("li",null,[p("p",null,[r("加"),p("code",null,"synchronized"),r("确实能解决库存为负数问题，但是这样会导致接口性能急剧下降，每次查询都需要竞争同一把锁，显然不太合理。")])]),p("li",null,[p("p",null,"为了解决上面的问题，代码优化如下：")])],-1),ms=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," exist "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisClient."),p("span",{style:{color:"#B392F0"}},"query"),p("span",{style:{color:"#E1E4E8"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(exist) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(redisClient."),p("span",{style:{color:"#B392F0"}},"incrby"),p("span",{style:{color:"#E1E4E8"}},"(productId, "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"redisClient."),p("span",{style:{color:"#B392F0"}},"add"),p("span",{style:{color:"#E1E4E8"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," exist "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisClient."),p("span",{style:{color:"#6F42C1"}},"query"),p("span",{style:{color:"#24292E"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(exist) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(redisClient."),p("span",{style:{color:"#6F42C1"}},"incrby"),p("span",{style:{color:"#24292E"}},"(productId, "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"redisClient."),p("span",{style:{color:"#6F42C1"}},"add"),p("span",{style:{color:"#24292E"}},"(productId,userId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")])])]),p("button",{class:"collapse"})],-1),hs=p("ul",null,[p("li",null,"该代码主要流程如下：")],-1),Ss=p("ol",null,[p("li",null,[p("p",null,"先判断该用户有没有秒杀过该商品，如果已经秒杀过，则直接返回-1。")]),p("li",null,[p("p",null,"扣减库存，判断返回值是否小于0，如果小于0，则直接返回0，表示库存不足。")]),p("li",null,[p("p",null,"如果扣减库存后，返回值大于或等于0，则将本次秒杀记录保存起来。然后返回1，表示成功。")])],-1),Cs=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"该方案咋一看，好像没问题。"),p("ul",null,[p("li",null,"但如果在高并发场景中，有多个请求同时扣减库存，大多数请求的incrby操作之后，结果都会小于0。")])]),p("li",null,[p("p",null,"虽说，库存出现负数，不会出现超卖的问题。但由于这里是预减库存，如果负数值负的太多的话，后面万一要回退库存时，就会导致库存不准。")]),p("li",null,[p("p",null,"那么，有没有更好的方案呢？")])])],-1),bs={id:"_6-3-lua脚本扣减库存",tabindex:"-1"},Bs=p("ul",null,[p("li",null,[p("p",null,"我们都知道lua脚本，是能够保证原子性的，它跟redis一起配合使用，能够完美解决上面的问题。")]),p("li",null,[p("p",null,"lua脚本有段非常经典的代码：")])],-1),vs=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"StringBuilder lua "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"StringBuilder"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},"\"if (redis.call('exists', KEYS[1]) == 1) then\""),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},"\"    local stock = tonumber(redis.call('get', KEYS[1]));\""),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"    if (stock == -1) then"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"        return 1;"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"    end;"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"    if (stock > 0) then"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},"\"        redis.call('incrby', KEYS[1], -1);\""),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"        return stock;"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"    end;"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"    return 0;"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"end;"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  lua."),p("span",{style:{color:"#B392F0"}},"append"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"return -1;"'),p("span",{style:{color:"#E1E4E8"}},");")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"StringBuilder lua "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"StringBuilder"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},"\"if (redis.call('exists', KEYS[1]) == 1) then\""),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},"\"    local stock = tonumber(redis.call('get', KEYS[1]));\""),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"    if (stock == -1) then"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"        return 1;"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"    end;"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"    if (stock > 0) then"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},"\"        redis.call('incrby', KEYS[1], -1);\""),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"        return stock;"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"    end;"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"    return 0;"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"end;"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  lua."),p("span",{style:{color:"#6F42C1"}},"append"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"return -1;"'),p("span",{style:{color:"#24292E"}},");")])])]),p("button",{class:"collapse"})],-1),fs=p("ul",null,[p("li",null,"该代码的主要流程如下：")],-1),Is=p("ol",null,[p("li",null,[p("p",null,"先判断商品id是否存在，如果不存在则直接返回。")]),p("li",null,[p("p",null,"获取该商品id的库存，判断库存如果是-1，则直接返回，表示不限制库存。")]),p("li",null,[p("p",null,"如果库存大于0，则扣减库存。")]),p("li",null,[p("p",null,"如果库存等于0，是直接返回，表示库存不足。")])],-1),_s={id:"_7-分布式锁",tabindex:"-1"},Ts=p("ul",null,[p("li",null,[p("p",null,"之前我提到过，在秒杀的时候，需要先从缓存中查商品是否存在，如果不存在，则会从数据库中查商品。如果数据库中有，则将该商品放入缓存中，然后返回。如果数据库中没有，则直接返回失败。")]),p("li",null,[p("p",null,"大家试想一下，如果在高并发下，有大量的请求都去查一个缓存中不存在的商品，这些请求都会直接打到数据库。数据库由于承受不住压力，而直接挂掉。")]),p("li",null,[p("p",null,"那么如何解决这个问题呢？"),p("ul",null,[p("li",null,"这就需要用redis分布式锁了。")])])],-1),Ls={id:"_7-1-setnx加锁",tabindex:"-1"},xs=p("ul",null,[p("li",null,"使用redis的分布式锁，首先想到的是setNx命令。")],-1),Rs=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (jedis."),p("span",{style:{color:"#B392F0"}},"setnx"),p("span",{style:{color:"#E1E4E8"}},"(lockKey, val) "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"   jedis."),p("span",{style:{color:"#B392F0"}},"expire"),p("span",{style:{color:"#E1E4E8"}},"(lockKey, timeout);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (jedis."),p("span",{style:{color:"#6F42C1"}},"setnx"),p("span",{style:{color:"#24292E"}},"(lockKey, val) "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"   jedis."),p("span",{style:{color:"#6F42C1"}},"expire"),p("span",{style:{color:"#24292E"}},"(lockKey, timeout);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Os=p("ul",null,[p("li",null,[p("p",null,"用该命令其实可以加锁，但和后面的设置超时时间是分开的，并非原子操作。")]),p("li",null,[p("p",null,"假如加锁成功了，但是设置超时时间失败了，该lockKey就变成永不失效的了。在高并发场景中，该问题会导致非常严重的后果。")]),p("li",null,[p("p",null,"那么，有没有保证原子性的加锁命令呢？")])],-1),js={id:"_7-2-set加锁",tabindex:"-1"},Ps=p("ul",null,[p("li",null,"使用redis的set命令，它可以指定多个参数。")],-1),Ks=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"String result "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," jedis."),p("span",{style:{color:"#B392F0"}},"set"),p("span",{style:{color:"#E1E4E8"}},"(lockKey, requestId, "),p("span",{style:{color:"#9ECBFF"}},'"NX"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"PX"'),p("span",{style:{color:"#E1E4E8"}},", expireTime);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#9ECBFF"}},'"OK"'),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"equals"),p("span",{style:{color:"#E1E4E8"}},"(result)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"String result "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," jedis."),p("span",{style:{color:"#6F42C1"}},"set"),p("span",{style:{color:"#24292E"}},"(lockKey, requestId, "),p("span",{style:{color:"#032F62"}},'"NX"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"PX"'),p("span",{style:{color:"#24292E"}},", expireTime);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#032F62"}},'"OK"'),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"equals"),p("span",{style:{color:"#24292E"}},"(result)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},";")])])]),p("button",{class:"collapse"})],-1),qs=p("p",null,"其中：",-1),ws=p("ul",null,[p("li",null,[p("p",null,"lockKey：锁的标识")]),p("li",null,[p("p",null,"requestId：请求id")]),p("li",null,[p("p",null,"NX：只在键不存在时，才对键进行设置操作。")]),p("li",null,[p("p",null,"PX：设置键的过期时间为 millisecond 毫秒。")]),p("li",null,[p("p",null,"expireTime：过期时间 由于该命令只有一步，所以它是原子操作。")])],-1),zs={id:"_7-3-释放锁",tabindex:"-1"},Ms=p("ul",null,[p("li",null,[p("p",null,"接下来，有些朋友可能会问：在加锁时，既然已经有了lockKey锁标识，为什么要需要记录requestId呢？"),p("ul",null,[p("li",null,"答：requestId是在释放锁的时候用的。")])]),p("li",null,[p("p",null,"在释放锁的时候，只能释放自己加的锁，不允许释放别人加的锁。")]),p("li",null,[p("p",null,"这里为什么要用requestId，用userId不行吗？"),p("ul",null,[p("li",null,"答：如果用userId的话，假设本次请求流程走完了，准备删除锁。此时，巧合锁到了过期时间失效了。而另外一个请求，巧合使用的相同userId加锁，会成功。而本次请求删除锁的时候，删除的其实是别人的锁了。")])]),p("li",null,[p("p",null,"当然使用lua脚本也能避免该问题：")])],-1),Vs=p("div",{style:{"max-height":"300px"},class:"language-shell"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"shell"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"redis.call("),p("span",{style:{color:"#B392F0"}},"'get'"),p("span",{style:{color:"#B392F0"}},","),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"KEYS["),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#9ECBFF"}},"]"),p("span",{style:{color:"#E1E4E8"}},") == ARGV["),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},"] "),p("span",{style:{color:"#F97583"}},"then"),p("span",{style:{color:"#E1E4E8"}}," ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"redis.call"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#B392F0"}},"'del'"),p("span",{style:{color:"#B392F0"}},","),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"KEYS["),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#9ECBFF"}},"]"),p("span",{style:{color:"#E1E4E8"}},") ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}}," ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"end")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"redis.call("),p("span",{style:{color:"#6F42C1"}},"'get'"),p("span",{style:{color:"#6F42C1"}},","),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"KEYS["),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#032F62"}},"]"),p("span",{style:{color:"#24292E"}},") == ARGV["),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},"] "),p("span",{style:{color:"#D73A49"}},"then"),p("span",{style:{color:"#24292E"}}," ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"redis.call"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#6F42C1"}},"'del'"),p("span",{style:{color:"#6F42C1"}},","),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"KEYS["),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#032F62"}},"]"),p("span",{style:{color:"#24292E"}},") ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}}," ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"end")])])]),p("button",{class:"collapse"})],-1),Us=p("blockquote",null,[p("p",null,"它能保证查询锁是否存在和删除锁是原子操作。")],-1),Ns={id:"_7-4-自旋锁",tabindex:"-1"},Hs=p("ul",null,[p("li",null,[p("p",null,"上面的加锁方法看起来好像没有问题，但如果你仔细想想，如果有1万的请求同时去竞争那把锁，可能只有一个请求是成功的，其余的9999个请求都会失败。")]),p("li",null,[p("p",null,"在秒杀场景下，会有什么问题？"),p("ul",null,[p("li",null,"答：每1万个请求，有1个成功。再1万个请求，有1个成功。如此下去，直到库存不足。这就变成均匀分布的秒杀了，跟我们想象中的不一样。")])]),p("li",null,[p("p",null,"如何解决这个问题呢？"),p("ul",null,[p("li",null,"答：使用自旋锁。")])])],-1),Ws=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  Long start "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," System."),p("span",{style:{color:"#B392F0"}},"currentTimeMillis"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"while"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      String result "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," jedis."),p("span",{style:{color:"#B392F0"}},"set"),p("span",{style:{color:"#E1E4E8"}},"(lockKey, requestId, "),p("span",{style:{color:"#9ECBFF"}},'"NX"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"PX"'),p("span",{style:{color:"#E1E4E8"}},", expireTime);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"     "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#9ECBFF"}},'"OK"'),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"equals"),p("span",{style:{color:"#E1E4E8"}},"(result)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"     }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"     ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"     "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," time "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," System."),p("span",{style:{color:"#B392F0"}},"currentTimeMillis"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#E1E4E8"}}," start;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (time"),p("span",{style:{color:"#F97583"}},">="),p("span",{style:{color:"#E1E4E8"}},"timeout) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          Thread."),p("span",{style:{color:"#B392F0"}},"sleep"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"50"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (InterruptedException "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"} "),p("span",{style:{color:"#F97583"}},"finally"),p("span",{style:{color:"#E1E4E8"}},"{")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#B392F0"}},"unlock"),p("span",{style:{color:"#E1E4E8"}},"(lockKey,requestId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}  ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  Long start "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," System."),p("span",{style:{color:"#6F42C1"}},"currentTimeMillis"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"while"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      String result "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," jedis."),p("span",{style:{color:"#6F42C1"}},"set"),p("span",{style:{color:"#24292E"}},"(lockKey, requestId, "),p("span",{style:{color:"#032F62"}},'"NX"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"PX"'),p("span",{style:{color:"#24292E"}},", expireTime);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"     "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#032F62"}},'"OK"'),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"equals"),p("span",{style:{color:"#24292E"}},"(result)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"     }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"     ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"     "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," time "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," System."),p("span",{style:{color:"#6F42C1"}},"currentTimeMillis"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#24292E"}}," start;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (time"),p("span",{style:{color:"#D73A49"}},">="),p("span",{style:{color:"#24292E"}},"timeout) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          Thread."),p("span",{style:{color:"#6F42C1"}},"sleep"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"50"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (InterruptedException "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"} "),p("span",{style:{color:"#D73A49"}},"finally"),p("span",{style:{color:"#24292E"}},"{")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6F42C1"}},"unlock"),p("span",{style:{color:"#24292E"}},"(lockKey,requestId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}  ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},";")])])]),p("button",{class:"collapse"})],-1),Xs=p("blockquote",null,[p("p",null,"在规定的时间，比如500毫秒内，自旋不断尝试加锁，如果成功则直接返回。如果失败，则休眠50毫秒，再发起新一轮的尝试。如果到了超时时间，还未加锁成功，则直接返回失败。")],-1),Js={id:"_7-5-redisson",tabindex:"-1"},Qs=p("li",null,[p("p",null,"除了上面的问题之外，使用redis分布式锁，还有锁竞争问题、续期问题、锁重入问题、多个redis实例加锁问题等。")],-1),Gs={id:"_8-mq异步处理",tabindex:"-1"},$s=p("ul",null,[p("li",null,"我们都知道在真实的秒杀场景中，有三个核心流程：")],-1),Ys=p("figure",null,[p("img",{alt:"image-20230429164405754",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429164405754.png"})],-1),Zs=p("ul",null,[p("li",null,[p("p",null,"而这三个核心流程中，真正并发量大的是秒杀功能，下单和支付功能实际并发量很小。所以，我们在设计秒杀系统时，有必要把下单和支付功能从秒杀的主流程中拆分出来，特别是下单功能要做成mq异步处理的。而支付功能，比如支付宝支付，是业务场景本身保证的异步。")]),p("li",null,[p("p",null,"于是，秒杀后下单的流程变成如下：")])],-1),sl=p("figure",null,[p("img",{alt:"image-20230429164509701",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429164509701.png"})],-1),ll=p("ul",null,[p("li",null,"如果使用mq，需要关注以下几个问题：")],-1),ol={id:"_8-1-消息丢失问题",tabindex:"-1"},nl=p("ul",null,[p("li",null,[p("p",null,"秒杀成功了，往mq发送下单消息的时候，有可能会失败。原因有很多，比如：网络问题、broker挂了、mq服务端磁盘问题等。这些情况，都可能会造成消息丢失。")]),p("li",null,[p("p",null,"那么，如何防止消息丢失呢？"),p("ul",null,[p("li",null,"答：加一张消息发送表。")])])],-1),al=p("figure",null,[p("img",{alt:"image-20230429164617994",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429164617994.png"})],-1),el=p("ul",null,[p("li",null,[p("p",null,"在生产者发送mq消息之前，先把该条消息写入消息发送表，初始状态是待处理，然后再发送mq消息。消费者消费消息时，处理完业务逻辑之后，再回调生产者的一个接口，修改消息状态为已处理。")]),p("li",null,[p("p",null,"如果生产者把消息写入消息发送表之后，再发送mq消息到mq服务端的过程中失败了，造成了消息丢失。")]),p("li",null,[p("p",null,"这时候，要如何处理呢？"),p("ul",null,[p("li",null,"答：使用job，增加重试机制。")])])],-1),cl=p("figure",null,[p("img",{alt:"image-20230429164724585",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429164724585.png"})],-1),tl=p("blockquote",null,[p("p",null,"用job每隔一段时间去查询消息发送表中状态为待处理的数据，然后重新发送mq消息。")],-1),pl={id:"_8-2-重复消费问题",tabindex:"-1"},rl=p("ul",null,[p("li",null,[p("p",null,"本来消费者消费消息时，在ack应答的时候，如果网络超时，本身就可能会消费重复的消息。但由于消息发送者增加了重试机制，会导致消费者重复消息的概率增大。")]),p("li",null,[p("p",null,"那么，如何解决重复消息问题呢？"),p("ul",null,[p("li",null,"答：加一张消息处理表。")])])],-1),El=p("figure",null,[p("img",{alt:"image-20230429164817906",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429164817906.png"})],-1),yl=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"消费者读到消息之后，先判断一下消息处理表，是否存在该消息，如果存在，表示是重复消费，则直接返回。如果不存在，则进行下单操作，接着将该消息写入消息处理表中，再返回。")]),p("li",null,[p("p",null,"有个比较关键的点是：下单和写消息处理表，要放在同一个事务中，保证原子操作。")])])],-1),il={id:"_8-3-垃圾消息问题",tabindex:"-1"},ul=p("ul",null,[p("li",null,[p("p",null,"这套方案表面上看起来没有问题，但如果出现了消息消费失败的情况。比如：由于某些原因，消息消费者下单一直失败，一直不能回调状态变更接口，这样job会不停的重试发消息。最后，会产生大量的垃圾消息。")]),p("li",null,[p("p",null,"那么，如何解决这个问题呢？")])],-1),dl=p("figure",null,[p("img",{alt:"image-20230429164937078",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429164937078.png"})],-1),Fl=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"每次在job重试时，需要先判断一下消息发送表中该消息的发送次数是否达到最大限制，如果达到了，则直接返回。如果没有达到，则将次数加1，然后发送消息。")]),p("li",null,[p("p",null,"这样如果出现异常，只会产生少量的垃圾消息，不会影响到正常的业务。")])])],-1),gl={id:"_8-4-延迟消费问题",tabindex:"-1"},Dl=p("ul",null,[p("li",null,[p("p",null,"通常情况下，如果用户秒杀成功了，下单之后，在15分钟之内还未完成支付的话，该订单会被自动取消，回退库存。")]),p("li",null,[p("p",null,"那么，在15分钟内未完成支付，订单被自动取消的功能，要如何实现呢？"),p("ul",null,[p("li",null,[p("p",null,"我们首先想到的可能是job，因为它比较简单。")]),p("li",null,[p("p",null,"但job有个问题，需要每隔一段时间处理一次，实时性不太好。")])])]),p("li",null,[p("p",null,"还有更好的方案？"),p("ul",null,[p("li",null,"答：使用延迟队列。")])]),p("li",null,[p("p",null,"我们都知道rocketmq，自带了延迟队列的功能。")])],-1),Al=p("figure",null,[p("img",{alt:"image-20230429165104965",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165104965.png"})],-1),kl=p("ul",null,[p("li",null,[p("p",null,"下单时消息生产者会先生成订单，此时状态为待支付，然后会向延迟队列中发一条消息。达到了延迟时间，消息消费者读取消息之后，会查询该订单的状态是否为待支付。如果是待支付状态，则会更新订单状态为取消状态。如果不是待支付状态，说明该订单已经支付过了，则直接返回。")]),p("li",null,[p("p",null,"还有个关键点，用户完成支付之后，会修改订单状态为已支付。")])],-1),ml=p("figure",null,[p("img",{alt:"image-20230429165137323",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165137323.png"})],-1),hl={id:"_9-如何限流",tabindex:"-1"},Sl=p("ul",null,[p("li",null,[p("p",null,"通过秒杀活动，如果我们运气爆棚，可能会用非常低的价格买到不错的商品（这种概率堪比买福利彩票中大奖）。")]),p("li",null,[p("p",null,"但有些高手，并不会像我们一样老老实实，通过秒杀页面点击秒杀按钮，抢购商品。他们可能在自己的服务器上，模拟正常用户登录系统，跳过秒杀页面，直接调用秒杀接口。")]),p("li",null,[p("p",null,"如果是我们手动操作，一般情况下，一秒钟只能点击一次秒杀按钮。")])],-1),Cl=p("figure",null,[p("img",{alt:"image-20230429165212649",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165212649.png"})],-1),bl=p("ul",null,[p("li",null,"但是如果是服务器，一秒钟可以请求成上千接口。")],-1),Bl=p("figure",null,[p("img",{alt:"image-20230429165302898",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165302898.png"})],-1),vl=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"这种差距实在太明显了，如果不做任何限制，绝大部分商品可能是被机器抢到，而非正常的用户，有点不太公平。")]),p("li",null,[p("p",null,"所以，我们有必要识别这些非法请求，做一些限制。那么，我们该如何现在这些非法请求呢？")]),p("li",null,[p("p",null,"目前有两种常用的限流方式："),p("ul",null,[p("li",null,"1基于nginx限流"),p("li",null,"2基于redis限流")])])])],-1),fl={id:"_9-1-对同一用户限流",tabindex:"-1"},Il=p("ul",null,[p("li",null,"为了防止某个用户，请求接口次数过于频繁，可以只针对该用户做限制。")],-1),_l=p("figure",null,[p("img",{alt:"image-20230429165408344",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165408344.png"})],-1),Tl=p("blockquote",null,[p("p",null,"限制同一个用户id，比如每分钟只能请求5次接口。")],-1),Ll={id:"_9-2-对同一ip限流",tabindex:"-1"},xl=p("ul",null,[p("li",null,[p("p",null,"有时候只对某个用户限流是不够的，有些高手可以模拟多个用户请求，这种nginx就没法识别了。")]),p("li",null,[p("p",null,"这时需要加同一ip限流功能。")])],-1),Rl=p("figure",null,[p("img",{alt:"image-20230429165439488",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165439488.png"})],-1),Ol=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"限制同一个ip，比如每分钟只能请求5次接口。")]),p("li",null,[p("p",null,"但这种限流方式可能会有误杀的情况，比如同一个公司或网吧的出口ip是相同的，如果里面有多个正常用户同时发起请求，有些用户可能会被限制住。")])])],-1),jl={id:"_9-3-对接口限流",tabindex:"-1"},Pl=p("ul",null,[p("li",null,[p("p",null,"别以为限制了用户和ip就万事大吉，有些高手甚至可以使用代理，每次都请求都换一个ip。")]),p("li",null,[p("p",null,"这时可以限制请求的接口总次数。")])],-1),Kl=p("figure",null,[p("img",{alt:"image-20230429165519105",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165519105.png"})],-1),ql=p("blockquote",null,[p("p",null,"在高并发场景下，这种限制对于系统的稳定性是非常有必要的。但可能由于有些非法请求次数太多，达到了该接口的请求上限，而影响其他的正常用户访问该接口。看起来有点得不偿失。")],-1),wl={id:"_9-4-加验证码",tabindex:"-1"},zl=p("ul",null,[p("li",null,"相对于上面三种方式，加验证码的方式可能更精准一些，同样能限制用户的访问频次，但好处是不会存在误杀的情况。")],-1),Ml=p("figure",null,[p("img",{alt:"image-20230429165554440",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429165554440.png"})],-1),Vl=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"通常情况下，用户在请求之前，需要先输入验证码。用户发起请求之后，服务端会去校验该验证码是否正确。只有正确才允许进行下一步操作，否则直接返回，并且提示验证码错误。")]),p("li",null,[p("p",null,"此外，验证码一般是一次性的，同一个验证码只允许使用一次，不允许重复使用。")]),p("li",null,[p("p",null,"普通验证码，由于生成的数字或者图案比较简单，可能会被破解。优点是生成速度比较快，缺点是有安全隐患。")]),p("li",null,[p("p",null,"还有一个验证码叫做：移动滑块，它生成速度比较慢，但比较安全，是目前各大互联网公司的首选。")])])],-1),Ul={id:"_9-5-提高业务门槛",tabindex:"-1"},Nl=p("blockquote",null,[p("ul",null,[p("li",null,[p("p",null,"上面说的加验证码虽然可以限制非法用户请求，但是有些影响用户体验。用户点击秒杀按钮前，还要先输入验证码，流程显得有点繁琐，秒杀功能的流程不是应该越简单越好吗？")]),p("li",null,[p("p",null,"其实，有时候达到某个目的，不一定非要通过技术手段，通过业务手段也一样。")]),p("li",null,[p("p",null,"12306刚开始的时候，全国人民都在同一时刻抢火车票，由于并发量太大，系统经常挂。后来，重构优化之后，将购买周期放长了，可以提前20天购买火车票，并且可以在9点、10、11点、12点等整点购买火车票。调整业务之后（当然技术也有很多调整），将之前集中的请求，分散开了，一下子降低了用户并发量。")]),p("li",null,[p("p",null,"回到这里，我们通过提高业务门槛，比如只有会员才能参与秒杀活动，普通注册用户没有权限。或者，只有等级到达3级以上的普通用户，才有资格参加该活动。")]),p("li",null,[p("p",null,"这样简单的提高一点门槛，即使是黄牛党也束手无策，他们总不可能为了参加一次秒杀活动，还另外花钱充值会员吧？")])])],-1),Hl={id:"秒杀系统项目实战",tabindex:"-1"},Wl={id:"_1-秒杀业务概要",tabindex:"-1"},Xl=p("ul",null,[p("li",null,[p("p",null,"秒杀具有瞬间高并发的特点，针对这一特点，必须要做到限流 + 异步 + 缓存（页面静态化） + 独立部署")]),p("li",null,[p("p",null,"限流方式："),p("ol",null,[p("li",null,"前端限流，一些高并发的网站直接在前端页面开始限流，列如：小米的验证码"),p("li",null,"nginx限流，直接负载部分请求到错误的静态页面，令牌算法、漏斗算法"),p("li",null,"网关限流、限流的过滤器"),p("li",null,"代码中使用分布式信号量"),p("li",null,"rabbitmq限流（能者多劳 channel.basicQos(1)）保证发挥服务器的所用性能")])]),p("li",null,[p("p",null,"秒杀架构图")])],-1),Jl=p("figure",null,[p("img",{alt:"image-20230429224850779",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429224850779.png"})],-1),Ql={id:"_2-秒杀流程",tabindex:"-1"},Gl=p("ul",null,[p("li",null,[p("p",null,"参考京东秒杀流程")]),p("li",null,[p("p",null,"见秒杀流程图")]),p("li",null,[p("p",null,[p("strong",null,"秒杀方式一")])])],-1),$l=p("figure",null,[p("img",{alt:"image-20230430003804352",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430003804352.png"})],-1),Yl=p("ul",null,[p("li",null,[p("strong",null,"秒杀方式二")])],-1),Zl=p("figure",null,[p("img",{alt:"image-20230430003907398",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430003907398.png"})],-1),so={id:"_3-秒杀核心业务",tabindex:"-1"},lo={id:"_3-1-后台添加秒杀商品",tabindex:"-1"},oo=p("figure",null,[p("img",{alt:"image-20230430133519183",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430133519183.png"})],-1),no=p("ul",null,[p("li",null,"关联商品")],-1),ao=p("figure",null,[p("img",{alt:"image-20230430133622474",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430133622474.png"})],-1),eo=p("ul",null,[p("li",null,"分页查询关联商品")],-1),co=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Service"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"seckillSkuRelationService"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuRelationServiceImpl"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"extends"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"ServiceImpl"),p("span",{style:{color:"#E1E4E8"}},"<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationDao"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},"> "),p("span",{style:{color:"#F97583"}},"implements"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuRelationService"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," PageUtils "),p("span",{style:{color:"#B392F0"}},"queryPage"),p("span",{style:{color:"#E1E4E8"}},"(Map<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"Object"),p("span",{style:{color:"#E1E4E8"}},"> "),p("span",{style:{color:"#FFAB70"}},"params"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        QueryWrapper<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},"> queryWrapper "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," QueryWrapper<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},">();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String promotionSessionId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," (String) params."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"promotionSessionId"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String key "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," (String) params."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"key"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"StringUtils."),p("span",{style:{color:"#B392F0"}},"isEmpty"),p("span",{style:{color:"#E1E4E8"}},"(key)){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            queryWrapper."),p("span",{style:{color:"#B392F0"}},"eq"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"sku_id"'),p("span",{style:{color:"#E1E4E8"}},", key)."),p("span",{style:{color:"#B392F0"}},"or"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"eq"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"seckill_price"'),p("span",{style:{color:"#E1E4E8"}},", key);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"StringUtils."),p("span",{style:{color:"#B392F0"}},"isEmpty"),p("span",{style:{color:"#E1E4E8"}},"(promotionSessionId)){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//根据场次id进行查询")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            queryWrapper."),p("span",{style:{color:"#B392F0"}},"eq"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"promotion_session_id"'),p("span",{style:{color:"#E1E4E8"}},", promotionSessionId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        IPage<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},"> page "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"this"),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"page"),p("span",{style:{color:"#E1E4E8"}},"(")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," Query<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},">()."),p("span",{style:{color:"#B392F0"}},"getPage"),p("span",{style:{color:"#E1E4E8"}},"(params),")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                queryWrapper")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        );")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"PageUtils"),p("span",{style:{color:"#E1E4E8"}},"(page);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Service"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"seckillSkuRelationService"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuRelationServiceImpl"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"extends"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"ServiceImpl"),p("span",{style:{color:"#24292E"}},"<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationDao"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},"> "),p("span",{style:{color:"#D73A49"}},"implements"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuRelationService"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," PageUtils "),p("span",{style:{color:"#6F42C1"}},"queryPage"),p("span",{style:{color:"#24292E"}},"(Map<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"Object"),p("span",{style:{color:"#24292E"}},"> "),p("span",{style:{color:"#E36209"}},"params"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        QueryWrapper<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},"> queryWrapper "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," QueryWrapper<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},">();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String promotionSessionId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," (String) params."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"promotionSessionId"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String key "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," (String) params."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"key"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"StringUtils."),p("span",{style:{color:"#6F42C1"}},"isEmpty"),p("span",{style:{color:"#24292E"}},"(key)){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            queryWrapper."),p("span",{style:{color:"#6F42C1"}},"eq"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"sku_id"'),p("span",{style:{color:"#24292E"}},", key)."),p("span",{style:{color:"#6F42C1"}},"or"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"eq"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"seckill_price"'),p("span",{style:{color:"#24292E"}},", key);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"StringUtils."),p("span",{style:{color:"#6F42C1"}},"isEmpty"),p("span",{style:{color:"#24292E"}},"(promotionSessionId)){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//根据场次id进行查询")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            queryWrapper."),p("span",{style:{color:"#6F42C1"}},"eq"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"promotion_session_id"'),p("span",{style:{color:"#24292E"}},", promotionSessionId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        IPage<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},"> page "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"this"),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"page"),p("span",{style:{color:"#24292E"}},"(")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," Query<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},">()."),p("span",{style:{color:"#6F42C1"}},"getPage"),p("span",{style:{color:"#24292E"}},"(params),")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                queryWrapper")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        );")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"PageUtils"),p("span",{style:{color:"#24292E"}},"(page);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),to=p("figure",null,[p("img",{alt:"image-20230430134014948",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430134014948.png"})],-1),po=p("figure",null,[p("img",{alt:"image-20230430134032296",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430134032296.png"})],-1),ro=p("figure",null,[p("img",{alt:"image-20230430134056247",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430134056247.png"})],-1),Eo=p("figure",null,[p("img",{alt:"image-20230430134613785",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430134613785.png"})],-1),yo=p("figure",null,[p("img",{alt:"image-20230430134650173",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430134650173.png"})],-1),io={id:"定时任务",tabindex:"-1"},uo={id:"_1-cron表达式",tabindex:"-1"},Fo=p("p",null,"语法：秒 分 时 日 月 周 年（Spring不支持）",-1),go=p("figure",null,[p("img",{alt:"image-20230430135420949",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430135420949.png"})],-1),Do=p("p",null,"特殊字符：",-1),Ao=p("ul",null,[p("li",null,[p("em",null,"（ “所有值”）-用于选择字段中的所有值。例如，分钟字段中的“ ”表示“每分钟”"),r("。")]),p("li",null,"？（ “无特定值”）-当您需要在允许使用字符的两个字段之一中指定某个内容而在另一个不允许的字段中指定某些内容时很有用。例如，如果我希望在某个月的某个特定日期（例如，第10天）触发触发器，但不在乎一周中的哪一天发生，则将“ 10”设置为月字段，以及“？” 在“星期几”字段中。请参阅下面的示例以进行澄清。"),p("li",null,"--用于指定范围。例如，小时字段中的“ 10-12”表示“小时10、11和12”。"),p("li",null,"， -用于指定其他值。例如，“星期几”字段中的“ MON，WED，FRI”表示“星期一，星期三和星期五的日子”。"),p("li",null,"/ -用于指定增量。例如，秒字段中的“ 0/15”表示“秒0、15、30和45”。秒字段中的“ 5/15”表示“秒5、20、35和50”。您还可以在“ ”字符后指定“ /” -在这种情况下，“ ”等效于在“ /”之前使用“ 0”。每月日期字段中的“ 1/3”表示“从该月的第一天开始每三天触发一次”。"),p("li",null,"L（ “最后一个”）-在允许使用的两个字段中都有不同的含义。例如，“月”字段中的值“ L”表示“月的最后一天”，即非January年的1月31日，2月28日。如果单独用于星期几字段，则仅表示“ 7”或“ SAT”。但是，如果在星期几字段中使用另一个值，则表示“该月的最后xxx天”，例如“ 6L”表示“该月的最后一个星期五”。您还可以指定与该月最后一天的偏移量，例如“ L-3”，这表示日历月的倒数第三天。 使用“ L”选项时，不要指定列表或值的范围很重要，因为这样会导致混淆/意外结果。"),p("li",null,"W（ “工作日”）-用于指定最接近给定日期的工作日（星期一至星期五）。例如，如果您要指定“ 15W”作为“月日”字段的值，则含义是： “离月15日最近的工作日”。因此，如果15号是星期六，则触发器将在14号星期五触发。如果15日是星期日，则触发器将在16日星期一触发。如果15号是星期二，那么它将在15号星期二触发。但是，如果您将“ 1W”指定为月份的值，并且第一个是星期六，则触发器将在第3个星期一触发，因为它不会“跳过”一个月日的边界。仅当月份中的某天是一天，而不是范围或天数列表时，才可以指定“ W”字符。")],-1),ko=p("blockquote",null,[p("p",null,"“ L”和“ W”字符也可以在“月日”字段中组合以产生“ LW”，这表示“每月的最后一个工作日” 。")],-1),mo=p("ul",null,[p("li",null,"＃ -用于指定每月的第“ XXX”天。例如，“星期几”字段中的值“ 6＃3”表示“该月的第三个星期五”（第6天=星期五，“＃3” =该月的第三个星期五）。其他示例：“ 2＃1” =该月的第一个星期一，“ 4＃5” =该月的第五个星期三。请注意，如果您指定“＃5”，并且该月的指定星期几中没有5个，则该月将不会触发。")],-1),ho=p("blockquote",null,[p("p",null,"法定字符以及月份和星期几的名称不区分大小写。MON 与mon相同。")],-1),So={id:"_2-cron-示例",tabindex:"-1"},Co=p("table",null,[p("thead",null,[p("tr",null,[p("th",null,[p("strong",null,"Expression")]),p("th",null,[p("strong",null,"Meaning")])])]),p("tbody",null,[p("tr",null,[p("td",null,[p("code",null,"0 0 12 * * ?")]),p("td",null,"Fire at 12pm (noon) every day")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 ? * *")]),p("td",null,"Fire at 10:15am every day")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 * * ?")]),p("td",null,"Fire at 10:15am every day")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 * * ? *")]),p("td",null,"Fire at 10:15am every day")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 * * ? 2005")]),p("td",null,"Fire at 10:15am every day during the year 2005")]),p("tr",null,[p("td",null,[p("code",null,"0 * 14 * * ?")]),p("td",null,"Fire every minute starting at 2pm and ending at 2:59pm, every day")]),p("tr",null,[p("td",null,[p("code",null,"0 0/5 14 * * ?")]),p("td",null,"Fire every 5 minutes starting at 2pm and ending at 2:55pm, every day")]),p("tr",null,[p("td",null,[p("code",null,"0 0/5 14,18 * * ?")]),p("td",null,"Fire every 5 minutes starting at 2pm and ending at 2:55pm, AND fire every 5 minutes starting at 6pm and ending at 6:55pm, every day")]),p("tr",null,[p("td",null,[p("code",null,"0 0-5 14 * * ?")]),p("td",null,"Fire every minute starting at 2pm and ending at 2:05pm, every day")]),p("tr",null,[p("td",null,[p("code",null,"0 10,44 14 ? 3 WED")]),p("td",null,"Fire at 2:10pm and at 2:44pm every Wednesday in the month of March.")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 ? * MON-FRI")]),p("td",null,"Fire at 10:15am every Monday, Tuesday, Wednesday, Thursday and Friday")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 15 * ?")]),p("td",null,"Fire at 10:15am on the 15th day of every month")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 L * ?")]),p("td",null,"Fire at 10:15am on the last day of every month")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 L-2 * ?")]),p("td",null,"Fire at 10:15am on the 2nd-to-last last day of every month")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 ? * 6L")]),p("td",null,"Fire at 10:15am on the last Friday of every month")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 ? * 6L")]),p("td",null,"Fire at 10:15am on the last Friday of every month")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 ? * 6L 2002-2005")]),p("td",null,"Fire at 10:15am on every last friday of every month during the years 2002, 2003, 2004 and 2005")]),p("tr",null,[p("td",null,[p("code",null,"0 15 10 ? * 6#3")]),p("td",null,"Fire at 10:15am on the third Friday of every month")]),p("tr",null,[p("td",null,[p("code",null,"0 0 12 1/5 * ?")]),p("td",null,"Fire at 12pm (noon) every 5 days every month, starting on the first day of the month.")]),p("tr",null,[p("td",null,[p("code",null,"0 11 11 11 11 ?")]),p("td",null,"Fire every November 11th at 11:11am.")])])],-1),bo={id:"_3-springboot整合定时任务",tabindex:"-1"},Bo=p("p",null,"定时任务相关注解:",-1),vo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"EnableAsync"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring异步任务支持")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"EnableScheduling"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring的计划任务执行功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Async"),p("span",{style:{color:"#E1E4E8"}}," 异步")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Scheduled"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"cron"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"* * * * * ?"'),p("span",{style:{color:"#E1E4E8"}},")")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"EnableAsync"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring异步任务支持")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"EnableScheduling"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring的计划任务执行功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Async"),p("span",{style:{color:"#24292E"}}," 异步")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Scheduled"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"cron"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"* * * * * ?"'),p("span",{style:{color:"#24292E"}},")")])])]),p("button",{class:"collapse"})],-1),fo=p("p",null,"代码：",-1),Io=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 定时任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      1、@EnableScheduling 开启定时任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      2、Scheduled 开启一个定时任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      3、自动配置类 TaskSchedulingAutoConfiguration 属性绑定在TaskExecutionProperties")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 异步任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      1、@EnableAsync 开启异步任务功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      2、@Async 给希望异步执行的方法上标注")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      3、自动配置类 TaskExecutionAutoConfiguration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Component")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"EnableAsync"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring异步任务支持")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"EnableScheduling"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring的计划任务执行功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"HelloSchedule"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 1、Spring中6位组成，不允许第7位的年")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 2、在周几的位置，1-7代表周一到周日：MON-SUN")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 3、定时任务应该阻塞，默认是阻塞的")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *      1、可以让业务以异步的方式运行，自己提交到线程池")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          CompletableFuture.runAsync(() -> {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *              xxxService.hello();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          })")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *      2、支持定时任务线程池，设置 TaskSchedulingProperties")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          spring.task.scheduling.pool.size=5")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *      3、让定时任务异步执行")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          异步执行")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *     解决：使用异步 + 定时任务来完成定时任务不阻塞的功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    @Async 异步")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//    @Scheduled(cron = "* * * * * ?")')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    public void hello() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//        log.info("hello...");')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 定时任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      1、@EnableScheduling 开启定时任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      2、Scheduled 开启一个定时任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      3、自动配置类 TaskSchedulingAutoConfiguration 属性绑定在TaskExecutionProperties")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 异步任务")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      1、@EnableAsync 开启异步任务功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      2、@Async 给希望异步执行的方法上标注")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *      3、自动配置类 TaskExecutionAutoConfiguration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Component")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"EnableAsync"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring异步任务支持")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"EnableScheduling"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"// 启用Spring的计划任务执行功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"HelloSchedule"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 1、Spring中6位组成，不允许第7位的年")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 2、在周几的位置，1-7代表周一到周日：MON-SUN")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 3、定时任务应该阻塞，默认是阻塞的")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *      1、可以让业务以异步的方式运行，自己提交到线程池")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          CompletableFuture.runAsync(() -> {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *              xxxService.hello();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          })")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *      2、支持定时任务线程池，设置 TaskSchedulingProperties")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          spring.task.scheduling.pool.size=5")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *      3、让定时任务异步执行")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *          异步执行")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *     解决：使用异步 + 定时任务来完成定时任务不阻塞的功能")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    @Async 异步")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//    @Scheduled(cron = "* * * * * ?")')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    public void hello() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//        log.info("hello...");')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),_o=p("div",{style:{"max-height":"300px"},class:"language-properties"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"properties"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"spring.task.execution.pool.core-size"),p("span",{style:{color:"#E1E4E8"}},"=5")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"spring.task.execution.pool.max-size"),p("span",{style:{color:"#E1E4E8"}},"=50")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"spring.task.execution.pool.core-size"),p("span",{style:{color:"#24292E"}},"=5")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"spring.task.execution.pool.max-size"),p("span",{style:{color:"#24292E"}},"=50")])])]),p("button",{class:"collapse"})],-1),To={id:"_3-2-秒杀商品上架",tabindex:"-1"},Lo=p("ul",null,[p("li",null,"定时上架秒杀商品")],-1),xo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  * 秒杀商品的定时上架；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      每天晚上3点；上架最近三天需要秒杀的商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      当天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      明天天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      后天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/27")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Service")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuScheduled"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SeckillService seckillService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Scheduled"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"cron"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"0 0 1/1 * * ? "'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"         seckillService."),p("span",{style:{color:"#B392F0"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  * 秒杀商品的定时上架；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      每天晚上3点；上架最近三天需要秒杀的商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      当天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      明天天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      后天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/27")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Service")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuScheduled"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SeckillService seckillService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Scheduled"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"cron"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"0 0 1/1 * * ? "'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"         seckillService."),p("span",{style:{color:"#6F42C1"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Ro=p("ul",null,[p("li",null,"远程获取近三天秒杀商品")],-1),Oo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"FeignClient"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"gulimall-coupon"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"interface"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"CouponFeignService"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"GetMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/coupon/seckillsession/latest3DaySession"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    R "),p("span",{style:{color:"#B392F0"}},"getLatest3DaySession"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"FeignClient"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"gulimall-coupon"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"interface"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"CouponFeignService"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"GetMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/coupon/seckillsession/latest3DaySession"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    R "),p("span",{style:{color:"#6F42C1"}},"getLatest3DaySession"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),jo=p("ul",null,[p("li",null,"获取最近3天的秒杀活动场次接口"),p("li",null,[p("code",null,"org.klaus.zgg01mall.coupon.controller.SeckillSessionController#getLatest3DaySession")])],-1),Po=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 获取最近3天的秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"GetMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/latest3DaySession"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," R "),p("span",{style:{color:"#B392F0"}},"getLatest3DaySession"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    List<"),p("span",{style:{color:"#F97583"}},"SeckillSessionEntity"),p("span",{style:{color:"#E1E4E8"}},"> sessionEntities "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillSessionService."),p("span",{style:{color:"#B392F0"}},"getLatest3DaySession"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," R."),p("span",{style:{color:"#B392F0"}},"ok"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"setData"),p("span",{style:{color:"#E1E4E8"}},"(sessionEntities);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 获取最近3天的秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"GetMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/latest3DaySession"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," R "),p("span",{style:{color:"#6F42C1"}},"getLatest3DaySession"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    List<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionEntity"),p("span",{style:{color:"#24292E"}},"> sessionEntities "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillSessionService."),p("span",{style:{color:"#6F42C1"}},"getLatest3DaySession"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," R."),p("span",{style:{color:"#6F42C1"}},"ok"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"setData"),p("span",{style:{color:"#24292E"}},"(sessionEntities);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Ko=p("ul",null,[p("li",null,"获取最近3天的秒杀活动场次方法实现及时间日期处理")],-1),qo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SeckillSkuRelationService seckillSkuRelationService;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"\t/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 获取最近3天的秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," List"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"SeckillSessionEntity"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getLatest3DaySession"),p("span",{style:{color:"#E1E4E8"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//获取最近三天信息")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        List<"),p("span",{style:{color:"#F97583"}},"SeckillSessionEntity"),p("span",{style:{color:"#E1E4E8"}},"> list "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"this"),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"list"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," QueryWrapper<"),p("span",{style:{color:"#F97583"}},"SeckillSessionEntity"),p("span",{style:{color:"#E1E4E8"}},">\t()."),p("span",{style:{color:"#B392F0"}},"between"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"start_time"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#B392F0"}},"startTime"),p("span",{style:{color:"#E1E4E8"}},"(), "),p("span",{style:{color:"#B392F0"}},"endTime"),p("span",{style:{color:"#E1E4E8"}},"()));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t"),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"startTime"),p("span",{style:{color:"#E1E4E8"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        LocalDate now "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," LocalDate."),p("span",{style:{color:"#B392F0"}},"now"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        LocalTime min "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," LocalTime.MIN;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        LocalDateTime start "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," LocalDateTime."),p("span",{style:{color:"#B392F0"}},"of"),p("span",{style:{color:"#E1E4E8"}},"(now, min);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String format "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," start."),p("span",{style:{color:"#B392F0"}},"format"),p("span",{style:{color:"#E1E4E8"}},"(DateTimeFormatter."),p("span",{style:{color:"#B392F0"}},"ofPattern"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"yyyy-MM-dd HH:mm:ss"'),p("span",{style:{color:"#E1E4E8"}},"));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," format;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"endTime"),p("span",{style:{color:"#E1E4E8"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        LocalDate now "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," LocalDate."),p("span",{style:{color:"#B392F0"}},"now"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        LocalDate localDate "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," now."),p("span",{style:{color:"#B392F0"}},"plusDays"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"2"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        LocalTime max "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," LocalTime.MAX;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        LocalDateTime end "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," LocalDateTime."),p("span",{style:{color:"#B392F0"}},"of"),p("span",{style:{color:"#E1E4E8"}},"(localDate, max);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String format "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," end."),p("span",{style:{color:"#B392F0"}},"format"),p("span",{style:{color:"#E1E4E8"}},"(DateTimeFormatter."),p("span",{style:{color:"#B392F0"}},"ofPattern"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"yyyy-MM-dd HH:mm:ss"'),p("span",{style:{color:"#E1E4E8"}},"));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," format;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SeckillSkuRelationService seckillSkuRelationService;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"\t/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 获取最近3天的秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," List"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"SeckillSessionEntity"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getLatest3DaySession"),p("span",{style:{color:"#24292E"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//获取最近三天信息")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        List<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionEntity"),p("span",{style:{color:"#24292E"}},"> list "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"this"),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"list"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," QueryWrapper<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionEntity"),p("span",{style:{color:"#24292E"}},">\t()."),p("span",{style:{color:"#6F42C1"}},"between"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"start_time"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#6F42C1"}},"startTime"),p("span",{style:{color:"#24292E"}},"(), "),p("span",{style:{color:"#6F42C1"}},"endTime"),p("span",{style:{color:"#24292E"}},"()));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t"),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"startTime"),p("span",{style:{color:"#24292E"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        LocalDate now "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," LocalDate."),p("span",{style:{color:"#6F42C1"}},"now"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        LocalTime min "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," LocalTime.MIN;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        LocalDateTime start "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," LocalDateTime."),p("span",{style:{color:"#6F42C1"}},"of"),p("span",{style:{color:"#24292E"}},"(now, min);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String format "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," start."),p("span",{style:{color:"#6F42C1"}},"format"),p("span",{style:{color:"#24292E"}},"(DateTimeFormatter."),p("span",{style:{color:"#6F42C1"}},"ofPattern"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"yyyy-MM-dd HH:mm:ss"'),p("span",{style:{color:"#24292E"}},"));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," format;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"endTime"),p("span",{style:{color:"#24292E"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        LocalDate now "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," LocalDate."),p("span",{style:{color:"#6F42C1"}},"now"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        LocalDate localDate "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," now."),p("span",{style:{color:"#6F42C1"}},"plusDays"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"2"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        LocalTime max "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," LocalTime.MAX;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        LocalDateTime end "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," LocalDateTime."),p("span",{style:{color:"#6F42C1"}},"of"),p("span",{style:{color:"#24292E"}},"(localDate, max);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String format "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," end."),p("span",{style:{color:"#6F42C1"}},"format"),p("span",{style:{color:"#24292E"}},"(DateTimeFormatter."),p("span",{style:{color:"#6F42C1"}},"ofPattern"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"yyyy-MM-dd HH:mm:ss"'),p("span",{style:{color:"#24292E"}},"));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," format;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])]),p("button",{class:"collapse"})],-1),wo=p("ul",null,[p("li",null,"秒杀活动场次添加商品关联（不记入数据库）")],-1),zo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @email klaus@gmail.com")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022-08-22 13:18:54")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"TableName"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"sms_seckill_session"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSessionEntity"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"implements"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"Serializable"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t......")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"   /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    * 所有秒杀活动商品关联")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"   @"),p("span",{style:{color:"#F97583"}},"TableField"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"exist"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"   "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," List<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},"> relationSkus;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @email klaus@gmail.com")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022-08-22 13:18:54")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"TableName"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"sms_seckill_session"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSessionEntity"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"implements"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"Serializable"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t......")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"   /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    * 所有秒杀活动商品关联")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"   @"),p("span",{style:{color:"#D73A49"}},"TableField"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"exist"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"   "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," List<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},"> relationSkus;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Mo=p("ul",null,[p("li",null,"完善获取最近3天的秒杀活动场次方法实现"),p("li",null,[p("code",null,"org.klaus.zgg01mall.coupon.service.impl.SeckillSessionServiceImpl#getLatest3DaySession")])],-1),Vo=p("figure",null,[p("img",{alt:"image-20230430142137405",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430142137405.png"})],-1),Uo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 获取最近3天的秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," List"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"SeckillSessionEntity"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getLatest3DaySession"),p("span",{style:{color:"#E1E4E8"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//获取最近三天信息")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    List<"),p("span",{style:{color:"#F97583"}},"SeckillSessionEntity"),p("span",{style:{color:"#E1E4E8"}},"> list "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"this"),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"list"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," QueryWrapper<"),p("span",{style:{color:"#F97583"}},"SeckillSessionEntity"),p("span",{style:{color:"#E1E4E8"}},">()."),p("span",{style:{color:"#B392F0"}},"between"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"start_time"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#B392F0"}},"startTime"),p("span",{style:{color:"#E1E4E8"}},"(), "),p("span",{style:{color:"#B392F0"}},"endTime"),p("span",{style:{color:"#E1E4E8"}},"()));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (list "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," list."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        List<"),p("span",{style:{color:"#F97583"}},"SeckillSessionEntity"),p("span",{style:{color:"#E1E4E8"}},"> collect "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," list."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(session "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//获取秒杀场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            Long id "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getId"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//根据秒杀场次id获取秒杀关联商品集合")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            List<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},"> skuRelationEntities "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillSkuRelationService."),p("span",{style:{color:"#B392F0"}},"list"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," QueryWrapper<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#E1E4E8"}},">()."),p("span",{style:{color:"#B392F0"}},"eq"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"promotion_session_id"'),p("span",{style:{color:"#E1E4E8"}},", id));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (skuRelationEntities "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," skuRelationEntities."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                session."),p("span",{style:{color:"#B392F0"}},"setRelationSkus"),p("span",{style:{color:"#E1E4E8"}},"(skuRelationEntities);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," session;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        })."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," collect;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 获取最近3天的秒杀活动场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," List"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"SeckillSessionEntity"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getLatest3DaySession"),p("span",{style:{color:"#24292E"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//获取最近三天信息")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    List<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionEntity"),p("span",{style:{color:"#24292E"}},"> list "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"this"),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"list"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," QueryWrapper<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionEntity"),p("span",{style:{color:"#24292E"}},">()."),p("span",{style:{color:"#6F42C1"}},"between"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"start_time"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#6F42C1"}},"startTime"),p("span",{style:{color:"#24292E"}},"(), "),p("span",{style:{color:"#6F42C1"}},"endTime"),p("span",{style:{color:"#24292E"}},"()));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (list "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," list."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        List<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionEntity"),p("span",{style:{color:"#24292E"}},"> collect "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," list."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(session "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//获取秒杀场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            Long id "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getId"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//根据秒杀场次id获取秒杀关联商品集合")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            List<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},"> skuRelationEntities "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillSkuRelationService."),p("span",{style:{color:"#6F42C1"}},"list"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," QueryWrapper<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRelationEntity"),p("span",{style:{color:"#24292E"}},">()."),p("span",{style:{color:"#6F42C1"}},"eq"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"promotion_session_id"'),p("span",{style:{color:"#24292E"}},", id));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (skuRelationEntities "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," skuRelationEntities."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                session."),p("span",{style:{color:"#6F42C1"}},"setRelationSkus"),p("span",{style:{color:"#24292E"}},"(skuRelationEntities);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," session;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        })."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," collect;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),No=p("ul",null,[p("li",null,"添加数据传输vo")],-1),Ho=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long id;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 场次名称")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String name;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每日开始时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Date startTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每日结束时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Date endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 启用状态")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Integer status;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 创建时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Date createTime;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," List<"),p("span",{style:{color:"#F97583"}},"SeckillSkuVo"),p("span",{style:{color:"#E1E4E8"}},"> relationSkus;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long id;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 场次名称")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String name;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每日开始时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Date startTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每日结束时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Date endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 启用状态")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Integer status;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 创建时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Date createTime;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," List<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuVo"),p("span",{style:{color:"#24292E"}},"> relationSkus;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Wo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuVo"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long id;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long promotionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long promotionSessionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long skuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillPrice;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀总量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每人限购数量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillLimit;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 排序")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Integer seckillSort;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuVo"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long id;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long promotionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long promotionSessionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long skuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillPrice;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀总量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每人限购数量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillLimit;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 排序")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Integer seckillSort;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Xo=p("ul",null,[p("li",null,"秒杀商品定时上架流程")],-1),Jo=p("figure",null,[p("img",{alt:"image-20230430004237857",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430004237857.png"})],-1),Qo=p("ul",null,[p("li",null,"秒杀服务远程调用扫描最近三天需要参与秒杀的活动方法实现"),p("li",null,[p("code",null,"org.klaus.zgg01mall.seckill.service.impl.SeckillServiceImpl#uploadSeckillSkuLatest3Days")])],-1),Go=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#E1E4E8"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//1、扫描最近三天需要参与秒杀的活动")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    R r "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," couponFeignService."),p("span",{style:{color:"#B392F0"}},"getLatest3DaySession"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (r."),p("span",{style:{color:"#B392F0"}},"getCode"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//远程调用成功，上架商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        List<"),p("span",{style:{color:"#F97583"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#E1E4E8"}},"> sessionData "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," r."),p("span",{style:{color:"#B392F0"}},"getData"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," TypeReference<List<"),p("span",{style:{color:"#F97583"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#E1E4E8"}},">>() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (sessionData "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," sessionData."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//缓存到redis")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//1、缓存活动信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#B392F0"}},"saveSessionInfos"),p("span",{style:{color:"#E1E4E8"}},"(sessionData);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//2、缓存活动的关联商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#B392F0"}},"saveSessionSkuInfos"),p("span",{style:{color:"#E1E4E8"}},"(sessionData);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#24292E"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//1、扫描最近三天需要参与秒杀的活动")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    R r "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," couponFeignService."),p("span",{style:{color:"#6F42C1"}},"getLatest3DaySession"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (r."),p("span",{style:{color:"#6F42C1"}},"getCode"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//远程调用成功，上架商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        List<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#24292E"}},"> sessionData "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," r."),p("span",{style:{color:"#6F42C1"}},"getData"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," TypeReference<List<"),p("span",{style:{color:"#D73A49"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#24292E"}},">>() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (sessionData "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," sessionData."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//缓存到redis")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//1、缓存活动信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6F42C1"}},"saveSessionInfos"),p("span",{style:{color:"#24292E"}},"(sessionData);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//2、缓存活动的关联商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6F42C1"}},"saveSessionSkuInfos"),p("span",{style:{color:"#24292E"}},"(sessionData);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),$o={id:"_1、缓存活动信息方法",tabindex:"-1"},Yo=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t"),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"final"),p("span",{style:{color:"#E1E4E8"}}," String SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"seckill:sessions:"'),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t"),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"saveSessionInfos"),p("span",{style:{color:"#E1E4E8"}},"(List"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," sessions) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (sessions "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," sessions."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            sessions."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(session "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," startTime "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getStartTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," endTime "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getEndTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                String key "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," startTime "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    List<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> skuIds "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getRelationSkus"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(item "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," item."),p("span",{style:{color:"#B392F0"}},"getPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," item."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"())."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//缓存所有活动信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    redisTemplate."),p("span",{style:{color:"#B392F0"}},"opsForList"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"leftPushAll"),p("span",{style:{color:"#E1E4E8"}},"(key, skuIds);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t"),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"final"),p("span",{style:{color:"#24292E"}}," String SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"seckill:sessions:"'),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t"),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"saveSessionInfos"),p("span",{style:{color:"#24292E"}},"(List"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," sessions) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (sessions "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," sessions."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            sessions."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(session "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," startTime "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getStartTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," endTime "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getEndTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                String key "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," startTime "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    List<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> skuIds "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getRelationSkus"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(item "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," item."),p("span",{style:{color:"#6F42C1"}},"getPromotionSessionId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," item."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"())."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//缓存所有活动信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    redisTemplate."),p("span",{style:{color:"#6F42C1"}},"opsForList"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"leftPushAll"),p("span",{style:{color:"#24292E"}},"(key, skuIds);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])]),p("button",{class:"collapse"})],-1),Zo=p("ul",null,[p("li",null,"sku的详细信息及秒杀活动场次信息数据传输to")],-1),sn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long promotionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long promotionSessionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long skuId;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品秒杀随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String randomCode;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillPrice;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀总量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每人限购数量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillLimit;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 排序")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Integer seckillSort;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的开始时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long startTime;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的结束时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * sku的详细信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," SkuInfoVo skuInfoVo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long promotionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long promotionSessionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long skuId;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品秒杀随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String randomCode;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillPrice;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀总量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每人限购数量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillLimit;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 排序")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Integer seckillSort;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的开始时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long startTime;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的结束时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * sku的详细信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," SkuInfoVo skuInfoVo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),ln=p("ul",null,[p("li",null,"sku的详细信息数据传输vo")],-1),on=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SkuInfoVo"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long skuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * spuId")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long spuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * sku名称")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String skuName;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * sku介绍描述")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String skuDesc;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 所属分类id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long catalogId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 品牌id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long brandId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 默认图片")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String skuDefaultImg;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 标题")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String skuTitle;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 副标题")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String skuSubtitle;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal price;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 销量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long saleCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SkuInfoVo"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long skuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * spuId")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long spuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * sku名称")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String skuName;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * sku介绍描述")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String skuDesc;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 所属分类id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long catalogId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 品牌id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long brandId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 默认图片")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String skuDefaultImg;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 标题")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String skuTitle;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 副标题")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String skuSubtitle;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal price;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 销量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long saleCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),nn=p("ul",null,[p("li",null,"远程获取sku详细信息")],-1),an=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"FeignClient"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"gulimall-product"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"interface"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"ProductFeignService"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"RequestMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/product/skuinfo/info/{skuId}"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    R "),p("span",{style:{color:"#B392F0"}},"getSkuInfo"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"PathVariable"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuId"'),p("span",{style:{color:"#E1E4E8"}},") Long "),p("span",{style:{color:"#FFAB70"}},"skuId"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"FeignClient"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"gulimall-product"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"interface"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"ProductFeignService"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"RequestMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/product/skuinfo/info/{skuId}"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    R "),p("span",{style:{color:"#6F42C1"}},"getSkuInfo"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"PathVariable"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuId"'),p("span",{style:{color:"#24292E"}},") Long "),p("span",{style:{color:"#E36209"}},"skuId"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),en=p("ul",null,[p("li",null,"获取sku详细信息接口")],-1),cn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"   * 信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"   */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  @"),p("span",{style:{color:"#F97583"}},"RequestMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/info/{skuId}"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#6A737D"}},'//@RequiresPermissions("product:skuinfo:info")')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," R "),p("span",{style:{color:"#B392F0"}},"info"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"PathVariable"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuId"'),p("span",{style:{color:"#E1E4E8"}},") Long skuId){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"SkuInfoEntity skuInfo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," skuInfoService."),p("span",{style:{color:"#B392F0"}},"getById"),p("span",{style:{color:"#E1E4E8"}},"(skuId);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," R."),p("span",{style:{color:"#B392F0"}},"ok"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"put"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuInfo"'),p("span",{style:{color:"#E1E4E8"}},", skuInfo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"   * 信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"   */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  @"),p("span",{style:{color:"#D73A49"}},"RequestMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/info/{skuId}"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#6A737D"}},'//@RequiresPermissions("product:skuinfo:info")')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," R "),p("span",{style:{color:"#6F42C1"}},"info"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"PathVariable"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuId"'),p("span",{style:{color:"#24292E"}},") Long skuId){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"SkuInfoEntity skuInfo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," skuInfoService."),p("span",{style:{color:"#6F42C1"}},"getById"),p("span",{style:{color:"#24292E"}},"(skuId);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," R."),p("span",{style:{color:"#6F42C1"}},"ok"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"put"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuInfo"'),p("span",{style:{color:"#24292E"}},", skuInfo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  }")])])]),p("button",{class:"collapse"})],-1),tn={id:"_2、缓存活动的关联商品信息",tabindex:"-1"},pn=p("ul",null,[p("li",null,"引入redisson依赖使用分布式信号量")],-1),rn=p("div",{style:{"max-height":"300px"},class:"language-xml"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"xml"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"\x3c!--以后使用redisson作为所有分布式锁，分布式对象等功能框架 --\x3e")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"<"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">org.redisson</"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">redisson</"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"version"),p("span",{style:{color:"#E1E4E8"}},">3.12.0</"),p("span",{style:{color:"#85E89D"}},"version"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"</"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"\x3c!--以后使用redisson作为所有分布式锁，分布式对象等功能框架 --\x3e")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"<"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">org.redisson</"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">redisson</"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"version"),p("span",{style:{color:"#24292E"}},">3.12.0</"),p("span",{style:{color:"#22863A"}},"version"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"</"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")])])]),p("button",{class:"collapse"})],-1),En=p("ul",null,[p("li",null,"相关配置")],-1),yn=p("div",{style:{"max-height":"300px"},class:"language-properties"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"properties"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"spring.redis.host"),p("span",{style:{color:"#E1E4E8"}},"=192.168.10.103")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"spring.redis.host"),p("span",{style:{color:"#24292E"}},"=192.168.10.103")])])]),p("button",{class:"collapse"})],-1),un=p("ul",null,[p("li",null,"配置类")],-1),dn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/7")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MyRedissonConfig"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 所有对Redisson的使用都是通过RedissonClient对象")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@throws"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#B392F0"}},"IOException")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Bean"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"destroyMethod"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#9ECBFF"}},'"shutdown"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RedissonClient "),p("span",{style:{color:"#B392F0"}},"redisson"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," IOException {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、创建配置")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//Redis url should start with redis:// or rediss://")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Config config "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"Config"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        config."),p("span",{style:{color:"#B392F0"}},"useSingleServer"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"setAddress"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"redis://192.168.10.103:6379"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//2、根据config创建出Redisson实例")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        RedissonClient redissonClient "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Redisson."),p("span",{style:{color:"#B392F0"}},"create"),p("span",{style:{color:"#E1E4E8"}},"(config);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," redissonClient;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/7")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MyRedissonConfig"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 所有对Redisson的使用都是通过RedissonClient对象")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@throws"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#6F42C1"}},"IOException")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Bean"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"destroyMethod"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#032F62"}},'"shutdown"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RedissonClient "),p("span",{style:{color:"#6F42C1"}},"redisson"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," IOException {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、创建配置")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//Redis url should start with redis:// or rediss://")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Config config "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"Config"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        config."),p("span",{style:{color:"#6F42C1"}},"useSingleServer"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"setAddress"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"redis://192.168.10.103:6379"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//2、根据config创建出Redisson实例")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        RedissonClient redissonClient "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Redisson."),p("span",{style:{color:"#6F42C1"}},"create"),p("span",{style:{color:"#24292E"}},"(config);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," redissonClient;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Fn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"final"),p("span",{style:{color:"#E1E4E8"}}," String SKUKILL_CACHE_PREFOX "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"seckill:skus:"'),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"final"),p("span",{style:{color:"#E1E4E8"}}," String SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"seckill:stock:"'),p("span",{style:{color:"#E1E4E8"}},";"),p("span",{style:{color:"#6A737D"}},"//+商品随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"saveSessionSkuInfos"),p("span",{style:{color:"#E1E4E8"}},"(List"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," sessions) {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备hash操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    BoundHashOperations<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"Object"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"Object"),p("span",{style:{color:"#E1E4E8"}},"> ops "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"boundHashOps"),p("span",{style:{color:"#E1E4E8"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (sessions "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," sessions."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        sessions."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(session "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            String token "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," UUID."),p("span",{style:{color:"#B392F0"}},"randomUUID"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"replace"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"-"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            session."),p("span",{style:{color:"#B392F0"}},"getRelationSkus"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    SeckillSkuRedisTo redisTo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//1、sku的基本数据")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    R r "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," productFeignService."),p("span",{style:{color:"#B392F0"}},"getSkuInfo"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (r."),p("span",{style:{color:"#B392F0"}},"getCode"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#6A737D"}},"//远程调用成功")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        SkuInfoVo skuInfo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," r."),p("span",{style:{color:"#B392F0"}},"getData"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuInfo"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," TypeReference<"),p("span",{style:{color:"#F97583"}},"SkuInfoVo"),p("span",{style:{color:"#E1E4E8"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        redisTo."),p("span",{style:{color:"#B392F0"}},"setSkuInfoVo"),p("span",{style:{color:"#E1E4E8"}},"(skuInfo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//2、sku的秒杀信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    BeanUtils."),p("span",{style:{color:"#B392F0"}},"copyProperties"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo, redisTo);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//3、设置上当前商品的秒杀时间信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    redisTo."),p("span",{style:{color:"#B392F0"}},"setStartTime"),p("span",{style:{color:"#E1E4E8"}},"(session."),p("span",{style:{color:"#B392F0"}},"getStartTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    redisTo."),p("span",{style:{color:"#B392F0"}},"setEndTime"),p("span",{style:{color:"#E1E4E8"}},"(session."),p("span",{style:{color:"#B392F0"}},"getEndTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//4、随机码   seckill?skuId=1&key=fewqfwrgvrw")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    redisTo."),p("span",{style:{color:"#B392F0"}},"setRandomCode"),p("span",{style:{color:"#E1E4E8"}},"(token);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    String jsonString "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," JSON."),p("span",{style:{color:"#B392F0"}},"toJSONString"),p("span",{style:{color:"#E1E4E8"}},"(redisTo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ops."),p("span",{style:{color:"#B392F0"}},"put"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"(), jsonString);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//秒杀请求进来先获取信号量，获取不到就无法执行数据库的所有方法了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//如果当前这个场次的商品的库存信息已经上架就不需要上架")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//5、使用库存作为分布式的信号量 -> 限流；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    RSemaphore semaphore "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redissonClient."),p("span",{style:{color:"#B392F0"}},"getSemaphore"),p("span",{style:{color:"#E1E4E8"}},"(SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," token);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//商品可以秒杀的数量作为信号量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    semaphore."),p("span",{style:{color:"#B392F0"}},"trySetPermits"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSeckillCount"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"intValue"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"final"),p("span",{style:{color:"#24292E"}}," String SKUKILL_CACHE_PREFOX "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"seckill:skus:"'),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"final"),p("span",{style:{color:"#24292E"}}," String SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"seckill:stock:"'),p("span",{style:{color:"#24292E"}},";"),p("span",{style:{color:"#6A737D"}},"//+商品随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"saveSessionSkuInfos"),p("span",{style:{color:"#24292E"}},"(List"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," sessions) {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备hash操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    BoundHashOperations<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"Object"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"Object"),p("span",{style:{color:"#24292E"}},"> ops "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"boundHashOps"),p("span",{style:{color:"#24292E"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (sessions "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," sessions."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        sessions."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(session "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            String token "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," UUID."),p("span",{style:{color:"#6F42C1"}},"randomUUID"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"replace"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"-"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            session."),p("span",{style:{color:"#6F42C1"}},"getRelationSkus"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    SeckillSkuRedisTo redisTo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//1、sku的基本数据")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    R r "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," productFeignService."),p("span",{style:{color:"#6F42C1"}},"getSkuInfo"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (r."),p("span",{style:{color:"#6F42C1"}},"getCode"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#6A737D"}},"//远程调用成功")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        SkuInfoVo skuInfo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," r."),p("span",{style:{color:"#6F42C1"}},"getData"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuInfo"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," TypeReference<"),p("span",{style:{color:"#D73A49"}},"SkuInfoVo"),p("span",{style:{color:"#24292E"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        redisTo."),p("span",{style:{color:"#6F42C1"}},"setSkuInfoVo"),p("span",{style:{color:"#24292E"}},"(skuInfo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//2、sku的秒杀信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    BeanUtils."),p("span",{style:{color:"#6F42C1"}},"copyProperties"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo, redisTo);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//3、设置上当前商品的秒杀时间信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    redisTo."),p("span",{style:{color:"#6F42C1"}},"setStartTime"),p("span",{style:{color:"#24292E"}},"(session."),p("span",{style:{color:"#6F42C1"}},"getStartTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    redisTo."),p("span",{style:{color:"#6F42C1"}},"setEndTime"),p("span",{style:{color:"#24292E"}},"(session."),p("span",{style:{color:"#6F42C1"}},"getEndTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//4、随机码   seckill?skuId=1&key=fewqfwrgvrw")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    redisTo."),p("span",{style:{color:"#6F42C1"}},"setRandomCode"),p("span",{style:{color:"#24292E"}},"(token);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    String jsonString "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," JSON."),p("span",{style:{color:"#6F42C1"}},"toJSONString"),p("span",{style:{color:"#24292E"}},"(redisTo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ops."),p("span",{style:{color:"#6F42C1"}},"put"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getPromotionSessionId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"(), jsonString);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//秒杀请求进来先获取信号量，获取不到就无法执行数据库的所有方法了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//如果当前这个场次的商品的库存信息已经上架就不需要上架")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//5、使用库存作为分布式的信号量 -> 限流；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    RSemaphore semaphore "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redissonClient."),p("span",{style:{color:"#6F42C1"}},"getSemaphore"),p("span",{style:{color:"#24292E"}},"(SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," token);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//商品可以秒杀的数量作为信号量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    semaphore."),p("span",{style:{color:"#6F42C1"}},"trySetPermits"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSeckillCount"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"intValue"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),gn=p("ul",null,[p("li",null,"修改上架时间")],-1),Dn=p("figure",null,[p("img",{alt:"image-20230430145943910",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430145943910.png"})],-1),An=p("figure",null,[p("img",{alt:"image-20230430150003699",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430150003699.png"})],-1),kn=p("ul",null,[p("li",null,"未做幂等性处理出现重复上架情况")],-1),mn=p("figure",null,[p("img",{alt:"image-20230430150132974",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430150132974.png"})],-1),hn=p("ul",null,[p("li",null,"活动信息收集的是我们的skuId不是活动记录id")],-1),Sn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"List<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> skuIds "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getRelationSkus"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(item "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," item."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"())."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"List<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> skuIds "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getRelationSkus"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(item "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," item."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"())."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")])])]),p("button",{class:"collapse"})],-1),Cn=p("figure",null,[p("img",{alt:"image-20230430150728958",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430150728958.png"})],-1),bn=p("ul",null,[p("li",null,"活动的关联商品信息key也为skuId")],-1),Bn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"ops."),p("span",{style:{color:"#B392F0"}},"put"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"(), jsonString);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"ops."),p("span",{style:{color:"#6F42C1"}},"put"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"(), jsonString);")])])]),p("button",{class:"collapse"})],-1),vn={id:"分布式定时任务",tabindex:"-1"},fn={id:"_1-定时任务的问题",tabindex:"-1"},In=p("figure",null,[p("img",{alt:"image-20230429224924881",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429224924881.png"})],-1),_n=p("ul",null,[p("li",null,[p("p",null,"1）、同时执行导致的重复"),p("ul",null,[p("li",null,"由于同样的服务会部署多个节点，多个节点的定时任务代码可能同时启动。将同样的事情做了多次使用分布式锁。")])]),p("li",null,[p("p",null,"2）、任务拆分并发执行"),p("ul",null,[p("li",null,"使用 ElasticJob")])])],-1),Tn={id:"_2-扩展-分布式调整",tabindex:"-1"},Ln={id:"_3-3-幂等性保证",tabindex:"-1"},xn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  * 秒杀商品的定时上架；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      每天晚上3点；上架最近三天需要秒杀的商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      当天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      明天天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      后天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/27")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Service")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuScheduled"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SeckillService seckillService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    RedissonClient redissonClient;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"final"),p("span",{style:{color:"#E1E4E8"}}," String UPLOAD_LOCK "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"seckill:upload:lock"'),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * todo 幂等性处理")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//     @Scheduled(cron = "*/5 * * * * ? ")')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Scheduled"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"cron"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"0 0 1/1 * * ? "'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、重复上架无需处理")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"info"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上架秒杀的商品信息..."'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//分布式锁。锁的业务执行完成，状态已经更新完成，释放锁以后，其他人获取到就会拿到最新的状态")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        RLock lock "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redissonClient."),p("span",{style:{color:"#B392F0"}},"getLock"),p("span",{style:{color:"#E1E4E8"}},"(UPLOAD_LOCK);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        lock."),p("span",{style:{color:"#B392F0"}},"lock"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"10"),p("span",{style:{color:"#E1E4E8"}},", TimeUnit.SECONDS);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            seckillService."),p("span",{style:{color:"#B392F0"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        } "),p("span",{style:{color:"#F97583"}},"finally"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            lock."),p("span",{style:{color:"#B392F0"}},"unlock"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  * 秒杀商品的定时上架；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      每天晚上3点；上架最近三天需要秒杀的商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      当天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      明天天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," *  *      后天00:00:00 - 23:59:59")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/27")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Service")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuScheduled"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SeckillService seckillService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    RedissonClient redissonClient;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"final"),p("span",{style:{color:"#24292E"}}," String UPLOAD_LOCK "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"seckill:upload:lock"'),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * todo 幂等性处理")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//     @Scheduled(cron = "*/5 * * * * ? ")')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Scheduled"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"cron"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"0 0 1/1 * * ? "'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、重复上架无需处理")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"info"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上架秒杀的商品信息..."'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//分布式锁。锁的业务执行完成，状态已经更新完成，释放锁以后，其他人获取到就会拿到最新的状态")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        RLock lock "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redissonClient."),p("span",{style:{color:"#6F42C1"}},"getLock"),p("span",{style:{color:"#24292E"}},"(UPLOAD_LOCK);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        lock."),p("span",{style:{color:"#6F42C1"}},"lock"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"10"),p("span",{style:{color:"#24292E"}},", TimeUnit.SECONDS);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            seckillService."),p("span",{style:{color:"#6F42C1"}},"uploadSeckillSkuLatest3Days"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        } "),p("span",{style:{color:"#D73A49"}},"finally"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            lock."),p("span",{style:{color:"#6F42C1"}},"unlock"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Rn=p("ul",null,[p("li",null,"完善缓存活动信息方法")],-1),On=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"saveSessionInfos"),p("span",{style:{color:"#E1E4E8"}},"(List"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," sessions) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (sessions "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," sessions."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        sessions."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(session "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," startTime "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getStartTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," endTime "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getEndTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            String key "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," startTime "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            Boolean hasKey "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"hasKey"),p("span",{style:{color:"#E1E4E8"}},"(key);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"hasKey) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                List<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> skuIds "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," session."),p("span",{style:{color:"#B392F0"}},"getRelationSkus"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(item "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," item."),p("span",{style:{color:"#B392F0"}},"getPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," item."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"())."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//缓存所有活动信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                redisTemplate."),p("span",{style:{color:"#B392F0"}},"opsForList"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"leftPushAll"),p("span",{style:{color:"#E1E4E8"}},"(key, skuIds);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"saveSessionInfos"),p("span",{style:{color:"#24292E"}},"(List"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," sessions) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (sessions "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," sessions."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        sessions."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(session "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," startTime "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getStartTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," endTime "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getEndTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            String key "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," startTime "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            Boolean hasKey "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"hasKey"),p("span",{style:{color:"#24292E"}},"(key);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"hasKey) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                List<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> skuIds "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," session."),p("span",{style:{color:"#6F42C1"}},"getRelationSkus"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(item "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," item."),p("span",{style:{color:"#6F42C1"}},"getPromotionSessionId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," item."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"())."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//缓存所有活动信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                redisTemplate."),p("span",{style:{color:"#6F42C1"}},"opsForList"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"leftPushAll"),p("span",{style:{color:"#24292E"}},"(key, skuIds);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),jn=p("ul",null,[p("li",null,"完善缓存活动的关联商品信息")],-1),Pn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"saveSessionSkuInfos"),p("span",{style:{color:"#E1E4E8"}},"(List"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," sessions) {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备hash操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    BoundHashOperations<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"Object"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"Object"),p("span",{style:{color:"#E1E4E8"}},"> ops "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"boundHashOps"),p("span",{style:{color:"#E1E4E8"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (sessions "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," sessions."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        sessions."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(session "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            String token "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," UUID."),p("span",{style:{color:"#B392F0"}},"randomUUID"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"replace"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"-"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            session."),p("span",{style:{color:"#B392F0"}},"getRelationSkus"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"ops."),p("span",{style:{color:"#B392F0"}},"hasKey"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"())) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    SeckillSkuRedisTo redisTo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//1、sku的基本数据")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    R r "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," productFeignService."),p("span",{style:{color:"#B392F0"}},"getSkuInfo"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (r."),p("span",{style:{color:"#B392F0"}},"getCode"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#6A737D"}},"//远程调用成功")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        SkuInfoVo skuInfo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," r."),p("span",{style:{color:"#B392F0"}},"getData"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuInfo"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," TypeReference<"),p("span",{style:{color:"#F97583"}},"SkuInfoVo"),p("span",{style:{color:"#E1E4E8"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        redisTo."),p("span",{style:{color:"#B392F0"}},"setSkuInfoVo"),p("span",{style:{color:"#E1E4E8"}},"(skuInfo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//2、sku的秒杀信息 vo->to")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    BeanUtils."),p("span",{style:{color:"#B392F0"}},"copyProperties"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo, redisTo);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//3、设置上当前商品的秒杀时间信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    redisTo."),p("span",{style:{color:"#B392F0"}},"setStartTime"),p("span",{style:{color:"#E1E4E8"}},"(session."),p("span",{style:{color:"#B392F0"}},"getStartTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    redisTo."),p("span",{style:{color:"#B392F0"}},"setEndTime"),p("span",{style:{color:"#E1E4E8"}},"(session."),p("span",{style:{color:"#B392F0"}},"getEndTime"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getTime"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//4、随机码   seckill?skuId=1&key=fewqfwrgvrw")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    redisTo."),p("span",{style:{color:"#B392F0"}},"setRandomCode"),p("span",{style:{color:"#E1E4E8"}},"(token);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    String jsonString "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," JSON."),p("span",{style:{color:"#B392F0"}},"toJSONString"),p("span",{style:{color:"#E1E4E8"}},"(redisTo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ops."),p("span",{style:{color:"#B392F0"}},"put"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"(), jsonString);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//秒杀请求进来先获取信号量，获取不到就无法执行数据库的所有方法了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//如果当前这个场次的商品的库存信息已经上架就不需要上架")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//5、使用库存作为分布式的信号量 -> 限流；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    RSemaphore semaphore "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redissonClient."),p("span",{style:{color:"#B392F0"}},"getSemaphore"),p("span",{style:{color:"#E1E4E8"}},"(SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," token);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//商品可以秒杀的数量作为信号量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    semaphore."),p("span",{style:{color:"#B392F0"}},"trySetPermits"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuVo."),p("span",{style:{color:"#B392F0"}},"getSeckillCount"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"intValue"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"saveSessionSkuInfos"),p("span",{style:{color:"#24292E"}},"(List"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"SeckillSessionWithSkus"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," sessions) {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备hash操作")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    BoundHashOperations<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"Object"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"Object"),p("span",{style:{color:"#24292E"}},"> ops "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"boundHashOps"),p("span",{style:{color:"#24292E"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (sessions "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," sessions."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        sessions."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(session "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            String token "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," UUID."),p("span",{style:{color:"#6F42C1"}},"randomUUID"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"replace"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"-"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            session."),p("span",{style:{color:"#6F42C1"}},"getRelationSkus"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"ops."),p("span",{style:{color:"#6F42C1"}},"hasKey"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getPromotionSessionId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"())) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//key不存在进行缓存商品")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    SeckillSkuRedisTo redisTo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//1、sku的基本数据")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    R r "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," productFeignService."),p("span",{style:{color:"#6F42C1"}},"getSkuInfo"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (r."),p("span",{style:{color:"#6F42C1"}},"getCode"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#6A737D"}},"//远程调用成功")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        SkuInfoVo skuInfo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," r."),p("span",{style:{color:"#6F42C1"}},"getData"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuInfo"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," TypeReference<"),p("span",{style:{color:"#D73A49"}},"SkuInfoVo"),p("span",{style:{color:"#24292E"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        redisTo."),p("span",{style:{color:"#6F42C1"}},"setSkuInfoVo"),p("span",{style:{color:"#24292E"}},"(skuInfo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//2、sku的秒杀信息 vo->to")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    BeanUtils."),p("span",{style:{color:"#6F42C1"}},"copyProperties"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo, redisTo);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//3、设置上当前商品的秒杀时间信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    redisTo."),p("span",{style:{color:"#6F42C1"}},"setStartTime"),p("span",{style:{color:"#24292E"}},"(session."),p("span",{style:{color:"#6F42C1"}},"getStartTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    redisTo."),p("span",{style:{color:"#6F42C1"}},"setEndTime"),p("span",{style:{color:"#24292E"}},"(session."),p("span",{style:{color:"#6F42C1"}},"getEndTime"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getTime"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//4、随机码   seckill?skuId=1&key=fewqfwrgvrw")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    redisTo."),p("span",{style:{color:"#6F42C1"}},"setRandomCode"),p("span",{style:{color:"#24292E"}},"(token);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    String jsonString "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," JSON."),p("span",{style:{color:"#6F42C1"}},"toJSONString"),p("span",{style:{color:"#24292E"}},"(redisTo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ops."),p("span",{style:{color:"#6F42C1"}},"put"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getPromotionSessionId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"(), jsonString);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//秒杀请求进来先获取信号量，获取不到就无法执行数据库的所有方法了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//如果当前这个场次的商品的库存信息已经上架就不需要上架")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//5、使用库存作为分布式的信号量 -> 限流；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    RSemaphore semaphore "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redissonClient."),p("span",{style:{color:"#6F42C1"}},"getSemaphore"),p("span",{style:{color:"#24292E"}},"(SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," token);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//商品可以秒杀的数量作为信号量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    semaphore."),p("span",{style:{color:"#6F42C1"}},"trySetPermits"),p("span",{style:{color:"#24292E"}},"(seckillSkuVo."),p("span",{style:{color:"#6F42C1"}},"getSeckillCount"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"intValue"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Kn={id:"_3-4-查询秒杀商品-页面渲染",tabindex:"-1"},qn=p("ul",null,[p("li",null,"返回当前时间可以参与的秒杀商品信息接口")],-1),wn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Controller")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillController"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SeckillService seckillService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 返回当前时间可以参与的秒杀商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"ResponseBody")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"GetMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/currentSeckillSkus"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," R "),p("span",{style:{color:"#B392F0"}},"getCurrentSeckillSkus"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        List<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#E1E4E8"}},"> tos "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillService."),p("span",{style:{color:"#B392F0"}},"getCurrentSeckillSkus"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," R."),p("span",{style:{color:"#B392F0"}},"ok"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"setData"),p("span",{style:{color:"#E1E4E8"}},"(tos);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Controller")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillController"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SeckillService seckillService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 返回当前时间可以参与的秒杀商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"ResponseBody")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"GetMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/currentSeckillSkus"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," R "),p("span",{style:{color:"#6F42C1"}},"getCurrentSeckillSkus"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        List<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#24292E"}},"> tos "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillService."),p("span",{style:{color:"#6F42C1"}},"getCurrentSeckillSkus"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," R."),p("span",{style:{color:"#6F42C1"}},"ok"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"setData"),p("span",{style:{color:"#24292E"}},"(tos);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])]),p("button",{class:"collapse"})],-1),zn=p("ul",null,[p("li",null,"返回当前时间可以参与的秒杀商品信息方法实现")],-1),Mn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 返回当前时间可以参与的秒杀商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," List"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getCurrentSeckillSkus"),p("span",{style:{color:"#E1E4E8"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、确定当前时间属于哪个秒杀场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," time "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," System."),p("span",{style:{color:"#B392F0"}},"currentTimeMillis"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Set<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> keys "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"keys"),p("span",{style:{color:"#E1E4E8"}},"(SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"*"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"for"),p("span",{style:{color:"#E1E4E8"}}," (String key "),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," keys) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//seckill:sessions:1664301600000_1664305200000->1664301600000_1664305200000")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            String replace "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," key."),p("span",{style:{color:"#B392F0"}},"replace"),p("span",{style:{color:"#E1E4E8"}},"(SESSIONS_CACHE_PREFOX, "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//[1664301600000 _ 1664305200000]")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//        0             1")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"[] s "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," replace."),p("span",{style:{color:"#B392F0"}},"split"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            Long start "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Long."),p("span",{style:{color:"#B392F0"}},"parseLong"),p("span",{style:{color:"#E1E4E8"}},"(s["),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},"]);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            Long end "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Long."),p("span",{style:{color:"#B392F0"}},"parseLong"),p("span",{style:{color:"#E1E4E8"}},"(s["),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},"]);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (time "),p("span",{style:{color:"#F97583"}},">="),p("span",{style:{color:"#E1E4E8"}}," start "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," time "),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#E1E4E8"}}," end) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//当前时间在秒杀时间范围内")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//2、获取这个秒杀场次需要的所有商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                List<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> range "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"opsForList"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"range"),p("span",{style:{color:"#E1E4E8"}},"(key, "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"100"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"100"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                BoundHashOperations<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> hashOps "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"boundHashOps"),p("span",{style:{color:"#E1E4E8"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"assert"),p("span",{style:{color:"#E1E4E8"}}," range "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                List<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> list "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," hashOps."),p("span",{style:{color:"#B392F0"}},"multiGet"),p("span",{style:{color:"#E1E4E8"}},"(range);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (list "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," list."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    List<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#E1E4E8"}},"> collect "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," list."),p("span",{style:{color:"#B392F0"}},"stream"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(item "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        SeckillSkuRedisTo skuRedisTo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," JSON."),p("span",{style:{color:"#B392F0"}},"parseObject"),p("span",{style:{color:"#E1E4E8"}},"((String) item, SeckillSkuRedisTo.class);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//                        skuRedisTo.setRandomCode(null);当前秒杀开始就需要随机码")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," skuRedisTo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    })."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," collect;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"break"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 返回当前时间可以参与的秒杀商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," List"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getCurrentSeckillSkus"),p("span",{style:{color:"#24292E"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、确定当前时间属于哪个秒杀场次")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," time "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," System."),p("span",{style:{color:"#6F42C1"}},"currentTimeMillis"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Set<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> keys "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"keys"),p("span",{style:{color:"#24292E"}},"(SESSIONS_CACHE_PREFOX "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"*"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"for"),p("span",{style:{color:"#24292E"}}," (String key "),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," keys) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//seckill:sessions:1664301600000_1664305200000->1664301600000_1664305200000")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            String replace "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," key."),p("span",{style:{color:"#6F42C1"}},"replace"),p("span",{style:{color:"#24292E"}},"(SESSIONS_CACHE_PREFOX, "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//[1664301600000 _ 1664305200000]")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//        0             1")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"[] s "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," replace."),p("span",{style:{color:"#6F42C1"}},"split"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            Long start "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Long."),p("span",{style:{color:"#6F42C1"}},"parseLong"),p("span",{style:{color:"#24292E"}},"(s["),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},"]);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            Long end "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Long."),p("span",{style:{color:"#6F42C1"}},"parseLong"),p("span",{style:{color:"#24292E"}},"(s["),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},"]);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (time "),p("span",{style:{color:"#D73A49"}},">="),p("span",{style:{color:"#24292E"}}," start "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," time "),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#24292E"}}," end) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//当前时间在秒杀时间范围内")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//2、获取这个秒杀场次需要的所有商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                List<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> range "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"opsForList"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"range"),p("span",{style:{color:"#24292E"}},"(key, "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"100"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"100"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                BoundHashOperations<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> hashOps "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"boundHashOps"),p("span",{style:{color:"#24292E"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"assert"),p("span",{style:{color:"#24292E"}}," range "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                List<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> list "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," hashOps."),p("span",{style:{color:"#6F42C1"}},"multiGet"),p("span",{style:{color:"#24292E"}},"(range);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (list "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," list."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    List<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#24292E"}},"> collect "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," list."),p("span",{style:{color:"#6F42C1"}},"stream"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(item "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        SeckillSkuRedisTo skuRedisTo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," JSON."),p("span",{style:{color:"#6F42C1"}},"parseObject"),p("span",{style:{color:"#24292E"}},"((String) item, SeckillSkuRedisTo.class);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//                        skuRedisTo.setRandomCode(null);当前秒杀开始就需要随机码")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," skuRedisTo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    })."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," collect;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"break"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])]),p("button",{class:"collapse"})],-1),Vn=p("figure",null,[p("img",{alt:"image-20230430152815352",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430152815352.png"})],-1),Un=p("figure",null,[p("img",{alt:"image-20230428202232121",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428202232121.png"})],-1),Nn=p("ul",null,[p("li",null,"商品服务远程查询秒杀信息"),p("li",null,"远程接口")],-1),Hn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"FeignClient"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"gulimall-seckill"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"fallback"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," SeckillFeignServiceFallBack.class )")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"interface"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillFeignService"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"GetMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/sku/seckill/{skuId}"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    R "),p("span",{style:{color:"#B392F0"}},"getSkuSeckillInfo"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"PathVariable"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuId"'),p("span",{style:{color:"#E1E4E8"}},")Long "),p("span",{style:{color:"#FFAB70"}},"skuId"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"FeignClient"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"gulimall-seckill"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"fallback"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," SeckillFeignServiceFallBack.class )")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"interface"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillFeignService"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"GetMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/sku/seckill/{skuId}"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    R "),p("span",{style:{color:"#6F42C1"}},"getSkuSeckillInfo"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"PathVariable"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuId"'),p("span",{style:{color:"#24292E"}},")Long "),p("span",{style:{color:"#E36209"}},"skuId"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Wn=p("ul",null,[p("li",null,"获取秒杀信息接口")],-1),Xn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ResponseBody")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"GetMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/sku/seckill/{skuId}"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," R "),p("span",{style:{color:"#B392F0"}},"getSkuSeckillInfo"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"PathVariable"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuId"'),p("span",{style:{color:"#E1E4E8"}},")Long skuId){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SeckillSkuRedisTo to "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillService."),p("span",{style:{color:"#B392F0"}},"getSkuSeckillInfo"),p("span",{style:{color:"#E1E4E8"}},"(skuId);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," R."),p("span",{style:{color:"#B392F0"}},"ok"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"setData"),p("span",{style:{color:"#E1E4E8"}},"(to);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ResponseBody")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"GetMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/sku/seckill/{skuId}"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," R "),p("span",{style:{color:"#6F42C1"}},"getSkuSeckillInfo"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"PathVariable"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuId"'),p("span",{style:{color:"#24292E"}},")Long skuId){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SeckillSkuRedisTo to "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillService."),p("span",{style:{color:"#6F42C1"}},"getSkuSeckillInfo"),p("span",{style:{color:"#24292E"}},"(skuId);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," R."),p("span",{style:{color:"#6F42C1"}},"ok"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"setData"),p("span",{style:{color:"#24292E"}},"(to);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Jn=p("ul",null,[p("li",null,"获取秒杀信息方法实现（正则匹配BUG已修复）")],-1),Qn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," SeckillSkuRedisTo "),p("span",{style:{color:"#B392F0"}},"getSkuSeckillInfo"),p("span",{style:{color:"#E1E4E8"}},"(Long skuId) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、找到所有需要参与秒杀的商品的key")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        BoundHashOperations<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> hashOps "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"boundHashOps"),p("span",{style:{color:"#E1E4E8"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Set<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> keys "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," hashOps."),p("span",{style:{color:"#B392F0"}},"keys"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (keys "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," keys."),p("span",{style:{color:"#B392F0"}},"size"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//todo 正则匹配2位数")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            String regx "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"d"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'d_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," skuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//创建匹配模式")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//            Pattern pattern = Pattern.compile("\\\\d_");//匹配一个或多个数字字符')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//2.选择匹配对象")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            Matcher matcher = pattern.matcher(skuId.toString());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"for"),p("span",{style:{color:"#E1E4E8"}}," (String key "),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," keys) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                log."),p("span",{style:{color:"#B392F0"}},"info"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"test:{}"'),p("span",{style:{color:"#E1E4E8"}},",  Pattern."),p("span",{style:{color:"#B392F0"}},"matches"),p("span",{style:{color:"#E1E4E8"}},"(regx, key));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"// 6_4")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (Pattern."),p("span",{style:{color:"#B392F0"}},"matches"),p("span",{style:{color:"#E1E4E8"}},"(regx, key)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//                if (regx.matches(key)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//                if (matcher.find()) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    String json "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," hashOps."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"(key);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    SeckillSkuRedisTo skuRedisTo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," JSON."),p("span",{style:{color:"#B392F0"}},"parseObject"),p("span",{style:{color:"#E1E4E8"}},"(json, SeckillSkuRedisTo.class);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//处理随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," current "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," System."),p("span",{style:{color:"#B392F0"}},"currentTimeMillis"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (current "),p("span",{style:{color:"#F97583"}},">="),p("span",{style:{color:"#E1E4E8"}}," skuRedisTo."),p("span",{style:{color:"#B392F0"}},"getStartTime"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," current "),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#E1E4E8"}}," skuRedisTo."),p("span",{style:{color:"#B392F0"}},"getEndTime"),p("span",{style:{color:"#E1E4E8"}},"()) {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    } "),p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#6A737D"}},"//在时间范围外直接置空")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        skuRedisTo."),p("span",{style:{color:"#B392F0"}},"setRandomCode"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," skuRedisTo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," SeckillSkuRedisTo "),p("span",{style:{color:"#6F42C1"}},"getSkuSeckillInfo"),p("span",{style:{color:"#24292E"}},"(Long skuId) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、找到所有需要参与秒杀的商品的key")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        BoundHashOperations<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> hashOps "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"boundHashOps"),p("span",{style:{color:"#24292E"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Set<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> keys "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," hashOps."),p("span",{style:{color:"#6F42C1"}},"keys"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (keys "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," keys."),p("span",{style:{color:"#6F42C1"}},"size"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//todo 正则匹配2位数")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            String regx "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"d"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'d_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," skuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//创建匹配模式")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//            Pattern pattern = Pattern.compile("\\\\d_");//匹配一个或多个数字字符')]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//2.选择匹配对象")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            Matcher matcher = pattern.matcher(skuId.toString());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"for"),p("span",{style:{color:"#24292E"}}," (String key "),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," keys) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                log."),p("span",{style:{color:"#6F42C1"}},"info"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"test:{}"'),p("span",{style:{color:"#24292E"}},",  Pattern."),p("span",{style:{color:"#6F42C1"}},"matches"),p("span",{style:{color:"#24292E"}},"(regx, key));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"// 6_4")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (Pattern."),p("span",{style:{color:"#6F42C1"}},"matches"),p("span",{style:{color:"#24292E"}},"(regx, key)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//                if (regx.matches(key)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//                if (matcher.find()) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    String json "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," hashOps."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"(key);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    SeckillSkuRedisTo skuRedisTo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," JSON."),p("span",{style:{color:"#6F42C1"}},"parseObject"),p("span",{style:{color:"#24292E"}},"(json, SeckillSkuRedisTo.class);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//处理随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," current "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," System."),p("span",{style:{color:"#6F42C1"}},"currentTimeMillis"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (current "),p("span",{style:{color:"#D73A49"}},">="),p("span",{style:{color:"#24292E"}}," skuRedisTo."),p("span",{style:{color:"#6F42C1"}},"getStartTime"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," current "),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#24292E"}}," skuRedisTo."),p("span",{style:{color:"#6F42C1"}},"getEndTime"),p("span",{style:{color:"#24292E"}},"()) {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    } "),p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#6A737D"}},"//在时间范围外直接置空")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        skuRedisTo."),p("span",{style:{color:"#6F42C1"}},"setRandomCode"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," skuRedisTo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])]),p("button",{class:"collapse"})],-1),Gn=p("ul",null,[p("li",null,"sku详情页获取商品（秒杀）详情接口")],-1),$n=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 展示当前sku的详情")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"skuId")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"GetMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/{skuId}.html"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"skuItem"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"PathVariable"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"skuId"'),p("span",{style:{color:"#E1E4E8"}},")Long skuId, Model model) throws ExecutionException, InterruptedException {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"准备查询"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," skuId "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"详情"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SkuItemVo vo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," skuInfoService."),p("span",{style:{color:"#B392F0"}},"item"),p("span",{style:{color:"#E1E4E8"}},"(skuId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//页面渲染")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    model."),p("span",{style:{color:"#B392F0"}},"addAttribute"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"item"'),p("span",{style:{color:"#E1E4E8"}},", vo);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"item"'),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 展示当前sku的详情")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"skuId")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"GetMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/{skuId}.html"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"skuItem"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"PathVariable"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"skuId"'),p("span",{style:{color:"#24292E"}},")Long skuId, Model model) throws ExecutionException, InterruptedException {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"准备查询"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," skuId "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"详情"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SkuItemVo vo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," skuInfoService."),p("span",{style:{color:"#6F42C1"}},"item"),p("span",{style:{color:"#24292E"}},"(skuId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//页面渲染")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    model."),p("span",{style:{color:"#6F42C1"}},"addAttribute"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"item"'),p("span",{style:{color:"#24292E"}},", vo);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"item"'),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Yn=p("ul",null,[p("li",null,[p("p",null,"获取商品（秒杀）详情方法实现"),p("ul",null,[p("li",null,"秒杀详情数据传输vo")]),p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillInfoVo"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long promotionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long promotionSessionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long skuId;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品秒杀随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String randomCode;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillPrice;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀总量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每人限购数量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillLimit;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 排序")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Integer seckillSort;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的开始时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long startTime;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的结束时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillInfoVo"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long promotionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 活动场次id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long promotionSessionId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long skuId;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 商品秒杀随机码")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String randomCode;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀价格")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillPrice;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀总量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillCount;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 每人限购数量")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillLimit;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 排序")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Integer seckillSort;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的开始时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long startTime;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 当前商品秒杀的结束时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long endTime;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})])])],-1),Zn=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t@"),p("span",{style:{color:"#F97583"}},"Resource")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SeckillFeignService seckillFeignService;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t@"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," SkuItemVo "),p("span",{style:{color:"#B392F0"}},"item"),p("span",{style:{color:"#E1E4E8"}},"(Long skuId) throws ExecutionException, InterruptedException {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        SkuItemVo skuItemVo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SkuItemVo"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        ......")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        CompletableFuture<"),p("span",{style:{color:"#F97583"}},"Void"),p("span",{style:{color:"#E1E4E8"}},"> seckillFuture "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," CompletableFuture."),p("span",{style:{color:"#B392F0"}},"runAsync"),p("span",{style:{color:"#E1E4E8"}},"(() "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"// 秒杀信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            R r "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillFeignService."),p("span",{style:{color:"#B392F0"}},"getSkuSeckillInfo"),p("span",{style:{color:"#E1E4E8"}},"(skuId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (r."),p("span",{style:{color:"#B392F0"}},"getCode"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//远程调用成功")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                SeckillInfoVo data "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," r."),p("span",{style:{color:"#B392F0"}},"getData"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," TypeReference<"),p("span",{style:{color:"#F97583"}},"SeckillInfoVo"),p("span",{style:{color:"#E1E4E8"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (data "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    skuItemVo."),p("span",{style:{color:"#B392F0"}},"setSeckillInfo"),p("span",{style:{color:"#E1E4E8"}},"(data);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }, productThreadPoolExecutor);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//等待所有的任务都完成")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        CompletableFuture."),p("span",{style:{color:"#B392F0"}},"allOf"),p("span",{style:{color:"#E1E4E8"}},"(saleAttrFuture, descFuture, baseAttrFuture, imageFuture, seckillFuture)."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," skuItemVo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t@"),p("span",{style:{color:"#D73A49"}},"Resource")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SeckillFeignService seckillFeignService;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t@"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," SkuItemVo "),p("span",{style:{color:"#6F42C1"}},"item"),p("span",{style:{color:"#24292E"}},"(Long skuId) throws ExecutionException, InterruptedException {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        SkuItemVo skuItemVo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SkuItemVo"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        ......")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        CompletableFuture<"),p("span",{style:{color:"#D73A49"}},"Void"),p("span",{style:{color:"#24292E"}},"> seckillFuture "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," CompletableFuture."),p("span",{style:{color:"#6F42C1"}},"runAsync"),p("span",{style:{color:"#24292E"}},"(() "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"// 秒杀信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            R r "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillFeignService."),p("span",{style:{color:"#6F42C1"}},"getSkuSeckillInfo"),p("span",{style:{color:"#24292E"}},"(skuId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (r."),p("span",{style:{color:"#6F42C1"}},"getCode"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//远程调用成功")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                SeckillInfoVo data "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," r."),p("span",{style:{color:"#6F42C1"}},"getData"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," TypeReference<"),p("span",{style:{color:"#D73A49"}},"SeckillInfoVo"),p("span",{style:{color:"#24292E"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (data "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    skuItemVo."),p("span",{style:{color:"#6F42C1"}},"setSeckillInfo"),p("span",{style:{color:"#24292E"}},"(data);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }, productThreadPoolExecutor);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//等待所有的任务都完成")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        CompletableFuture."),p("span",{style:{color:"#6F42C1"}},"allOf"),p("span",{style:{color:"#24292E"}},"(saleAttrFuture, descFuture, baseAttrFuture, imageFuture, seckillFuture)."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," skuItemVo;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])]),p("button",{class:"collapse"})],-1),sa=p("figure",null,[p("img",{alt:"image-20230428202310827",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428202310827.png"})],-1),la=p("figure",null,[p("img",{alt:"image-20230428202403297",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428202403297.png"})],-1),oa={id:"_3-5-秒杀系统设计",tabindex:"-1"},na=p("figure",null,[p("img",{alt:"image-20230429225031339",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429225031339.png"})],-1),aa=p("figure",null,[p("img",{alt:"image-20230429225211015",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230429225211015.png"})],-1),ea={id:"_3-6-登录检查",tabindex:"-1"},ca=p("ul",null,[p("li",null,"引入Spring Session依赖")],-1),ta=p("div",{style:{"max-height":"300px"},class:"language-xml"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"xml"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"<"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">org.springframework.session</"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">spring-session-data-redis</"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"</"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"<"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">org.springframework.session</"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">spring-session-data-redis</"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"</"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")])])]),p("button",{class:"collapse"})],-1),pa=p("ul",null,[p("li",null,"Session配置类")],-1),ra=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"EnableRedisHttpSession")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"GulimallSessionConfig"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," CookieSerializer "),p("span",{style:{color:"#B392F0"}},"cookieSerializer"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        DefaultCookieSerializer cookieSerializer "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"DefaultCookieSerializer"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        cookieSerializer."),p("span",{style:{color:"#B392F0"}},"setDomainName"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"gulimall.com"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        cookieSerializer."),p("span",{style:{color:"#B392F0"}},"setCookieName"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"KLAUSSESSION"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," cookieSerializer;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RedisSerializer<"),p("span",{style:{color:"#F97583"}},"Object"),p("span",{style:{color:"#E1E4E8"}},"> "),p("span",{style:{color:"#B392F0"}},"springSessionDefaultRedisSerializer"),p("span",{style:{color:"#E1E4E8"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"GenericJackson2JsonRedisSerializer"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"EnableRedisHttpSession")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"GulimallSessionConfig"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," CookieSerializer "),p("span",{style:{color:"#6F42C1"}},"cookieSerializer"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        DefaultCookieSerializer cookieSerializer "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"DefaultCookieSerializer"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        cookieSerializer."),p("span",{style:{color:"#6F42C1"}},"setDomainName"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"gulimall.com"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        cookieSerializer."),p("span",{style:{color:"#6F42C1"}},"setCookieName"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"KLAUSSESSION"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," cookieSerializer;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RedisSerializer<"),p("span",{style:{color:"#D73A49"}},"Object"),p("span",{style:{color:"#24292E"}},"> "),p("span",{style:{color:"#6F42C1"}},"springSessionDefaultRedisSerializer"),p("span",{style:{color:"#24292E"}},"() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"GenericJackson2JsonRedisSerializer"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Ea=p("ul",null,[p("li",null,"相关配置")],-1),ya=p("div",{style:{"max-height":"300px"},class:"language-properties"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"properties"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"spring.session.store-type"),p("span",{style:{color:"#E1E4E8"}},"=REDIS")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"spring.session.store-type"),p("span",{style:{color:"#24292E"}},"=REDIS")])])]),p("button",{class:"collapse"})],-1),ia=p("ul",null,[p("li",null,"添加登录拦截器")],-1),ua=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Component")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"LoginUserInterceptor"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"implements"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"HandlerInterceptor"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"static"),p("span",{style:{color:"#E1E4E8"}}," ThreadLocal<"),p("span",{style:{color:"#F97583"}},"MemberRespVo"),p("span",{style:{color:"#E1E4E8"}},"> loginUser "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," ThreadLocal<>();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"preHandle"),p("span",{style:{color:"#E1E4E8"}},"(HttpServletRequest "),p("span",{style:{color:"#FFAB70"}},"request"),p("span",{style:{color:"#E1E4E8"}},", HttpServletResponse "),p("span",{style:{color:"#FFAB70"}},"response"),p("span",{style:{color:"#E1E4E8"}},", Object "),p("span",{style:{color:"#FFAB70"}},"handler"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," Exception {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"///order/order/status/{orderSn}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String uri "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," request."),p("span",{style:{color:"#B392F0"}},"getRequestURI"),p("span",{style:{color:"#E1E4E8"}},"();"),p("span",{style:{color:"#6A737D"}},"//  /order/order/status/")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//                  路径匹配器")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," match "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"AntPathMatcher"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"match"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/kill"'),p("span",{style:{color:"#E1E4E8"}},", uri);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (match){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//路径匹配进行登录拦截")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            MemberRespVo attribute "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," (MemberRespVo) request."),p("span",{style:{color:"#B392F0"}},"getSession"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getAttribute"),p("span",{style:{color:"#E1E4E8"}},"(AuthServerConstant.LOGIN_USER);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//判断用户是否登录")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (attribute "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//登录了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                loginUser."),p("span",{style:{color:"#B392F0"}},"set"),p("span",{style:{color:"#E1E4E8"}},"(attribute);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }"),p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//未登录就去登录")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                request."),p("span",{style:{color:"#B392F0"}},"getSession"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"setAttribute"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"msg"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"请先进行登录"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                response."),p("span",{style:{color:"#B392F0"}},"sendRedirect"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"http://auth.gulimall.com/login.html"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Component")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"LoginUserInterceptor"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"implements"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"HandlerInterceptor"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"static"),p("span",{style:{color:"#24292E"}}," ThreadLocal<"),p("span",{style:{color:"#D73A49"}},"MemberRespVo"),p("span",{style:{color:"#24292E"}},"> loginUser "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," ThreadLocal<>();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"preHandle"),p("span",{style:{color:"#24292E"}},"(HttpServletRequest "),p("span",{style:{color:"#E36209"}},"request"),p("span",{style:{color:"#24292E"}},", HttpServletResponse "),p("span",{style:{color:"#E36209"}},"response"),p("span",{style:{color:"#24292E"}},", Object "),p("span",{style:{color:"#E36209"}},"handler"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," Exception {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"///order/order/status/{orderSn}")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String uri "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," request."),p("span",{style:{color:"#6F42C1"}},"getRequestURI"),p("span",{style:{color:"#24292E"}},"();"),p("span",{style:{color:"#6A737D"}},"//  /order/order/status/")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//                  路径匹配器")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," match "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"AntPathMatcher"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"match"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/kill"'),p("span",{style:{color:"#24292E"}},", uri);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (match){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//路径匹配进行登录拦截")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            MemberRespVo attribute "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," (MemberRespVo) request."),p("span",{style:{color:"#6F42C1"}},"getSession"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getAttribute"),p("span",{style:{color:"#24292E"}},"(AuthServerConstant.LOGIN_USER);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//判断用户是否登录")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (attribute "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//登录了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                loginUser."),p("span",{style:{color:"#6F42C1"}},"set"),p("span",{style:{color:"#24292E"}},"(attribute);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }"),p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//未登录就去登录")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                request."),p("span",{style:{color:"#6F42C1"}},"getSession"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"setAttribute"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"msg"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"请先进行登录"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                response."),p("span",{style:{color:"#6F42C1"}},"sendRedirect"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"http://auth.gulimall.com/login.html"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),da=p("ul",null,[p("li",null,"拦截器注册")],-1),Fa=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillWebConfig"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"implements"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"WebMvcConfigurer"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    LoginUserInterceptor loginUserInterceptor;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"addInterceptors"),p("span",{style:{color:"#E1E4E8"}},"(InterceptorRegistry "),p("span",{style:{color:"#FFAB70"}},"registry"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        registry."),p("span",{style:{color:"#B392F0"}},"addInterceptor"),p("span",{style:{color:"#E1E4E8"}},"(loginUserInterceptor)."),p("span",{style:{color:"#B392F0"}},"addPathPatterns"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/**"'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillWebConfig"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"implements"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"WebMvcConfigurer"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    LoginUserInterceptor loginUserInterceptor;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"addInterceptors"),p("span",{style:{color:"#24292E"}},"(InterceptorRegistry "),p("span",{style:{color:"#E36209"}},"registry"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        registry."),p("span",{style:{color:"#6F42C1"}},"addInterceptor"),p("span",{style:{color:"#24292E"}},"(loginUserInterceptor)."),p("span",{style:{color:"#6F42C1"}},"addPathPatterns"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/**"'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),ga=p("ul",null,[p("li",null,"秒杀抢购未登录提示")],-1),Da=p("figure",null,[p("img",{alt:"image-20230430155945442",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430155945442.png"})],-1),Aa=p("ul",null,[p("li",null,"未登录跳转到登录页")],-1),ka=p("figure",null,[p("img",{alt:"image-20230430160017370",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430160017370.png"})],-1),ma={id:"_3-7-秒杀流程",tabindex:"-1"},ha=p("figure",null,[p("img",{alt:"image-20230430003907398",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430003907398.png"})],-1),Sa=p("ul",null,[p("li",null,"秒杀成功页接口")],-1),Ca=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"GetMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/kill"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"secKill"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"killId"'),p("span",{style:{color:"#E1E4E8"}},") String killId,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                      @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"key"'),p("span",{style:{color:"#E1E4E8"}},") String key,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                      @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"num"'),p("span",{style:{color:"#E1E4E8"}},") Integer num,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                      Model model){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String orderSn "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillService."),p("span",{style:{color:"#B392F0"}},"kill"),p("span",{style:{color:"#E1E4E8"}},"(killId, key, num);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    model."),p("span",{style:{color:"#B392F0"}},"addAttribute"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"orderSn"'),p("span",{style:{color:"#E1E4E8"}},", orderSn);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//1、判断是否登录")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"success"'),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"GetMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/kill"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"secKill"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"killId"'),p("span",{style:{color:"#24292E"}},") String killId,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                      @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"key"'),p("span",{style:{color:"#24292E"}},") String key,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                      @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"num"'),p("span",{style:{color:"#24292E"}},") Integer num,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                      Model model){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String orderSn "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillService."),p("span",{style:{color:"#6F42C1"}},"kill"),p("span",{style:{color:"#24292E"}},"(killId, key, num);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    model."),p("span",{style:{color:"#6F42C1"}},"addAttribute"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"orderSn"'),p("span",{style:{color:"#24292E"}},", orderSn);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//1、判断是否登录")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"success"'),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),ba=p("ul",null,[p("li",null,[r("秒杀订单信息数据传输公共to"),p("code",null,"org.klaus.common.to.mq.SeckillOrderTo")])],-1),Ba=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/29")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillOrderTo"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String orderSn;"),p("span",{style:{color:"#6A737D"}},"//订单号")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long promotionSessionId;"),p("span",{style:{color:"#6A737D"}},"//活动场次id")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long skuId;"),p("span",{style:{color:"#6A737D"}},"//商品id")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," BigDecimal seckillPrice;"),p("span",{style:{color:"#6A737D"}},"//秒杀价")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Integer num;"),p("span",{style:{color:"#6A737D"}},"//购买数量")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long memberId;"),p("span",{style:{color:"#6A737D"}},"//会员id")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    private List<String> skuAttrs;//商品属性集")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/29")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillOrderTo"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String orderSn;"),p("span",{style:{color:"#6A737D"}},"//订单号")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long promotionSessionId;"),p("span",{style:{color:"#6A737D"}},"//活动场次id")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long skuId;"),p("span",{style:{color:"#6A737D"}},"//商品id")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," BigDecimal seckillPrice;"),p("span",{style:{color:"#6A737D"}},"//秒杀价")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Integer num;"),p("span",{style:{color:"#6A737D"}},"//购买数量")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long memberId;"),p("span",{style:{color:"#6A737D"}},"//会员id")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//    private List<String> skuAttrs;//商品属性集")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),va=p("ul",null,[p("li",null,"秒杀方法实现")],-1),fa=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"kill"),p("span",{style:{color:"#E1E4E8"}},"(String killId, String key, Integer num) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," s1 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," System."),p("span",{style:{color:"#B392F0"}},"currentTimeMillis"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//获取当前登录的信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MemberRespVo respVo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," LoginUserInterceptor.loginUser."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//获取当前秒杀商品的详细信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    BoundHashOperations<"),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"> hashOps "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"boundHashOps"),p("span",{style:{color:"#E1E4E8"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String json "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," hashOps."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"(killId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (StringUtils."),p("span",{style:{color:"#B392F0"}},"isEmpty"),p("span",{style:{color:"#E1E4E8"}},"(json)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        SeckillSkuRedisTo redis "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," JSON."),p("span",{style:{color:"#B392F0"}},"parseObject"),p("span",{style:{color:"#E1E4E8"}},"(json, SeckillSkuRedisTo.class);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、校验合法性")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Long startTime "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redis."),p("span",{style:{color:"#B392F0"}},"getStartTime"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Long endTime "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redis."),p("span",{style:{color:"#B392F0"}},"getEndTime"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," current "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," System."),p("span",{style:{color:"#B392F0"}},"currentTimeMillis"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//过期时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," ttl "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," endTime "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#E1E4E8"}}," current;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (current "),p("span",{style:{color:"#F97583"}},">="),p("span",{style:{color:"#E1E4E8"}}," startTime "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," current "),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#E1E4E8"}}," endTime) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//2、校验随机码和商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            String randomCode "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redis."),p("span",{style:{color:"#B392F0"}},"getRandomCode"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//   1_49")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            String seckillSkuId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redis."),p("span",{style:{color:"#B392F0"}},"getPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," redis."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (randomCode."),p("span",{style:{color:"#B392F0"}},"equals"),p("span",{style:{color:"#E1E4E8"}},"(key) "),p("span",{style:{color:"#F97583"}},"&&"),p("span",{style:{color:"#E1E4E8"}}," killId."),p("span",{style:{color:"#B392F0"}},"equals"),p("span",{style:{color:"#E1E4E8"}},"(seckillSkuId)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//3、验证购物数量是否合理")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (num "),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#E1E4E8"}}," redis."),p("span",{style:{color:"#B392F0"}},"getSeckillLimit"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"intValue"),p("span",{style:{color:"#E1E4E8"}},"()) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//4、验证这个人是否已经购买过。幂等性；如果秒杀成功，就去占位，userId_sessionId_skuId")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    String redisKey "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," respVo."),p("span",{style:{color:"#B392F0"}},"getId"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"_"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," seckillSkuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#6A737D"}},"//自动过期                     SEINX 原子性")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    Boolean aBoolean "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redisTemplate."),p("span",{style:{color:"#B392F0"}},"opsForValue"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"setIfAbsent"),p("span",{style:{color:"#E1E4E8"}},"(redisKey, num."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"(), ttl, TimeUnit.MILLISECONDS);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (aBoolean) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#6A737D"}},"//占位成功说明从来没有买过")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        RSemaphore semaphore "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," redissonClient."),p("span",{style:{color:"#B392F0"}},"getSemaphore"),p("span",{style:{color:"#E1E4E8"}},"(SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," randomCode);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#6A737D"}},"//120 ms ->  20ms")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," b "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," semaphore."),p("span",{style:{color:"#B392F0"}},"tryAcquire"),p("span",{style:{color:"#E1E4E8"}},"(num);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (b) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            "),p("span",{style:{color:"#6A737D"}},"//秒杀成功；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            "),p("span",{style:{color:"#6A737D"}},"//快速下单，发送MQ消息 10ms")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            "),p("span",{style:{color:"#6A737D"}},"//创建随机订单号")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            String timeId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," IdWorker."),p("span",{style:{color:"#B392F0"}},"getTimeId"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            SeckillOrderTo orderTo "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SeckillOrderTo"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            orderTo."),p("span",{style:{color:"#B392F0"}},"setOrderSn"),p("span",{style:{color:"#E1E4E8"}},"(timeId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            orderTo."),p("span",{style:{color:"#B392F0"}},"setMemberId"),p("span",{style:{color:"#E1E4E8"}},"(respVo."),p("span",{style:{color:"#B392F0"}},"getId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            orderTo."),p("span",{style:{color:"#B392F0"}},"setNum"),p("span",{style:{color:"#E1E4E8"}},"(num);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            orderTo."),p("span",{style:{color:"#B392F0"}},"setPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"(redis."),p("span",{style:{color:"#B392F0"}},"getPromotionSessionId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            orderTo."),p("span",{style:{color:"#B392F0"}},"setSkuId"),p("span",{style:{color:"#E1E4E8"}},"(redis."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            orderTo."),p("span",{style:{color:"#B392F0"}},"setSeckillPrice"),p("span",{style:{color:"#E1E4E8"}},"(redis."),p("span",{style:{color:"#B392F0"}},"getSeckillPrice"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            "),p("span",{style:{color:"#6A737D"}},"//String exchange, String routingKey, Object message, MessagePostProcessor messagePostProcessor")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            rabbitTemplate."),p("span",{style:{color:"#B392F0"}},"convertAndSend"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"order-event-exchange"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"order.seckill.order"'),p("span",{style:{color:"#E1E4E8"}},", orderTo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," s2 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," System."),p("span",{style:{color:"#B392F0"}},"currentTimeMillis"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            log."),p("span",{style:{color:"#B392F0"}},"info"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"耗时...{}"'),p("span",{style:{color:"#E1E4E8"}},", (s2 "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#E1E4E8"}}," s1));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            "),p("span",{style:{color:"#6A737D"}},"//返回订单号")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," timeId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#6A737D"}},"//信号量为0时，虽然data为空，但缓存还会存一份")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        redisTemplate."),p("span",{style:{color:"#B392F0"}},"opsForValue"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"(redisKey);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    } "),p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#6A737D"}},"//说明已经买过了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            } "),p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        } "),p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"kill"),p("span",{style:{color:"#24292E"}},"(String killId, String key, Integer num) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," s1 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," System."),p("span",{style:{color:"#6F42C1"}},"currentTimeMillis"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//获取当前登录的信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MemberRespVo respVo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," LoginUserInterceptor.loginUser."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//获取当前秒杀商品的详细信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    BoundHashOperations<"),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"> hashOps "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"boundHashOps"),p("span",{style:{color:"#24292E"}},"(SKUKILL_CACHE_PREFOX);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String json "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," hashOps."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"(killId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (StringUtils."),p("span",{style:{color:"#6F42C1"}},"isEmpty"),p("span",{style:{color:"#24292E"}},"(json)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        SeckillSkuRedisTo redis "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," JSON."),p("span",{style:{color:"#6F42C1"}},"parseObject"),p("span",{style:{color:"#24292E"}},"(json, SeckillSkuRedisTo.class);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、校验合法性")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Long startTime "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redis."),p("span",{style:{color:"#6F42C1"}},"getStartTime"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Long endTime "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redis."),p("span",{style:{color:"#6F42C1"}},"getEndTime"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," current "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," System."),p("span",{style:{color:"#6F42C1"}},"currentTimeMillis"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//过期时间")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," ttl "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," endTime "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#24292E"}}," current;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (current "),p("span",{style:{color:"#D73A49"}},">="),p("span",{style:{color:"#24292E"}}," startTime "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," current "),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#24292E"}}," endTime) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//2、校验随机码和商品id")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            String randomCode "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redis."),p("span",{style:{color:"#6F42C1"}},"getRandomCode"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//   1_49")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            String seckillSkuId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redis."),p("span",{style:{color:"#6F42C1"}},"getPromotionSessionId"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," redis."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (randomCode."),p("span",{style:{color:"#6F42C1"}},"equals"),p("span",{style:{color:"#24292E"}},"(key) "),p("span",{style:{color:"#D73A49"}},"&&"),p("span",{style:{color:"#24292E"}}," killId."),p("span",{style:{color:"#6F42C1"}},"equals"),p("span",{style:{color:"#24292E"}},"(seckillSkuId)) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//3、验证购物数量是否合理")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (num "),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#24292E"}}," redis."),p("span",{style:{color:"#6F42C1"}},"getSeckillLimit"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"intValue"),p("span",{style:{color:"#24292E"}},"()) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//4、验证这个人是否已经购买过。幂等性；如果秒杀成功，就去占位，userId_sessionId_skuId")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    String redisKey "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," respVo."),p("span",{style:{color:"#6F42C1"}},"getId"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"_"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," seckillSkuId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#6A737D"}},"//自动过期                     SEINX 原子性")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    Boolean aBoolean "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redisTemplate."),p("span",{style:{color:"#6F42C1"}},"opsForValue"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"setIfAbsent"),p("span",{style:{color:"#24292E"}},"(redisKey, num."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"(), ttl, TimeUnit.MILLISECONDS);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (aBoolean) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#6A737D"}},"//占位成功说明从来没有买过")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        RSemaphore semaphore "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," redissonClient."),p("span",{style:{color:"#6F42C1"}},"getSemaphore"),p("span",{style:{color:"#24292E"}},"(SKU_STOCK_SEMAPHORE "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," randomCode);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#6A737D"}},"//120 ms ->  20ms")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," b "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," semaphore."),p("span",{style:{color:"#6F42C1"}},"tryAcquire"),p("span",{style:{color:"#24292E"}},"(num);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (b) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            "),p("span",{style:{color:"#6A737D"}},"//秒杀成功；")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            "),p("span",{style:{color:"#6A737D"}},"//快速下单，发送MQ消息 10ms")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            "),p("span",{style:{color:"#6A737D"}},"//创建随机订单号")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            String timeId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," IdWorker."),p("span",{style:{color:"#6F42C1"}},"getTimeId"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            SeckillOrderTo orderTo "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SeckillOrderTo"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            orderTo."),p("span",{style:{color:"#6F42C1"}},"setOrderSn"),p("span",{style:{color:"#24292E"}},"(timeId);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            orderTo."),p("span",{style:{color:"#6F42C1"}},"setMemberId"),p("span",{style:{color:"#24292E"}},"(respVo."),p("span",{style:{color:"#6F42C1"}},"getId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            orderTo."),p("span",{style:{color:"#6F42C1"}},"setNum"),p("span",{style:{color:"#24292E"}},"(num);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            orderTo."),p("span",{style:{color:"#6F42C1"}},"setPromotionSessionId"),p("span",{style:{color:"#24292E"}},"(redis."),p("span",{style:{color:"#6F42C1"}},"getPromotionSessionId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            orderTo."),p("span",{style:{color:"#6F42C1"}},"setSkuId"),p("span",{style:{color:"#24292E"}},"(redis."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            orderTo."),p("span",{style:{color:"#6F42C1"}},"setSeckillPrice"),p("span",{style:{color:"#24292E"}},"(redis."),p("span",{style:{color:"#6F42C1"}},"getSeckillPrice"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            "),p("span",{style:{color:"#6A737D"}},"//String exchange, String routingKey, Object message, MessagePostProcessor messagePostProcessor")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            rabbitTemplate."),p("span",{style:{color:"#6F42C1"}},"convertAndSend"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"order-event-exchange"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"order.seckill.order"'),p("span",{style:{color:"#24292E"}},", orderTo);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," s2 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," System."),p("span",{style:{color:"#6F42C1"}},"currentTimeMillis"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            log."),p("span",{style:{color:"#6F42C1"}},"info"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"耗时...{}"'),p("span",{style:{color:"#24292E"}},", (s2 "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#24292E"}}," s1));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            "),p("span",{style:{color:"#6A737D"}},"//返回订单号")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," timeId;")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#6A737D"}},"//信号量为0时，虽然data为空，但缓存还会存一份")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        redisTemplate."),p("span",{style:{color:"#6F42C1"}},"opsForValue"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"(redisKey);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    } "),p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#6A737D"}},"//说明已经买过了")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            } "),p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        } "),p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Ia={id:"_3-8-秒杀效果-秒杀页面",tabindex:"-1"},_a=p("figure",null,[p("img",{alt:"image-20230430161527281",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230430161527281.png"})],-1),Ta=p("ul",null,[p("li",null,"引入RabbitMQ依赖")],-1),La=p("div",{style:{"max-height":"300px"},class:"language-xml"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"xml"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"<"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">org.springframework.boot</"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">spring-boot-starter-amqp</"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"</"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"<"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">org.springframework.boot</"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">spring-boot-starter-amqp</"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"</"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")])])]),p("button",{class:"collapse"})],-1),xa=p("ul",null,[p("li",null,"相关配置")],-1),Ra=p("div",{style:{"max-height":"300px"},class:"language-properties"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"properties"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"spring.rabbitmq.virtual-host"),p("span",{style:{color:"#E1E4E8"}},"=/")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"spring.rabbitmq.host"),p("span",{style:{color:"#E1E4E8"}},"=192.168.10.103")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"spring.rabbitmq.virtual-host"),p("span",{style:{color:"#24292E"}},"=/")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"spring.rabbitmq.host"),p("span",{style:{color:"#24292E"}},"=192.168.10.103")])])]),p("button",{class:"collapse"})],-1),Oa=p("ul",null,[p("li",null,"配置RabbitMQ的Json序列化")],-1),ja=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/20")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MyRabbitConfig"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    RabbitTemplate rabbitTemplate;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 使用JSON序列化机制，进行消息转换")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," MessageConverter "),p("span",{style:{color:"#B392F0"}},"messageConverter"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"Jackson2JsonMessageConverter"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/20")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MyRabbitConfig"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    RabbitTemplate rabbitTemplate;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 使用JSON序列化机制，进行消息转换")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," MessageConverter "),p("span",{style:{color:"#6F42C1"}},"messageConverter"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"Jackson2JsonMessageConverter"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Pa=p("ul",null,[p("li",null,"发送秒杀成功消息给订单服务")],-1),Ka=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//String exchange, String routingKey, Object message, MessagePostProcessor messagePostProcessor")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"rabbitTemplate."),p("span",{style:{color:"#B392F0"}},"convertAndSend"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"order-event-exchange"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"order.seckill.order"'),p("span",{style:{color:"#E1E4E8"}},", orderTo);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//String exchange, String routingKey, Object message, MessagePostProcessor messagePostProcessor")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"rabbitTemplate."),p("span",{style:{color:"#6F42C1"}},"convertAndSend"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"order-event-exchange"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"order.seckill.order"'),p("span",{style:{color:"#24292E"}},", orderTo);")])])]),p("button",{class:"collapse"})],-1),qa=p("ul",null,[p("li",null,"订单服务创建秒杀订单消息队列")],-1),wa=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MyMQConfig"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ......")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," Exchange "),p("span",{style:{color:"#B392F0"}},"orderEventExchange"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//String name, boolean durable, boolean autoDelete, Map<String, Object> arguments")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"TopicExchange"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"order-event-exchange"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ......")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀削峰队列")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," Queue "),p("span",{style:{color:"#B392F0"}},"orderSeckillOrderQueue"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"Queue"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"order.seckill.order.queue"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," Binding "),p("span",{style:{color:"#B392F0"}},"orderSeckillOrderBinding"),p("span",{style:{color:"#E1E4E8"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"Binding"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"order.seckill.order.queue"'),p("span",{style:{color:"#E1E4E8"}},",")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                Binding.DestinationType.QUEUE,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#9ECBFF"}},'"order-event-exchange"'),p("span",{style:{color:"#E1E4E8"}},",")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#9ECBFF"}},'"order.seckill.order"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Configuration")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MyMQConfig"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ......")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," Exchange "),p("span",{style:{color:"#6F42C1"}},"orderEventExchange"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//String name, boolean durable, boolean autoDelete, Map<String, Object> arguments")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"TopicExchange"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"order-event-exchange"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ......")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"    /**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 秒杀削峰队列")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@return")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," Queue "),p("span",{style:{color:"#6F42C1"}},"orderSeckillOrderQueue"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"Queue"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"order.seckill.order.queue"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Bean")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," Binding "),p("span",{style:{color:"#6F42C1"}},"orderSeckillOrderBinding"),p("span",{style:{color:"#24292E"}},"(){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"Binding"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"order.seckill.order.queue"'),p("span",{style:{color:"#24292E"}},",")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                Binding.DestinationType.QUEUE,")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#032F62"}},'"order-event-exchange"'),p("span",{style:{color:"#24292E"}},",")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#032F62"}},'"order.seckill.order"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),za=p("ul",null,[p("li",null,[r("削峰队列监听器"),p("code",null,"org.klaus.zgg01mall.order.listener.OrderSeckillListener")])],-1),Ma=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 削峰队列监听器")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2023/4/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"RabbitListener"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"queues"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"order.seckill.order.queue"'),p("span",{style:{color:"#E1E4E8"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Component")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"OrderSeckillListener"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    OrderService orderService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"RabbitHandler")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"listener"),p("span",{style:{color:"#E1E4E8"}},"(SeckillOrderTo "),p("span",{style:{color:"#FFAB70"}},"seckillOrder"),p("span",{style:{color:"#E1E4E8"}},", Channel "),p("span",{style:{color:"#FFAB70"}},"channel"),p("span",{style:{color:"#E1E4E8"}},", Message "),p("span",{style:{color:"#FFAB70"}},"message"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," IOException {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            log."),p("span",{style:{color:"#B392F0"}},"info"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"准备创建秒杀单的详细信息...."'),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            orderService."),p("span",{style:{color:"#B392F0"}},"createSeckillOrder"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//手动调用支付宝收单")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//签收订单")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            channel."),p("span",{style:{color:"#B392F0"}},"basicAck"),p("span",{style:{color:"#E1E4E8"}},"(message."),p("span",{style:{color:"#B392F0"}},"getMessageProperties"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getDeliveryTag"),p("span",{style:{color:"#E1E4E8"}},"(), "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            channel."),p("span",{style:{color:"#B392F0"}},"basicReject"),p("span",{style:{color:"#E1E4E8"}},"(message."),p("span",{style:{color:"#B392F0"}},"getMessageProperties"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getDeliveryTag"),p("span",{style:{color:"#E1E4E8"}},"(), "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 削峰队列监听器")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2023/4/28")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Slf4j")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"RabbitListener"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"queues"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"order.seckill.order.queue"'),p("span",{style:{color:"#24292E"}},")")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Component")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"OrderSeckillListener"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Autowired")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    OrderService orderService;")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"RabbitHandler")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"listener"),p("span",{style:{color:"#24292E"}},"(SeckillOrderTo "),p("span",{style:{color:"#E36209"}},"seckillOrder"),p("span",{style:{color:"#24292E"}},", Channel "),p("span",{style:{color:"#E36209"}},"channel"),p("span",{style:{color:"#24292E"}},", Message "),p("span",{style:{color:"#E36209"}},"message"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," IOException {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            log."),p("span",{style:{color:"#6F42C1"}},"info"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"准备创建秒杀单的详细信息...."'),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            orderService."),p("span",{style:{color:"#6F42C1"}},"createSeckillOrder"),p("span",{style:{color:"#24292E"}},"(seckillOrder);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//手动调用支付宝收单")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//签收订单")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            channel."),p("span",{style:{color:"#6F42C1"}},"basicAck"),p("span",{style:{color:"#24292E"}},"(message."),p("span",{style:{color:"#6F42C1"}},"getMessageProperties"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getDeliveryTag"),p("span",{style:{color:"#24292E"}},"(), "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            channel."),p("span",{style:{color:"#6F42C1"}},"basicReject"),p("span",{style:{color:"#24292E"}},"(message."),p("span",{style:{color:"#6F42C1"}},"getMessageProperties"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getDeliveryTag"),p("span",{style:{color:"#24292E"}},"(), "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},");")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])]),p("button",{class:"collapse"})],-1),Va=p("ul",null,[p("li",null,[r("创建秒杀订单方法实现"),p("code",null,"org.klaus.zgg01mall.order.service.impl.OrderServiceImpl#createSeckillOrder")])],-1),Ua=p("div",{style:{"max-height":"300px"},class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t@"),p("span",{style:{color:"#F97583"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"createSeckillOrder"),p("span",{style:{color:"#E1E4E8"}},"(SeckillOrderTo seckillOrder) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//todo 保存订单信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        OrderEntity orderEntity "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"OrderEntity"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderEntity."),p("span",{style:{color:"#B392F0"}},"setOrderSn"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder."),p("span",{style:{color:"#B392F0"}},"getOrderSn"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderEntity."),p("span",{style:{color:"#B392F0"}},"setMemberId"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder."),p("span",{style:{color:"#B392F0"}},"getMemberId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderEntity."),p("span",{style:{color:"#B392F0"}},"setStatus"),p("span",{style:{color:"#E1E4E8"}},"(OrderStatusEnum.CREATE_NEW."),p("span",{style:{color:"#B392F0"}},"getCode"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        BigDecimal amount "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillOrder."),p("span",{style:{color:"#B392F0"}},"getSeckillPrice"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"multiply"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"BigDecimal"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," seckillOrder."),p("span",{style:{color:"#B392F0"}},"getNum"),p("span",{style:{color:"#E1E4E8"}},"()));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderEntity."),p("span",{style:{color:"#B392F0"}},"setPayAmount"),p("span",{style:{color:"#E1E4E8"}},"(amount);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderEntity."),p("span",{style:{color:"#B392F0"}},"setTotalAmount"),p("span",{style:{color:"#E1E4E8"}},"(amount);"),p("span",{style:{color:"#6A737D"}},"//todo")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//保存订单")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#79B8FF"}},"this"),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"save"),p("span",{style:{color:"#E1E4E8"}},"(orderEntity);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//todo 保存订单项信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        OrderItemEntity itemEntity "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"OrderItemEntity"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        itemEntity."),p("span",{style:{color:"#B392F0"}},"setOrderSn"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder."),p("span",{style:{color:"#B392F0"}},"getOrderSn"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        itemEntity."),p("span",{style:{color:"#B392F0"}},"setRealAmount"),p("span",{style:{color:"#E1E4E8"}},"(amount);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//todo 获取当前sku的详细信息进行设置 seckillservice-> productFeignService.getSpuInfoBySkuId()")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        R r "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," productFeignService."),p("span",{style:{color:"#B392F0"}},"getSpuInfoBySkuId"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (r."),p("span",{style:{color:"#B392F0"}},"getCode"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            SpuInfoVo data "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," r."),p("span",{style:{color:"#B392F0"}},"getData"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," TypeReference<"),p("span",{style:{color:"#F97583"}},"SpuInfoVo"),p("span",{style:{color:"#E1E4E8"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            itemEntity."),p("span",{style:{color:"#B392F0"}},"setSpuId"),p("span",{style:{color:"#E1E4E8"}},"(data."),p("span",{style:{color:"#B392F0"}},"getId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            itemEntity."),p("span",{style:{color:"#B392F0"}},"setSpuName"),p("span",{style:{color:"#E1E4E8"}},"(data."),p("span",{style:{color:"#B392F0"}},"getSpuName"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            itemEntity."),p("span",{style:{color:"#B392F0"}},"setSpuBrand"),p("span",{style:{color:"#E1E4E8"}},"(data."),p("span",{style:{color:"#B392F0"}},"getBrandId"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            itemEntity."),p("span",{style:{color:"#B392F0"}},"setCategoryId"),p("span",{style:{color:"#E1E4E8"}},"(data."),p("span",{style:{color:"#B392F0"}},"getCatalogId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、找到所有需要参与秒杀的商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        R info "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," seckillFeignService."),p("span",{style:{color:"#B392F0"}},"getSkuSeckillInfo"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (info."),p("span",{style:{color:"#B392F0"}},"getCode"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},"){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            SeckillSkuRedisTo data "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," info."),p("span",{style:{color:"#B392F0"}},"getData"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," TypeReference<"),p("span",{style:{color:"#F97583"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#E1E4E8"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            itemEntity."),p("span",{style:{color:"#B392F0"}},"setSkuName"),p("span",{style:{color:"#E1E4E8"}},"(data."),p("span",{style:{color:"#B392F0"}},"getSkuInfoVo"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getSkuTitle"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            itemEntity."),p("span",{style:{color:"#B392F0"}},"setSkuPic"),p("span",{style:{color:"#E1E4E8"}},"(data."),p("span",{style:{color:"#B392F0"}},"getSkuInfoVo"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"getSkuDefaultImg"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//todo 销售属性组合")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        itemEntity."),p("span",{style:{color:"#B392F0"}},"setSkuId"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder."),p("span",{style:{color:"#B392F0"}},"getSkuId"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        itemEntity."),p("span",{style:{color:"#B392F0"}},"setSkuQuantity"),p("span",{style:{color:"#E1E4E8"}},"(seckillOrder."),p("span",{style:{color:"#B392F0"}},"getNum"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//保存订单项")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderItemService."),p("span",{style:{color:"#B392F0"}},"save"),p("span",{style:{color:"#E1E4E8"}},"(itemEntity);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 保存订单数据")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"order")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"saveOrder"),p("span",{style:{color:"#E1E4E8"}},"(OrderCreateTo order) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        OrderEntity orderEntity "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," order."),p("span",{style:{color:"#B392F0"}},"getOrder"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderEntity."),p("span",{style:{color:"#B392F0"}},"setModifyTime"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"Date"),p("span",{style:{color:"#E1E4E8"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//插入订单")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#79B8FF"}},"this"),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"save"),p("span",{style:{color:"#E1E4E8"}},"(orderEntity);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        List<"),p("span",{style:{color:"#F97583"}},"OrderItemEntity"),p("span",{style:{color:"#E1E4E8"}},"> orderItems "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," order."),p("span",{style:{color:"#B392F0"}},"getOrderItems"),p("span",{style:{color:"#E1E4E8"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//seata不支持批量保存...且在高并发环境此业务不适用Seata")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        orderItemService."),p("span",{style:{color:"#B392F0"}},"saveBatch"),p("span",{style:{color:"#E1E4E8"}},"(orderItems);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        for (OrderItemEntity orderItem : orderItems) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            orderItemService.save(orderItem);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t@"),p("span",{style:{color:"#D73A49"}},"Override")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"createSeckillOrder"),p("span",{style:{color:"#24292E"}},"(SeckillOrderTo seckillOrder) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//todo 保存订单信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        OrderEntity orderEntity "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"OrderEntity"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderEntity."),p("span",{style:{color:"#6F42C1"}},"setOrderSn"),p("span",{style:{color:"#24292E"}},"(seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getOrderSn"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderEntity."),p("span",{style:{color:"#6F42C1"}},"setMemberId"),p("span",{style:{color:"#24292E"}},"(seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getMemberId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderEntity."),p("span",{style:{color:"#6F42C1"}},"setStatus"),p("span",{style:{color:"#24292E"}},"(OrderStatusEnum.CREATE_NEW."),p("span",{style:{color:"#6F42C1"}},"getCode"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        BigDecimal amount "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getSeckillPrice"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"multiply"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"BigDecimal"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getNum"),p("span",{style:{color:"#24292E"}},"()));")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderEntity."),p("span",{style:{color:"#6F42C1"}},"setPayAmount"),p("span",{style:{color:"#24292E"}},"(amount);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderEntity."),p("span",{style:{color:"#6F42C1"}},"setTotalAmount"),p("span",{style:{color:"#24292E"}},"(amount);"),p("span",{style:{color:"#6A737D"}},"//todo")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//保存订单")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#005CC5"}},"this"),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"save"),p("span",{style:{color:"#24292E"}},"(orderEntity);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//todo 保存订单项信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        OrderItemEntity itemEntity "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"OrderItemEntity"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        itemEntity."),p("span",{style:{color:"#6F42C1"}},"setOrderSn"),p("span",{style:{color:"#24292E"}},"(seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getOrderSn"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        itemEntity."),p("span",{style:{color:"#6F42C1"}},"setRealAmount"),p("span",{style:{color:"#24292E"}},"(amount);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//todo 获取当前sku的详细信息进行设置 seckillservice-> productFeignService.getSpuInfoBySkuId()")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        R r "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," productFeignService."),p("span",{style:{color:"#6F42C1"}},"getSpuInfoBySkuId"),p("span",{style:{color:"#24292E"}},"(seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (r."),p("span",{style:{color:"#6F42C1"}},"getCode"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            SpuInfoVo data "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," r."),p("span",{style:{color:"#6F42C1"}},"getData"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," TypeReference<"),p("span",{style:{color:"#D73A49"}},"SpuInfoVo"),p("span",{style:{color:"#24292E"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            itemEntity."),p("span",{style:{color:"#6F42C1"}},"setSpuId"),p("span",{style:{color:"#24292E"}},"(data."),p("span",{style:{color:"#6F42C1"}},"getId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            itemEntity."),p("span",{style:{color:"#6F42C1"}},"setSpuName"),p("span",{style:{color:"#24292E"}},"(data."),p("span",{style:{color:"#6F42C1"}},"getSpuName"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            itemEntity."),p("span",{style:{color:"#6F42C1"}},"setSpuBrand"),p("span",{style:{color:"#24292E"}},"(data."),p("span",{style:{color:"#6F42C1"}},"getBrandId"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            itemEntity."),p("span",{style:{color:"#6F42C1"}},"setCategoryId"),p("span",{style:{color:"#24292E"}},"(data."),p("span",{style:{color:"#6F42C1"}},"getCatalogId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//1、找到所有需要参与秒杀的商品信息")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        R info "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," seckillFeignService."),p("span",{style:{color:"#6F42C1"}},"getSkuSeckillInfo"),p("span",{style:{color:"#24292E"}},"(seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (info."),p("span",{style:{color:"#6F42C1"}},"getCode"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},"){")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            SeckillSkuRedisTo data "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," info."),p("span",{style:{color:"#6F42C1"}},"getData"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," TypeReference<"),p("span",{style:{color:"#D73A49"}},"SeckillSkuRedisTo"),p("span",{style:{color:"#24292E"}},">() {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            });")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            itemEntity."),p("span",{style:{color:"#6F42C1"}},"setSkuName"),p("span",{style:{color:"#24292E"}},"(data."),p("span",{style:{color:"#6F42C1"}},"getSkuInfoVo"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getSkuTitle"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            itemEntity."),p("span",{style:{color:"#6F42C1"}},"setSkuPic"),p("span",{style:{color:"#24292E"}},"(data."),p("span",{style:{color:"#6F42C1"}},"getSkuInfoVo"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"getSkuDefaultImg"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//todo 销售属性组合")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        itemEntity."),p("span",{style:{color:"#6F42C1"}},"setSkuId"),p("span",{style:{color:"#24292E"}},"(seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getSkuId"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        itemEntity."),p("span",{style:{color:"#6F42C1"}},"setSkuQuantity"),p("span",{style:{color:"#24292E"}},"(seckillOrder."),p("span",{style:{color:"#6F42C1"}},"getNum"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//保存订单项")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderItemService."),p("span",{style:{color:"#6F42C1"}},"save"),p("span",{style:{color:"#24292E"}},"(itemEntity);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * 保存订单数据")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"order")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"saveOrder"),p("span",{style:{color:"#24292E"}},"(OrderCreateTo order) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        OrderEntity orderEntity "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," order."),p("span",{style:{color:"#6F42C1"}},"getOrder"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderEntity."),p("span",{style:{color:"#6F42C1"}},"setModifyTime"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"Date"),p("span",{style:{color:"#24292E"}},"());")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//插入订单")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#005CC5"}},"this"),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"save"),p("span",{style:{color:"#24292E"}},"(orderEntity);")]),r("\n"),p("span",{class:"line"}),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        List<"),p("span",{style:{color:"#D73A49"}},"OrderItemEntity"),p("span",{style:{color:"#24292E"}},"> orderItems "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," order."),p("span",{style:{color:"#6F42C1"}},"getOrderItems"),p("span",{style:{color:"#24292E"}},"();")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//seata不支持批量保存...且在高并发环境此业务不适用Seata")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        orderItemService."),p("span",{style:{color:"#6F42C1"}},"saveBatch"),p("span",{style:{color:"#24292E"}},"(orderItems);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        for (OrderItemEntity orderItem : orderItems) {")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            orderItemService.save(orderItem);")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        }")]),r("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])]),p("button",{class:"collapse"})],-1),Na=p("ul",null,[p("li",null,"准备秒杀（已登录）")],-1),Ha=p("figure",null,[p("img",{alt:"image-20230428202310827",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428202310827.png"})],-1),Wa=p("ul",null,[p("li",null,"秒杀成功页")],-1),Xa=p("figure",null,[p("img",{alt:"image-20230428203902875",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428203902875.png"})],-1),Ja=p("ul",null,[p("li",null,"去支付")],-1),Qa=p("figure",null,[p("img",{alt:"image-20230428204012516",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428204012516.png"})],-1),Ga=p("figure",null,[p("img",{alt:"image-20230428204042723",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428204042723.png"})],-1),$a=p("ul",null,[p("li",null,"支付成功")],-1),Ya=p("figure",null,[p("img",{alt:"image-20230428204055365",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428204055365.png"})],-1),Za=p("figure",null,[p("img",{alt:"image-20230428204105232",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428204105232.png"})],-1),se=p("ul",null,[p("li",null,"同步通知，支付成功，一般跳转到成功页")],-1),le=p("figure",null,[p("img",{alt:"image-20230428204113061",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428204113061.png"})],-1),oe=p("blockquote",null,[p("p",null,"未开发秒杀订单超时/未付款/已取消")],-1),ne=p("ul",null,[p("li",null,"秒杀失败页面返回（秒杀占位key：userId_sessionId_skuId未过期，已被别人抢购了）")],-1),ae=p("figure",null,[p("img",{alt:"image-20230428202441771",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428202441771.png"})],-1),ee=p("figure",null,[p("img",{alt:"image-20230428202629284",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428202629284.png"})],-1),ce=p("ul",null,[p("li",null,[p("p",null,"信号量限制抢购数量")]),p("li",null,[p("p",null,"信号量每秒杀成功一次，信号量减一，seckill_count -> seckill_count - 1")])],-1),te=p("figure",null,[p("img",{alt:"image-20230428202717075",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428202717075.png"})],-1),pe=p("ul",null,[p("li",null,"秒杀锁的过期是为long ttl = endTime - current;")],-1),re=p("figure",null,[p("img",{alt:"image-20230428203528296",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230428203528296.png"})],-1),Ee={id:"_4-秒杀-高并发-系统关注的问题",tabindex:"-1"},ye={id:"_4-1-服务单一职责-独立部署",tabindex:"-1"},ie=p("ul",null,[p("li",null,"秒杀服务即使自己扛不住压力，挂掉，不要影响别人")],-1),ue={id:"_4-2-秒杀链接加密",tabindex:"-1"},de=p("ul",null,[p("li",null,"防止恶意攻击模拟秒杀请求，1000次/s攻击 防止连接暴露，自己工作人员，提前秒杀商品")],-1),Fe={id:"_4-3-库存预热-快速扣减",tabindex:"-1"},ge=p("ul",null,[p("li",null,"提前把数据加载缓存中")],-1),De={id:"_4-4-动静分离",tabindex:"-1"},Ae=p("ul",null,[p("li",null,[p("p",null,"nginx做好动静分离，保证秒杀和商品详情页的动态请求才打到后端的服务集群")]),p("li",null,[p("p",null,"使用 CDN 网络，分担服务器压力")])],-1),ke={id:"_4-5-恶意请求拦截",tabindex:"-1"},me=p("ul",null,[p("li",null,"识别非法攻击的请求并进行拦截 ，网关层")],-1),he={id:"_4-6-流量错峰",tabindex:"-1"},Se=p("ul",null,[p("li",null,"使用各种手段，将流量分担到更大宽度的时间点，比如验证码，加入购物车")],-1),Ce={id:"_4-7-限流-熔断-降级",tabindex:"-1"},be=p("ul",null,[p("li",null,[p("p",null,"前端限流 + 后端限流")]),p("li",null,[p("p",null,"限制次数，限制总量，快速失败降级运行，熔断隔离防止雪崩")])],-1),Be={id:"_4-8-队列消峰",tabindex:"-1"},ve=p("ul",null,[p("li",null,"1万个请求，每个1000件被秒杀，双11所有秒杀成功的请求，进入队列，慢慢创建订单，扣减库存即可")],-1),fe={id:"_5-限流-熔断-降级",tabindex:"-1"};const Ie=s(F,[["render",function(s,l,o,u,d,F){const Ie=i,_e=e;return c(),n(_e,{frontmatter:d.frontmatter,data:d.data},{"main-content-md":a((()=>[g,t(" more "),p("h2",D,[r("如何设计一个秒杀系统？ "),E(Ie,{class:"header-anchor",href:"#如何设计一个秒杀系统","aria-label":'Permalink to "如何设计一个秒杀系统？"'},{default:a((()=>[r("​")])),_:1})]),A,k,p("h3",m,[r("1 瞬时高并发 "),E(Ie,{class:"header-anchor",href:"#_1-瞬时高并发","aria-label":'Permalink to "1 瞬时高并发"'},{default:a((()=>[r("​")])),_:1})]),h,S,C,p("h3",b,[r("2 页面静态化 "),E(Ie,{class:"header-anchor",href:"#_2-页面静态化","aria-label":'Permalink to "2 页面静态化"'},{default:a((()=>[r("​")])),_:1})]),B,v,f,I,_,T,L,p("h3",x,[r("3 秒杀按钮 "),E(Ie,{class:"header-anchor",href:"#_3-秒杀按钮","aria-label":'Permalink to "3 秒杀按钮"'},{default:a((()=>[r("​")])),_:1})]),R,O,j,P,K,p("h3",q,[r("4 读多写少 "),E(Ie,{class:"header-anchor",href:"#_4-读多写少","aria-label":'Permalink to "4 读多写少"'},{default:a((()=>[r("​")])),_:1})]),w,z,M,V,p("h3",U,[r("5 缓存问题 "),E(Ie,{class:"header-anchor",href:"#_5-缓存问题","aria-label":'Permalink to "5 缓存问题"'},{default:a((()=>[r("​")])),_:1})]),N,H,W,p("h4",X,[r("5.1 缓存击穿 "),E(Ie,{class:"header-anchor",href:"#_5-1-缓存击穿","aria-label":'Permalink to "5.1 缓存击穿"'},{default:a((()=>[r("​")])),_:1})]),J,Q,G,p("h4",$,[r("5.2 缓存穿透 "),E(Ie,{class:"header-anchor",href:"#_5-2-缓存穿透","aria-label":'Permalink to "5.2 缓存穿透"'},{default:a((()=>[r("​")])),_:1})]),Y,Z,ss,ls,os,p("h3",ns,[r("6 库存问题 "),E(Ie,{class:"header-anchor",href:"#_6-库存问题","aria-label":'Permalink to "6 库存问题"'},{default:a((()=>[r("​")])),_:1})]),as,es,cs,p("h4",ts,[r("6.1 数据库扣减库存 "),E(Ie,{class:"header-anchor",href:"#_6-1-数据库扣减库存","aria-label":'Permalink to "6.1 数据库扣减库存"'},{default:a((()=>[r("​")])),_:1})]),ps,rs,Es,ys,p("h4",is,[r("6.2 redis扣减库存 "),E(Ie,{class:"header-anchor",href:"#_6-2-redis扣减库存","aria-label":'Permalink to "6.2 redis扣减库存"'},{default:a((()=>[r("​")])),_:1})]),us,ds,Fs,gs,Ds,As,ks,ms,hs,Ss,Cs,p("h4",bs,[r("6.3 lua脚本扣减库存 "),E(Ie,{class:"header-anchor",href:"#_6-3-lua脚本扣减库存","aria-label":'Permalink to "6.3 lua脚本扣减库存"'},{default:a((()=>[r("​")])),_:1})]),Bs,vs,fs,Is,p("h3",_s,[r("7 分布式锁 "),E(Ie,{class:"header-anchor",href:"#_7-分布式锁","aria-label":'Permalink to "7 分布式锁"'},{default:a((()=>[r("​")])),_:1})]),Ts,p("h4",Ls,[r("7.1 setNx加锁 "),E(Ie,{class:"header-anchor",href:"#_7-1-setnx加锁","aria-label":'Permalink to "7.1 setNx加锁"'},{default:a((()=>[r("​")])),_:1})]),xs,Rs,Os,p("h4",js,[r("7.2 set加锁 "),E(Ie,{class:"header-anchor",href:"#_7-2-set加锁","aria-label":'Permalink to "7.2 set加锁"'},{default:a((()=>[r("​")])),_:1})]),Ps,Ks,qs,ws,p("h4",zs,[r("7.3 释放锁 "),E(Ie,{class:"header-anchor",href:"#_7-3-释放锁","aria-label":'Permalink to "7.3 释放锁"'},{default:a((()=>[r("​")])),_:1})]),Ms,Vs,Us,p("h4",Ns,[r("7.4 自旋锁 "),E(Ie,{class:"header-anchor",href:"#_7-4-自旋锁","aria-label":'Permalink to "7.4 自旋锁"'},{default:a((()=>[r("​")])),_:1})]),Hs,Ws,Xs,p("h4",Js,[r("7.5 redisson "),E(Ie,{class:"header-anchor",href:"#_7-5-redisson","aria-label":'Permalink to "7.5 redisson"'},{default:a((()=>[r("​")])),_:1})]),p("ul",null,[Qs,p("li",null,[p("p",null,[E(Ie,{href:"https://imlklaus.github.io/posts/%E7%BC%93%E5%AD%98+%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%9C%A8java%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8#_3%E3%80%81redisson-%E5%AE%8C%E6%88%90%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81",target:"_blank",rel:"noreferrer"},{default:a((()=>[r("Redisson分布式锁的使用")])),_:1})])])]),p("h3",Gs,[r("8 mq异步处理 "),E(Ie,{class:"header-anchor",href:"#_8-mq异步处理","aria-label":'Permalink to "8 mq异步处理"'},{default:a((()=>[r("​")])),_:1})]),$s,Ys,Zs,sl,ll,p("h4",ol,[r("8.1 消息丢失问题 "),E(Ie,{class:"header-anchor",href:"#_8-1-消息丢失问题","aria-label":'Permalink to "8.1 消息丢失问题"'},{default:a((()=>[r("​")])),_:1})]),nl,al,el,cl,tl,p("h4",pl,[r("8.2 重复消费问题 "),E(Ie,{class:"header-anchor",href:"#_8-2-重复消费问题","aria-label":'Permalink to "8.2 重复消费问题"'},{default:a((()=>[r("​")])),_:1})]),rl,El,yl,p("h4",il,[r("8.3 垃圾消息问题 "),E(Ie,{class:"header-anchor",href:"#_8-3-垃圾消息问题","aria-label":'Permalink to "8.3 垃圾消息问题"'},{default:a((()=>[r("​")])),_:1})]),ul,dl,Fl,p("h4",gl,[r("8.4 延迟消费问题 "),E(Ie,{class:"header-anchor",href:"#_8-4-延迟消费问题","aria-label":'Permalink to "8.4 延迟消费问题"'},{default:a((()=>[r("​")])),_:1})]),Dl,Al,kl,ml,p("h3",hl,[r("9 如何限流？ "),E(Ie,{class:"header-anchor",href:"#_9-如何限流","aria-label":'Permalink to "9 如何限流？"'},{default:a((()=>[r("​")])),_:1})]),Sl,Cl,bl,Bl,vl,p("h4",fl,[r("9.1 对同一用户限流 "),E(Ie,{class:"header-anchor",href:"#_9-1-对同一用户限流","aria-label":'Permalink to "9.1 对同一用户限流"'},{default:a((()=>[r("​")])),_:1})]),Il,_l,Tl,p("h4",Ll,[r("9.2 对同一ip限流 "),E(Ie,{class:"header-anchor",href:"#_9-2-对同一ip限流","aria-label":'Permalink to "9.2 对同一ip限流"'},{default:a((()=>[r("​")])),_:1})]),xl,Rl,Ol,p("h4",jl,[r("9.3 对接口限流 "),E(Ie,{class:"header-anchor",href:"#_9-3-对接口限流","aria-label":'Permalink to "9.3 对接口限流"'},{default:a((()=>[r("​")])),_:1})]),Pl,Kl,ql,p("h4",wl,[r("9.4 加验证码 "),E(Ie,{class:"header-anchor",href:"#_9-4-加验证码","aria-label":'Permalink to "9.4 加验证码"'},{default:a((()=>[r("​")])),_:1})]),zl,Ml,Vl,p("h4",Ul,[r("9.5 提高业务门槛 "),E(Ie,{class:"header-anchor",href:"#_9-5-提高业务门槛","aria-label":'Permalink to "9.5 提高业务门槛"'},{default:a((()=>[r("​")])),_:1})]),Nl,p("h2",Hl,[r("秒杀系统项目实战 "),E(Ie,{class:"header-anchor",href:"#秒杀系统项目实战","aria-label":'Permalink to "秒杀系统项目实战"'},{default:a((()=>[r("​")])),_:1})]),p("h3",Wl,[r("1 秒杀业务概要 "),E(Ie,{class:"header-anchor",href:"#_1-秒杀业务概要","aria-label":'Permalink to "1 秒杀业务概要"'},{default:a((()=>[r("​")])),_:1})]),Xl,Jl,p("h3",Ql,[r("2 秒杀流程 "),E(Ie,{class:"header-anchor",href:"#_2-秒杀流程","aria-label":'Permalink to "2 秒杀流程"'},{default:a((()=>[r("​")])),_:1})]),Gl,$l,Yl,Zl,p("h3",so,[r("3 秒杀核心业务 "),E(Ie,{class:"header-anchor",href:"#_3-秒杀核心业务","aria-label":'Permalink to "3 秒杀核心业务"'},{default:a((()=>[r("​")])),_:1})]),p("h4",lo,[r("3.1 后台添加秒杀商品 "),E(Ie,{class:"header-anchor",href:"#_3-1-后台添加秒杀商品","aria-label":'Permalink to "3.1 后台添加秒杀商品"'},{default:a((()=>[r("​")])),_:1})]),oo,no,ao,eo,co,to,po,ro,Eo,yo,p("h4",io,[r("定时任务 "),E(Ie,{class:"header-anchor",href:"#定时任务","aria-label":'Permalink to "定时任务"'},{default:a((()=>[r("​")])),_:1})]),p("h5",uo,[r("1.cron表达式 "),E(Ie,{class:"header-anchor",href:"#_1-cron表达式","aria-label":'Permalink to "1.cron表达式"'},{default:a((()=>[r("​")])),_:1})]),Fo,p("p",null,[E(Ie,{href:"http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/crontrigger.html",target:"_blank",rel:"noreferrer"},{default:a((()=>[r("http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/crontrigger.html")])),_:1})]),go,Do,Ao,ko,mo,ho,p("h5",So,[r("2.cron 示例 "),E(Ie,{class:"header-anchor",href:"#_2-cron-示例","aria-label":'Permalink to "2.cron 示例"'},{default:a((()=>[r("​")])),_:1})]),Co,p("h5",bo,[r("3.SpringBoot整合定时任务 "),E(Ie,{class:"header-anchor",href:"#_3-springboot整合定时任务","aria-label":'Permalink to "3.SpringBoot整合定时任务"'},{default:a((()=>[r("​")])),_:1})]),Bo,vo,fo,Io,_o,p("h4",To,[r("3.2 秒杀商品上架 "),E(Ie,{class:"header-anchor",href:"#_3-2-秒杀商品上架","aria-label":'Permalink to "3.2 秒杀商品上架"'},{default:a((()=>[r("​")])),_:1})]),Lo,xo,Ro,Oo,jo,Po,Ko,qo,wo,zo,Mo,Vo,Uo,No,Ho,Wo,Xo,Jo,Qo,Go,p("h5",$o,[r("1、缓存活动信息方法 "),E(Ie,{class:"header-anchor",href:"#_1、缓存活动信息方法","aria-label":'Permalink to "1、缓存活动信息方法"'},{default:a((()=>[r("​")])),_:1})]),Yo,Zo,sn,ln,on,nn,an,en,cn,p("h5",tn,[r("2、缓存活动的关联商品信息 "),E(Ie,{class:"header-anchor",href:"#_2、缓存活动的关联商品信息","aria-label":'Permalink to "2、缓存活动的关联商品信息"'},{default:a((()=>[r("​")])),_:1})]),pn,rn,En,yn,un,dn,Fn,gn,Dn,An,kn,mn,hn,Sn,Cn,bn,Bn,p("h4",vn,[r("分布式定时任务 "),E(Ie,{class:"header-anchor",href:"#分布式定时任务","aria-label":'Permalink to "分布式定时任务"'},{default:a((()=>[r("​")])),_:1})]),p("h5",fn,[r("1.定时任务的问题 "),E(Ie,{class:"header-anchor",href:"#_1-定时任务的问题","aria-label":'Permalink to "1.定时任务的问题"'},{default:a((()=>[r("​")])),_:1})]),In,_n,p("h5",Tn,[r("2.扩展 - 分布式调整 "),E(Ie,{class:"header-anchor",href:"#_2-扩展-分布式调整","aria-label":'Permalink to "2.扩展 - 分布式调整"'},{default:a((()=>[r("​")])),_:1})]),p("p",null,[E(Ie,{href:"http://elasticjob.io/docs/elastic-job-cloud/00-overview/",target:"_blank",rel:"noreferrer"},{default:a((()=>[r("http://elasticjob.io/docs/elastic-job-cloud/00-overview/")])),_:1})]),p("h4",Ln,[r("3.3 幂等性保证 "),E(Ie,{class:"header-anchor",href:"#_3-3-幂等性保证","aria-label":'Permalink to "3.3 幂等性保证"'},{default:a((()=>[r("​")])),_:1})]),xn,Rn,On,jn,Pn,p("h4",Kn,[r("3.4 查询秒杀商品+页面渲染 "),E(Ie,{class:"header-anchor",href:"#_3-4-查询秒杀商品-页面渲染","aria-label":'Permalink to "3.4 查询秒杀商品+页面渲染"'},{default:a((()=>[r("​")])),_:1})]),qn,wn,zn,Mn,Vn,Un,Nn,Hn,Wn,Xn,Jn,Qn,Gn,$n,Yn,Zn,sa,la,p("h4",oa,[r("3.5 秒杀系统设计 "),E(Ie,{class:"header-anchor",href:"#_3-5-秒杀系统设计","aria-label":'Permalink to "3.5 秒杀系统设计"'},{default:a((()=>[r("​")])),_:1})]),na,aa,p("h4",ea,[r("3.6 登录检查 "),E(Ie,{class:"header-anchor",href:"#_3-6-登录检查","aria-label":'Permalink to "3.6 登录检查"'},{default:a((()=>[r("​")])),_:1})]),ca,ta,pa,ra,Ea,ya,ia,ua,da,Fa,ga,Da,Aa,ka,p("h4",ma,[r("3.7 秒杀流程 "),E(Ie,{class:"header-anchor",href:"#_3-7-秒杀流程","aria-label":'Permalink to "3.7 秒杀流程"'},{default:a((()=>[r("​")])),_:1})]),ha,Sa,Ca,ba,Ba,va,fa,p("h4",Ia,[r("3.8 秒杀效果+秒杀页面 "),E(Ie,{class:"header-anchor",href:"#_3-8-秒杀效果-秒杀页面","aria-label":'Permalink to "3.8 秒杀效果+秒杀页面"'},{default:a((()=>[r("​")])),_:1})]),_a,Ta,La,xa,Ra,Oa,ja,Pa,Ka,qa,wa,za,Ma,Va,Ua,Na,Ha,Wa,Xa,Ja,Qa,Ga,$a,Ya,p("ul",null,[p("li",null,[r("页面跳转同步通知页面路径 需"),E(Ie,{href:"http://xn--79sp5fckt6rwxd161acp1b",target:"_blank",rel:"noreferrer"},{default:a((()=>[r("http://格式的完整路径")])),_:1}),r("，不能加?id=123这类自定义参数，必须外网可以正常访问（配置内网穿透）")])]),Za,se,le,oe,ne,p("p",null,[E(Ie,{href:"http://seckill.gulimall.com/kill?killId=20_61&key=83e8d796d84d4048b3c93608b30f8493&num=1",target:"_blank",rel:"noreferrer"},{default:a((()=>[r("seckill.gulimall.com/kill?killId=20_61&key=83e8d796d84d4048b3c93608b30f8493&num=1")])),_:1})]),ae,ee,ce,te,pe,re,p("h3",Ee,[r("4 秒杀（高并发）系统关注的问题 "),E(Ie,{class:"header-anchor",href:"#_4-秒杀-高并发-系统关注的问题","aria-label":'Permalink to "4 秒杀（高并发）系统关注的问题"'},{default:a((()=>[r("​")])),_:1})]),p("h4",ye,[r("4.1 服务单一职责+独立部署 "),E(Ie,{class:"header-anchor",href:"#_4-1-服务单一职责-独立部署","aria-label":'Permalink to "4.1 服务单一职责+独立部署"'},{default:a((()=>[r("​")])),_:1})]),ie,p("h4",ue,[r("4.2 秒杀链接加密 "),E(Ie,{class:"header-anchor",href:"#_4-2-秒杀链接加密","aria-label":'Permalink to "4.2 秒杀链接加密"'},{default:a((()=>[r("​")])),_:1})]),de,p("h4",Fe,[r("4.3 库存预热 + 快速扣减 "),E(Ie,{class:"header-anchor",href:"#_4-3-库存预热-快速扣减","aria-label":'Permalink to "4.3 库存预热 + 快速扣减"'},{default:a((()=>[r("​")])),_:1})]),ge,p("h4",De,[r("4.4 动静分离 "),E(Ie,{class:"header-anchor",href:"#_4-4-动静分离","aria-label":'Permalink to "4.4 动静分离"'},{default:a((()=>[r("​")])),_:1})]),Ae,p("h4",ke,[r("4.5 恶意请求拦截 "),E(Ie,{class:"header-anchor",href:"#_4-5-恶意请求拦截","aria-label":'Permalink to "4.5 恶意请求拦截"'},{default:a((()=>[r("​")])),_:1})]),me,p("h4",he,[r("4.6 流量错峰 "),E(Ie,{class:"header-anchor",href:"#_4-6-流量错峰","aria-label":'Permalink to "4.6 流量错峰"'},{default:a((()=>[r("​")])),_:1})]),Se,p("h4",Ce,[r("4.7 限流 & 熔断 & 降级 "),E(Ie,{class:"header-anchor",href:"#_4-7-限流-熔断-降级","aria-label":'Permalink to "4.7 限流 & 熔断 & 降级"'},{default:a((()=>[r("​")])),_:1})]),be,p("h4",Be,[r("4.8 队列消峰 "),E(Ie,{class:"header-anchor",href:"#_4-8-队列消峰","aria-label":'Permalink to "4.8 队列消峰"'},{default:a((()=>[r("​")])),_:1})]),ve,p("h3",fe,[r("5 限流 & 熔断 & 降级 "),E(Ie,{class:"header-anchor",href:"#_5-限流-熔断-降级","aria-label":'Permalink to "5 限流 & 熔断 & 降级"'},{default:a((()=>[r("​")])),_:1})])])),"main-header":a((()=>[y(s.$slots,"main-header")])),"main-header-after":a((()=>[y(s.$slots,"main-header-after")])),"main-nav":a((()=>[y(s.$slots,"main-nav")])),"main-content":a((()=>[y(s.$slots,"main-content")])),"main-content-after":a((()=>[y(s.$slots,"main-content-after")])),"main-nav-before":a((()=>[y(s.$slots,"main-nav-before")])),"main-nav-after":a((()=>[y(s.$slots,"main-nav-after")])),comment:a((()=>[y(s.$slots,"comment")])),footer:a((()=>[y(s.$slots,"footer")])),aside:a((()=>[y(s.$slots,"aside")])),"aside-custom":a((()=>[y(s.$slots,"aside-custom")])),default:a((()=>[y(s.$slots,"default")])),_:3},8,["frontmatter","data"])}]]);export{u as __pageData,Ie as default};
