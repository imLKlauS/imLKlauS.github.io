import{_ as s,h as l,p as o,j as n,k as e,l as a,m as c,s as p,t,v as r,q as E,x as y}from"../../assets/app-56b13812.js";import"../@vueuse/@vueuse.2d040ebb.js";import"../animejs/animejs.7aacf446.js";const i=JSON.parse('{"title":"分布式文件系统-minio","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/planet_clouds_light_94996_1920x1080.jpg","title":"分布式文件系统-minio","date":"2023-07-04T21:21:17.000Z","author":"imklaus","categories":"Java","tags":["Spring Cloud","Spring Boot","minio"],"top":240,"outline":"deep"},"headers":[{"level":2,"title":"一 分布式文件系统","slug":"一-分布式文件系统","link":"#一-分布式文件系统","children":[{"level":3,"title":"1.1 什么是分布式文件系统","slug":"_1-1-什么是分布式文件系统","link":"#_1-1-什么是分布式文件系统","children":[]},{"level":3,"title":"1.2 MinIO","slug":"_1-2-minio","link":"#_1-2-minio","children":[]}]},{"level":2,"title":"二 上传图片","slug":"二-上传图片","link":"#二-上传图片","children":[{"level":3,"title":"2.1 需求分析","slug":"_2-1-需求分析","link":"#_2-1-需求分析","children":[]},{"level":3,"title":"2.2 准备环境","slug":"_2-2-准备环境","link":"#_2-2-准备环境","children":[]},{"level":3,"title":"2.3 接口定义","slug":"_2-3-接口定义","link":"#_2-3-接口定义","children":[]},{"level":3,"title":"2.4 接口开发","slug":"_2-4-接口开发","link":"#_2-4-接口开发","children":[]}]},{"level":2,"title":"三 上传视频","slug":"三-上传视频","link":"#三-上传视频","children":[{"level":3,"title":"3.1 需求分析","slug":"_3-1-需求分析","link":"#_3-1-需求分析","children":[]},{"level":3,"title":"3.2 断点续传技术","slug":"_3-2-断点续传技术","link":"#_3-2-断点续传技术","children":[]},{"level":3,"title":"3.3 接口定义","slug":"_3-3-接口定义","link":"#_3-3-接口定义","children":[]},{"level":3,"title":"3.4 上传分块开发","slug":"_3-4-上传分块开发","link":"#_3-4-上传分块开发","children":[]},{"level":3,"title":"3.5 合并分块开发","slug":"_3-5-合并分块开发","link":"#_3-5-合并分块开发","children":[]}]},{"level":2,"title":"四 绑定媒资","slug":"四-绑定媒资","link":"#四-绑定媒资","children":[{"level":3,"title":"4.1 需求分析","slug":"_4-1-需求分析","link":"#_4-1-需求分析","children":[]},{"level":3,"title":"4.2 接口定义","slug":"_4-2-接口定义","link":"#_4-2-接口定义","children":[]},{"level":3,"title":"4.3 接口开发","slug":"_4-3-接口开发","link":"#_4-3-接口开发","children":[]},{"level":3,"title":"4.4 实战","slug":"_4-4-实战","link":"#_4-4-实战","children":[]}]}],"relativePath":"pages/posts/Distributed File System - minio.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-blog\\\\imklaus.github.io-main\\\\pages\\\\posts\\\\Distributed File System - minio.md","lastUpdated":null}'),F=JSON.parse('{"title":"分布式文件系统-minio","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/planet_clouds_light_94996_1920x1080.jpg","title":"分布式文件系统-minio","date":"2023-07-04T21:21:17.000Z","author":"imklaus","categories":"Java","tags":["Spring Cloud","Spring Boot","minio"],"top":240,"outline":"deep"},"headers":[{"level":2,"title":"一 分布式文件系统","slug":"一-分布式文件系统","link":"#一-分布式文件系统","children":[{"level":3,"title":"1.1 什么是分布式文件系统","slug":"_1-1-什么是分布式文件系统","link":"#_1-1-什么是分布式文件系统","children":[]},{"level":3,"title":"1.2 MinIO","slug":"_1-2-minio","link":"#_1-2-minio","children":[]}]},{"level":2,"title":"二 上传图片","slug":"二-上传图片","link":"#二-上传图片","children":[{"level":3,"title":"2.1 需求分析","slug":"_2-1-需求分析","link":"#_2-1-需求分析","children":[]},{"level":3,"title":"2.2 准备环境","slug":"_2-2-准备环境","link":"#_2-2-准备环境","children":[]},{"level":3,"title":"2.3 接口定义","slug":"_2-3-接口定义","link":"#_2-3-接口定义","children":[]},{"level":3,"title":"2.4 接口开发","slug":"_2-4-接口开发","link":"#_2-4-接口开发","children":[]}]},{"level":2,"title":"三 上传视频","slug":"三-上传视频","link":"#三-上传视频","children":[{"level":3,"title":"3.1 需求分析","slug":"_3-1-需求分析","link":"#_3-1-需求分析","children":[]},{"level":3,"title":"3.2 断点续传技术","slug":"_3-2-断点续传技术","link":"#_3-2-断点续传技术","children":[]},{"level":3,"title":"3.3 接口定义","slug":"_3-3-接口定义","link":"#_3-3-接口定义","children":[]},{"level":3,"title":"3.4 上传分块开发","slug":"_3-4-上传分块开发","link":"#_3-4-上传分块开发","children":[]},{"level":3,"title":"3.5 合并分块开发","slug":"_3-5-合并分块开发","link":"#_3-5-合并分块开发","children":[]}]},{"level":2,"title":"四 绑定媒资","slug":"四-绑定媒资","link":"#四-绑定媒资","children":[{"level":3,"title":"4.1 需求分析","slug":"_4-1-需求分析","link":"#_4-1-需求分析","children":[]},{"level":3,"title":"4.2 接口定义","slug":"_4-2-接口定义","link":"#_4-2-接口定义","children":[]},{"level":3,"title":"4.3 接口开发","slug":"_4-3-接口开发","link":"#_4-3-接口开发","children":[]},{"level":3,"title":"4.4 实战","slug":"_4-4-实战","link":"#_4-4-实战","children":[]}]}],"relativePath":"pages/posts/Distributed File System - minio.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-blog\\\\imklaus.github.io-main\\\\pages\\\\posts\\\\Distributed File System - minio.md","lastUpdated":null}'),d={name:"pages/posts/Distributed File System - minio.md",data:()=>({data:F,frontmatter:F.frontmatter,$frontmatter:F.frontmatter}),setup(){const s=l();s.meta.frontmatter=Object.assign(s.meta.frontmatter,F.frontmatter),o("pageData",F)}},u={id:"一-分布式文件系统",tabindex:"-1"},D=p("strong",null,"一 分布式文件系统",-1),m={id:"_1-1-什么是分布式文件系统",tabindex:"-1"},A=p("strong",null,"1.1 什么是分布式文件系统",-1),g=p("p",null,"要理解分布式文件系统首先了解什么是文件系统。",-1),C=p("p",null,"查阅百度百科：",-1),h=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps49.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),B=p("p",null,"​ 文件系统是负责管理和存储文件的系统软件，操作系统通过文件系统提供的接口去存取文件，用户通过操作系统访问磁盘上的文件。",-1),b=p("p",null,"下图指示了文件系统所处的位置：",-1),f=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps50.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),k=p("p",null,"常见的文件系统：FAT16/FAT32、NTFS、HFS、UFS、APFS、XFS、Ext4等 。",-1),S=p("p",null,"现在有个问题，一此短视频平台拥有大量的视频、图片，这些视频文件、图片文件该如何存储呢？如何存储可以满足互联网上海量用户的浏览。",-1),v=p("p",null,"今天讲的分布式文件系统就是海量用户查阅海量文件的方案。",-1),M=p("p",null,"我们阅读百度百科去理解分布式文件系统的定义：",-1),j=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps51.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),P=p("p",null,"通过概念可以简单理解为：一个计算机无法存储海量的文件，通过网络将若干计算机组织起来共同去存储海量的文件，去接收海量用户的请求，这些组织起来的计算机通过网络进行通信，如下图：",-1),_=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704215201202.png",alt:"image-20230704215201202",loading:"lazy",decoding:"async"})],-1),I=p("p",null,"好处：",-1),T=p("blockquote",null,[p("p",null,"1、一台计算机的文件系统处理能力扩充到多台计算机同时处理。"),p("p",null,"2、一台计算机挂了还有另外副本计算机提供数据。"),p("p",null,"3、每台计算机可以放在不同的地域，这样用户就可以就近访问，提高访问速度。")],-1),O=p("p",null,"市面上有哪些分布式文件系统的产品呢？",-1),R=p("p",null,"1、NFS",-1),x=p("p",null,"阅读百度百科：",-1),w=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps53.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),L=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps54.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),N=p("p",null,"特点：",-1),U=p("p",null,"1）在客户端上映射NFS服务器的驱动器。",-1),z=p("p",null,"2）客户端通过网络访问NFS服务器的硬盘完全透明。",-1),q=p("p",null,"2、GFS",-1),K=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps55.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),H=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps56.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),W=p("p",null,"1）GFS采用主从结构，一个GFS集群由一个master和大量的chunkserver组成。",-1),G=p("p",null,"2）master存储了数据文件的元数据，一个文件被分成了若干块存储在多个chunkserver中。",-1),$=p("p",null,"3）用户从master中获取数据元信息，向chunkserver存储数据。",-1),V=p("p",null,"3、HDFS",-1),X=p("p",null,"HDFS，是Hadoop Distributed File System的简称，是Hadoop抽象文件系统的一种实现。HDFS是一个高度容错性的系统，适合部署在廉价的机器上。HDFS能提供高吞吐量的数据访问，非常适合大规模数据集上的应用。 HDFS的文件分布在集群机器上，同时提供副本进行容错及可靠性保证。例如客户端写入读取文件的直接操作都是分布在集群各个机器上的，没有单点性能压力。",-1),J=p("p",null,"下图是HDFS的架构图：",-1),Q=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704215636100.png",alt:"image-20230704215636100",loading:"lazy",decoding:"async"})],-1),Y=p("p",null,"1）HDFS采用主从结构，一个HDFS集群由一个名称结点和若干数据结点组成。",-1),Z=p("p",null,"2）名称结点存储数据的元信息，一个完整的数据文件分成若干块存储在数据结点。",-1),ss=p("p",null,"3）客户端从名称结点获取数据的元信息及数据分块的信息，得到信息客户端即可从数据块来存取数据。",-1),ls=p("p",null,[p("strong",null,"4、云计算厂家")],-1),os=p("p",null,"阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。其数据设计持久性不低于 99.9999999999%（12 个 9），服务设计可用性（或业务连续性）不低于 99.995%。",-1),ns=p("em",null,"官方网站：",-1),es=p("em",null,"https://www.aliyun.com/product/oss",-1),as=p("p",null,"百度对象存储BOS提供稳定、安全、高效、高可扩展的云存储服务。您可以将任意数量和形式的非结构化数据存入BOS，并对数据进行管理和处理。BOS支持标准、低频、冷和归档存储等多种存储类型，满足多场景的存储需求。",-1),cs=p("em",null,"官方网站：",-1),ps=p("em",null,"https://cloud.baidu.com/product/bos.html",-1),ts={id:"_1-2-minio",tabindex:"-1"},rs=p("strong",null,"1.2 MinIO",-1),Es={id:"_1-2-1-介绍",tabindex:"-1"},ys=p("strong",null,"1.2.1 介绍",-1),is=p("p",null,"本项目采用MinIO构建分布式文件系统，MinIO 是一个非常轻量的服务,可以很简单的和其他应用的结合使用，它兼容亚马逊 S3 云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等。",-1),Fs=p("p",null,"它一大特点就是轻量，使用简单，功能强大，支持各种平台，单个文件最大5TB，兼容 Amazon S3接口，提供了 Java、Python、GO等多版本SDK支持。",-1),ds=p("p",null,"MinIO集群采用去中心化共享架构，每个结点是对等关系，通过Nginx可对MinIO进行负载均衡访问。",-1),us=p("p",null,"去中心化有什么好处？",-1),Ds=p("p",null,"在大数据领域，通常的设计理念都是无中心和分布式。Minio分布式模式可以帮助你搭建一个高可用的对象存储服务，你可以使用这些存储设备，而不用考虑其真实物理位置。",-1),ms=p("p",null,"它将分布在不同服务器上的多块硬盘组成一个对象存储服务。由于硬盘分布在不同的节点上，分布式Minio避免了单点故障。如下图：",-1),As=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps58.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),gs=p("p",null,"Minio使用纠删码技术来保护数据，它是一种恢复丢失和损坏数据的数学算法，它将数据分块冗余的分散存储在各各节点的磁盘上，所有的可用磁盘组成一个集合，上图由8块硬盘组成一个集合，当上传一个文件时会通过纠删码算法计算对文件进行分块存储，除了将文件本身分成4个数据块，还会生成4个校验块，数据块和校验块会分散的存储在这8块硬盘上。",-1),Cs=p("p",null,"使用纠删码的好处是即便丢失一半数量（N/2）的硬盘，仍然可以恢复数据。 比如上边集合中有4个以内的硬盘损害仍可保证数据恢复，不影响上传和下载，如果多于一半的硬盘坏了则无法恢复。",-1),hs={id:"_1-2-2-数据恢复演示",tabindex:"-1"},Bs=p("strong",null,"1.2.2 数据恢复演示",-1),bs=p("p",null,"下边在本机演示MinIO恢复数据的过程，在本地创建4个目录表示4个硬盘。",-1),fs=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps59.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),ks=p("div",{class:"language-shell"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"shell"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#B392F0"}},"minio.exe"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"server"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"D:"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"evelop"),p("span",{style:{color:"#79B8FF"}},"\\m"),p("span",{style:{color:"#9ECBFF"}},"inio_data"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"ata1"),p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#9ECBFF"}},"D:"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"evelop"),p("span",{style:{color:"#79B8FF"}},"\\m"),p("span",{style:{color:"#9ECBFF"}},"inio_data"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"ata2"),p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#9ECBFF"}},"D:"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"evelop"),p("span",{style:{color:"#79B8FF"}},"\\m"),p("span",{style:{color:"#9ECBFF"}},"inio_data"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"ata3"),p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#9ECBFF"}},"D:"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"evelop"),p("span",{style:{color:"#79B8FF"}},"\\m"),p("span",{style:{color:"#9ECBFF"}},"inio_data"),p("span",{style:{color:"#79B8FF"}},"\\d"),p("span",{style:{color:"#9ECBFF"}},"ata4")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6F42C1"}},"minio.exe"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"server"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"D:"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"evelop"),p("span",{style:{color:"#005CC5"}},"\\m"),p("span",{style:{color:"#032F62"}},"inio_data"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"ata1"),p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#032F62"}},"D:"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"evelop"),p("span",{style:{color:"#005CC5"}},"\\m"),p("span",{style:{color:"#032F62"}},"inio_data"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"ata2"),p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#032F62"}},"D:"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"evelop"),p("span",{style:{color:"#005CC5"}},"\\m"),p("span",{style:{color:"#032F62"}},"inio_data"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"ata3"),p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#032F62"}},"D:"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"evelop"),p("span",{style:{color:"#005CC5"}},"\\m"),p("span",{style:{color:"#032F62"}},"inio_data"),p("span",{style:{color:"#005CC5"}},"\\d"),p("span",{style:{color:"#032F62"}},"ata4")])])])],-1),Ss=p("p",null,"启动结果如下：",-1),vs=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps60.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Ms=p("p",null,"说明如下：",-1),js=p("p",null,[p("code",null,"WARNING: MINIO_ACCESS_KEY and MINIO_SECRET_KEY are deprecated. Please use MINIO_ROOT_USER and MINIO_ROOT_PASSWORD Formatting 1st pool, 1 set(s), 4 drives per set. WARNING: Host local has more than 2 drives of set. A host failure will result in data becoming unavailable. WARNING: Detected default credentials 'minioadmin:minioadmin', we recommend that you change these values with 'MINIO_ROOT_USER' and 'MINIO_ROOT_PASSWORD' environment variables")],-1),Ps=p("p",null,"1）老版本使用的MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY不推荐使用，推荐使用MINIO_ROOT_USER 和MINIO_ROOT_PASSWORD设置账号和密码。",-1),_s=p("p",null,"2）pool即minio节点组成的池子，当前有一个pool和4个硬盘组成的set集合",-1),Is=p("p",null,"3）因为集合是4个硬盘，大于2的硬盘损坏数据将无法恢复。",-1),Ts=p("p",null,"4）账号和密码默认为minioadmin、minioadmin，可以在环境变量中设置通过'MINIO_ROOT_USER' and 'MINIO_ROOT_PASSWORD' 进行设置。",-1),Os=p("p",null,"下边输入http://localhost:9000进行登录，账号和密码为：minioadmin/minioadmin",-1),Rs=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps61.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),xs=p("p",null,"登录成功：",-1),ws=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps62.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Ls=p("p",null,"下一步创建bucket，桶，它相当于存储文件的目录，可以创建若干的桶。",-1),Ns=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704220604232.png",alt:"image-20230704220604232",loading:"lazy",decoding:"async"})],-1),Us=p("p",null,"输入bucket的名称，点击“CreateBucket”，创建成功",-1),zs=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps64.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),qs=p("p",null,"点击“upload”上传文件。",-1),Ks=p("p",null,"下边上传几个文件",-1),Hs=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps65.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Ws=p("p",null,"下边去四个目录观察文件的存储情况",-1),Gs=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps66.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),$s=p("p",null,"我们发现上传的1.mp4文件存储在了四个目录，即四个硬盘上。",-1),Vs=p("p",null,"下边测试minio的数据恢复过程：",-1),Xs=p("p",null,"1、首先删除一个目录。",-1),Js=p("p",null,"删除目录后仍然可以在web控制台上传文件和下载文件。",-1),Qs=p("p",null,"稍等片刻删除的目录自动恢复。",-1),Ys=p("p",null,"2、删除两个目录。",-1),Zs=p("p",null,"删除两个目录也会自动恢复。",-1),sl=p("p",null,"3、删除三个目录 。",-1),ll=p("p",null,"由于 集合中共有4块硬盘，有大于一半的硬盘损坏数据无法恢复。",-1),ol=p("p",null,[t("此时报错："),p("code",null,"We encountered an internal error, please try again. (Read failed. Insufficient number of drives online)"),t("在线驱动器数量不足。")],-1),nl={id:"_1-2-3-测试docker环境",tabindex:"-1"},el=p("strong",null,"1.2.3 测试Docker环境",-1),al=p("p",null,"开发阶段和生产阶段统一使用Docker下的MINIO。",-1),cl=p("p",null,"在下发的虚拟机中已安装了MinIO的镜像和容器，执行sh /data/soft /restart.sh启动Docker下的MinIO",-1),pl=p("p",null,"启动完成登录MinIO查看是否正常。",-1),tl=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704221009748.png",alt:"image-20230704221009748",loading:"lazy",decoding:"async"})],-1),rl=p("p",null,"本项目创建两个buckets：",-1),El=p("p",null,"mediafiles： 普通文件",-1),yl=p("p",null,"video：视频文件",-1),il={id:"_1-2-4-sdk",tabindex:"-1"},Fl=p("strong",null,"1.2.4 SDK",-1),dl={id:"_1-2-4-1上传文件",tabindex:"-1"},ul=p("strong",null,"1.2.4.1上传文件",-1),Dl=p("p",null,"MinIO提供多个语言版本SDK的支持，下边找到java版本的文档：",-1),ml=p("p",null,"最低需求Java 1.8或更高版本:",-1),Al=p("p",null,"maven依赖如下：",-1),gl=p("div",{class:"language-xml"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"xml"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"<"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">io.minio</"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">minio</"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"version"),p("span",{style:{color:"#E1E4E8"}},">8.4.3</"),p("span",{style:{color:"#85E89D"}},"version"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"</"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"<"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">com.squareup.okhttp3</"),p("span",{style:{color:"#85E89D"}},"groupId"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">okhttp</"),p("span",{style:{color:"#85E89D"}},"artifactId"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    <"),p("span",{style:{color:"#85E89D"}},"version"),p("span",{style:{color:"#E1E4E8"}},">4.8.1</"),p("span",{style:{color:"#85E89D"}},"version"),p("span",{style:{color:"#E1E4E8"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"</"),p("span",{style:{color:"#85E89D"}},"dependency"),p("span",{style:{color:"#E1E4E8"}},">")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"<"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">io.minio</"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">minio</"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"version"),p("span",{style:{color:"#24292E"}},">8.4.3</"),p("span",{style:{color:"#22863A"}},"version"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"</"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"<"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">com.squareup.okhttp3</"),p("span",{style:{color:"#22863A"}},"groupId"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">okhttp</"),p("span",{style:{color:"#22863A"}},"artifactId"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    <"),p("span",{style:{color:"#22863A"}},"version"),p("span",{style:{color:"#24292E"}},">4.8.1</"),p("span",{style:{color:"#22863A"}},"version"),p("span",{style:{color:"#24292E"}},">")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"</"),p("span",{style:{color:"#22863A"}},"dependency"),p("span",{style:{color:"#24292E"}},">")])])])],-1),Cl=p("p",null,"在media-service工程添加此依赖。",-1),hl=p("p",null,"参数说明：",-1),Bl=p("p",null,"需要三个参数才能连接到minio服务。",-1),bl=p("table",null,[p("thead",null,[p("tr",null,[p("th",null,"参数"),p("th",null,"说明")])]),p("tbody",null,[p("tr",null,[p("td",null,"Endpoint"),p("td",null,"对象存储服务的URL")]),p("tr",null,[p("td",null,"Access Key"),p("td",null,"Access key就像用户ID，可以唯一标识你的账户。")]),p("tr",null,[p("td",null,"Secret Key"),p("td",null,"Secret key是你账户的密码。")])])],-1),fl=p("p",null,"官方的示例代码如下：",-1),kl=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.BucketExistsArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.MakeBucketArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.MinioClient;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.UploadObjectArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.errors.MinioException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," java.io.IOException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," java.security.InvalidKeyException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," java.security.NoSuchAlgorithmException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileUploader"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"static"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"main"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"String"),p("span",{style:{color:"#E1E4E8"}},"[] "),p("span",{style:{color:"#FFAB70"}},"args"),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," IOException, NoSuchAlgorithmException, InvalidKeyException {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#6A737D"}},"// Create a minioClient with the MinIO server playground, its access key and secret key.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      MinioClient minioClient "),p("span",{style:{color:"#F97583"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          MinioClient."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              ."),p("span",{style:{color:"#B392F0"}},"endpoint"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"https://play.min.io"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              ."),p("span",{style:{color:"#B392F0"}},"credentials"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"Q3AM3UQ867SPQQA43P2F"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#6A737D"}},"// Make 'asiatrip' bucket if not exist.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," found "),p("span",{style:{color:"#F97583"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          minioClient."),p("span",{style:{color:"#B392F0"}},"bucketExists"),p("span",{style:{color:"#E1E4E8"}},"(BucketExistsArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"asiatrip"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"found) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"// Make a new bucket called 'asiatrip'.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        minioClient."),p("span",{style:{color:"#B392F0"}},"makeBucket"),p("span",{style:{color:"#E1E4E8"}},"(MakeBucketArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"asiatrip"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      } "),p("span",{style:{color:"#F97583"}},"else"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},"\"Bucket 'asiatrip' already exists.\""),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#6A737D"}},"// Upload '/home/user/Photos/asiaphotos.zip' as object name 'asiaphotos-2015.zip' to bucket")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#6A737D"}},"// 'asiatrip'.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      minioClient."),p("span",{style:{color:"#B392F0"}},"uploadObject"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          UploadObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"asiatrip"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"asiaphotos-2015.zip"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              ."),p("span",{style:{color:"#B392F0"}},"filename"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/home/user/Photos/asiaphotos.zip"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          "),p("span",{style:{color:"#9ECBFF"}},"\"'/home/user/Photos/asiaphotos.zip' is successfully uploaded as \"")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"              "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"\"object 'asiaphotos-2015.zip' to bucket 'asiatrip'.\""),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (MinioException "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"Error occurred: "'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"HTTP trace: "'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," e."),p("span",{style:{color:"#B392F0"}},"httpTrace"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.BucketExistsArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.MakeBucketArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.MinioClient;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.UploadObjectArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.errors.MinioException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," java.io.IOException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," java.security.InvalidKeyException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," java.security.NoSuchAlgorithmException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileUploader"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"static"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"main"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"String"),p("span",{style:{color:"#24292E"}},"[] "),p("span",{style:{color:"#E36209"}},"args"),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," IOException, NoSuchAlgorithmException, InvalidKeyException {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#6A737D"}},"// Create a minioClient with the MinIO server playground, its access key and secret key.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      MinioClient minioClient "),p("span",{style:{color:"#D73A49"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          MinioClient."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              ."),p("span",{style:{color:"#6F42C1"}},"endpoint"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"https://play.min.io"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              ."),p("span",{style:{color:"#6F42C1"}},"credentials"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"Q3AM3UQ867SPQQA43P2F"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#6A737D"}},"// Make 'asiatrip' bucket if not exist.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," found "),p("span",{style:{color:"#D73A49"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          minioClient."),p("span",{style:{color:"#6F42C1"}},"bucketExists"),p("span",{style:{color:"#24292E"}},"(BucketExistsArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"asiatrip"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"found) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"// Make a new bucket called 'asiatrip'.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        minioClient."),p("span",{style:{color:"#6F42C1"}},"makeBucket"),p("span",{style:{color:"#24292E"}},"(MakeBucketArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"asiatrip"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      } "),p("span",{style:{color:"#D73A49"}},"else"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},"\"Bucket 'asiatrip' already exists.\""),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#6A737D"}},"// Upload '/home/user/Photos/asiaphotos.zip' as object name 'asiaphotos-2015.zip' to bucket")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#6A737D"}},"// 'asiatrip'.")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      minioClient."),p("span",{style:{color:"#6F42C1"}},"uploadObject"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          UploadObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"asiatrip"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"asiaphotos-2015.zip"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              ."),p("span",{style:{color:"#6F42C1"}},"filename"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/home/user/Photos/asiaphotos.zip"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          "),p("span",{style:{color:"#032F62"}},"\"'/home/user/Photos/asiaphotos.zip' is successfully uploaded as \"")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"              "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"\"object 'asiaphotos-2015.zip' to bucket 'asiatrip'.\""),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (MinioException "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"Error occurred: "'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"HTTP trace: "'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," e."),p("span",{style:{color:"#6F42C1"}},"httpTrace"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Sl=p("p",null,"参考示例在media-service工程中 测试上传文件功能，首先创建一个用于测试的bucket",-1),vl=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps68.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Ml=p("p",null,"点击“Manage”修改bucket的访问权限",-1),jl=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps69.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Pl=p("p",null,"选择public权限",-1),_l=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps70.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Il=p("p",null,"在xuecheng-plus-media-service工程 的test下编写测试代码如下：",-1),Tl=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.BucketExistsArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.MakeBucketArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.MinioClient;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.UploadObjectArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," io.minio.errors.MinioException;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," java.io.IOException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," java.security.InvalidKeyException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"import"),p("span",{style:{color:"#E1E4E8"}}," java.security.NoSuchAlgorithmException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MinioTest"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MinioClient minioClient "),p("span",{style:{color:"#F97583"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            MinioClient."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"endpoint"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"http://192.168.2.203:9000"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"credentials"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"minioadmin"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"minioadmin"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"test_upload"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            UploadObjectArgs testbucket "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"filename"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1.mp4"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"test/01/1.mp4"'),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"contentType"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"video/mp4"'),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#6A737D"}},"//默认根据扩展名确定文件内容类型，也可以指定")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            minioClient."),p("span",{style:{color:"#B392F0"}},"uploadObject"),p("span",{style:{color:"#E1E4E8"}},"(testbucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传成功"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传失败"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.BucketExistsArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.MakeBucketArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.MinioClient;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.UploadObjectArgs;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," io.minio.errors.MinioException;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," java.io.IOException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," java.security.InvalidKeyException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"import"),p("span",{style:{color:"#24292E"}}," java.security.NoSuchAlgorithmException;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MinioTest"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MinioClient minioClient "),p("span",{style:{color:"#D73A49"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            MinioClient."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"endpoint"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"http://192.168.2.203:9000"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"credentials"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"minioadmin"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"minioadmin"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"test_upload"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            UploadObjectArgs testbucket "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," UploadObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"filename"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1.mp4"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"test/01/1.mp4"'),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"contentType"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"video/mp4"'),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#6A737D"}},"//默认根据扩展名确定文件内容类型，也可以指定")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            minioClient."),p("span",{style:{color:"#6F42C1"}},"uploadObject"),p("span",{style:{color:"#24292E"}},"(testbucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传成功"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传失败"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Ol=p("p",null,"执行upload方法，分别测试向桶的根目录上传文件以及子目录上传文件。",-1),Rl=p("p",null,"上传成功，通过web控制台查看文件，并预览文件。",-1),xl=p("p",null,"说明：",-1),wl=p("p",null,"设置contentType可以通过com.j256.simplemagic.ContentType枚举类查看常用的mimeType（媒体类型）",-1),Ll=p("p",null,"通过扩展名得到mimeType，代码如下：",-1),Nl=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ContentInfo extensionMatch "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," ContentInfoUtil."),p("span",{style:{color:"#B392F0"}},"findExtensionMatch"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'".mp4"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),p("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ContentInfo extensionMatch "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," ContentInfoUtil."),p("span",{style:{color:"#6F42C1"}},"findExtensionMatch"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'".mp4"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),p("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")])])])],-1),Ul=p("p",null,"完善上边的代码 如下：",-1),zl=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"test_upload"),p("span",{style:{color:"#E1E4E8"}},"() throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//通过扩展名得到媒体资源类型 mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        ContentInfo extensionMatch "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," ContentInfoUtil."),p("span",{style:{color:"#B392F0"}},"findExtensionMatch"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'".mp4"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),p("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(extensionMatch"),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," extensionMatch."),p("span",{style:{color:"#B392F0"}},"getMimeType"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        UploadObjectArgs uploadObjectArgs "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"filename"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1.mp4"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"test/01/1.mp4"'),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"contentType"),p("span",{style:{color:"#E1E4E8"}},"(mimeType)"),p("span",{style:{color:"#6A737D"}},"//设置媒体文件类型")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        minioClient."),p("span",{style:{color:"#B392F0"}},"uploadObject"),p("span",{style:{color:"#E1E4E8"}},"(uploadObjectArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"test_upload"),p("span",{style:{color:"#24292E"}},"() throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//通过扩展名得到媒体资源类型 mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        ContentInfo extensionMatch "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," ContentInfoUtil."),p("span",{style:{color:"#6F42C1"}},"findExtensionMatch"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'".mp4"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),p("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(extensionMatch"),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," extensionMatch."),p("span",{style:{color:"#6F42C1"}},"getMimeType"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        UploadObjectArgs uploadObjectArgs "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," UploadObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"filename"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1.mp4"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"test/01/1.mp4"'),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"contentType"),p("span",{style:{color:"#24292E"}},"(mimeType)"),p("span",{style:{color:"#6A737D"}},"//设置媒体文件类型")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        minioClient."),p("span",{style:{color:"#6F42C1"}},"uploadObject"),p("span",{style:{color:"#24292E"}},"(uploadObjectArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])])],-1),ql={id:"_1-2-4-2-删除文件",tabindex:"-1"},Kl=p("strong",null,"1.2.4.2 删除文件",-1),Hl=p("p",null,"下边测试删除文件",-1),Wl=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"delete"),p("span",{style:{color:"#E1E4E8"}},"(){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        minioClient."),p("span",{style:{color:"#B392F0"}},"removeObject"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"               RemoveObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"001/test001.mp4"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"删除成功"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"删除失败"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"delete"),p("span",{style:{color:"#24292E"}},"(){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        minioClient."),p("span",{style:{color:"#6F42C1"}},"removeObject"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"               RemoveObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"001/test001.mp4"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"删除成功"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"删除失败"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Gl={id:"_1-2-4-3-查询文件",tabindex:"-1"},$l=p("strong",null,"1.2.4.3 查询文件",-1),Vl=p("p",null,"通过查询文件查看文件是否存在minio中。",-1),Xl=p("p",null,"校验文件的完整性，对文件计算出md5值，比较原始文件的md5和目标文件的md5，一致则说明完整",-1),Jl=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//查询文件 从minio中下载")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"test_getFile"),p("span",{style:{color:"#E1E4E8"}},"() throws Exception {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    GetObjectArgs getObjectArgs "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," GetObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"test/01/1.mp4"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//查询远程服务获取到一个流对象")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    FilterInputStream inputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," minioClient."),p("span",{style:{color:"#B392F0"}},"getObject"),p("span",{style:{color:"#E1E4E8"}},"(getObjectArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//指定输出流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    FileOutputStream outputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileOutputStream"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1a.mp4"'),p("span",{style:{color:"#E1E4E8"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    IOUtils."),p("span",{style:{color:"#B392F0"}},"copy"),p("span",{style:{color:"#E1E4E8"}},"(inputStream,outputStream);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//校验文件的完整性对文件的内容进行md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream1 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileInputStream"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1.mp4"'),p("span",{style:{color:"#E1E4E8"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String source_md5 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," DigestUtils."),p("span",{style:{color:"#B392F0"}},"md5Hex"),p("span",{style:{color:"#E1E4E8"}},"(fileInputStream1);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileInputStream"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1a.mp4"'),p("span",{style:{color:"#E1E4E8"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String local_md5 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," DigestUtils."),p("span",{style:{color:"#B392F0"}},"md5Hex"),p("span",{style:{color:"#E1E4E8"}},"(fileInputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(source_md5."),p("span",{style:{color:"#B392F0"}},"equals"),p("span",{style:{color:"#E1E4E8"}},"(local_md5)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"下载成功"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//查询文件 从minio中下载")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"test_getFile"),p("span",{style:{color:"#24292E"}},"() throws Exception {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    GetObjectArgs getObjectArgs "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," GetObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"test/01/1.mp4"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//查询远程服务获取到一个流对象")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    FilterInputStream inputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," minioClient."),p("span",{style:{color:"#6F42C1"}},"getObject"),p("span",{style:{color:"#24292E"}},"(getObjectArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//指定输出流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    FileOutputStream outputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileOutputStream"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1a.mp4"'),p("span",{style:{color:"#24292E"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    IOUtils."),p("span",{style:{color:"#6F42C1"}},"copy"),p("span",{style:{color:"#24292E"}},"(inputStream,outputStream);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//校验文件的完整性对文件的内容进行md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream1 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileInputStream"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1.mp4"'),p("span",{style:{color:"#24292E"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String source_md5 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," DigestUtils."),p("span",{style:{color:"#6F42C1"}},"md5Hex"),p("span",{style:{color:"#24292E"}},"(fileInputStream1);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileInputStream"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1a.mp4"'),p("span",{style:{color:"#24292E"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String local_md5 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," DigestUtils."),p("span",{style:{color:"#6F42C1"}},"md5Hex"),p("span",{style:{color:"#24292E"}},"(fileInputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(source_md5."),p("span",{style:{color:"#6F42C1"}},"equals"),p("span",{style:{color:"#24292E"}},"(local_md5)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"下载成功"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Ql={id:"二-上传图片",tabindex:"-1"},Yl=p("strong",null,"二 上传图片",-1),Zl={id:"_2-1-需求分析",tabindex:"-1"},so=p("strong",null,"2.1 需求分析",-1),lo={id:"_2-1-1-业务流程",tabindex:"-1"},oo=p("strong",null,"2.1.1 业务流程",-1),no=p("p",null,"课程图片是宣传课程非常重要的信息，在新增课程界面上传课程图片，也可以修改课程图片。",-1),eo=p("p",null,"如下图：",-1),ao=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704224229162.png",alt:"image-20230704224229162",loading:"lazy",decoding:"async"})],-1),co=p("p",null,"上传课程图片总体上包括两部分：",-1),po=p("p",null,"1、上传课程图片前端请求媒资管理服务将文件上传至分布式文件系统，并且在媒资管理数据库保存文件信息。",-1),to=p("p",null,"2、上传图片成功保存图片地址到课程基本信息表中。",-1),ro=p("p",null,"详细流程如下：",-1),Eo=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps72.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),yo=p("p",null,"1、前端进入上传图片界面",-1),io=p("p",null,"2、上传图片，请求媒资管理服务。",-1),Fo=p("p",null,"3、媒资管理服务将图片文件存储在MinIO。",-1),uo=p("p",null,"4、媒资管理记录文件信息到数据库。",-1),Do=p("p",null,"5、前端请求内容管理服务保存课程信息，在内容管理数据库保存图片地址。",-1),mo={id:"_2-1-2-数据模型",tabindex:"-1"},Ao=p("strong",null,"2.1.2 数据模型",-1),go=p("p",null,"涉及到的数据表有：课程信息表中的图片字段、媒资数据库的文件表，下边主要看媒资数据库的文件表。",-1),Co=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps73.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),ho=p("p",null,"各字段描述如下：",-1),Bo=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps74.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),bo={id:"_2-2-准备环境",tabindex:"-1"},fo=p("strong",null,"2.2 准备环境",-1),ko=p("p",null,"首先在minio配置bucket，bucket名称为：mediafiles，并设置bucket的权限为公开。",-1),So=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps75.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),vo=p("p",null,[t("在nacos配置中minio的相关信息，进入"),p("code",null,"media-service-dev.yaml"),t(":")],-1),Mo=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps76.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),jo=p("p",null,"配置信息如下：",-1),Po=p("div",{class:"language-yaml"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"yaml"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"minio"),p("span",{style:{color:"#E1E4E8"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#85E89D"}},"endpoint"),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},"http://192.168.2.203:9000")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#85E89D"}},"accessKey"),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},"minioadmin")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#85E89D"}},"secretKey"),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},"minioadmin")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#85E89D"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#85E89D"}},"files"),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},"mediafiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#85E89D"}},"videofiles"),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},"video")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"minio"),p("span",{style:{color:"#24292E"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#22863A"}},"endpoint"),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},"http://192.168.2.203:9000")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#22863A"}},"accessKey"),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},"minioadmin")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#22863A"}},"secretKey"),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},"minioadmin")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#22863A"}},"bucket"),p("span",{style:{color:"#24292E"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#22863A"}},"files"),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},"mediafiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#22863A"}},"videofiles"),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},"video")])])])],-1),_o=p("p",null,"在media-service工程编写minio的配置类：",-1),Io=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Configuration")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MinioConfig"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," @"),p("span",{style:{color:"#F97583"}},"Value"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"${minio.endpoint}"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String endpoint;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," @"),p("span",{style:{color:"#F97583"}},"Value"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"${minio.accessKey}"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String accessKey;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," @"),p("span",{style:{color:"#F97583"}},"Value"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"${minio.secretKey}"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String secretKey;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," @"),p("span",{style:{color:"#F97583"}},"Bean")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," MinioClient "),p("span",{style:{color:"#B392F0"}},"minioClient"),p("span",{style:{color:"#E1E4E8"}},"() {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  MinioClient minioClient "),p("span",{style:{color:"#F97583"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"          MinioClient."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                  ."),p("span",{style:{color:"#B392F0"}},"endpoint"),p("span",{style:{color:"#E1E4E8"}},"(endpoint)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                  ."),p("span",{style:{color:"#B392F0"}},"credentials"),p("span",{style:{color:"#E1E4E8"}},"(accessKey, secretKey)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                  ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," minioClient;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Configuration")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MinioConfig"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," @"),p("span",{style:{color:"#D73A49"}},"Value"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"${minio.endpoint}"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String endpoint;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," @"),p("span",{style:{color:"#D73A49"}},"Value"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"${minio.accessKey}"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String accessKey;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," @"),p("span",{style:{color:"#D73A49"}},"Value"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"${minio.secretKey}"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String secretKey;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," @"),p("span",{style:{color:"#D73A49"}},"Bean")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," MinioClient "),p("span",{style:{color:"#6F42C1"}},"minioClient"),p("span",{style:{color:"#24292E"}},"() {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  MinioClient minioClient "),p("span",{style:{color:"#D73A49"}},"=")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"          MinioClient."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                  ."),p("span",{style:{color:"#6F42C1"}},"endpoint"),p("span",{style:{color:"#24292E"}},"(endpoint)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                  ."),p("span",{style:{color:"#6F42C1"}},"credentials"),p("span",{style:{color:"#24292E"}},"(accessKey, secretKey)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                  ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," minioClient;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),To={id:"_2-3-接口定义",tabindex:"-1"},Oo=p("strong",null,"2.3 接口定义",-1),Ro=p("p",null,"根据需求分析，下边进行接口定义，此接口定义为一个通用的上传文件接口，可以上传图片或其它文件。",-1),xo=p("p",null,"首先分析接口：",-1),wo=p("blockquote",null,[p("p",null,"请求地址：/media/upload/coursefile"),p("p",null,[t("请求内容："),p("strong",null,"Content-Type:"),t(" multipart/form-data;")]),p("p",null,'form-data; name="filedata"; filename="具体的文件名称"')],-1),Lo=p("p",null,"响应参数：文件信息，如下",-1),No=p("div",{class:"language-json"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"json"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"id"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"a16da7a132559daf9e1193166b3e7f52"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"companyId"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"1232141425"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"companyName"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"filename"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"1.jpg"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"fileType"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"001001"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"tags"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"bucket"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"fileId"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"a16da7a132559daf9e1193166b3e7f52"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"url"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"timelength"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"username"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"createDate"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"2022-09-12T21:57:18"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"changeDate"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"status"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"1"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"remark"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"auditStatus"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"auditMind"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"fileSize"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"248329")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"id"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"a16da7a132559daf9e1193166b3e7f52"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"companyId"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"1232141425"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"companyName"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"filename"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"1.jpg"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"fileType"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"001001"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"tags"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"bucket"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"fileId"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"a16da7a132559daf9e1193166b3e7f52"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"url"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"timelength"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"username"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"createDate"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"2022-09-12T21:57:18"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"changeDate"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"status"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"1"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"remark"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"auditStatus"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"auditMind"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"fileSize"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"248329")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Uo=p("p",null,"定义上传响应模型类：",-1),zo=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 上传普通文件成功响应结果")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"UploadFileResultDto"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"extends"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MediaFiles"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 上传普通文件成功响应结果")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"UploadFileResultDto"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"extends"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MediaFiles"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),qo=p("p",null,"定义接口如下：",-1),Ko=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"RequestMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/upload/coursefile"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"consumes"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),p("span",{style:{color:"#B392F0"}},"upload"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestPart"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"filedata"'),p("span",{style:{color:"#E1E4E8"}},") MultipartFile upload) throws IOException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"RequestMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/upload/coursefile"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"consumes"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," UploadFileResultDto "),p("span",{style:{color:"#6F42C1"}},"upload"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestPart"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"filedata"'),p("span",{style:{color:"#24292E"}},") MultipartFile upload) throws IOException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Ho=p("p",null,"接口定义好后可以用httpclient工具测试一下",-1),Wo=p("p",null,"使用httpclient测试",-1),Go=p("div",{class:"language-http"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"http"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"POST"),p("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/upload/coursefile")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"Content-Type"),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"multipart/form-data; boundary=WebAppBoundary")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"--WebAppBoundary")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"Content-Disposition"),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'form-data; name="filedata"; filename="1.jpg"')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"Content-Type"),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"application/octet-stream")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"< d:/develop/upload/1.jpg")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"POST"),p("span",{style:{color:"#24292E"}}," {{media_host}}/media/upload/coursefile")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"Content-Type"),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"multipart/form-data; boundary=WebAppBoundary")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"--WebAppBoundary")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"Content-Disposition"),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'form-data; name="filedata"; filename="1.jpg"')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"Content-Type"),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"application/octet-stream")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"< d:/develop/upload/1.jpg")])])])],-1),$o={id:"_2-4-接口开发",tabindex:"-1"},Vo=p("strong",null,"2.4 接口开发",-1),Xo={id:"_2-4-1-dao开发",tabindex:"-1"},Jo=p("strong",null,"2.4.1 DAO开发",-1),Qo=p("p",null,[t("根据需求分析DAO层实现向"),p("code",null,"media_files"),t("表插入一条记录，使用"),p("code",null,"media_files"),t("表生成的mapper即可。")],-1),Yo={id:"_2-4-2-service开发",tabindex:"-1"},Zo=p("strong",null,"2.4.2 Service开发",-1),sn=p("p",null,"Service方法需要提供一个更加通用的保存文件的方法。",-1),ln=p("p",null,"定义请求参数类：",-1),on=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 上传普通文件请求参数")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," @"),p("span",{style:{color:"#F97583"}},"Data")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String filename;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 文件类型（文档，音频，视频）")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String fileType;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long fileSize;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 标签")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String tags;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 上传人")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String username;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 备注")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String remark;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 上传普通文件请求参数")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," @"),p("span",{style:{color:"#D73A49"}},"Data")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String filename;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 文件类型（文档，音频，视频）")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String fileType;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long fileSize;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 标签")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String tags;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 上传人")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String username;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," /**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  * 备注")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"  */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String remark;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),nn=p("p",null,"定义service方法：",-1),en=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"companyId"),p("span",{style:{color:"#6A737D"}}," 机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}}," 上传文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"localFilePath"),p("span",{style:{color:"#6A737D"}}," 文件磁盘路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," 文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),p("span",{style:{color:"#B392F0"}},"uploadFile"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//修改版")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),p("span",{style:{color:"#B392F0"}},"uploadFile"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"companyId"),p("span",{style:{color:"#6A737D"}}," 机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}}," 上传文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"localFilePath"),p("span",{style:{color:"#6A737D"}}," 文件磁盘路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," 文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," UploadFileResultDto "),p("span",{style:{color:"#6F42C1"}},"uploadFile"),p("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//修改版")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," UploadFileResultDto "),p("span",{style:{color:"#6F42C1"}},"uploadFile"),p("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName);")])])])],-1),an=p("p",null,"实现方法如下：",-1),cn=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"MinioClient minioClient;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"MediaFilesMapper mediaFilesMapper;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//普通文件桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Value"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"${minio.bucket.files}"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String bucket_Files;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//获取文件默认存储目录路径 年/月/日")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"getDefaultFolderPath"),p("span",{style:{color:"#E1E4E8"}},"() {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    SimpleDateFormat sdf "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"SimpleDateFormat"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"yyyy-MM-dd"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String folder "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," sdf."),p("span",{style:{color:"#B392F0"}},"format"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"Date"),p("span",{style:{color:"#E1E4E8"}},"())."),p("span",{style:{color:"#B392F0"}},"replace"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"-"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," folder;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//获取文件的md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"getFileMd5"),p("span",{style:{color:"#E1E4E8"}},"(File file) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," (FileInputStream fileInputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileInputStream"),p("span",{style:{color:"#E1E4E8"}},"(file)) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String fileMd5 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," DigestUtils."),p("span",{style:{color:"#B392F0"}},"md5Hex"),p("span",{style:{color:"#E1E4E8"}},"(fileInputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," fileMd5;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"getMimeType"),p("span",{style:{color:"#E1E4E8"}},"(String extension){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(extension"),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        extension "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ContentInfo extensionMatch "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," ContentInfoUtil."),p("span",{style:{color:"#B392F0"}},"findExtensionMatch"),p("span",{style:{color:"#E1E4E8"}},"(extension);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(extensionMatch"),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," extensionMatch."),p("span",{style:{color:"#B392F0"}},"getMimeType"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mimeType;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件写入minIO")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"localFilePath"),p("span",{style:{color:"#6A737D"}},"  文件地址")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," void")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#E1E4E8"}},"(String localFilePath,String mimeType,String bucket, String objectName) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        UploadObjectArgs testbucket "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"(objectName)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"filename"),p("span",{style:{color:"#E1E4E8"}},"(localFilePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"contentType"),p("span",{style:{color:"#E1E4E8"}},"(mimeType)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        minioClient."),p("span",{style:{color:"#B392F0"}},"uploadObject"),p("span",{style:{color:"#E1E4E8"}},"(testbucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传文件到minio成功,bucket:{},objectName:{}"'),p("span",{style:{color:"#E1E4E8"}},",bucket,objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传成功"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"error"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传文件到minio出错,bucket:{},objectName:{},错误原因:{}"'),p("span",{style:{color:"#E1E4E8"}},",bucket,objectName,e."),p("span",{style:{color:"#B392F0"}},"getMessage"),p("span",{style:{color:"#E1E4E8"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),p("span",{style:{color:"#B392F0"}},"cast"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传文件到文件系统失败"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," MediaFiles "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//从数据库查询文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),p("span",{style:{color:"#B392F0"}},"selectById"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (mediaFiles "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MediaFiles"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//拷贝基本信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        BeanUtils."),p("span",{style:{color:"#B392F0"}},"copyProperties"),p("span",{style:{color:"#E1E4E8"}},"(uploadFileParamsDto, mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setId"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setFileId"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setCompanyId"),p("span",{style:{color:"#E1E4E8"}},"(companyId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setUrl"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," bucket "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setBucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setFilePath"),p("span",{style:{color:"#E1E4E8"}},"(objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setCreateDate"),p("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),p("span",{style:{color:"#B392F0"}},"now"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setAuditStatus"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"002003"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setStatus"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"1"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//保存文件信息到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," insert "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),p("span",{style:{color:"#B392F0"}},"insert"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (insert "),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            log."),p("span",{style:{color:"#B392F0"}},"error"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库失败,{}"'),p("span",{style:{color:"#E1E4E8"}},",mediaFiles."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            XueChengPlusException."),p("span",{style:{color:"#B392F0"}},"cast"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"保存文件信息失败"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库成功,{}"'),p("span",{style:{color:"#E1E4E8"}},",mediaFiles."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mediaFiles;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),p("span",{style:{color:"#B392F0"}},"uploadFile"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File file "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"(localFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"file."),p("span",{style:{color:"#B392F0"}},"exists"),p("span",{style:{color:"#E1E4E8"}},"()) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),p("span",{style:{color:"#B392F0"}},"cast"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"文件不存在"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String filename "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"getFilename"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String extension "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," filename."),p("span",{style:{color:"#B392F0"}},"substring"),p("span",{style:{color:"#E1E4E8"}},"(filename."),p("span",{style:{color:"#B392F0"}},"lastIndexOf"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"."'),p("span",{style:{color:"#E1E4E8"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getMimeType"),p("span",{style:{color:"#E1E4E8"}},"(extension);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件的md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String fileMd5 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getFileMd5"),p("span",{style:{color:"#E1E4E8"}},"(file);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件的默认目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String defaultFolderPath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getDefaultFolderPath"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//存储到minio中的对象名(带目录)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String  objectName "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," defaultFolderPath "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," fileMd5 "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," exension;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件上传到minio")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," b "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#E1E4E8"}},"(localFilePath, mimeType, bucket_files, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileSize"),p("span",{style:{color:"#E1E4E8"}},"(file."),p("span",{style:{color:"#B392F0"}},"length"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件信息存储到数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备返回数据")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"UploadFileResultDto"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    BeanUtils."),p("span",{style:{color:"#B392F0"}},"copyProperties"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles, uploadFileResultDto);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"MinioClient minioClient;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"MediaFilesMapper mediaFilesMapper;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//普通文件桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Value"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"${minio.bucket.files}"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String bucket_Files;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//获取文件默认存储目录路径 年/月/日")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"getDefaultFolderPath"),p("span",{style:{color:"#24292E"}},"() {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    SimpleDateFormat sdf "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"SimpleDateFormat"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"yyyy-MM-dd"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String folder "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," sdf."),p("span",{style:{color:"#6F42C1"}},"format"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"Date"),p("span",{style:{color:"#24292E"}},"())."),p("span",{style:{color:"#6F42C1"}},"replace"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"-"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," folder;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//获取文件的md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"getFileMd5"),p("span",{style:{color:"#24292E"}},"(File file) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," (FileInputStream fileInputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileInputStream"),p("span",{style:{color:"#24292E"}},"(file)) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String fileMd5 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," DigestUtils."),p("span",{style:{color:"#6F42C1"}},"md5Hex"),p("span",{style:{color:"#24292E"}},"(fileInputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," fileMd5;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"getMimeType"),p("span",{style:{color:"#24292E"}},"(String extension){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(extension"),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        extension "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ContentInfo extensionMatch "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," ContentInfoUtil."),p("span",{style:{color:"#6F42C1"}},"findExtensionMatch"),p("span",{style:{color:"#24292E"}},"(extension);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(extensionMatch"),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," extensionMatch."),p("span",{style:{color:"#6F42C1"}},"getMimeType"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mimeType;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件写入minIO")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"localFilePath"),p("span",{style:{color:"#6A737D"}},"  文件地址")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," void")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#24292E"}},"(String localFilePath,String mimeType,String bucket, String objectName) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        UploadObjectArgs testbucket "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," UploadObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"(bucket)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"(objectName)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"filename"),p("span",{style:{color:"#24292E"}},"(localFilePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"contentType"),p("span",{style:{color:"#24292E"}},"(mimeType)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        minioClient."),p("span",{style:{color:"#6F42C1"}},"uploadObject"),p("span",{style:{color:"#24292E"}},"(testbucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传文件到minio成功,bucket:{},objectName:{}"'),p("span",{style:{color:"#24292E"}},",bucket,objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传成功"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"error"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传文件到minio出错,bucket:{},objectName:{},错误原因:{}"'),p("span",{style:{color:"#24292E"}},",bucket,objectName,e."),p("span",{style:{color:"#6F42C1"}},"getMessage"),p("span",{style:{color:"#24292E"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        XueChengPlusException."),p("span",{style:{color:"#6F42C1"}},"cast"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传文件到文件系统失败"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," MediaFiles "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//从数据库查询文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFilesMapper."),p("span",{style:{color:"#6F42C1"}},"selectById"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (mediaFiles "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MediaFiles"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//拷贝基本信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        BeanUtils."),p("span",{style:{color:"#6F42C1"}},"copyProperties"),p("span",{style:{color:"#24292E"}},"(uploadFileParamsDto, mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setId"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setFileId"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setCompanyId"),p("span",{style:{color:"#24292E"}},"(companyId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setUrl"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," bucket "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setBucket"),p("span",{style:{color:"#24292E"}},"(bucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setFilePath"),p("span",{style:{color:"#24292E"}},"(objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setCreateDate"),p("span",{style:{color:"#24292E"}},"(LocalDateTime."),p("span",{style:{color:"#6F42C1"}},"now"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setAuditStatus"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"002003"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setStatus"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"1"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//保存文件信息到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," insert "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFilesMapper."),p("span",{style:{color:"#6F42C1"}},"insert"),p("span",{style:{color:"#24292E"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (insert "),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            log."),p("span",{style:{color:"#6F42C1"}},"error"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"保存文件信息到数据库失败,{}"'),p("span",{style:{color:"#24292E"}},",mediaFiles."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            XueChengPlusException."),p("span",{style:{color:"#6F42C1"}},"cast"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"保存文件信息失败"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"保存文件信息到数据库成功,{}"'),p("span",{style:{color:"#24292E"}},",mediaFiles."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mediaFiles;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," UploadFileResultDto "),p("span",{style:{color:"#6F42C1"}},"uploadFile"),p("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File file "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"(localFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"file."),p("span",{style:{color:"#6F42C1"}},"exists"),p("span",{style:{color:"#24292E"}},"()) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        XueChengPlusException."),p("span",{style:{color:"#6F42C1"}},"cast"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"文件不存在"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String filename "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"getFilename"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String extension "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," filename."),p("span",{style:{color:"#6F42C1"}},"substring"),p("span",{style:{color:"#24292E"}},"(filename."),p("span",{style:{color:"#6F42C1"}},"lastIndexOf"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"."'),p("span",{style:{color:"#24292E"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getMimeType"),p("span",{style:{color:"#24292E"}},"(extension);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件的md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String fileMd5 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getFileMd5"),p("span",{style:{color:"#24292E"}},"(file);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件的默认目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String defaultFolderPath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getDefaultFolderPath"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//存储到minio中的对象名(带目录)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String  objectName "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," defaultFolderPath "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," fileMd5 "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," exension;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件上传到minio")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," b "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#24292E"}},"(localFilePath, mimeType, bucket_files, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileSize"),p("span",{style:{color:"#24292E"}},"(file."),p("span",{style:{color:"#6F42C1"}},"length"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件信息存储到数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备返回数据")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"UploadFileResultDto"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    BeanUtils."),p("span",{style:{color:"#6F42C1"}},"copyProperties"),p("span",{style:{color:"#24292E"}},"(mediaFiles, uploadFileResultDto);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),pn=p("p",null,"修改版",-1),tn=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//将文件信息添加到文件表添加到service接口")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"MediaFiles "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/*-----------------------------------------------------------------------------------------------------------------------*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//注入自身")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"MediaFileService currentProxy;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," MediaFiles "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        MediaFiles mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),p("span",{style:{color:"#B392F0"}},"selectById"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MediaFiles"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            BeanUtils."),p("span",{style:{color:"#B392F0"}},"copyProperties"),p("span",{style:{color:"#E1E4E8"}},"(uploadFileParamsDto,mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//文件id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setId"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setCompanyId"),p("span",{style:{color:"#E1E4E8"}},"(companyId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setBucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//file_path")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setFilePath"),p("span",{style:{color:"#E1E4E8"}},"(objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//file_id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setFileId"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//url")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setUrl"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"bucket"),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//上传时间")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setCreateDate"),p("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),p("span",{style:{color:"#B392F0"}},"now"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setStatus"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"1"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//审核状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),p("span",{style:{color:"#B392F0"}},"setAuditStatus"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"002003"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//插入数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," insert "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),p("span",{style:{color:"#B392F0"}},"insert"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(insert"),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),p("span",{style:{color:"#E1E4E8"}},",bucket,objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#B392F0"}},"addWaitingTask"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库成功,{}"'),p("span",{style:{color:"#E1E4E8"}},", mediaFiles."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mediaFiles;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),p("span",{style:{color:"#B392F0"}},"uploadFile"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName) {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String filename "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"getFilename"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//先得到扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String extension "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," filename."),p("span",{style:{color:"#B392F0"}},"substring"),p("span",{style:{color:"#E1E4E8"}},"(filename."),p("span",{style:{color:"#B392F0"}},"lastIndexOf"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"."'),p("span",{style:{color:"#E1E4E8"}},"));")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getMimeType"),p("span",{style:{color:"#E1E4E8"}},"(extension);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//子目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String defaultFolderPath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getDefaultFolderPath"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件的md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String fileMd5 "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getFileMd5"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"(localFilePath));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (StringUtil."),p("span",{style:{color:"#B392F0"}},"isEmpty"),p("span",{style:{color:"#E1E4E8"}},"(objectName)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//                      2023/6/23/  adgfgetgwg24f4gr.jpg")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        objectName "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," defaultFolderPath"),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"fileMd5"),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"extension;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传文件到minio")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," result "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#E1E4E8"}},"(localFilePath, mimeType, bucket_mediafiles, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"result){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),p("span",{style:{color:"#B392F0"}},"cast"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传文件失败"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//入库文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," currentProxy."),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_mediafiles, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles"),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),p("span",{style:{color:"#B392F0"}},"cast"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"文件上传后保存信息失败"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备返回的对象")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"UploadFileResultDto"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    BeanUtils."),p("span",{style:{color:"#B392F0"}},"copyProperties"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles,uploadFileResultDto);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//将文件信息添加到文件表添加到service接口")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"MediaFiles "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/*-----------------------------------------------------------------------------------------------------------------------*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//注入自身")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"MediaFileService currentProxy;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"     */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," MediaFiles "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        MediaFiles mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFilesMapper."),p("span",{style:{color:"#6F42C1"}},"selectById"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(mediaFiles "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MediaFiles"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            BeanUtils."),p("span",{style:{color:"#6F42C1"}},"copyProperties"),p("span",{style:{color:"#24292E"}},"(uploadFileParamsDto,mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//文件id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setId"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setCompanyId"),p("span",{style:{color:"#24292E"}},"(companyId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setBucket"),p("span",{style:{color:"#24292E"}},"(bucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//file_path")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setFilePath"),p("span",{style:{color:"#24292E"}},"(objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//file_id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setFileId"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//url")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setUrl"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"bucket"),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//上传时间")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setCreateDate"),p("span",{style:{color:"#24292E"}},"(LocalDateTime."),p("span",{style:{color:"#6F42C1"}},"now"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setStatus"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"1"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//审核状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setAuditStatus"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"002003"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//插入数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," insert "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFilesMapper."),p("span",{style:{color:"#6F42C1"}},"insert"),p("span",{style:{color:"#24292E"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(insert"),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),p("span",{style:{color:"#24292E"}},",bucket,objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6F42C1"}},"addWaitingTask"),p("span",{style:{color:"#24292E"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"保存文件信息到数据库成功,{}"'),p("span",{style:{color:"#24292E"}},", mediaFiles."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mediaFiles;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," UploadFileResultDto "),p("span",{style:{color:"#6F42C1"}},"uploadFile"),p("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName) {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String filename "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"getFilename"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//先得到扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String extension "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," filename."),p("span",{style:{color:"#6F42C1"}},"substring"),p("span",{style:{color:"#24292E"}},"(filename."),p("span",{style:{color:"#6F42C1"}},"lastIndexOf"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"."'),p("span",{style:{color:"#24292E"}},"));")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getMimeType"),p("span",{style:{color:"#24292E"}},"(extension);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//子目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String defaultFolderPath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getDefaultFolderPath"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件的md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String fileMd5 "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getFileMd5"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"(localFilePath));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (StringUtil."),p("span",{style:{color:"#6F42C1"}},"isEmpty"),p("span",{style:{color:"#24292E"}},"(objectName)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//                      2023/6/23/  adgfgetgwg24f4gr.jpg")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        objectName "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," defaultFolderPath"),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"fileMd5"),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"extension;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传文件到minio")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," result "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#24292E"}},"(localFilePath, mimeType, bucket_mediafiles, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"result){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        XueChengPlusException."),p("span",{style:{color:"#6F42C1"}},"cast"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传文件失败"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//入库文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," currentProxy."),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_mediafiles, objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(mediaFiles"),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        XueChengPlusException."),p("span",{style:{color:"#6F42C1"}},"cast"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"文件上传后保存信息失败"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//准备返回的对象")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"UploadFileResultDto"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    BeanUtils."),p("span",{style:{color:"#6F42C1"}},"copyProperties"),p("span",{style:{color:"#24292E"}},"(mediaFiles,uploadFileResultDto);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),rn={id:"_2-4-3-完善接口层",tabindex:"-1"},En=p("strong",null,"2.4.3 完善接口层",-1),yn=p("p",null,"完善接口层代码 ：",-1),Fn=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"RequestMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/upload/coursefile"'),p("span",{style:{color:"#E1E4E8"}},","),p("span",{style:{color:"#79B8FF"}},"consumes"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ResponseBody")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),p("span",{style:{color:"#B392F0"}},"upload"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestPart"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"filedata"'),p("span",{style:{color:"#E1E4E8"}},") MultipartFile upload,@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"folder"'),p("span",{style:{color:"#E1E4E8"}},","),p("span",{style:{color:"#79B8FF"}},"required"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},") String folder,@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"objectName"'),p("span",{style:{color:"#E1E4E8"}},","),p("span",{style:{color:"#79B8FF"}},"required"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},") String objectName) throws IOException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Long companyId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1232141425L"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    UploadFileParamsDto uploadFileParamsDto "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileSize"),p("span",{style:{color:"#E1E4E8"}},"(filedata."),p("span",{style:{color:"#B392F0"}},"getSize"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//图片")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileType"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"001001"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFilename"),p("span",{style:{color:"#E1E4E8"}},"(filedata."),p("span",{style:{color:"#B392F0"}},"getOriginalFilename"),p("span",{style:{color:"#E1E4E8"}},"());"),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"long"),p("span",{style:{color:"#E1E4E8"}}," fileSize "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," filedata."),p("span",{style:{color:"#B392F0"}},"getSize"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileSize"),p("span",{style:{color:"#E1E4E8"}},"(fileSize);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//创建临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File tempFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," File."),p("span",{style:{color:"#B392F0"}},"createTempFile"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"minio"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"temp"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    filedata."),p("span",{style:{color:"#B392F0"}},"transferTo"),p("span",{style:{color:"#E1E4E8"}},"(tempFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String absolutePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," tempFile."),p("span",{style:{color:"#B392F0"}},"getAbsolutePath"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFileService."),p("span",{style:{color:"#B392F0"}},"uploadFile"),p("span",{style:{color:"#E1E4E8"}},"(companyId, uploadFileParamsDto, absolutePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"\t"),p("span",{style:{color:"#6A737D"}},"//修改版")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," \t@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传图片"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"RequestMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/upload/coursefile"'),p("span",{style:{color:"#E1E4E8"}},","),p("span",{style:{color:"#79B8FF"}},"consumes"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),p("span",{style:{color:"#B392F0"}},"upload"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestPart"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"filedata"'),p("span",{style:{color:"#E1E4E8"}},") MultipartFile filedata,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                      @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"objectName"'),p("span",{style:{color:"#E1E4E8"}},","),p("span",{style:{color:"#79B8FF"}},"required"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},") String objectName) throws IOException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//准备上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        UploadFileParamsDto uploadFileParamsDto "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//原始文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFilename"),p("span",{style:{color:"#E1E4E8"}},"(filedata."),p("span",{style:{color:"#B392F0"}},"getOriginalFilename"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileSize"),p("span",{style:{color:"#E1E4E8"}},"(filedata."),p("span",{style:{color:"#B392F0"}},"getSize"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件类型")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileType"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"001001"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//创建一个临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        File tempFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," File."),p("span",{style:{color:"#B392F0"}},"createTempFile"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"minio"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'".temp"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//将本地要上传的文件拷贝到临时文件，拿到本地路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        filedata."),p("span",{style:{color:"#B392F0"}},"transferTo"),p("span",{style:{color:"#E1E4E8"}},"(tempFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Long companyId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1232141425L"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String localFilePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," tempFile."),p("span",{style:{color:"#B392F0"}},"getAbsolutePath"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//调用service上传图片")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFileService."),p("span",{style:{color:"#B392F0"}},"uploadFile"),p("span",{style:{color:"#E1E4E8"}},"(companyId, uploadFileParamsDto, localFilePath, objectName);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"RequestMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/upload/coursefile"'),p("span",{style:{color:"#24292E"}},","),p("span",{style:{color:"#005CC5"}},"consumes"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ResponseBody")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," UploadFileResultDto "),p("span",{style:{color:"#6F42C1"}},"upload"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestPart"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"filedata"'),p("span",{style:{color:"#24292E"}},") MultipartFile upload,@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"folder"'),p("span",{style:{color:"#24292E"}},","),p("span",{style:{color:"#005CC5"}},"required"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},") String folder,@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"objectName"'),p("span",{style:{color:"#24292E"}},","),p("span",{style:{color:"#005CC5"}},"required"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},") String objectName) throws IOException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Long companyId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1232141425L"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    UploadFileParamsDto uploadFileParamsDto "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileSize"),p("span",{style:{color:"#24292E"}},"(filedata."),p("span",{style:{color:"#6F42C1"}},"getSize"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//图片")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileType"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"001001"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFilename"),p("span",{style:{color:"#24292E"}},"(filedata."),p("span",{style:{color:"#6F42C1"}},"getOriginalFilename"),p("span",{style:{color:"#24292E"}},"());"),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"long"),p("span",{style:{color:"#24292E"}}," fileSize "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," filedata."),p("span",{style:{color:"#6F42C1"}},"getSize"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileSize"),p("span",{style:{color:"#24292E"}},"(fileSize);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//创建临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File tempFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," File."),p("span",{style:{color:"#6F42C1"}},"createTempFile"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"minio"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"temp"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    filedata."),p("span",{style:{color:"#6F42C1"}},"transferTo"),p("span",{style:{color:"#24292E"}},"(tempFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String absolutePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," tempFile."),p("span",{style:{color:"#6F42C1"}},"getAbsolutePath"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFileService."),p("span",{style:{color:"#6F42C1"}},"uploadFile"),p("span",{style:{color:"#24292E"}},"(companyId, uploadFileParamsDto, absolutePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"\t"),p("span",{style:{color:"#6A737D"}},"//修改版")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," \t@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传图片"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"RequestMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/upload/coursefile"'),p("span",{style:{color:"#24292E"}},","),p("span",{style:{color:"#005CC5"}},"consumes"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," UploadFileResultDto "),p("span",{style:{color:"#6F42C1"}},"upload"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestPart"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"filedata"'),p("span",{style:{color:"#24292E"}},") MultipartFile filedata,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                      @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"objectName"'),p("span",{style:{color:"#24292E"}},","),p("span",{style:{color:"#005CC5"}},"required"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},") String objectName) throws IOException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//准备上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        UploadFileParamsDto uploadFileParamsDto "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//原始文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFilename"),p("span",{style:{color:"#24292E"}},"(filedata."),p("span",{style:{color:"#6F42C1"}},"getOriginalFilename"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileSize"),p("span",{style:{color:"#24292E"}},"(filedata."),p("span",{style:{color:"#6F42C1"}},"getSize"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件类型")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileType"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"001001"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//创建一个临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        File tempFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," File."),p("span",{style:{color:"#6F42C1"}},"createTempFile"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"minio"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'".temp"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//将本地要上传的文件拷贝到临时文件，拿到本地路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        filedata."),p("span",{style:{color:"#6F42C1"}},"transferTo"),p("span",{style:{color:"#24292E"}},"(tempFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Long companyId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1232141425L"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String localFilePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," tempFile."),p("span",{style:{color:"#6F42C1"}},"getAbsolutePath"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//调用service上传图片")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        UploadFileResultDto uploadFileResultDto "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFileService."),p("span",{style:{color:"#6F42C1"}},"uploadFile"),p("span",{style:{color:"#24292E"}},"(companyId, uploadFileParamsDto, localFilePath, objectName);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")])])])],-1),dn={id:"_2-4-4-接口测试",tabindex:"-1"},un=p("strong",null,"2.4.4 接口测试",-1),Dn=p("p",null,"1、首先使用httpclient测试",-1),mn=p("div",{class:"language-http"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"http"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"POST"),p("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/upload/coursefile")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"Content-Type"),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"multipart/form-data; boundary=WebAppBoundary")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"--WebAppBoundary")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"Content-Disposition"),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'form-data; name="filedata"; filename="1.jpg"')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"Content-Type"),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"application/octet-stream")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"< d:/develop/upload/1.jpg")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"POST"),p("span",{style:{color:"#24292E"}}," {{media_host}}/media/upload/coursefile")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"Content-Type"),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"multipart/form-data; boundary=WebAppBoundary")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"--WebAppBoundary")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"Content-Disposition"),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'form-data; name="filedata"; filename="1.jpg"')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"Content-Type"),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"application/octet-stream")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"< d:/develop/upload/1.jpg")])])])],-1),An=p("p",null,"2、再进行前后端联调测试",-1),gn=p("p",null,"在新增课程、编辑课程界面上传图，保存课程信息后再次进入编辑课程界面，查看是否可以正常保存课程图片信息。",-1),Cn=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps77.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),hn=p("p",null,"上图图片完成后，进入媒资管理，查看文件列表中是否有刚刚上传的图片信息。",-1),Bn=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps78.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),bn={id:"_2-4-5-service事务优化",tabindex:"-1"},fn=p("strong",null,"2.4.5 Service事务优化",-1),kn=p("p",null,"上边的service方法优化后并测试通过，现在思考关于uploadFile方法的是否应该开启事务。",-1),Sn=p("p",null,[t("目前是在uploadFile方法上添加"),p("code",null,"@Transactional"),t("，当调用uploadFile方法前会开启数据库事务，如果上传文件过程时间较长那么数据库的事务持续时间就会变长，这样数据库链接释放就慢，最终导致数据库链接不够用。")],-1),vn=p("p",null,[t("我们只将addMediaFilesToDb方法添加事务控制即可,uploadFile方法上的"),p("code",null,"@Transactional"),t("注解去掉。")],-1),Mn=p("p",null,"优化后如下：",-1),jn=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," MediaFiles "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),p("span",{style:{color:"#B392F0"}},"selectById"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"MediaFiles"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        BeanUtils."),p("span",{style:{color:"#B392F0"}},"copyProperties"),p("span",{style:{color:"#E1E4E8"}},"(uploadFileParamsDto,mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setId"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setCompanyId"),p("span",{style:{color:"#E1E4E8"}},"(companyId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setBucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//file_path")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setFilePath"),p("span",{style:{color:"#E1E4E8"}},"(objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//file_id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setFileId"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//url")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setUrl"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"bucket"),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传时间")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setCreateDate"),p("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),p("span",{style:{color:"#B392F0"}},"now"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setStatus"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"1"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//审核状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),p("span",{style:{color:"#B392F0"}},"setAuditStatus"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"002003"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//插入数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," insert "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),p("span",{style:{color:"#B392F0"}},"insert"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(insert"),p("span",{style:{color:"#F97583"}},"<="),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),p("span",{style:{color:"#E1E4E8"}},",bucket,objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#B392F0"}},"addWaitingTask"),p("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库成功,{}"'),p("span",{style:{color:"#E1E4E8"}},", mediaFiles."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mediaFiles;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," MediaFiles "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFilesMapper."),p("span",{style:{color:"#6F42C1"}},"selectById"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(mediaFiles "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"MediaFiles"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        BeanUtils."),p("span",{style:{color:"#6F42C1"}},"copyProperties"),p("span",{style:{color:"#24292E"}},"(uploadFileParamsDto,mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setId"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setCompanyId"),p("span",{style:{color:"#24292E"}},"(companyId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setBucket"),p("span",{style:{color:"#24292E"}},"(bucket);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//file_path")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setFilePath"),p("span",{style:{color:"#24292E"}},"(objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//file_id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setFileId"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//url")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setUrl"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"bucket"),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传时间")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setCreateDate"),p("span",{style:{color:"#24292E"}},"(LocalDateTime."),p("span",{style:{color:"#6F42C1"}},"now"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setStatus"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"1"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//审核状态")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        mediaFiles."),p("span",{style:{color:"#6F42C1"}},"setAuditStatus"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"002003"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//插入数据库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," insert "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFilesMapper."),p("span",{style:{color:"#6F42C1"}},"insert"),p("span",{style:{color:"#24292E"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(insert"),p("span",{style:{color:"#D73A49"}},"<="),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),p("span",{style:{color:"#24292E"}},",bucket,objectName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6F42C1"}},"addWaitingTask"),p("span",{style:{color:"#24292E"}},"(mediaFiles);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"保存文件信息到数据库成功,{}"'),p("span",{style:{color:"#24292E"}},", mediaFiles."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mediaFiles;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Pn=p("p",null,[t("我们人为在"),p("code",null,"int insert = mediaFilesMapper.insert(mediaFiles);"),t("下边添加一个异常代码"),p("code",null,"int a=1/0;")],-1),_n=p("p",null,"测试是否事务控制。很遗憾，事务控制失败。",-1),In=p("p",null,[t("方法上已经添加了"),p("code",null,"@Transactional"),t("注解为什么该方法不能被事务控制呢？")],-1),Tn=p("p",null,[t("如果是在uploadFile方法上添加"),p("code",null,"@Transactional"),t("注解就可以控制事务，去掉则不行。")],-1),On=p("p",null,"现在的问题其实是一个非事务方法调同类一个事务方法，事务无法控制，这是为什么？",-1),Rn=p("p",null,"下边分析原因：",-1),xn=p("p",null,[t("如果在uploadFile方法上添加"),p("code",null,"@Transactional"),t("注解，代理对象执行此方法前会开启事务，如下图：")],-1),wn=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps79.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Ln=p("p",null,[t("如果在uploadFile方法上没有"),p("code",null,"@Transactional"),t("注解，代理对象执行此方法前不进行事务控制，如下图：")],-1),Nn=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps80.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Un=p("p",null,[t("所以判断该方法是否可以事务控制必须保证是通过代理对象调用此方法，且此方法上添加了"),p("code",null,"@Transactional"),t("注解。")],-1),zn=p("p",null,[t("现在在addMediaFilesToDb方法上添加"),p("code",null,"@Transactional"),t("注解，也不会进行事务控制是因为并不是通过代理对象执行的addMediaFilesToDb方法。为了判断在uploadFile方法中去调用addMediaFilesToDb方法是否是通过代理对象去调用，我们可以打断点跟踪。")],-1),qn=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps81.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Kn=p("p",null,"我们发现在uploadFile方法中去调用addMediaFilesToDb方法不是通过代理对象去调用。",-1),Hn=p("p",null,"如何解决呢？通过代理对象去调用addMediaFilesToDb方法即可解决。",-1),Wn=p("p",null,"在MediaFileService的实现类中注入MediaFileService的代理对象，如下：",-1),Gn=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"MediaFileService currentProxy;")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Autowired")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"MediaFileService currentProxy;")])])])],-1),$n=p("p",null,"将addMediaFilesToDb方法提成接口。",-1),Vn=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," MediaFiles "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"bucket"),p("span",{style:{color:"#6A737D"}},"  桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," MediaFiles "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")])])])],-1),Xn=p("p",null,"调用addMediaFilesToDb方法的代码处改为如下：",-1),Jn=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"..... ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//写入文件表 ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," currentProxy."),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);  ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"....")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"..... ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//写入文件表 ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," currentProxy."),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);  ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"....")])])])],-1),Qn=p("p",null,"再次测试事务是否可以正常控制。",-1),Yn={id:"三-上传视频",tabindex:"-1"},Zn=p("strong",null,"三 上传视频",-1),se={id:"_3-1-需求分析",tabindex:"-1"},le=p("strong",null,"3.1 需求分析",-1),oe=p("p",null,"1、教学机构人员进入媒资管理列表查询自己上传的媒资文件。",-1),ne=p("p",null,"点击“媒资管理”",-1),ee=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps82.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),ae=p("p",null,"进入媒资管理列表页面查询本机构上传的媒资文件。",-1),ce=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704231746909.png",alt:"image-20230704231746909",loading:"lazy",decoding:"async"})],-1),pe=p("p",null,'2、教育机构用户在"媒资管理"页面中点击 "上传视频" 按钮。',-1),te=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps84.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),re=p("p",null,"点击“上传视频”打开上传页面",-1),Ee=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps85.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),ye=p("p",null,"3、选择要上传的文件，自动执行文件上传。",-1),ie=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps86.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Fe=p("p",null,"4、视频上传成功会自动处理，处理完成可以预览视频。",-1),de=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps87.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),ue={id:"_3-2-断点续传技术",tabindex:"-1"},De=p("strong",null,"3.2 断点续传技术",-1),me={id:"_3-2-1-什么是断点续传",tabindex:"-1"},Ae=p("strong",null,"3.2.1 什么是断点续传",-1),ge=p("p",null,"通常视频文件都比较大，所以对于媒资系统上传文件的需求要满足大文件的上传要求。http协议本身对上传文件大小没有限制，但是客户的网络环境质量、电脑硬件环境等参差不齐，如果一个大文件快上传完了网断了没有上传完成，需要客户重新上传，用户体验非常差，所以对于大文件上传的要求最基本的是断点续传。",-1),Ce=p("p",null,"什么是断点续传：",-1),he=p("p",null,"​ 引用百度百科：断点续传指的是在下载或上传时，将下载或上传任务（一个文件或一个压缩包）人为的划分为几个部分，每一个部分采用一个线程进行上传或下载，如果碰到网络故障，可以从已经上传或下载的部分开始继续上传下载未完成的部分，而没有必要从头开始上传下载，断点续传可以提高节省操作时间，提高用户体验性。",-1),Be=p("p",null,"断点续传流程如下图：",-1),be=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps88.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),fe=p("p",null,"流程如下：",-1),ke=p("p",null,"1、前端上传前先把文件分成块",-1),Se=p("p",null,"2、一块一块的上传，上传中断后重新上传，已上传的分块则不用再上传",-1),ve=p("p",null,"3、各分块上传完成最后在服务端合并文件",-1),Me={id:"_3-2-2-分块与合并测试",tabindex:"-1"},je=p("strong",null,"3.2.2 分块与合并测试",-1),Pe=p("p",null,"为了更好的理解文件分块上传的原理，下边用java代码测试文件的分块与合并。",-1),_e=p("p",null,"文件分块的流程如下：",-1),Ie=p("p",null,"1、获取源文件长度",-1),Te=p("p",null,"2、根据设定的分块文件的大小计算出块数",-1),Oe=p("p",null,"3、从源文件读数据依次向每一个块文件写数据。",-1),Re=p("p",null,"测试代码如下：",-1),xe=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2023/06/23 19:43")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 测试大文件上传方法")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"BigFileTest"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//分块测试")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"testChunk"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," IOException {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//源文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        File sourceFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1.mkv"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//分块文件存储路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String chunkFilePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"chunk"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'"'),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//分块文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//long chunkSize = 1024 * 1024 * 1;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkSize "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1024"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"*"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1024"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"*"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"5"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//分块文件个数")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkNum "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}},") Math."),p("span",{style:{color:"#B392F0"}},"ceil"),p("span",{style:{color:"#E1E4E8"}},"(sourceFile."),p("span",{style:{color:"#B392F0"}},"length"),p("span",{style:{color:"#E1E4E8"}},"() "),p("span",{style:{color:"#F97583"}},"*"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1.0"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"/"),p("span",{style:{color:"#E1E4E8"}}," chunkSize);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//使用流从源文件读数据，向分块文件中写数据")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        RandomAccessFile raf_r "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"RandomAccessFile"),p("span",{style:{color:"#E1E4E8"}},"(sourceFile, "),p("span",{style:{color:"#9ECBFF"}},'"r"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//缓存区")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"byte"),p("span",{style:{color:"#E1E4E8"}},"[] bytes "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"byte"),p("span",{style:{color:"#E1E4E8"}},"["),p("span",{style:{color:"#79B8FF"}},"1024"),p("span",{style:{color:"#E1E4E8"}},"];")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"for"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," i "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},"; i "),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}}," chunkNum; i"),p("span",{style:{color:"#F97583"}},"++"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            File chunkFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"(chunkFilePath "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," i);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//分块文件写入流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            RandomAccessFile raf_rw "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"RandomAccessFile"),p("span",{style:{color:"#E1E4E8"}},"(chunkFile, "),p("span",{style:{color:"#9ECBFF"}},'"rw"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," len "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"while"),p("span",{style:{color:"#E1E4E8"}}," ((len"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}},"raf_r."),p("span",{style:{color:"#B392F0"}},"read"),p("span",{style:{color:"#E1E4E8"}},"(bytes))"),p("span",{style:{color:"#F97583"}},"!=-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                raf_rw."),p("span",{style:{color:"#B392F0"}},"write"),p("span",{style:{color:"#E1E4E8"}},"(bytes,"),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},",len);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(chunkFile."),p("span",{style:{color:"#B392F0"}},"length"),p("span",{style:{color:"#E1E4E8"}},"()"),p("span",{style:{color:"#F97583"}},">="),p("span",{style:{color:"#E1E4E8"}},"chunkSize){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    "),p("span",{style:{color:"#F97583"}},"break"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            raf_rw."),p("span",{style:{color:"#B392F0"}},"close"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        raf_r."),p("span",{style:{color:"#B392F0"}},"close"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Klaus")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2023/06/23 19:43")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 测试大文件上传方法")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"BigFileTest"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//分块测试")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"testChunk"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," IOException {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//源文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        File sourceFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1.mkv"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//分块文件存储路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String chunkFilePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"chunk"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'"'),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//分块文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//long chunkSize = 1024 * 1024 * 1;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkSize "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1024"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"*"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1024"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"*"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"5"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//分块文件个数")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkNum "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}},") Math."),p("span",{style:{color:"#6F42C1"}},"ceil"),p("span",{style:{color:"#24292E"}},"(sourceFile."),p("span",{style:{color:"#6F42C1"}},"length"),p("span",{style:{color:"#24292E"}},"() "),p("span",{style:{color:"#D73A49"}},"*"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1.0"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"/"),p("span",{style:{color:"#24292E"}}," chunkSize);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//使用流从源文件读数据，向分块文件中写数据")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        RandomAccessFile raf_r "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),p("span",{style:{color:"#24292E"}},"(sourceFile, "),p("span",{style:{color:"#032F62"}},'"r"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//缓存区")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"byte"),p("span",{style:{color:"#24292E"}},"[] bytes "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"byte"),p("span",{style:{color:"#24292E"}},"["),p("span",{style:{color:"#005CC5"}},"1024"),p("span",{style:{color:"#24292E"}},"];")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"for"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," i "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},"; i "),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}}," chunkNum; i"),p("span",{style:{color:"#D73A49"}},"++"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            File chunkFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"(chunkFilePath "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," i);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//分块文件写入流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            RandomAccessFile raf_rw "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),p("span",{style:{color:"#24292E"}},"(chunkFile, "),p("span",{style:{color:"#032F62"}},'"rw"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," len "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"while"),p("span",{style:{color:"#24292E"}}," ((len"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}},"raf_r."),p("span",{style:{color:"#6F42C1"}},"read"),p("span",{style:{color:"#24292E"}},"(bytes))"),p("span",{style:{color:"#D73A49"}},"!=-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                raf_rw."),p("span",{style:{color:"#6F42C1"}},"write"),p("span",{style:{color:"#24292E"}},"(bytes,"),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},",len);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(chunkFile."),p("span",{style:{color:"#6F42C1"}},"length"),p("span",{style:{color:"#24292E"}},"()"),p("span",{style:{color:"#D73A49"}},">="),p("span",{style:{color:"#24292E"}},"chunkSize){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    "),p("span",{style:{color:"#D73A49"}},"break"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            raf_rw."),p("span",{style:{color:"#6F42C1"}},"close"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        raf_r."),p("span",{style:{color:"#6F42C1"}},"close"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),we=p("p",null,"文件合并流程：",-1),Le=p("p",null,"1、找到要合并的文件并按文件合并的先后进行排序。",-1),Ne=p("p",null,"2、创建合并文件",-1),Ue=p("p",null,"3、依次从合并的文件中读取数据向合并文件写入数",-1),ze=p("p",null,"文件合并的测试代码 ：",-1),qe=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//将分块进行合并")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"testMerge"),p("span",{style:{color:"#E1E4E8"}},"() throws IOException {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//块文件目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File chunkFolder "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'chunk"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//源文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File sourceFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1.mkv"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并后的文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File mergeFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"File"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'1_1.mkv"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//取出所有分块文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"File"),p("span",{style:{color:"#E1E4E8"}},"[] files "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," chunkFolder."),p("span",{style:{color:"#B392F0"}},"listFiles"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//将数组转成list")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    List<"),p("span",{style:{color:"#F97583"}},"File"),p("span",{style:{color:"#E1E4E8"}},"> filesList "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Arrays."),p("span",{style:{color:"#B392F0"}},"asList"),p("span",{style:{color:"#E1E4E8"}},"(files);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//对分块文件排序")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    Collections."),p("span",{style:{color:"#B392F0"}},"sort"),p("span",{style:{color:"#E1E4E8"}},"(filesList, "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," Comparator<"),p("span",{style:{color:"#F97583"}},"File"),p("span",{style:{color:"#E1E4E8"}},">() {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        @"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"compare"),p("span",{style:{color:"#E1E4E8"}},"(File "),p("span",{style:{color:"#FFAB70"}},"o1"),p("span",{style:{color:"#E1E4E8"}},", File "),p("span",{style:{color:"#FFAB70"}},"o2"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," Integer."),p("span",{style:{color:"#B392F0"}},"parseInt"),p("span",{style:{color:"#E1E4E8"}},"(o1."),p("span",{style:{color:"#B392F0"}},"getName"),p("span",{style:{color:"#E1E4E8"}},"())"),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#E1E4E8"}},"Integer."),p("span",{style:{color:"#B392F0"}},"parseInt"),p("span",{style:{color:"#E1E4E8"}},"(o2."),p("span",{style:{color:"#B392F0"}},"getName"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    });")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//向合并文件写的流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    RandomAccessFile raf_rw "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"RandomAccessFile"),p("span",{style:{color:"#E1E4E8"}},"(mergeFile, "),p("span",{style:{color:"#9ECBFF"}},'"rw"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//缓存区")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"byte"),p("span",{style:{color:"#E1E4E8"}},"[] bytes "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"byte"),p("span",{style:{color:"#E1E4E8"}},"["),p("span",{style:{color:"#79B8FF"}},"1024"),p("span",{style:{color:"#E1E4E8"}},"];")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//遍历分块文件，向合并 的文件写")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"for"),p("span",{style:{color:"#E1E4E8"}}," (File file "),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," filesList) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//读分块的流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        RandomAccessFile raf_r "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"RandomAccessFile"),p("span",{style:{color:"#E1E4E8"}},"(file, "),p("span",{style:{color:"#9ECBFF"}},'"r"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," len "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"while"),p("span",{style:{color:"#E1E4E8"}}," ((len"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}},"raf_r."),p("span",{style:{color:"#B392F0"}},"read"),p("span",{style:{color:"#E1E4E8"}},"(bytes))"),p("span",{style:{color:"#F97583"}},"!=-"),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            raf_rw."),p("span",{style:{color:"#B392F0"}},"write"),p("span",{style:{color:"#E1E4E8"}},"(bytes,"),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},",len);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        raf_r."),p("span",{style:{color:"#B392F0"}},"close"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    raf_rw."),p("span",{style:{color:"#B392F0"}},"close"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并文件完成后对合并的文件md5校验")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream_merge "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileInputStream"),p("span",{style:{color:"#E1E4E8"}},"(mergeFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream_source "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileInputStream"),p("span",{style:{color:"#E1E4E8"}},"(sourceFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String md5_merge "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," DigestUtils."),p("span",{style:{color:"#B392F0"}},"md5Hex"),p("span",{style:{color:"#E1E4E8"}},"(fileInputStream_merge);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String md5_source "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," DigestUtils."),p("span",{style:{color:"#B392F0"}},"md5Hex"),p("span",{style:{color:"#E1E4E8"}},"(fileInputStream_source);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(md5_merge."),p("span",{style:{color:"#B392F0"}},"equals"),p("span",{style:{color:"#E1E4E8"}},"(md5_source)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"文件合并成功"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//将分块进行合并")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"testMerge"),p("span",{style:{color:"#24292E"}},"() throws IOException {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//块文件目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File chunkFolder "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'chunk"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//源文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File sourceFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1.mkv"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并后的文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File mergeFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"File"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'1_1.mkv"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//取出所有分块文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"File"),p("span",{style:{color:"#24292E"}},"[] files "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," chunkFolder."),p("span",{style:{color:"#6F42C1"}},"listFiles"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//将数组转成list")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    List<"),p("span",{style:{color:"#D73A49"}},"File"),p("span",{style:{color:"#24292E"}},"> filesList "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Arrays."),p("span",{style:{color:"#6F42C1"}},"asList"),p("span",{style:{color:"#24292E"}},"(files);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//对分块文件排序")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    Collections."),p("span",{style:{color:"#6F42C1"}},"sort"),p("span",{style:{color:"#24292E"}},"(filesList, "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," Comparator<"),p("span",{style:{color:"#D73A49"}},"File"),p("span",{style:{color:"#24292E"}},">() {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        @"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"compare"),p("span",{style:{color:"#24292E"}},"(File "),p("span",{style:{color:"#E36209"}},"o1"),p("span",{style:{color:"#24292E"}},", File "),p("span",{style:{color:"#E36209"}},"o2"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," Integer."),p("span",{style:{color:"#6F42C1"}},"parseInt"),p("span",{style:{color:"#24292E"}},"(o1."),p("span",{style:{color:"#6F42C1"}},"getName"),p("span",{style:{color:"#24292E"}},"())"),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#24292E"}},"Integer."),p("span",{style:{color:"#6F42C1"}},"parseInt"),p("span",{style:{color:"#24292E"}},"(o2."),p("span",{style:{color:"#6F42C1"}},"getName"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    });")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//向合并文件写的流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    RandomAccessFile raf_rw "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),p("span",{style:{color:"#24292E"}},"(mergeFile, "),p("span",{style:{color:"#032F62"}},'"rw"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//缓存区")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"byte"),p("span",{style:{color:"#24292E"}},"[] bytes "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"byte"),p("span",{style:{color:"#24292E"}},"["),p("span",{style:{color:"#005CC5"}},"1024"),p("span",{style:{color:"#24292E"}},"];")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//遍历分块文件，向合并 的文件写")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"for"),p("span",{style:{color:"#24292E"}}," (File file "),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," filesList) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//读分块的流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        RandomAccessFile raf_r "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),p("span",{style:{color:"#24292E"}},"(file, "),p("span",{style:{color:"#032F62"}},'"r"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," len "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"while"),p("span",{style:{color:"#24292E"}}," ((len"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}},"raf_r."),p("span",{style:{color:"#6F42C1"}},"read"),p("span",{style:{color:"#24292E"}},"(bytes))"),p("span",{style:{color:"#D73A49"}},"!=-"),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            raf_rw."),p("span",{style:{color:"#6F42C1"}},"write"),p("span",{style:{color:"#24292E"}},"(bytes,"),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},",len);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        raf_r."),p("span",{style:{color:"#6F42C1"}},"close"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    raf_rw."),p("span",{style:{color:"#6F42C1"}},"close"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并文件完成后对合并的文件md5校验")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream_merge "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileInputStream"),p("span",{style:{color:"#24292E"}},"(mergeFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream_source "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileInputStream"),p("span",{style:{color:"#24292E"}},"(sourceFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String md5_merge "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," DigestUtils."),p("span",{style:{color:"#6F42C1"}},"md5Hex"),p("span",{style:{color:"#24292E"}},"(fileInputStream_merge);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String md5_source "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," DigestUtils."),p("span",{style:{color:"#6F42C1"}},"md5Hex"),p("span",{style:{color:"#24292E"}},"(fileInputStream_source);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(md5_merge."),p("span",{style:{color:"#6F42C1"}},"equals"),p("span",{style:{color:"#24292E"}},"(md5_source)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"文件合并成功"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Ke={id:"_3-2-3-视频上传流程",tabindex:"-1"},He=p("strong",null,"3.2.3 视频上传流程",-1),We=p("p",null,"下图是上传视频的整体流程：",-1),Ge=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704232249335.png",alt:"image-20230704232249335",loading:"lazy",decoding:"async"})],-1),$e=p("p",null,"1、前端对文件进行分块。",-1),Ve=p("p",null,"2、前端上传分块文件前请求媒资服务检查文件是否存在，如果已经存在则不再上传。",-1),Xe=p("p",null,"3、如果分块文件不存在则前端开始上传",-1),Je=p("p",null,"4、前端请求媒资服务上传分块。",-1),Qe=p("p",null,"5、媒资服务将分块上传至MinIO。",-1),Ye=p("p",null,"6、前端将分块上传完毕请求媒资服务合并分块。",-1),Ze=p("p",null,"7、媒资服务判断分块上传完成则请求MinIO合并文件。",-1),sa=p("p",null,"8、合并完成校验合并后的文件是否完整，如果完整则上传完成，否则删除文件。",-1),la={id:"_3-2-4-minio合并文件测试",tabindex:"-1"},oa=p("strong",null,"3.2.4 minio合并文件测试",-1),na=p("p",null,"1、将分块文件上传至minio",-1),ea=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//将分块文件上传到minio")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"uploadChunk"),p("span",{style:{color:"#E1E4E8"}},"() throws IOException,  InsufficientDataException, ErrorResponseException, NoSuchAlgorithmException,  InvalidResponseException, XmlParserException, InternalException, ServerException, InvalidKeyException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"for"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," i "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},"; i "),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"3"),p("span",{style:{color:"#E1E4E8"}},"; i"),p("span",{style:{color:"#F97583"}},"++"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        UploadObjectArgs uploadObjectArgs "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")"),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"filename"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"D:'),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"Learning"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"upload"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},"chunk"),p("span",{style:{color:"#79B8FF"}},"\\\\"),p("span",{style:{color:"#9ECBFF"}},'"'),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"i) "),p("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunk/"'),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"i)"),p("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        minioClient."),p("span",{style:{color:"#B392F0"}},"uploadObject"),p("span",{style:{color:"#E1E4E8"}},"(uploadObjectArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        System.out."),p("span",{style:{color:"#B392F0"}},"println"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传分块"'),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"i"),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#9ECBFF"}},'"成功"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//将分块文件上传到minio")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"uploadChunk"),p("span",{style:{color:"#24292E"}},"() throws IOException,  InsufficientDataException, ErrorResponseException, NoSuchAlgorithmException,  InvalidResponseException, XmlParserException, InternalException, ServerException, InvalidKeyException {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"for"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," i "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},"; i "),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"3"),p("span",{style:{color:"#24292E"}},"; i"),p("span",{style:{color:"#D73A49"}},"++"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        UploadObjectArgs uploadObjectArgs "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," UploadObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")"),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"filename"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"D:'),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"Learning"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"upload"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},"chunk"),p("span",{style:{color:"#005CC5"}},"\\\\"),p("span",{style:{color:"#032F62"}},'"'),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"i) "),p("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunk/"'),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"i)"),p("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//上传文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        minioClient."),p("span",{style:{color:"#6F42C1"}},"uploadObject"),p("span",{style:{color:"#24292E"}},"(uploadObjectArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        System.out."),p("span",{style:{color:"#6F42C1"}},"println"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传分块"'),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"i"),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#032F62"}},'"成功"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),aa=p("p",null,"2、通过minio的合并文件",-1),ca=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//合并文件，要求分块文件最小5M")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"testMerge"),p("span",{style:{color:"#E1E4E8"}},"() throws Exception {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        List<ComposeSource> sources = new ArrayList<>();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        for (int i = 0; i < 30; i++) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            //指定分块文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//            ComposeSource composeSource = ComposeSource.builder().bucket("testbucket").object("chunk/" + i).build();')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            sources.add(composeSource);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        List<"),p("span",{style:{color:"#F97583"}},"ComposeSource"),p("span",{style:{color:"#E1E4E8"}},"> sources "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Stream."),p("span",{style:{color:"#B392F0"}},"iterate"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},", i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"++"),p("span",{style:{color:"#E1E4E8"}},"i)."),p("span",{style:{color:"#B392F0"}},"limit"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"3"),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," ComposeSource."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunk/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," i)."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"())."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//指定合并后的objectName等信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        ComposeObjectArgs composeObjectArgs "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," ComposeObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"merge01.mp4"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"sources"),p("span",{style:{color:"#E1E4E8"}},"(sources)"),p("span",{style:{color:"#6A737D"}},"//指定源文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//合并文件,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//报错size 1048576 must be greater than 5242880，minio默认的分块文件大小为5M")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        minioClient."),p("span",{style:{color:"#B392F0"}},"composeObject"),p("span",{style:{color:"#E1E4E8"}},"(composeObjectArgs);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//清除分块文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"test_removeObjects"),p("span",{style:{color:"#E1E4E8"}},"(){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并分块完成将分块文件清除")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    List<"),p("span",{style:{color:"#F97583"}},"DeleteObject"),p("span",{style:{color:"#E1E4E8"}},"> deleteObjects "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Stream."),p("span",{style:{color:"#B392F0"}},"iterate"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},", i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"++"),p("span",{style:{color:"#E1E4E8"}},"i)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            ."),p("span",{style:{color:"#B392F0"}},"limit"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"6"),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            ."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"DeleteObject"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunk/"'),p("span",{style:{color:"#E1E4E8"}},"."),p("span",{style:{color:"#B392F0"}},"concat"),p("span",{style:{color:"#E1E4E8"}},"(Integer."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"(i))))")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            ."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    RemoveObjectsArgs removeObjectsArgs "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," RemoveObjectsArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"testbucket"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"objects"),p("span",{style:{color:"#E1E4E8"}},"(deleteObjects)."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    Iterable<Result<"),p("span",{style:{color:"#F97583"}},"DeleteError"),p("span",{style:{color:"#E1E4E8"}},">> results "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," minioClient."),p("span",{style:{color:"#B392F0"}},"removeObjects"),p("span",{style:{color:"#E1E4E8"}},"(removeObjectsArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    results."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(r"),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        DeleteError deleteError "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            deleteError "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," r."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    });")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//合并文件，要求分块文件最小5M")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"testMerge"),p("span",{style:{color:"#24292E"}},"() throws Exception {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        List<ComposeSource> sources = new ArrayList<>();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        for (int i = 0; i < 30; i++) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            //指定分块文件的信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},'//            ComposeSource composeSource = ComposeSource.builder().bucket("testbucket").object("chunk/" + i).build();')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//            sources.add(composeSource);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//        }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        List<"),p("span",{style:{color:"#D73A49"}},"ComposeSource"),p("span",{style:{color:"#24292E"}},"> sources "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Stream."),p("span",{style:{color:"#6F42C1"}},"iterate"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},", i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"++"),p("span",{style:{color:"#24292E"}},"i)."),p("span",{style:{color:"#6F42C1"}},"limit"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"3"),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," ComposeSource."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunk/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," i)."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"())."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//指定合并后的objectName等信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        ComposeObjectArgs composeObjectArgs "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," ComposeObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"merge01.mp4"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"sources"),p("span",{style:{color:"#24292E"}},"(sources)"),p("span",{style:{color:"#6A737D"}},"//指定源文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//合并文件,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//报错size 1048576 must be greater than 5242880，minio默认的分块文件大小为5M")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        minioClient."),p("span",{style:{color:"#6F42C1"}},"composeObject"),p("span",{style:{color:"#24292E"}},"(composeObjectArgs);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//清除分块文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Test")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"test_removeObjects"),p("span",{style:{color:"#24292E"}},"(){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并分块完成将分块文件清除")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    List<"),p("span",{style:{color:"#D73A49"}},"DeleteObject"),p("span",{style:{color:"#24292E"}},"> deleteObjects "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Stream."),p("span",{style:{color:"#6F42C1"}},"iterate"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},", i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"++"),p("span",{style:{color:"#24292E"}},"i)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            ."),p("span",{style:{color:"#6F42C1"}},"limit"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"6"),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            ."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"DeleteObject"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunk/"'),p("span",{style:{color:"#24292E"}},"."),p("span",{style:{color:"#6F42C1"}},"concat"),p("span",{style:{color:"#24292E"}},"(Integer."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"(i))))")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            ."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    RemoveObjectsArgs removeObjectsArgs "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," RemoveObjectsArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"testbucket"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"objects"),p("span",{style:{color:"#24292E"}},"(deleteObjects)."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    Iterable<Result<"),p("span",{style:{color:"#D73A49"}},"DeleteError"),p("span",{style:{color:"#24292E"}},">> results "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," minioClient."),p("span",{style:{color:"#6F42C1"}},"removeObjects"),p("span",{style:{color:"#24292E"}},"(removeObjectsArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    results."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(r"),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        DeleteError deleteError "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            deleteError "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," r."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    });")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),pa=p("p",null,[t("使用minio合并文件报错："),p("code",null,"java.lang.IllegalArgumentException: source testbucket/chunk/0: size 1048576 must be greater than 5242880")],-1),ta=p("p",null,"minio合并文件默认分块最小5M，我们将分块改为5M再次测试。",-1),ra={id:"_3-3-接口定义",tabindex:"-1"},Ea=p("strong",null,"3.3 接口定义",-1),ya=p("p",null,[t("根据上传视频流程，定义接口，与前端的约定是操作成功返回"),p("code",null,"{code:0}"),t("否则返回"),p("code",null,"{code:-1}")],-1),ia=p("p",null,[t("从课程资料中拷贝"),p("code",null,"RestResponse.java"),t("类到base工程下的model包下。")],-1),Fa=p("p",null,"定义接口如下：",-1),da=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Api"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"大文件上传接口"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"tags"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"大文件上传接口"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"RestController")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"BigFilesController"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"文件上传前检查文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/checkfile"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse<"),p("span",{style:{color:"#F97583"}},"Boolean"),p("span",{style:{color:"#E1E4E8"}},"> "),p("span",{style:{color:"#B392F0"}},"checkfile"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String "),p("span",{style:{color:"#FFAB70"}},"fileMd5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    ) "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"分块文件上传前的检测"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/checkchunk"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse<"),p("span",{style:{color:"#F97583"}},"Boolean"),p("span",{style:{color:"#E1E4E8"}},"> "),p("span",{style:{color:"#B392F0"}},"checkchunk"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                            @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunk"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#FFAB70"}},"chunk"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"上传分块文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/uploadchunk"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"uploadchunk"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"file"'),p("span",{style:{color:"#E1E4E8"}},") MultipartFile "),p("span",{style:{color:"#FFAB70"}},"file"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                    @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                    @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunk"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#FFAB70"}},"chunk"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"合并文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    @"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/mergechunks"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"mergechunks"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                    @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileName"'),p("span",{style:{color:"#E1E4E8"}},") String "),p("span",{style:{color:"#FFAB70"}},"fileName"),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                    @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunkTotal"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#FFAB70"}},"chunkTotal"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"throws"),p("span",{style:{color:"#E1E4E8"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Api"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"大文件上传接口"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"tags"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"大文件上传接口"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"RestController")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"BigFilesController"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"文件上传前检查文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/checkfile"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse<"),p("span",{style:{color:"#D73A49"}},"Boolean"),p("span",{style:{color:"#24292E"}},"> "),p("span",{style:{color:"#6F42C1"}},"checkfile"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String "),p("span",{style:{color:"#E36209"}},"fileMd5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    ) "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"分块文件上传前的检测"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/checkchunk"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse<"),p("span",{style:{color:"#D73A49"}},"Boolean"),p("span",{style:{color:"#24292E"}},"> "),p("span",{style:{color:"#6F42C1"}},"checkchunk"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                            @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunk"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#E36209"}},"chunk"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"上传分块文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/uploadchunk"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"uploadchunk"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"file"'),p("span",{style:{color:"#24292E"}},") MultipartFile "),p("span",{style:{color:"#E36209"}},"file"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                    @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                    @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunk"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#E36209"}},"chunk"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"合并文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    @"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/mergechunks"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"mergechunks"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                    @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileName"'),p("span",{style:{color:"#24292E"}},") String "),p("span",{style:{color:"#E36209"}},"fileName"),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                    @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunkTotal"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#E36209"}},"chunkTotal"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"throws"),p("span",{style:{color:"#24292E"}}," Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),ua={id:"_3-4-上传分块开发",tabindex:"-1"},Da=p("strong",null,"3.4 上传分块开发",-1),ma={id:"_3-4-1-dao开发",tabindex:"-1"},Aa=p("strong",null,"3.4.1 DAO开发",-1),ga=p("p",null,"向媒资数据库的文件表插入记录，使用自动生成的Mapper接口即可满足要求。",-1),Ca={id:"_3-4-2-service开发",tabindex:"-1"},ha=p("strong",null,"3.4.2 Service开发",-1),Ba={id:"_3-4-2-1-检查文件和分块",tabindex:"-1"},ba=p("strong",null,"3.4.2.1 检查文件和分块",-1),fa=p("p",null,"接口完成进行接口实现，首先实现检查文件方法和检查分块方法。",-1),ka=p("p",null,"在MediaFileService中定义service接口如下：",-1),Sa=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 检查文件是否存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}}," 文件的md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"Boolean"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"checkFile"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 检查分块是否存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件的md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"chunkIndex"),p("span",{style:{color:"#6A737D"}},"  分块序号")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"Boolean"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"checkChunk"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5, "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkIndex);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 检查文件是否存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}}," 文件的md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"Boolean"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"checkFile"),p("span",{style:{color:"#24292E"}},"(String fileMd5);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 检查分块是否存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件的md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"chunkIndex"),p("span",{style:{color:"#6A737D"}},"  分块序号")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"Boolean"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"checkChunk"),p("span",{style:{color:"#24292E"}},"(String fileMd5, "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkIndex);")])])])],-1),va=p("p",null,"service接口实现方法：",-1),Ma=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"Boolean"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"checkFile"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//查询文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),p("span",{style:{color:"#B392F0"}},"selectById"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (mediaFiles "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String bucket "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFiles."),p("span",{style:{color:"#B392F0"}},"getBucket"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//存储目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String filePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," mediaFiles."),p("span",{style:{color:"#B392F0"}},"getFilePath"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        InputStream stream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            stream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," minioClient."),p("span",{style:{color:"#B392F0"}},"getObject"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    GetObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"(filePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                            ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (stream "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#6A737D"}},"//文件已存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"success"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"           ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件不存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"success"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"Boolean"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"checkChunk"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5, "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkIndex) {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String chunkFileFolderPath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String chunkFilePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," chunkFileFolderPath "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," chunkIndex;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    InputStream fileInputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        fileInputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," minioClient."),p("span",{style:{color:"#B392F0"}},"getObject"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                GetObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"(chunkFilePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," (fileInputStream "),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#6A737D"}},"//分块已存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"success"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//分块未存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"success"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//得到分块文件的目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," fileMd5."),p("span",{style:{color:"#B392F0"}},"substring"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," fileMd5."),p("span",{style:{color:"#B392F0"}},"substring"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"2"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," fileMd5 "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"chunk"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"Boolean"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"checkFile"),p("span",{style:{color:"#24292E"}},"(String fileMd5) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//查询文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFilesMapper."),p("span",{style:{color:"#6F42C1"}},"selectById"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (mediaFiles "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String bucket "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFiles."),p("span",{style:{color:"#6F42C1"}},"getBucket"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//存储目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String filePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," mediaFiles."),p("span",{style:{color:"#6F42C1"}},"getFilePath"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        InputStream stream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            stream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," minioClient."),p("span",{style:{color:"#6F42C1"}},"getObject"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    GetObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"(bucket)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"(filePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                            ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (stream "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#6A737D"}},"//文件已存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"success"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"           ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件不存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"success"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"Boolean"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"checkChunk"),p("span",{style:{color:"#24292E"}},"(String fileMd5, "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkIndex) {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String chunkFileFolderPath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String chunkFilePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," chunkFileFolderPath "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," chunkIndex;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件流")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    InputStream fileInputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        fileInputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," minioClient."),p("span",{style:{color:"#6F42C1"}},"getObject"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                GetObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"(bucket_videoFiles)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"(chunkFilePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," (fileInputStream "),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#6A737D"}},"//分块已存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"success"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        ")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//分块未存在")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"success"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"//得到分块文件的目录")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),p("span",{style:{color:"#24292E"}},"(String fileMd5) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," fileMd5."),p("span",{style:{color:"#6F42C1"}},"substring"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," fileMd5."),p("span",{style:{color:"#6F42C1"}},"substring"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"2"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," fileMd5 "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"chunk"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),ja={id:"_3-4-2-2-上传分块",tabindex:"-1"},Pa=p("strong",null,"3.4.2.2 上传分块",-1),_a=p("p",null,"定义service接口",-1),Ia=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 上传分块")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"chunk"),p("span",{style:{color:"#6A737D"}},"  分块序号")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"localChunkFilePath"),p("span",{style:{color:"#6A737D"}},"  分块文件本地路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"uploadChunk"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5,"),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunk,String localChunkFilePath);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 上传分块")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"chunk"),p("span",{style:{color:"#6A737D"}},"  分块序号")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"localChunkFilePath"),p("span",{style:{color:"#6A737D"}},"  分块文件本地路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"uploadChunk"),p("span",{style:{color:"#24292E"}},"(String fileMd5,"),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunk,String localChunkFilePath);")])])])],-1),Ta=p("p",null,"接口实现：",-1),Oa=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"uploadChunk"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5, "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunk, String localChunkFilePath) {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件的目录路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String chunkFileFolderPath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String chunkFilePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," chunkFileFolderPath "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," chunk;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String mimeType "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getMimeType"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件存储至minIO")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"boolean"),p("span",{style:{color:"#E1E4E8"}}," b "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#E1E4E8"}},"(localChunkFilePath, mimeType, bucket_videoFiles, chunkFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}}," ("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"b) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传分块文件失败:{}"'),p("span",{style:{color:"#E1E4E8"}},", chunkFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"validfail"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"上传分块失败"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"上传分块文件成功:{}"'),p("span",{style:{color:"#E1E4E8"}},",chunkFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"success"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"uploadChunk"),p("span",{style:{color:"#24292E"}},"(String fileMd5, "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunk, String localChunkFilePath) {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件的目录路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String chunkFileFolderPath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String chunkFilePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," chunkFileFolderPath "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," chunk;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//mimeType")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String mimeType "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getMimeType"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//将文件存储至minIO")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"boolean"),p("span",{style:{color:"#24292E"}}," b "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),p("span",{style:{color:"#24292E"}},"(localChunkFilePath, mimeType, bucket_videoFiles, chunkFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}}," ("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"b) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传分块文件失败:{}"'),p("span",{style:{color:"#24292E"}},", chunkFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"validfail"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"上传分块失败"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"上传分块文件成功:{}"'),p("span",{style:{color:"#24292E"}},",chunkFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"success"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Ra={id:"_3-4-2-3-上传分块测试",tabindex:"-1"},xa=p("strong",null,"3.4.2.3 上传分块测试",-1),wa=p("p",null,"完善接口层：",-1),La=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"文件上传前检查文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/checkfile"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"Boolean"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"checkfile"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String fileMd5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},") throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mediaFileService."),p("span",{style:{color:"#B392F0"}},"checkFile"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"分块文件上传前的检测"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/checkchunk"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse"),p("span",{style:{color:"#F97583"}},"<"),p("span",{style:{color:"#E1E4E8"}},"Boolean"),p("span",{style:{color:"#F97583"}},">"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"checkchunk"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String fileMd5,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                        @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunk"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunk) throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mediaFileService."),p("span",{style:{color:"#B392F0"}},"checkChunk"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5,chunk);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"上传分块文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/uploadchunk"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"uploadchunk"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"file"'),p("span",{style:{color:"#E1E4E8"}},") MultipartFile file,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String fileMd5,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunk"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunk) throws Exception {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//创建临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File tempFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," File."),p("span",{style:{color:"#B392F0"}},"createTempFile"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"minio"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"temp"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    file."),p("span",{style:{color:"#B392F0"}},"transferTo"),p("span",{style:{color:"#E1E4E8"}},"(tempFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String absolutePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," tempFile."),p("span",{style:{color:"#B392F0"}},"getAbsolutePath"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mediaFileService."),p("span",{style:{color:"#B392F0"}},"uploadChunk"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5,chunk,absolutePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"文件上传前检查文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/checkfile"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"Boolean"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"checkfile"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String fileMd5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},") throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mediaFileService."),p("span",{style:{color:"#6F42C1"}},"checkFile"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"分块文件上传前的检测"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/checkchunk"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse"),p("span",{style:{color:"#D73A49"}},"<"),p("span",{style:{color:"#24292E"}},"Boolean"),p("span",{style:{color:"#D73A49"}},">"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"checkchunk"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String fileMd5,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                        @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunk"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunk) throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mediaFileService."),p("span",{style:{color:"#6F42C1"}},"checkChunk"),p("span",{style:{color:"#24292E"}},"(fileMd5,chunk);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"上传分块文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/uploadchunk"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"uploadchunk"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"file"'),p("span",{style:{color:"#24292E"}},") MultipartFile file,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String fileMd5,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunk"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunk) throws Exception {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//创建临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File tempFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," File."),p("span",{style:{color:"#6F42C1"}},"createTempFile"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"minio"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"temp"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    file."),p("span",{style:{color:"#6F42C1"}},"transferTo"),p("span",{style:{color:"#24292E"}},"(tempFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String absolutePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," tempFile."),p("span",{style:{color:"#6F42C1"}},"getAbsolutePath"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mediaFileService."),p("span",{style:{color:"#6F42C1"}},"uploadChunk"),p("span",{style:{color:"#24292E"}},"(fileMd5,chunk,absolutePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Na=p("p",null,"启动前端工程，进入上传视频界面进行前后端联调测试。",-1),Ua=p("p",null,"前端对文件分块的大小为5MB，SpringBoot web默认上传文件的大小限制为1MB，这里需要在media-api工程修改配置如下：",-1),za=p("div",{class:"language-yaml"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"yaml"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"spring"),p("span",{style:{color:"#E1E4E8"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#85E89D"}},"servlet"),p("span",{style:{color:"#E1E4E8"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#85E89D"}},"multipart"),p("span",{style:{color:"#E1E4E8"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#85E89D"}},"max-file-size"),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},"50MB")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"      "),p("span",{style:{color:"#85E89D"}},"max-request-size"),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},"50MB")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"spring"),p("span",{style:{color:"#24292E"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#22863A"}},"servlet"),p("span",{style:{color:"#24292E"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#22863A"}},"multipart"),p("span",{style:{color:"#24292E"}},":")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#22863A"}},"max-file-size"),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},"50MB")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"      "),p("span",{style:{color:"#22863A"}},"max-request-size"),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},"50MB")])])])],-1),qa=p("p",null,[p("code",null,"max-file-size"),t("：单个文件的大小限制")],-1),Ka=p("p",null,[p("code",null,"Max-request-size"),t(": 单次请求的大小限制")],-1),Ha=p("p",null,[t("上传分块时被限制大小，在本地"),p("code",null,"nginx.conf"),t("配置：")],-1),Wa=p("div",{class:"language-apl"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"apl"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#79B8FF"}},"#"),p("span",{style:{color:"#E1E4E8"}},"gzip  on"),p("span",{style:{color:"#F97583"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#79B8FF"}},"#"),p("span",{style:{color:"#E1E4E8"}},"文件服务")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"client_max_body_size "),p("span",{style:{color:"#79B8FF"}},"50m"),p("span",{style:{color:"#F97583"}},";")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#005CC5"}},"#"),p("span",{style:{color:"#24292E"}},"gzip  on"),p("span",{style:{color:"#D73A49"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#005CC5"}},"#"),p("span",{style:{color:"#24292E"}},"文件服务")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"client_max_body_size "),p("span",{style:{color:"#005CC5"}},"50m"),p("span",{style:{color:"#D73A49"}},";")])])])],-1),Ga={id:"_3-5-合并分块开发",tabindex:"-1"},$a=p("strong",null,"3.5 合并分块开发",-1),Va={id:"_3-5-1-service开发",tabindex:"-1"},Xa=p("strong",null,"3.5.1 service开发",-1),Ja=p("p",null,"定义service接口：",-1),Qa=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 合并分块")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"chunkTotal"),p("span",{style:{color:"#6A737D"}}," 分块总和")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}}," 文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"mergechunks"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,"),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkTotal,UploadFileParamsDto uploadFileParamsDto);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 合并分块")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"companyId"),p("span",{style:{color:"#6A737D"}},"  机构id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}},"  文件md5")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"chunkTotal"),p("span",{style:{color:"#6A737D"}}," 分块总和")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),p("span",{style:{color:"#6A737D"}}," 文件信息")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"mergechunks"),p("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,"),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkTotal,UploadFileParamsDto uploadFileParamsDto);")])])])],-1),Ya=p("p",null,"service实现：",-1),Za=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"Java")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"mergechunks"),p("span",{style:{color:"#E1E4E8"}},"(Long companyId, String fileMd5, "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkTotal, UploadFileParamsDto uploadFileParamsDto) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//=====获取分块文件路径=====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String chunkFileFolderPath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//组成将分块文件路径组成 List<ComposeSource>")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    List<"),p("span",{style:{color:"#F97583"}},"ComposeSource"),p("span",{style:{color:"#E1E4E8"}},"> sourceObjectList "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Stream."),p("span",{style:{color:"#B392F0"}},"iterate"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},", i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"++"),p("span",{style:{color:"#E1E4E8"}},"i)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            ."),p("span",{style:{color:"#B392F0"}},"limit"),p("span",{style:{color:"#E1E4E8"}},"(chunkTotal)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            ."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," ComposeSource."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"(chunkFileFolderPath."),p("span",{style:{color:"#B392F0"}},"concat"),p("span",{style:{color:"#E1E4E8"}},"(Integer."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"(i)))")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                    ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"())")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            ."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//=====合并=====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String fileName "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"getFilename"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String extName "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," fileName."),p("span",{style:{color:"#B392F0"}},"substring"),p("span",{style:{color:"#E1E4E8"}},"(fileName."),p("span",{style:{color:"#B392F0"}},"lastIndexOf"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"."'),p("span",{style:{color:"#E1E4E8"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    String mergeFilePath "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"getFilePathByMd5"),p("span",{style:{color:"#E1E4E8"}},"(fileMd5, extName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//合并文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        ObjectWriteResponse response "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," minioClient."),p("span",{style:{color:"#B392F0"}},"composeObject"),p("span",{style:{color:"#E1E4E8"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ComposeObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"(mergeFilePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        ."),p("span",{style:{color:"#B392F0"}},"sources"),p("span",{style:{color:"#E1E4E8"}},"(sourceObjectList)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                        ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"合并文件成功:{}"'),p("span",{style:{color:"#E1E4E8"}},",mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"合并文件失败,fileMd5:{},异常:{}"'),p("span",{style:{color:"#E1E4E8"}},",fileMd5,e."),p("span",{style:{color:"#B392F0"}},"getMessage"),p("span",{style:{color:"#E1E4E8"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"validfail"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"合并文件失败。"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"// ====验证md5====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//下载合并后的文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File minioFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"downloadFileFromMinIO"),p("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles,mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(minioFile "),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"下载合并后文件失败,mergeFilePath:{}"'),p("span",{style:{color:"#E1E4E8"}},",mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"validfail"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"下载合并后文件失败。"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," (InputStream newFileInputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileInputStream"),p("span",{style:{color:"#E1E4E8"}},"(minioFile)) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//minio上文件的md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        String md5Hex "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," DigestUtils."),p("span",{style:{color:"#B392F0"}},"md5Hex"),p("span",{style:{color:"#E1E4E8"}},"(newFileInputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//比较md5值，不一致则说明文件不完整")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"!"),p("span",{style:{color:"#E1E4E8"}},"fileMd5."),p("span",{style:{color:"#B392F0"}},"equals"),p("span",{style:{color:"#E1E4E8"}},"(md5Hex)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"validfail"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"文件合并校验失败，最终上传失败。"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileSize"),p("span",{style:{color:"#E1E4E8"}},"(minioFile."),p("span",{style:{color:"#B392F0"}},"length"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }"),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"debug"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"校验文件失败,fileMd5:{},异常:{}"'),p("span",{style:{color:"#E1E4E8"}},",fileMd5,e."),p("span",{style:{color:"#B392F0"}},"getMessage"),p("span",{style:{color:"#E1E4E8"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"validfail"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"false"),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'"文件合并校验失败，最终上传失败。"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }"),p("span",{style:{color:"#F97583"}},"finally"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(minioFile"),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"           minioFile."),p("span",{style:{color:"#B392F0"}},"delete"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件入库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    currentProxy."),p("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),p("span",{style:{color:"#E1E4E8"}},"(companyId,fileMd5,uploadFileParamsDto,bucket_videoFiles,mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//=====清除分块文件=====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#B392F0"}},"clearChunkFiles"),p("span",{style:{color:"#E1E4E8"}},"(chunkFileFolderPath,chunkTotal);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," RestResponse."),p("span",{style:{color:"#B392F0"}},"success"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 从minio下载文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"bucket"),p("span",{style:{color:"#6A737D"}}," 桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," 下载后的文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," File "),p("span",{style:{color:"#B392F0"}},"downloadFileFromMinIO"),p("span",{style:{color:"#E1E4E8"}},"(String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#6A737D"}},"//临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    File minioFile "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    FileOutputStream outputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        InputStream stream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," minioClient."),p("span",{style:{color:"#B392F0"}},"getObject"),p("span",{style:{color:"#E1E4E8"}},"(GetObjectArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"(bucket)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"object"),p("span",{style:{color:"#E1E4E8"}},"(objectName)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#6A737D"}},"//创建临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        minioFile"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}},"File."),p("span",{style:{color:"#B392F0"}},"createTempFile"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"minio"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#9ECBFF"}},'".merge"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        outputStream "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"FileOutputStream"),p("span",{style:{color:"#E1E4E8"}},"(minioFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        IOUtils."),p("span",{style:{color:"#B392F0"}},"copy"),p("span",{style:{color:"#E1E4E8"}},"(stream,outputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," minioFile;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"       e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }"),p("span",{style:{color:"#F97583"}},"finally"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(outputStream"),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                outputStream."),p("span",{style:{color:"#B392F0"}},"close"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (IOException "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 得到合并后的文件的地址")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileMd5"),p("span",{style:{color:"#6A737D"}}," 文件id即md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"fileExt"),p("span",{style:{color:"#6A737D"}}," 文件扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String "),p("span",{style:{color:"#B392F0"}},"getFilePathByMd5"),p("span",{style:{color:"#E1E4E8"}},"(String fileMd5,String fileExt){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}},"   fileMd5."),p("span",{style:{color:"#B392F0"}},"substring"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},","),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," fileMd5."),p("span",{style:{color:"#B392F0"}},"substring"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"1"),p("span",{style:{color:"#E1E4E8"}},","),p("span",{style:{color:"#79B8FF"}},"2"),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," fileMd5 "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"/"'),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"fileMd5 "),p("span",{style:{color:"#F97583"}},"+"),p("span",{style:{color:"#E1E4E8"}},"fileExt;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 清除分块文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"chunkFileFolderPath"),p("span",{style:{color:"#6A737D"}}," 分块文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"chunkTotal"),p("span",{style:{color:"#6A737D"}}," 分块文件总数")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"clearChunkFiles"),p("span",{style:{color:"#E1E4E8"}},"(String chunkFileFolderPath,"),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkTotal){")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        List<"),p("span",{style:{color:"#F97583"}},"DeleteObject"),p("span",{style:{color:"#E1E4E8"}},"> deleteObjects "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," Stream."),p("span",{style:{color:"#B392F0"}},"iterate"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"0"),p("span",{style:{color:"#E1E4E8"}},", i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"++"),p("span",{style:{color:"#E1E4E8"}},"i)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"limit"),p("span",{style:{color:"#E1E4E8"}},"(chunkTotal)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"map"),p("span",{style:{color:"#E1E4E8"}},"(i "),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"DeleteObject"),p("span",{style:{color:"#E1E4E8"}},"(chunkFileFolderPath."),p("span",{style:{color:"#B392F0"}},"concat"),p("span",{style:{color:"#E1E4E8"}},"(Integer."),p("span",{style:{color:"#B392F0"}},"toString"),p("span",{style:{color:"#E1E4E8"}},"(i))))")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                ."),p("span",{style:{color:"#B392F0"}},"collect"),p("span",{style:{color:"#E1E4E8"}},"(Collectors."),p("span",{style:{color:"#B392F0"}},"toList"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        RemoveObjectsArgs removeObjectsArgs "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," RemoveObjectsArgs."),p("span",{style:{color:"#B392F0"}},"builder"),p("span",{style:{color:"#E1E4E8"}},"()."),p("span",{style:{color:"#B392F0"}},"bucket"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"video"'),p("span",{style:{color:"#E1E4E8"}},")."),p("span",{style:{color:"#B392F0"}},"objects"),p("span",{style:{color:"#E1E4E8"}},"(deleteObjects)."),p("span",{style:{color:"#B392F0"}},"build"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        Iterable<Result<"),p("span",{style:{color:"#F97583"}},"DeleteError"),p("span",{style:{color:"#E1E4E8"}},">> results "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," minioClient."),p("span",{style:{color:"#B392F0"}},"removeObjects"),p("span",{style:{color:"#E1E4E8"}},"(removeObjectsArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        results."),p("span",{style:{color:"#B392F0"}},"forEach"),p("span",{style:{color:"#E1E4E8"}},"(r"),p("span",{style:{color:"#F97583"}},"->"),p("span",{style:{color:"#E1E4E8"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            DeleteError deleteError "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            "),p("span",{style:{color:"#F97583"}},"try"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                deleteError "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," r."),p("span",{style:{color:"#B392F0"}},"get"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                log."),p("span",{style:{color:"#B392F0"}},"error"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"清楚分块文件失败,objectname:{}"'),p("span",{style:{color:"#E1E4E8"}},",deleteError."),p("span",{style:{color:"#B392F0"}},"objectName"),p("span",{style:{color:"#E1E4E8"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        });")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    } "),p("span",{style:{color:"#F97583"}},"catch"),p("span",{style:{color:"#E1E4E8"}}," (Exception "),p("span",{style:{color:"#FFAB70"}},"e"),p("span",{style:{color:"#E1E4E8"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        e."),p("span",{style:{color:"#B392F0"}},"printStackTrace"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"        log."),p("span",{style:{color:"#B392F0"}},"error"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"清楚分块文件失败,chunkFileFolderPath:{}"'),p("span",{style:{color:"#E1E4E8"}},",chunkFileFolderPath,e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"Java")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"mergechunks"),p("span",{style:{color:"#24292E"}},"(Long companyId, String fileMd5, "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkTotal, UploadFileParamsDto uploadFileParamsDto) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//=====获取分块文件路径=====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String chunkFileFolderPath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),p("span",{style:{color:"#24292E"}},"(fileMd5);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//组成将分块文件路径组成 List<ComposeSource>")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    List<"),p("span",{style:{color:"#D73A49"}},"ComposeSource"),p("span",{style:{color:"#24292E"}},"> sourceObjectList "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Stream."),p("span",{style:{color:"#6F42C1"}},"iterate"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},", i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"++"),p("span",{style:{color:"#24292E"}},"i)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            ."),p("span",{style:{color:"#6F42C1"}},"limit"),p("span",{style:{color:"#24292E"}},"(chunkTotal)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            ."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," ComposeSource."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"(bucket_videoFiles)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"(chunkFileFolderPath."),p("span",{style:{color:"#6F42C1"}},"concat"),p("span",{style:{color:"#24292E"}},"(Integer."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"(i)))")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                    ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"())")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            ."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//=====合并=====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String fileName "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"getFilename"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String extName "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," fileName."),p("span",{style:{color:"#6F42C1"}},"substring"),p("span",{style:{color:"#24292E"}},"(fileName."),p("span",{style:{color:"#6F42C1"}},"lastIndexOf"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"."'),p("span",{style:{color:"#24292E"}},"));")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//合并文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    String mergeFilePath "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"getFilePathByMd5"),p("span",{style:{color:"#24292E"}},"(fileMd5, extName);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//合并文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        ObjectWriteResponse response "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," minioClient."),p("span",{style:{color:"#6F42C1"}},"composeObject"),p("span",{style:{color:"#24292E"}},"(")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ComposeObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"(bucket_videoFiles)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"(mergeFilePath)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        ."),p("span",{style:{color:"#6F42C1"}},"sources"),p("span",{style:{color:"#24292E"}},"(sourceObjectList)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                        ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"合并文件成功:{}"'),p("span",{style:{color:"#24292E"}},",mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"合并文件失败,fileMd5:{},异常:{}"'),p("span",{style:{color:"#24292E"}},",fileMd5,e."),p("span",{style:{color:"#6F42C1"}},"getMessage"),p("span",{style:{color:"#24292E"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"validfail"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"合并文件失败。"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"// ====验证md5====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//下载合并后的文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File minioFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"downloadFileFromMinIO"),p("span",{style:{color:"#24292E"}},"(bucket_videoFiles,mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(minioFile "),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"下载合并后文件失败,mergeFilePath:{}"'),p("span",{style:{color:"#24292E"}},",mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"validfail"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"下载合并后文件失败。"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," (InputStream newFileInputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileInputStream"),p("span",{style:{color:"#24292E"}},"(minioFile)) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//minio上文件的md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        String md5Hex "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," DigestUtils."),p("span",{style:{color:"#6F42C1"}},"md5Hex"),p("span",{style:{color:"#24292E"}},"(newFileInputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//比较md5值，不一致则说明文件不完整")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"!"),p("span",{style:{color:"#24292E"}},"fileMd5."),p("span",{style:{color:"#6F42C1"}},"equals"),p("span",{style:{color:"#24292E"}},"(md5Hex)){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"validfail"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"文件合并校验失败，最终上传失败。"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//文件大小")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileSize"),p("span",{style:{color:"#24292E"}},"(minioFile."),p("span",{style:{color:"#6F42C1"}},"length"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }"),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"debug"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"校验文件失败,fileMd5:{},异常:{}"'),p("span",{style:{color:"#24292E"}},",fileMd5,e."),p("span",{style:{color:"#6F42C1"}},"getMessage"),p("span",{style:{color:"#24292E"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"validfail"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"false"),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'"文件合并校验失败，最终上传失败。"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }"),p("span",{style:{color:"#D73A49"}},"finally"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(minioFile"),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"           minioFile."),p("span",{style:{color:"#6F42C1"}},"delete"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//文件入库")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    currentProxy."),p("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),p("span",{style:{color:"#24292E"}},"(companyId,fileMd5,uploadFileParamsDto,bucket_videoFiles,mergeFilePath);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//=====清除分块文件=====")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6F42C1"}},"clearChunkFiles"),p("span",{style:{color:"#24292E"}},"(chunkFileFolderPath,chunkTotal);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," RestResponse."),p("span",{style:{color:"#6F42C1"}},"success"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 从minio下载文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"bucket"),p("span",{style:{color:"#6A737D"}}," 桶")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"objectName"),p("span",{style:{color:"#6A737D"}}," 对象名称")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," 下载后的文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," File "),p("span",{style:{color:"#6F42C1"}},"downloadFileFromMinIO"),p("span",{style:{color:"#24292E"}},"(String bucket,String objectName){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#6A737D"}},"//临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    File minioFile "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    FileOutputStream outputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        InputStream stream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," minioClient."),p("span",{style:{color:"#6F42C1"}},"getObject"),p("span",{style:{color:"#24292E"}},"(GetObjectArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"(bucket)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"object"),p("span",{style:{color:"#24292E"}},"(objectName)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#6A737D"}},"//创建临时文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        minioFile"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}},"File."),p("span",{style:{color:"#6F42C1"}},"createTempFile"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"minio"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#032F62"}},'".merge"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        outputStream "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"FileOutputStream"),p("span",{style:{color:"#24292E"}},"(minioFile);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        IOUtils."),p("span",{style:{color:"#6F42C1"}},"copy"),p("span",{style:{color:"#24292E"}},"(stream,outputStream);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," minioFile;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"       e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }"),p("span",{style:{color:"#D73A49"}},"finally"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(outputStream"),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                outputStream."),p("span",{style:{color:"#6F42C1"}},"close"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (IOException "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 得到合并后的文件的地址")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileMd5"),p("span",{style:{color:"#6A737D"}}," 文件id即md5值")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"fileExt"),p("span",{style:{color:"#6A737D"}}," 文件扩展名")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String "),p("span",{style:{color:"#6F42C1"}},"getFilePathByMd5"),p("span",{style:{color:"#24292E"}},"(String fileMd5,String fileExt){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}},"   fileMd5."),p("span",{style:{color:"#6F42C1"}},"substring"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},","),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," fileMd5."),p("span",{style:{color:"#6F42C1"}},"substring"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"1"),p("span",{style:{color:"#24292E"}},","),p("span",{style:{color:"#005CC5"}},"2"),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," fileMd5 "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"/"'),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"fileMd5 "),p("span",{style:{color:"#D73A49"}},"+"),p("span",{style:{color:"#24292E"}},"fileExt;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * 清除分块文件")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"chunkFileFolderPath"),p("span",{style:{color:"#6A737D"}}," 分块文件路径")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"chunkTotal"),p("span",{style:{color:"#6A737D"}}," 分块文件总数")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," */")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"clearChunkFiles"),p("span",{style:{color:"#24292E"}},"(String chunkFileFolderPath,"),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkTotal){")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        List<"),p("span",{style:{color:"#D73A49"}},"DeleteObject"),p("span",{style:{color:"#24292E"}},"> deleteObjects "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," Stream."),p("span",{style:{color:"#6F42C1"}},"iterate"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"0"),p("span",{style:{color:"#24292E"}},", i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"++"),p("span",{style:{color:"#24292E"}},"i)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"limit"),p("span",{style:{color:"#24292E"}},"(chunkTotal)")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"map"),p("span",{style:{color:"#24292E"}},"(i "),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"DeleteObject"),p("span",{style:{color:"#24292E"}},"(chunkFileFolderPath."),p("span",{style:{color:"#6F42C1"}},"concat"),p("span",{style:{color:"#24292E"}},"(Integer."),p("span",{style:{color:"#6F42C1"}},"toString"),p("span",{style:{color:"#24292E"}},"(i))))")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                ."),p("span",{style:{color:"#6F42C1"}},"collect"),p("span",{style:{color:"#24292E"}},"(Collectors."),p("span",{style:{color:"#6F42C1"}},"toList"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        RemoveObjectsArgs removeObjectsArgs "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," RemoveObjectsArgs."),p("span",{style:{color:"#6F42C1"}},"builder"),p("span",{style:{color:"#24292E"}},"()."),p("span",{style:{color:"#6F42C1"}},"bucket"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"video"'),p("span",{style:{color:"#24292E"}},")."),p("span",{style:{color:"#6F42C1"}},"objects"),p("span",{style:{color:"#24292E"}},"(deleteObjects)."),p("span",{style:{color:"#6F42C1"}},"build"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        Iterable<Result<"),p("span",{style:{color:"#D73A49"}},"DeleteError"),p("span",{style:{color:"#24292E"}},">> results "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," minioClient."),p("span",{style:{color:"#6F42C1"}},"removeObjects"),p("span",{style:{color:"#24292E"}},"(removeObjectsArgs);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        results."),p("span",{style:{color:"#6F42C1"}},"forEach"),p("span",{style:{color:"#24292E"}},"(r"),p("span",{style:{color:"#D73A49"}},"->"),p("span",{style:{color:"#24292E"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            DeleteError deleteError "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            "),p("span",{style:{color:"#D73A49"}},"try"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                deleteError "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," r."),p("span",{style:{color:"#6F42C1"}},"get"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                log."),p("span",{style:{color:"#6F42C1"}},"error"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"清楚分块文件失败,objectname:{}"'),p("span",{style:{color:"#24292E"}},",deleteError."),p("span",{style:{color:"#6F42C1"}},"objectName"),p("span",{style:{color:"#24292E"}},"(),e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"            }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        });")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    } "),p("span",{style:{color:"#D73A49"}},"catch"),p("span",{style:{color:"#24292E"}}," (Exception "),p("span",{style:{color:"#E36209"}},"e"),p("span",{style:{color:"#24292E"}},") {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        e."),p("span",{style:{color:"#6F42C1"}},"printStackTrace"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"        log."),p("span",{style:{color:"#6F42C1"}},"error"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"清楚分块文件失败,chunkFileFolderPath:{}"'),p("span",{style:{color:"#24292E"}},",chunkFileFolderPath,e);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),sc={id:"_3-5-2-接口层完善",tabindex:"-1"},lc=p("strong",null,"3.5.2 接口层完善",-1),oc=p("p",null,"下边完善接口层",-1),nc=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"合并文件"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/upload/mergechunks"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," RestResponse "),p("span",{style:{color:"#B392F0"}},"mergechunks"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),p("span",{style:{color:"#E1E4E8"}},") String fileMd5,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"fileName"'),p("span",{style:{color:"#E1E4E8"}},") String fileName,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"                                @"),p("span",{style:{color:"#F97583"}},"RequestParam"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"chunkTotal"'),p("span",{style:{color:"#E1E4E8"}},") "),p("span",{style:{color:"#F97583"}},"int"),p("span",{style:{color:"#E1E4E8"}}," chunkTotal) throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    Long companyId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"1232141425L"),p("span",{style:{color:"#E1E4E8"}},";")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    UploadFileParamsDto uploadFileParamsDto "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFileType"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"001002"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setTags"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"课程视频"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setRemark"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),p("span",{style:{color:"#B392F0"}},"setFilename"),p("span",{style:{color:"#E1E4E8"}},"(fileName);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," mediaFileService."),p("span",{style:{color:"#B392F0"}},"mergechunks"),p("span",{style:{color:"#E1E4E8"}},"(companyId,fileMd5,chunkTotal,uploadFileParamsDto);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"合并文件"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/upload/mergechunks"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," RestResponse "),p("span",{style:{color:"#6F42C1"}},"mergechunks"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileMd5"'),p("span",{style:{color:"#24292E"}},") String fileMd5,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"fileName"'),p("span",{style:{color:"#24292E"}},") String fileName,")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"                                @"),p("span",{style:{color:"#D73A49"}},"RequestParam"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"chunkTotal"'),p("span",{style:{color:"#24292E"}},") "),p("span",{style:{color:"#D73A49"}},"int"),p("span",{style:{color:"#24292E"}}," chunkTotal) throws Exception {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    Long companyId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"1232141425L"),p("span",{style:{color:"#24292E"}},";")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    UploadFileParamsDto uploadFileParamsDto "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFileType"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"001002"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setTags"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"课程视频"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setRemark"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),p("span",{style:{color:"#6F42C1"}},"setFilename"),p("span",{style:{color:"#24292E"}},"(fileName);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," mediaFileService."),p("span",{style:{color:"#6F42C1"}},"mergechunks"),p("span",{style:{color:"#24292E"}},"(companyId,fileMd5,chunkTotal,uploadFileParamsDto);")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),ec={id:"_3-5-3-合并分块测试",tabindex:"-1"},ac=p("strong",null,"3.5.3 合并分块测试",-1),cc=p("p",null,"下边进行前后端联调：",-1),pc=p("p",null,"1、上传一个视频测试合并分块的执行逻辑",-1),tc=p("p",null,"进入service方法逐行跟踪。",-1),rc=p("p",null,"2、断点续传测试",-1),Ec=p("p",null,"上传一部分后，停止刷新浏览器再重新上传，通过浏览器日志发现已经上传过的分块不再重新上传",-1),yc=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps90.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),ic={id:"四-绑定媒资",tabindex:"-1"},Fc=p("strong",null,"四 绑定媒资",-1),dc={id:"_4-1-需求分析",tabindex:"-1"},uc=p("strong",null,"4.1 需求分析",-1),Dc={id:"_4-1-1-业务流程",tabindex:"-1"},mc=p("strong",null,"4.1.1 业务流程",-1),Ac=p("p",null,"到目前为止，媒资管理已完成文件上传、视频处理、我的媒资功能等基本功能，其它模块可以使用媒资文件，本节要讲解课程计划绑定媒资文件。",-1),gc=p("p",null,"如何将课程计划绑定媒资呢？",-1),Cc=p("p",null,"首先进入课程计划界面，然后选择要绑定的视频进行绑定即可。",-1),hc=p("p",null,"具体的业务流程如下：",-1),Bc=p("p",null,'1.教育机构用户进入课程管理页面并编辑某一个课程，在"课程大纲"标签页的某一小节后可点击”添加视频“。',-1),bc=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps139.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),fc=p("p",null,"2.弹出添加视频对话框，可通过视频关键字搜索已审核通过的视频媒资。",-1),kc=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps140.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Sc=p("p",null,"3.选择视频媒资，点击提交按钮，完成课程计划绑定媒资流程。",-1),vc=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps141.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Mc=p("p",null,"课程计划关联视频后如下图：",-1),jc=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps142.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Pc=p("p",null,"点击已经绑定的视频名称即可解除绑定。",-1),_c=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps143.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Ic={id:"_4-1-2-数据模型",tabindex:"-1"},Tc=p("strong",null,"4.1.2 数据模型",-1),Oc=p("p",null,"课程计划绑定媒资文件后存储至课程计划绑定媒资表",-1),Rc=p("figure",null,[p("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps144.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),xc={id:"_4-2-接口定义",tabindex:"-1"},wc=p("strong",null,"4.2 接口定义",-1),Lc=p("p",null,"根据业务流程，用户进入课程计划列表，首先确定向哪个课程计划添加视频，点击”添加视频“后用户选择视频，选择视频，点击提交，前端以json格式请求以下参数：",-1),Nc=p("p",null,"提交媒资文件id、文件名称、教学计划id",-1),Uc=p("p",null,"示例如下：",-1),zc=p("div",{class:"language-json"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"json"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"mediaId"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"70a98b4a2fffc89e50b101f959cc33ca"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"fileName"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'"22-Hmily实现TCC事务-开发bank2的confirm方法.avi"'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"teachplanId"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#79B8FF"}},"257")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"mediaId"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"70a98b4a2fffc89e50b101f959cc33ca"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"fileName"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'"22-Hmily实现TCC事务-开发bank2的confirm方法.avi"'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"teachplanId"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#005CC5"}},"257")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),qc=p("p",null,"此接口在内容管理模块提供。",-1),Kc=p("p",null,"在内容管理模块定义请求参数模型类型：",-1),Hc=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Data")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiModel"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#9ECBFF"}},'"BindTeachplanMediaDto"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"description"),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#9ECBFF"}},'"教学计划-媒资绑定提交数据"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"class"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"BindTeachplanMediaDto"),p("span",{style:{color:"#E1E4E8"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiModelProperty"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"媒资文件id"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"required"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String mediaId;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiModelProperty"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"媒资文件名称"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"required"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," String fileName;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," @"),p("span",{style:{color:"#F97583"}},"ApiModelProperty"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"课程计划标识"'),p("span",{style:{color:"#E1E4E8"}},", "),p("span",{style:{color:"#79B8FF"}},"required"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#79B8FF"}},"true"),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"private"),p("span",{style:{color:"#E1E4E8"}}," Long teachplanId;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Data")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiModel"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#032F62"}},'"BindTeachplanMediaDto"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"description"),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#032F62"}},'"教学计划-媒资绑定提交数据"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"class"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"BindTeachplanMediaDto"),p("span",{style:{color:"#24292E"}}," {")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiModelProperty"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"媒资文件id"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"required"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String mediaId;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiModelProperty"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"媒资文件名称"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"required"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," String fileName;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," @"),p("span",{style:{color:"#D73A49"}},"ApiModelProperty"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"课程计划标识"'),p("span",{style:{color:"#24292E"}},", "),p("span",{style:{color:"#005CC5"}},"required"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#005CC5"}},"true"),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"private"),p("span",{style:{color:"#24292E"}}," Long teachplanId;")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),Wc=p("p",null,"在TeachplanController类中定义接口如下：",-1),Gc=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"课程计划和媒资信息绑定"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/teachplan/association/media"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"associationMedia"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestBody"),p("span",{style:{color:"#E1E4E8"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"课程计划和媒资信息绑定"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/teachplan/association/media"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"associationMedia"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestBody"),p("span",{style:{color:"#24292E"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),$c={id:"_4-3-接口开发",tabindex:"-1"},Vc=p("strong",null,"4.3 接口开发",-1),Xc={id:"_4-3-1-dao开发",tabindex:"-1"},Jc=p("strong",null,"4.3.1 DAO开发",-1),Qc=p("p",null,"对teachplanMedia表自动生成Mapper。",-1),Yc={id:"_4-3-2-service开发",tabindex:"-1"},Zc=p("strong",null,"4.3.2 Service开发",-1),sp=p("p",null,"根据需求定义service接口",-1),lp=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 教学计划绑定媒资")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#FFAB70"}},"bindTeachplanMediaDto")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.content.model.po.TeachplanMedia")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#F97583"}},"@author"),p("span",{style:{color:"#6A737D"}}," Mr.M")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/14 22:20")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," TeachplanMedia "),p("span",{style:{color:"#B392F0"}},"associationMedia"),p("span",{style:{color:"#E1E4E8"}},"(BindTeachplanMediaDto bindTeachplanMediaDto);")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"/**")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @description 教学计划绑定媒资")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@param"),p("span",{style:{color:"#6A737D"}}," "),p("span",{style:{color:"#E36209"}},"bindTeachplanMediaDto")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@return"),p("span",{style:{color:"#6A737D"}}," com.xuecheng.content.model.po.TeachplanMedia")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * "),p("span",{style:{color:"#D73A49"}},"@author"),p("span",{style:{color:"#6A737D"}}," Mr.M")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}}," * @date 2022/9/14 22:20")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"*/")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," TeachplanMedia "),p("span",{style:{color:"#6F42C1"}},"associationMedia"),p("span",{style:{color:"#24292E"}},"(BindTeachplanMediaDto bindTeachplanMediaDto);")])])])],-1),op=p("p",null,"定义接口实现",-1),np=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," @"),p("span",{style:{color:"#F97583"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"public"),p("span",{style:{color:"#E1E4E8"}}," TeachplanMedia "),p("span",{style:{color:"#B392F0"}},"associationMedia"),p("span",{style:{color:"#E1E4E8"}},"(BindTeachplanMediaDto bindTeachplanMediaDto) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"//教学计划id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," Long teachplanId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," bindTeachplanMediaDto."),p("span",{style:{color:"#B392F0"}},"getTeachplanId"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," Teachplan teachplan "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," teachplanMapper."),p("span",{style:{color:"#B392F0"}},"selectById"),p("span",{style:{color:"#E1E4E8"}},"(teachplanId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(teachplan"),p("span",{style:{color:"#F97583"}},"=="),p("span",{style:{color:"#79B8FF"}},"null"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  XueChengPlusException."),p("span",{style:{color:"#B392F0"}},"cast"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"教学计划不存在"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," Integer grade "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," teachplan."),p("span",{style:{color:"#B392F0"}},"getGrade"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"if"),p("span",{style:{color:"#E1E4E8"}},"(grade"),p("span",{style:{color:"#F97583"}},"!="),p("span",{style:{color:"#79B8FF"}},"2"),p("span",{style:{color:"#E1E4E8"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  XueChengPlusException."),p("span",{style:{color:"#B392F0"}},"cast"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"只允许第二级教学计划绑定媒资文件"'),p("span",{style:{color:"#E1E4E8"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"//课程id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," Long courseId "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," teachplan."),p("span",{style:{color:"#B392F0"}},"getCourseId"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"//先删除原来该教学计划绑定的媒资")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," teachplanMediaMapper."),p("span",{style:{color:"#B392F0"}},"delete"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),p("span",{style:{color:"#F97583"}},"TeachplanMedia"),p("span",{style:{color:"#E1E4E8"}},">()."),p("span",{style:{color:"#B392F0"}},"eq"),p("span",{style:{color:"#E1E4E8"}},"(TeachplanMedia"),p("span",{style:{color:"#F97583"}},"::"),p("span",{style:{color:"#E1E4E8"}},"getTeachplanId,teachplanId));")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#6A737D"}},"//再添加教学计划与媒资的绑定关系")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," TeachplanMedia teachplanMedia "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"new"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"TeachplanMedia"),p("span",{style:{color:"#E1E4E8"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),p("span",{style:{color:"#B392F0"}},"setCourseId"),p("span",{style:{color:"#E1E4E8"}},"(courseId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),p("span",{style:{color:"#B392F0"}},"setTeachplanId"),p("span",{style:{color:"#E1E4E8"}},"(teachplanId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),p("span",{style:{color:"#B392F0"}},"setMediaFilename"),p("span",{style:{color:"#E1E4E8"}},"(bindTeachplanMediaDto."),p("span",{style:{color:"#B392F0"}},"getFileName"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),p("span",{style:{color:"#B392F0"}},"setMediaId"),p("span",{style:{color:"#E1E4E8"}},"(bindTeachplanMediaDto."),p("span",{style:{color:"#B392F0"}},"getMediaId"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),p("span",{style:{color:"#B392F0"}},"setCreateDate"),p("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),p("span",{style:{color:"#B392F0"}},"now"),p("span",{style:{color:"#E1E4E8"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," teachplanMediaMapper."),p("span",{style:{color:"#B392F0"}},"insert"),p("span",{style:{color:"#E1E4E8"}},"(teachplanMedia);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"return"),p("span",{style:{color:"#E1E4E8"}}," teachplanMedia;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"Transactional")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," @"),p("span",{style:{color:"#D73A49"}},"Override")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"public"),p("span",{style:{color:"#24292E"}}," TeachplanMedia "),p("span",{style:{color:"#6F42C1"}},"associationMedia"),p("span",{style:{color:"#24292E"}},"(BindTeachplanMediaDto bindTeachplanMediaDto) {")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"//教学计划id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," Long teachplanId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," bindTeachplanMediaDto."),p("span",{style:{color:"#6F42C1"}},"getTeachplanId"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," Teachplan teachplan "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," teachplanMapper."),p("span",{style:{color:"#6F42C1"}},"selectById"),p("span",{style:{color:"#24292E"}},"(teachplanId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(teachplan"),p("span",{style:{color:"#D73A49"}},"=="),p("span",{style:{color:"#005CC5"}},"null"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  XueChengPlusException."),p("span",{style:{color:"#6F42C1"}},"cast"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"教学计划不存在"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," Integer grade "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," teachplan."),p("span",{style:{color:"#6F42C1"}},"getGrade"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"if"),p("span",{style:{color:"#24292E"}},"(grade"),p("span",{style:{color:"#D73A49"}},"!="),p("span",{style:{color:"#005CC5"}},"2"),p("span",{style:{color:"#24292E"}},"){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  XueChengPlusException."),p("span",{style:{color:"#6F42C1"}},"cast"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"只允许第二级教学计划绑定媒资文件"'),p("span",{style:{color:"#24292E"}},");")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," }")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"//课程id")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," Long courseId "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," teachplan."),p("span",{style:{color:"#6F42C1"}},"getCourseId"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"//先删除原来该教学计划绑定的媒资")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," teachplanMediaMapper."),p("span",{style:{color:"#6F42C1"}},"delete"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),p("span",{style:{color:"#D73A49"}},"TeachplanMedia"),p("span",{style:{color:"#24292E"}},">()."),p("span",{style:{color:"#6F42C1"}},"eq"),p("span",{style:{color:"#24292E"}},"(TeachplanMedia"),p("span",{style:{color:"#D73A49"}},"::"),p("span",{style:{color:"#24292E"}},"getTeachplanId,teachplanId));")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6A737D"}},"//再添加教学计划与媒资的绑定关系")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," TeachplanMedia teachplanMedia "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"new"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"TeachplanMedia"),p("span",{style:{color:"#24292E"}},"();")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," teachplanMedia."),p("span",{style:{color:"#6F42C1"}},"setCourseId"),p("span",{style:{color:"#24292E"}},"(courseId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," teachplanMedia."),p("span",{style:{color:"#6F42C1"}},"setTeachplanId"),p("span",{style:{color:"#24292E"}},"(teachplanId);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," teachplanMedia."),p("span",{style:{color:"#6F42C1"}},"setMediaFilename"),p("span",{style:{color:"#24292E"}},"(bindTeachplanMediaDto."),p("span",{style:{color:"#6F42C1"}},"getFileName"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," teachplanMedia."),p("span",{style:{color:"#6F42C1"}},"setMediaId"),p("span",{style:{color:"#24292E"}},"(bindTeachplanMediaDto."),p("span",{style:{color:"#6F42C1"}},"getMediaId"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," teachplanMedia."),p("span",{style:{color:"#6F42C1"}},"setCreateDate"),p("span",{style:{color:"#24292E"}},"(LocalDateTime."),p("span",{style:{color:"#6F42C1"}},"now"),p("span",{style:{color:"#24292E"}},"());")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," teachplanMediaMapper."),p("span",{style:{color:"#6F42C1"}},"insert"),p("span",{style:{color:"#24292E"}},"(teachplanMedia);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"return"),p("span",{style:{color:"#24292E"}}," teachplanMedia;")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),ep={id:"_4-3-3-接口层完善",tabindex:"-1"},ap=p("strong",null,"4.3.3 接口层完善",-1),cp=p("p",null,"完善接口层调用Service层的代码",-1),pp=p("div",{class:"language-java"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"java"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"ApiOperation"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#79B8FF"}},"value"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#F97583"}},"="),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},'"课程计划和媒资信息绑定"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"@"),p("span",{style:{color:"#F97583"}},"PostMapping"),p("span",{style:{color:"#E1E4E8"}},"("),p("span",{style:{color:"#9ECBFF"}},'"/teachplan/association/media"'),p("span",{style:{color:"#E1E4E8"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"void"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#B392F0"}},"associationMedia"),p("span",{style:{color:"#E1E4E8"}},"(@"),p("span",{style:{color:"#F97583"}},"RequestBody"),p("span",{style:{color:"#E1E4E8"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"    teachplanService."),p("span",{style:{color:"#B392F0"}},"associationMedia"),p("span",{style:{color:"#E1E4E8"}},"(bindTeachplanMediaDto);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"ApiOperation"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#005CC5"}},"value"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#D73A49"}},"="),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},'"课程计划和媒资信息绑定"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"@"),p("span",{style:{color:"#D73A49"}},"PostMapping"),p("span",{style:{color:"#24292E"}},"("),p("span",{style:{color:"#032F62"}},'"/teachplan/association/media"'),p("span",{style:{color:"#24292E"}},")")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"void"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#6F42C1"}},"associationMedia"),p("span",{style:{color:"#24292E"}},"(@"),p("span",{style:{color:"#D73A49"}},"RequestBody"),p("span",{style:{color:"#24292E"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"    teachplanService."),p("span",{style:{color:"#6F42C1"}},"associationMedia"),p("span",{style:{color:"#24292E"}},"(bindTeachplanMediaDto);")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),tp={id:"_4-3-4-接口测试",tabindex:"-1"},rp=p("strong",null,"4.3.4 接口测试",-1),Ep=p("p",null,"1、使用httpclient测试",-1),yp=p("div",{class:"language-http"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"http"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 课程计划绑定视频")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"POST"),p("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/teachplan/association/media")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#85E89D"}},"Content-Type"),p("span",{style:{color:"#F97583"}},":"),p("span",{style:{color:"#E1E4E8"}}," "),p("span",{style:{color:"#9ECBFF"}},"application/json")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"mediaId"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"fileName"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'""'),p("span",{style:{color:"#E1E4E8"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"  "),p("span",{style:{color:"#79B8FF"}},'"teachplanId"'),p("span",{style:{color:"#E1E4E8"}},": "),p("span",{style:{color:"#9ECBFF"}},'""')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#E1E4E8"}},"}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 课程计划绑定视频")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"POST"),p("span",{style:{color:"#24292E"}}," {{media_host}}/media/teachplan/association/media")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#22863A"}},"Content-Type"),p("span",{style:{color:"#D73A49"}},":"),p("span",{style:{color:"#24292E"}}," "),p("span",{style:{color:"#032F62"}},"application/json")]),t("\n"),p("span",{class:"line"}),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"{")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"mediaId"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"fileName"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'""'),p("span",{style:{color:"#24292E"}},",")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"  "),p("span",{style:{color:"#005CC5"}},'"teachplanId"'),p("span",{style:{color:"#24292E"}},": "),p("span",{style:{color:"#032F62"}},'""')]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#24292E"}},"}")])])])],-1),ip=p("p",null,"2、前后端联调",-1),Fp=p("p",null,"此功能较为简单推荐直接前后端联调",-1),dp=p("p",null,"向指定课程计划添加视频",-1),up={id:"_4-4-实战",tabindex:"-1"},Dp=p("strong",null,"4.4 实战",-1),mp=p("p",null,"根据接口定义实现解除绑定功能。",-1),Ap=p("p",null,"点击已经绑定的视频名称即可解除绑定。",-1),gp=p("figure",null,[p("img",{src:"https://jsd.cdn.zzko.cn/gh/imLKlauS/blog-picture@main/blogs/wps145.jpg",alt:"img",loading:"lazy",decoding:"async"})],-1),Cp=p("p",null,"接口定义如下：",-1),hp=p("p",null,[p("code",null,"delete /teachplan/association/media/{teachPlanId}/{mediaId} 返回200状态码表示成功。")],-1),Bp=p("p",null,"开发完成使用httpclient测试、前后端联调",-1),bp=p("div",{class:"language-http"},[p("button",{title:"Copy Code",class:"copy"}),p("span",{class:"lang"},"http"),p("pre",{class:"shiki github-dark vp-code-dark"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 课程计划接触视频绑定")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#F97583"}},"DELETE"),p("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/teachplan/association/media/{teachPlanId}/{mediaId}")])])]),p("pre",{class:"shiki github-light vp-code-light"},[p("code",null,[p("span",{class:"line"},[p("span",{style:{color:"#6A737D"}},"### 课程计划接触视频绑定")]),t("\n"),p("span",{class:"line"},[p("span",{style:{color:"#D73A49"}},"DELETE"),p("span",{style:{color:"#24292E"}}," {{media_host}}/media/teachplan/association/media/{teachPlanId}/{mediaId}")])])])],-1);const fp=s(d,[["render",function(s,l,o,i,F,d){const fp=y,kp=a;return c(),n(kp,{frontmatter:F.frontmatter,data:F.data},{"main-content-md":e((()=>[p("h2",u,[D,t(),r(fp,{class:"header-anchor",href:"#一-分布式文件系统","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h3",m,[A,t(),r(fp,{class:"header-anchor",href:"#_1-1-什么是分布式文件系统","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),g,C,h,B,b,f,k,S,v,M,j,P,_,I,T,O,R,x,w,L,N,U,z,q,K,H,W,G,$,V,X,J,Q,Y,Z,ss,ls,os,p("p",null,[ns,r(fp,{href:"https://www.aliyun.com/product/oss",target:"_blank",rel:"noreferrer"},{default:e((()=>[es])),_:1})]),as,p("p",null,[cs,r(fp,{href:"https://cloud.baidu.com/product/bos.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[ps])),_:1})]),p("h3",ts,[rs,t(),r(fp,{class:"header-anchor",href:"#_1-2-minio","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",Es,[ys,t(),r(fp,{class:"header-anchor",href:"#_1-2-1-介绍","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),is,Fs,p("p",null,[t("官网："),r(fp,{href:"https://min.io",target:"_blank",rel:"noreferrer"},{default:e((()=>[t("https://min.io")])),_:1})]),p("p",null,[t("中文："),r(fp,{href:"https://www.minio.org.cn/%EF%BC%8Chttp://docs.minio.org.cn/docs/",target:"_blank",rel:"noreferrer"},{default:e((()=>[t("https://www.minio.org.cn/，http://docs.minio.org.cn/docs/")])),_:1})]),ds,us,Ds,ms,As,gs,Cs,p("h4",hs,[Bs,t(),r(fp,{class:"header-anchor",href:"#_1-2-2-数据恢复演示","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),bs,fs,p("p",null,[t("下载minio，下载地址在"),r(fp,{href:"https://dl.min.io/server/minio/release/%EF%BC%8C%E5%8F%AF%E4%BB%8E%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%96%99%E6%89%BE%E5%88%B0MinIO%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6minio.zip%E8%A7%A3%E5%8E%8B%E5%8D%B3%E5%8F%AF%E4%BD%BF%E7%94%A8%EF%BC%8CCMD%E8%BF%9B%E5%85%A5%E6%9C%89minio.exe%E7%9A%84%E7%9B%AE%E5%BD%95%EF%BC%8C%E8%BF%90%E8%A1%8C%E4%B8%8B%E8%BE%B9%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%9A",target:"_blank",rel:"noreferrer"},{default:e((()=>[t("https://dl.min.io/server/minio/release/，可从课程资料找到MinIO的安装文件minio.zip解压即可使用，CMD进入有minio.exe的目录，运行下边的命令：")])),_:1})]),ks,Ss,vs,Ms,js,Ps,_s,Is,Ts,Os,Rs,xs,ws,Ls,Ns,Us,zs,qs,Ks,Hs,Ws,Gs,$s,Vs,Xs,Js,Qs,Ys,Zs,sl,ll,ol,p("h4",nl,[el,t(),r(fp,{class:"header-anchor",href:"#_1-2-3-测试docker环境","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),al,cl,pl,p("p",null,[t("访问"),r(fp,{href:"http://192.168.2.203:9000",target:"_blank",rel:"noreferrer"},{default:e((()=>[t("http://192.168.2.203:9000")])),_:1})]),tl,rl,El,yl,p("h4",il,[Fl,t(),r(fp,{class:"header-anchor",href:"#_1-2-4-sdk","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h5",dl,[ul,t(),r(fp,{class:"header-anchor",href:"#_1-2-4-1上传文件","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Dl,p("p",null,[t("地址："),r(fp,{href:"https://docs.min.io/docs/java-client-quickstart-guide.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[t("https://docs.min.io/docs/java-client-quickstart-guide.html")])),_:1})]),ml,Al,gl,Cl,hl,Bl,bl,fl,kl,Sl,vl,Ml,jl,Pl,_l,Il,Tl,Ol,Rl,xl,wl,Ll,Nl,Ul,zl,p("h5",ql,[Kl,t(),r(fp,{class:"header-anchor",href:"#_1-2-4-2-删除文件","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Hl,p("p",null,[t("参考："),r(fp,{href:"https://docs.min.io/docs/java-client-api-reference#removeObject",target:"_blank",rel:"noreferrer"},{default:e((()=>[t("https://docs.min.io/docs/java-client-api-reference#removeObject")])),_:1})]),Wl,p("h5",Gl,[$l,t(),r(fp,{class:"header-anchor",href:"#_1-2-4-3-查询文件","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Vl,p("p",null,[t("参考："),r(fp,{href:"https://docs.min.io/docs/java-client-api-reference#getObject",target:"_blank",rel:"noreferrer"},{default:e((()=>[t("https://docs.min.io/docs/java-client-api-reference#getObject")])),_:1})]),Xl,Jl,p("h2",Ql,[Yl,t(),r(fp,{class:"header-anchor",href:"#二-上传图片","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h3",Zl,[so,t(),r(fp,{class:"header-anchor",href:"#_2-1-需求分析","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",lo,[oo,t(),r(fp,{class:"header-anchor",href:"#_2-1-1-业务流程","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),no,eo,ao,co,po,to,ro,Eo,yo,io,Fo,uo,Do,p("h4",mo,[Ao,t(),r(fp,{class:"header-anchor",href:"#_2-1-2-数据模型","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),go,Co,ho,Bo,p("h3",bo,[fo,t(),r(fp,{class:"header-anchor",href:"#_2-2-准备环境","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),ko,So,vo,Mo,jo,Po,_o,Io,p("h3",To,[Oo,t(),r(fp,{class:"header-anchor",href:"#_2-3-接口定义","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Ro,xo,wo,Lo,No,Uo,zo,qo,Ko,Ho,Wo,Go,p("h3",$o,[Vo,t(),r(fp,{class:"header-anchor",href:"#_2-4-接口开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",Xo,[Jo,t(),r(fp,{class:"header-anchor",href:"#_2-4-1-dao开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Qo,p("h4",Yo,[Zo,t(),r(fp,{class:"header-anchor",href:"#_2-4-2-service开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),sn,ln,on,nn,en,an,cn,pn,tn,p("h4",rn,[En,t(),r(fp,{class:"header-anchor",href:"#_2-4-3-完善接口层","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),yn,Fn,p("h4",dn,[un,t(),r(fp,{class:"header-anchor",href:"#_2-4-4-接口测试","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Dn,mn,An,gn,Cn,hn,Bn,p("h4",bn,[fn,t(),r(fp,{class:"header-anchor",href:"#_2-4-5-service事务优化","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),kn,Sn,vn,Mn,jn,Pn,_n,In,Tn,On,Rn,xn,wn,Ln,Nn,Un,zn,qn,Kn,Hn,Wn,Gn,$n,Vn,Xn,Jn,Qn,p("h2",Yn,[Zn,t(),r(fp,{class:"header-anchor",href:"#三-上传视频","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h3",se,[le,t(),r(fp,{class:"header-anchor",href:"#_3-1-需求分析","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),oe,ne,ee,ae,ce,pe,te,re,Ee,ye,ie,Fe,de,p("h3",ue,[De,t(),r(fp,{class:"header-anchor",href:"#_3-2-断点续传技术","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",me,[Ae,t(),r(fp,{class:"header-anchor",href:"#_3-2-1-什么是断点续传","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),ge,Ce,he,Be,be,fe,ke,Se,ve,p("h4",Me,[je,t(),r(fp,{class:"header-anchor",href:"#_3-2-2-分块与合并测试","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Pe,_e,Ie,Te,Oe,Re,xe,we,Le,Ne,Ue,ze,qe,p("h4",Ke,[He,t(),r(fp,{class:"header-anchor",href:"#_3-2-3-视频上传流程","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),We,Ge,$e,Ve,Xe,Je,Qe,Ye,Ze,sa,p("h4",la,[oa,t(),r(fp,{class:"header-anchor",href:"#_3-2-4-minio合并文件测试","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),na,ea,aa,ca,pa,ta,p("h3",ra,[Ea,t(),r(fp,{class:"header-anchor",href:"#_3-3-接口定义","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),ya,ia,Fa,da,p("h3",ua,[Da,t(),r(fp,{class:"header-anchor",href:"#_3-4-上传分块开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",ma,[Aa,t(),r(fp,{class:"header-anchor",href:"#_3-4-1-dao开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),ga,p("h4",Ca,[ha,t(),r(fp,{class:"header-anchor",href:"#_3-4-2-service开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h5",Ba,[ba,t(),r(fp,{class:"header-anchor",href:"#_3-4-2-1-检查文件和分块","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),fa,ka,Sa,va,Ma,p("h5",ja,[Pa,t(),r(fp,{class:"header-anchor",href:"#_3-4-2-2-上传分块","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),_a,Ia,Ta,Oa,p("h5",Ra,[xa,t(),r(fp,{class:"header-anchor",href:"#_3-4-2-3-上传分块测试","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),wa,La,Na,Ua,za,qa,Ka,Ha,Wa,p("h3",Ga,[$a,t(),r(fp,{class:"header-anchor",href:"#_3-5-合并分块开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",Va,[Xa,t(),r(fp,{class:"header-anchor",href:"#_3-5-1-service开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Ja,Qa,Ya,Za,p("h4",sc,[lc,t(),r(fp,{class:"header-anchor",href:"#_3-5-2-接口层完善","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),oc,nc,p("h4",ec,[ac,t(),r(fp,{class:"header-anchor",href:"#_3-5-3-合并分块测试","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),cc,pc,tc,rc,Ec,yc,p("h2",ic,[Fc,t(),r(fp,{class:"header-anchor",href:"#四-绑定媒资","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h3",dc,[uc,t(),r(fp,{class:"header-anchor",href:"#_4-1-需求分析","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",Dc,[mc,t(),r(fp,{class:"header-anchor",href:"#_4-1-1-业务流程","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Ac,gc,Cc,hc,Bc,bc,fc,kc,Sc,vc,Mc,jc,Pc,_c,p("h4",Ic,[Tc,t(),r(fp,{class:"header-anchor",href:"#_4-1-2-数据模型","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Oc,Rc,p("h3",xc,[wc,t(),r(fp,{class:"header-anchor",href:"#_4-2-接口定义","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Lc,Nc,Uc,zc,qc,Kc,Hc,Wc,Gc,p("h3",$c,[Vc,t(),r(fp,{class:"header-anchor",href:"#_4-3-接口开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),p("h4",Xc,[Jc,t(),r(fp,{class:"header-anchor",href:"#_4-3-1-dao开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Qc,p("h4",Yc,[Zc,t(),r(fp,{class:"header-anchor",href:"#_4-3-2-service开发","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),sp,lp,op,np,p("h4",ep,[ap,t(),r(fp,{class:"header-anchor",href:"#_4-3-3-接口层完善","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),cp,pp,p("h4",tp,[rp,t(),r(fp,{class:"header-anchor",href:"#_4-3-4-接口测试","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),Ep,yp,ip,Fp,dp,p("h3",up,[Dp,t(),r(fp,{class:"header-anchor",href:"#_4-4-实战","aria-hidden":"true"},{default:e((()=>[t("#")])),_:1})]),mp,Ap,gp,Cp,hp,Bp,bp])),"main-header":e((()=>[E(s.$slots,"main-header")])),"main-header-after":e((()=>[E(s.$slots,"main-header-after")])),"main-nav":e((()=>[E(s.$slots,"main-nav")])),"main-content":e((()=>[E(s.$slots,"main-content")])),"main-content-after":e((()=>[E(s.$slots,"main-content-after")])),"main-nav-before":e((()=>[E(s.$slots,"main-nav-before")])),"main-nav-after":e((()=>[E(s.$slots,"main-nav-after")])),comment:e((()=>[E(s.$slots,"comment")])),footer:e((()=>[E(s.$slots,"footer")])),aside:e((()=>[E(s.$slots,"aside")])),"aside-custom":e((()=>[E(s.$slots,"aside-custom")])),default:e((()=>[E(s.$slots,"default")])),_:3},8,["frontmatter","data"])}]]);export{i as __pageData,fp as default};
