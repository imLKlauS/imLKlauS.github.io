import{u as i,p as l,o as s,c as a,w as n,a as t,_ as h,r as e,b as g,d as k}from"../../assets/app-BJOH8xQC.js";const r=g("h1",{id:"基础篇",tabindex:"-1"},[k("基础篇 "),g("a",{class:"header-anchor",href:"#基础篇","aria-label":'Permalink to "基础篇"'},"​")],-1),p=g("h2",{id:"_1-arraylist",tabindex:"-1"},[k("1. ArrayList "),g("a",{class:"header-anchor",href:"#_1-arraylist","aria-label":'Permalink to "1. ArrayList"'},"​")],-1),d=g("p",null,[g("strong",null,"要求")],-1),c=g("ul",null,[g("li",null,"掌握 ArrayList 扩容规则")],-1),u=g("p",null,[g("strong",null,"扩容规则")],-1),o=g("ol",null,[g("li",null,[g("strong",null,"ArrayList()"),k(" 会使用"),g("strong",null,"长度为零"),k("的数组")])],-1),E=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418114304421.png",alt:"image-20230418114304421",loading:"lazy",decoding:"async",class:"lazy"})],-1),y=g("ol",{start:"2"},[g("li",null,[g("strong",null,"ArrayList(int initialCapacity)"),k(" 会使用"),g("strong",null,"指定容量"),k("的数组")])],-1),m=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418114403174.png",alt:"image-20230418114403174",loading:"lazy",decoding:"async",class:"lazy"})],-1),F=g("ol",{start:"3"},[g("li",null,"public ArrayList(Collection<? extends E> c) 会使用 c 的大小作为数组容量")],-1),b=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418114502997.png",alt:"image-20230418114502997",loading:"lazy",decoding:"async",class:"lazy"})],-1),f=g("ol",{start:"4"},[g("li",null,"add(Object o) 首次扩容为 10，再次扩容为上次容量的 1.5 倍")],-1),C=g("ul",null,[g("li",null,"第一次添加数组，数组为0，发生第一次扩容"),g("li",null,"第一个元素放入新数组索引0，新数组替换旧数组(首次为0)")],-1),A=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418115017704.png",alt:"image-20230418115017704",loading:"lazy",decoding:"async",class:"lazy"})],-1),z=g("ul",null,[g("li",null,"再次扩容为上次容量的 1.5 倍，完成扩容并添加元素，新数组替换旧数组，旧数组没人引用就会被垃圾回收")],-1),S=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418115545132.png",alt:"image-20230418115545132",loading:"lazy",decoding:"async",class:"lazy"})],-1),D=g("ul",null,[g("li",null,"以后扩容按上次容量+上次容量右移1位")],-1),L=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418115811928.png",alt:"image-20230418115811928",loading:"lazy",decoding:"async",class:"lazy"})],-1),v=g("ul",null,[g("li",null,"此方式为调用的add方法得到的扩容结果")],-1),j=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418120314176.png",alt:"image-20230418120314176",loading:"lazy",decoding:"async",class:"lazy"})],-1),B=g("ol",{start:"5"},[g("li",null,"addAll(Collection c) 没有元素时，扩容为 Math.max(10, 实际元素个数)，有元素时为 Math.max(原容量 1.5 倍, 实际元素个数)")],-1),K=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418120611741.png",alt:"image-20230418120611741",loading:"lazy",decoding:"async",class:"lazy"})],-1),x=g("ul",null,[g("li",null,"第一次空数组扩容(元素个数<10)")],-1),_=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418120727097.png",alt:"image-20230418120727097",loading:"lazy",decoding:"async",class:"lazy"})],-1),M=g("ul",null,[g("li",null,"第一次空数组扩容(10<元素个数<15，此时会拿当前元素个数与当前容量下次扩容的容量二者之间的较大值作为当前容量)")],-1),N=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418121100137.png",alt:"image-20230418121100137",loading:"lazy",decoding:"async",class:"lazy"})],-1),w=g("ul",null,[g("li",null,"第一次非空数组扩容(规则一样)")],-1),H=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418121501578.png",alt:"image-20230418121501578",loading:"lazy",decoding:"async",class:"lazy"})],-1),P=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418121608015.png",alt:"image-20230418121608015",loading:"lazy",decoding:"async",class:"lazy"})],-1),T=g("p",null,"其中第 4 点必须知道，其它几点视个人情况而定",-1),I=g("p",null,[g("strong",null,"提示")],-1),O=g("ul",null,[g("li",null,[k("测试代码见 "),g("code",null,"day01.list.TestArrayList"),k(" ，这里不再列出")]),g("li",null,[k("要"),g("strong",null,"注意"),k("的是，示例中用反射方式来更直观地反映 ArrayList 的扩容特征，但从 JDK 9 由于模块化的影响，对反射做了较多限制，需要在运行测试代码时添加 VM 参数 "),g("code",null,"--add-opens java.base/java.util=ALL-UNNAMED"),k(" 方能运行通过，后面的例子都有相同问题")])],-1),U=g("blockquote",null,[g("p",null,[g("em",null,[g("strong",null,"代码说明")])]),g("ul",null,[g("li",null,"day01.list.TestArrayList#arrayListGrowRule 演示了 add(Object) 方法的扩容规则，输入参数 n 代表打印多少次扩容后的数组长度")])],-1),V=g("h3",{id:"补充",tabindex:"-1"},[k("补充 "),g("a",{class:"header-anchor",href:"#补充","aria-label":'Permalink to "补充"'},"​")],-1),q=g("blockquote",null,[g("p",null,[g("strong",null,"addAll扩容机制"),k("：添加元素后的元素个数与下一次扩容数作比较 0->10:3个->10,11->11;10->15:13->15,16->16")])],-1),J=g("h2",{id:"_2-iterator",tabindex:"-1"},[k("2. Iterator "),g("a",{class:"header-anchor",href:"#_2-iterator","aria-label":'Permalink to "2. Iterator"'},"​")],-1),$=g("p",null,[g("strong",null,"要求")],-1),R=g("ul",null,[g("li",null,"掌握什么是 Fail-Fast、什么是 Fail-Safe")],-1),G=g("p",null,"Fail-Fast 与 Fail-Safe",-1),W=g("ul",null,[g("li",null,"ArrayList 是 fail-fast 的典型代表，遍历的同时不能修改，尽快失败"),g("li",null,"fail-fast 一旦发现遍历的同时其它人来修改，则立刻抛异常")],-1),Z=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418133457466.png",alt:"image-20230418133457466",loading:"lazy",decoding:"async",class:"lazy"})],-1),Q=g("ul",null,[g("li",null,"fail-fast实现原理")],-1),X=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418135557765.png",alt:"image-20230418135557765",loading:"lazy",decoding:"async",class:"lazy"})],-1),Y=g("ul",null,[g("li",null,"CopyOnWriteArrayList 是 fail-safe 的典型代表，遍历的同时可以修改，原理是读写分离"),g("li",null,"fail-safe 发现遍历的同时其它人来修改，应当能有应对策略，例如牺牲一致性来让整个遍历运行完成")],-1),ii=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418133702722.png",alt:"image-20230418133702722",loading:"lazy",decoding:"async",class:"lazy"})],-1),li=g("ul",null,[g("li",null,"fail-safe实现原理")],-1),si=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418142258054.png",alt:"image-20230418142258054",loading:"lazy",decoding:"async",class:"lazy"})],-1),ai=g("p",null,[g("strong",null,"提示")],-1),ni=g("ul",null,[g("li",null,[g("p",null,[k("测试代码见 "),g("code",null,"day01.list.FailFastVsFailSafe"),k("，这里不再列出")])]),g("li",null,[g("p",null,"第一次笔记："),g("ul",null,[g("li",null,[g("p",null,[g("strong",null,"fail-fast:")]),g("ul",null,[g("li",null,[g("p",null,"​ 1.调用迭代器Iterator构造方法并初始化成员变量")]),g("li",null,[g("p",null,"​ 2.检查：expectedModCount(迭代一开始记录的修改次数)与modCount(外面list的修改次数)做对比，不等则抛异常")])])]),g("li",null,[g("p",null,[g("strong",null,"fail-safe:")]),g("ul",null,[g("li",null,"​ list.add中每次调用add方法时都会把旧的数组拷贝一份，并让长度加一，把新加的元素放到扩容数组(新数组)最后一个位置，即添加和遍历的数组不同，互不干扰")])])])]),g("li",null,[g("p",null,"第二次笔记："),g("ul",null,[g("li",null,[g("p",null,[g("strong",null,"failfast"),k("：")]),g("ul",null,[g("li",null,"增强for循环开始前的修改次数（crud）modCount"),g("li",null,"expectedModCount初始值=modCount"),g("li",null,"每次遍历元素前（迭代）都检查以上的值是否相等，在遍历期间并发修改了，等遍历下个元素时就会抛出异常")])]),g("li",null,[g("p",null,[g("strong",null,"failsafe"),k("：")]),g("ul",null,[g("li",null,"iterator遍历集合，list.add方法每次添加元素，都会拷贝一份原集合并让容量加一，在并发修改时迭代器是不知道，遍历的还是原集合，即添加是一个集合，遍历是另一个集合")])])])])],-1),ti=g("h2",{id:"_3-linkedlist-vs-arraylist",tabindex:"-1"},[k("3. LinkedList VS "),g("strong",null,"ArrayList"),k(),g("a",{class:"header-anchor",href:"#_3-linkedlist-vs-arraylist","aria-label":'Permalink to "3. LinkedList VS **ArrayList**"'},"​")],-1),hi=g("p",null,[g("strong",null,"要求")],-1),ei=g("ul",null,[g("li",null,"能够说清楚 LinkedList 对比 ArrayList 的区别，并重视纠正部分错误的认知")],-1),gi=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418144031416.png",alt:"image-20230418144031416",loading:"lazy",decoding:"async",class:"lazy"})],-1),ki=g("ul",null,[g("li",null,"两者查询元素内容的时间复杂度都是O(n)，都不太适合用来查询，查询可以选择更高效的数据结构，如HashMap、TreeMap等")],-1),ri=g("p",null,[g("strong",null,"LinkedList")],-1),pi=g("ol",null,[g("li",null,"基于双向链表，无需连续内存")],-1),di=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418143629513.png",alt:"image-20230418143629513",loading:"lazy",decoding:"async",class:"lazy"})],-1),ci=g("ol",null,[g("li",null,"随机访问慢（要沿着链表遍历）")],-1),ui=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418143509162.png",alt:"image-20230418143509162",loading:"lazy",decoding:"async",class:"lazy"})],-1),oi=g("ol",null,[g("li",null,"头尾插入删除性能高"),g("li",null,"占用内存多")],-1),Ei=g("p",null,[g("strong",null,"ArrayList")],-1),yi=g("ol",null,[g("li",null,"基于数组，需要连续内存")],-1),mi=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418143617488.png",alt:"image-20230418143617488",loading:"lazy",decoding:"async",class:"lazy"})],-1),Fi=g("ol",null,[g("li",null,"随机访问快（指根据下标访问）")],-1),bi=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418143527810.png",alt:"image-20230418143527810",loading:"lazy",decoding:"async",class:"lazy"})],-1),fi=g("ol",null,[g("li",null,"尾部插入、删除性能可以，其它部分插入、删除都会移动数据，因此性能会低")],-1),Ci=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418144640481.png",alt:"image-20230418144640481",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ai=g("ol",null,[g("li",null,"可以利用 cpu 缓存，局部性原理（将读取变量和其相邻的变量也一次读到CPU缓存中）")],-1),zi=g("blockquote",null,[g("p",null,[g("em",null,[g("strong",null,"代码说明")])]),g("ul",null,[g("li",null,"day01.list.ArrayListVsLinkedList#randomAccess 对比随机访问性能")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418143722912.png",alt:"image-20230418143722912",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"day01.list.ArrayListVsLinkedList#addMiddle 对比向中间插入性能"),g("li",null,"day01.list.ArrayListVsLinkedList#addFirst 对比头部插入性能"),g("li",null,"day01.list.ArrayListVsLinkedList#addLast 对比尾部插入性能")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418145338167.png",alt:"image-20230418145338167",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"day01.list.ArrayListVsLinkedList#linkedListSize 打印一个 LinkedList 占用内存"),g("li",null,"day01.list.ArrayListVsLinkedList#arrayListSize 打印一个 ArrayList 占用内存")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418153454935.png",alt:"image-20230418153454935",loading:"lazy",decoding:"async",class:"lazy"})]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418150308326.png",alt:"image-20230418150308326",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,[g("p",null,"CPU进行计算的数据还是来自内存中的，比如进行加法运算，首先将内存中a的变量的读取到CPU的寄存器中，然后将b的值读到另一个寄存器中，数据都有了就进行接下来的加法运算，计算后的结果也会写到内存中的c变量，这样就完成了一次加法运算的计算过程，在这个计算过程里瓶颈在于内存变量的读和写上，因为内存的读写效率是非常低的，读一次、写一次大约需要花几百纳秒，对于CPU来讲这个时间是非常漫长的，CPU执行一次计算是少于纳秒级别的，也许花了不到1纳秒就完成了，但等待数据读进来写出去就要花费成百倍的时间，显然是不可接受的；")]),g("li",null,[g("p",null,"因此需要在CPU与内存之间加入CPU缓存，这个缓存的读写性能就比内存高很多了，CPU缓存又分为1级、2级、3级缓存，速度快的能达到10纳秒，速度慢的也能到达几十纳秒，对比内存的几百纳秒就快了很多")])]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418151824705.png",alt:"image-20230418151824705",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,[k("局部性原理 "),g("ul",null,[g("li",null,"往缓存中读数据时的一种规则，一种优化措施"),g("li",null,"将某个数据以及它相邻的数据都读取到缓存中，它会出于这样一种假设，当读取某个变量时，它相邻的变量也会有很大几率被访问到，即拿到某个元素后，有很大几率会遍历数组，即可以直接在缓存中遍历了，无需再到内存中遍历")])])]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418152143557.png",alt:"image-20230418152143557",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"链表的局部性原理就不可行，因为第一个元素与第二个元素相邻的有点远")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418152725657.png",alt:"image-20230418152725657",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"CPU缓存的空间也是有限的，如果将2和3也读到缓存，就会把之前的数据清空掉了，因此链表就不能很好的配合CPU缓存(局部性原理)来提升性能")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418152845212.png",alt:"image-20230418152845212",loading:"lazy",decoding:"async",class:"lazy"})])],-1),Si=g("h2",{id:"_4-hashmap",tabindex:"-1"},[k("4. HashMap "),g("a",{class:"header-anchor",href:"#_4-hashmap","aria-label":'Permalink to "4. HashMap"'},"​")],-1),Di=g("p",null,[g("strong",null,"要求")],-1),Li=g("ul",null,[g("li",null,"掌握 HashMap 的基本数据结构"),g("li",null,"掌握树化"),g("li",null,"理解索引计算方法、二次 hash 的意义、容量对索引计算的影响"),g("li",null,"掌握 put 流程、扩容、扩容因子"),g("li",null,"理解并发使用 HashMap 可能导致的问题"),g("li",null,"理解 key 的设计")],-1),vi=g("h3",{id:"_1-基本数据结构",tabindex:"-1"},[k("1）基本数据结构 "),g("a",{class:"header-anchor",href:"#_1-基本数据结构","aria-label":'Permalink to "1）基本数据结构"'},"​")],-1),ji=g("ul",null,[g("li",null,"1.7 数组 + 链表"),g("li",null,"1.8 数组 + （链表 | 红黑树）")],-1),Bi=g("blockquote",null,[g("p",null,"更形象的演示，见资料中的 hash-demo.jar，运行需要 jdk14 以上环境，进入 jar 包目录，执行下面命令"),g("div",{style:{"max-height":"300px"},class:"language- vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"}),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",null,"java -jar --add-exports java.base/jdk.internal.misc=ALL-UNNAMED hash-demo.jar")])])]),g("button",{class:"collapse"})])],-1),Ki=g("h3",{id:"_2-树化与退化",tabindex:"-1"},[k("2）树化与退化 "),g("a",{class:"header-anchor",href:"#_2-树化与退化","aria-label":'Permalink to "2）树化与退化"'},"​")],-1),xi=g("p",null,[g("strong",null,"树化意义")],-1),_i=g("ul",null,[g("li",null,"红黑树用来避免 DoS 攻击，防止链表超长时性能下降，树化应当是偶然情况，是保底策略"),g("li",null,[k("hash 表的查找，更新的时间复杂度是 O(1)"),g("em",null,"O"),k("(1)，而红黑树的查找，更新的时间复杂度是 O(log_2⁡n )"),g("em",null,"O"),k("("),g("em",null,[k("l"),g("strong",null,"o"),k("g")]),k("2⁡"),g("em",null,"n"),k(")，TreeNode 占用空间也比普通 Node 的大，如非必要，尽量还是使用链表")]),g("li",null,"hash 值如果足够随机，则在 hash 表内按泊松分布，在负载因子 0.75 的情况下，长度超过 8 的链表出现概率是 0.00000006，树化阈值选择 8 就是为了让树化几率足够小")],-1),Mi=g("p",null,[g("strong",null,"树化规则")],-1),Ni=g("ul",null,[g("li",null,"当链表长度超过树化阈值 8 时，先尝试扩容来减少链表长度，如果数组容量已经 >=64，才会进行树化")],-1),wi=g("p",null,[g("strong",null,"退化规则")],-1),Hi=g("ul",null,[g("li",null,"情况1：在扩容时如果拆分树时，树元素个数 <= 6 则会退化链表"),g("li",null,"情况2：remove 树节点时，若 root、root.left、root.right、root.left.left 有一个为 null ，也会退化为链表")],-1),Pi=g("h3",{id:"_3-索引计算",tabindex:"-1"},[k("3）索引计算 "),g("a",{class:"header-anchor",href:"#_3-索引计算","aria-label":'Permalink to "3）索引计算"'},"​")],-1),Ti=g("ul",null,[g("li",null,[g("p",null,"前置知识"),g("ul",null,[g("li",null,[g("ol",null,[g("li",null,"与运算（&）")]),g("p",null,"参加运算的两个数据，按二进制位进行“与”运算。"),g("p",null,"运算规则：0&0=0; 0&1=0; 1&0=0; 1&1=1;"),g("p",null,"即：两位同时为“1”，结果才为“1”，否则为0"),g("p",null,"例如：3&5 即 0000 0011 & 0000 0101 = 0000 0001 因此，3&5的值得1。"),g("p",null,"例如：9&5 即 0000 1001 (9的二进制补码)&00000101 (5的二进制补码) =00000001 (1的二进制补码)可见9&5=1。"),g("ol",{start:"2"},[g("li",null,"或运算（|）")]),g("p",null,"参加运算的两个对象，按二进制位进行“或”运算。"),g("p",null,"运算规则：0|0=0； 0|1=1； 1|0=1； 1|1=1；"),g("p",null,"即 ：参加运算的两个对象只要有一个为1，其值为1。"),g("p",null,"例如:3|5　即 0000 0011 | 0000 0101 = 0000 0111 因此，3|5的值得7。"),g("p",null,"例如：9|5可写算式如下： 00001001|00000101 =00001101 (十进制为13)可见9|5=13"),g("ol",{start:"3"},[g("li",null,"异或运算（^）")]),g("p",null,"参加运算的两个数据，按二进制位进行“异或”运算。"),g("p",null,"运算规则：0^0=0； 0^1=1； 1^0=1； 1^1=0；"),g("p",null,"即：参加运算的两个对象，如果两个相应位为“异”（值不同），则该位结果为1，否则为0。"),g("p",null,"例如：9^5可写成算式如下： 00001001^00000101=00001100 (十进制为12)可见9^5=12")])]),g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 01010"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 10000"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 11010"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"26"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"----------"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 00000"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"----------"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 10000"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(2的四次方（"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"）)")])])]),g("button",{class:"collapse"})]),g("p",null,[k("8421码指的是四位二进制数，从0000~1001，分别代表十进制0~9，其每位的权分别为"),g("span",{class:"katex"},[g("span",{class:"katex-mathml"},[g("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[g("semantics",null,[g("mrow",null,[g("msup",null,[g("mn",null,"2"),g("mn",null,"3")])]),g("annotation",{encoding:"application/x-tex"},"2^3")])])]),g("span",{class:"katex-html","aria-hidden":"true"},[g("span",{class:"base"},[g("span",{class:"strut",style:{height:"0.8141em"}}),g("span",{class:"mord"},[g("span",{class:"mord"},"2"),g("span",{class:"msupsub"},[g("span",{class:"vlist-t"},[g("span",{class:"vlist-r"},[g("span",{class:"vlist",style:{height:"0.8141em"}},[g("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[g("span",{class:"pstrut",style:{height:"2.7em"}}),g("span",{class:"sizing reset-size6 size3 mtight"},[g("span",{class:"mord mtight"},"3")])])])])])])])])])]),k("（8）、"),g("span",{class:"katex"},[g("span",{class:"katex-mathml"},[g("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[g("semantics",null,[g("mrow",null,[g("msup",null,[g("mn",null,"2"),g("mn",null,"2")])]),g("annotation",{encoding:"application/x-tex"},"2^2")])])]),g("span",{class:"katex-html","aria-hidden":"true"},[g("span",{class:"base"},[g("span",{class:"strut",style:{height:"0.8141em"}}),g("span",{class:"mord"},[g("span",{class:"mord"},"2"),g("span",{class:"msupsub"},[g("span",{class:"vlist-t"},[g("span",{class:"vlist-r"},[g("span",{class:"vlist",style:{height:"0.8141em"}},[g("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[g("span",{class:"pstrut",style:{height:"2.7em"}}),g("span",{class:"sizing reset-size6 size3 mtight"},[g("span",{class:"mord mtight"},"2")])])])])])])])])])]),k("（4）、"),g("span",{class:"katex"},[g("span",{class:"katex-mathml"},[g("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[g("semantics",null,[g("mrow",null,[g("msup",null,[g("mn",null,"2"),g("mn",null,"1")])]),g("annotation",{encoding:"application/x-tex"},"2^1")])])]),g("span",{class:"katex-html","aria-hidden":"true"},[g("span",{class:"base"},[g("span",{class:"strut",style:{height:"0.8141em"}}),g("span",{class:"mord"},[g("span",{class:"mord"},"2"),g("span",{class:"msupsub"},[g("span",{class:"vlist-t"},[g("span",{class:"vlist-r"},[g("span",{class:"vlist",style:{height:"0.8141em"}},[g("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[g("span",{class:"pstrut",style:{height:"2.7em"}}),g("span",{class:"sizing reset-size6 size3 mtight"},[g("span",{class:"mord mtight"},"1")])])])])])])])])])]),k("（2）、"),g("span",{class:"katex"},[g("span",{class:"katex-mathml"},[g("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[g("semantics",null,[g("mrow",null,[g("msup",null,[g("mn",null,"2"),g("mn",null,"0")])]),g("annotation",{encoding:"application/x-tex"},"2^0")])])]),g("span",{class:"katex-html","aria-hidden":"true"},[g("span",{class:"base"},[g("span",{class:"strut",style:{height:"0.8141em"}}),g("span",{class:"mord"},[g("span",{class:"mord"},"2"),g("span",{class:"msupsub"},[g("span",{class:"vlist-t"},[g("span",{class:"vlist-r"},[g("span",{class:"vlist",style:{height:"0.8141em"}},[g("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[g("span",{class:"pstrut",style:{height:"2.7em"}}),g("span",{class:"sizing reset-size6 size3 mtight"},[g("span",{class:"mord mtight"},"0")])])])])])])])])])]),k("（1）。除了8421码外，类似的还有5421码。")]),g("ul",null,[g("li",null,"索引如何计算？hashCode都有了，为何还要提供hash()方法？数组容量为何是2的n次幂？")])])],-1),Ii=g("p",null,[g("strong",null,"索引计算方法"),k("（"),g("strong",null,"为了配合容量是 2 的 n 次幂的优化手段"),k(" ）")],-1),Oi=g("ul",null,[g("li",null,[g("p",null,"首先，计算对象的 hashCode()")]),g("li",null,[g("p",null,"再进行调用 HashMap 的 hash() 方法进行二次哈希"),g("ul",null,[g("li",null,[g("p",null,[k("二次 hash() 是为了综合高位数据，让哈希分布更为均匀；"),g("strong",null,"计算索hashCode的值更均匀，hashCode分布得越均匀，链表就越不会有过长的情况")]),g("ul",null,[g("li",null,"HashMap1.8二次hash")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418201334955.png",alt:"image-20230418201334955",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"HashMap1.7二次hash")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418201418625.png",alt:"image-20230418201418625",loading:"lazy",decoding:"async",class:"lazy"})])]),g("li",null,[g("p",null,"hashCode足够均匀")])]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418202517544.png",alt:"image-20230418202517544",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"hashCode选取不够好，不够随机")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418202727603.png",alt:"image-20230418202727603",loading:"lazy",decoding:"async",class:"lazy"})]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418202829734.png",alt:"image-20230418202829734",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"进行二次hash扰动函数，使得hashCode分布更均匀，防止超长链表的产生")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418203040744.png",alt:"image-20230418203040744",loading:"lazy",decoding:"async",class:"lazy"})]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418203513964.png",alt:"image-20230418203513964",loading:"lazy",decoding:"async",class:"lazy"})])]),g("li",null,[g("p",null,"最后 & (capacity – 1) 得到索引（容量capacity必须为2的n次幂）")])],-1),Ui=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418195049973.png",alt:"image-20230418195049973",loading:"lazy",decoding:"async",class:"lazy"})],-1),Vi=g("p",null,[g("strong",null,"数组容量为何是 2 的 n 次幂")],-1),qi=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418195337120.png",alt:"image-20230418195337120",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ji=g("ol",null,[g("li",null,"计算索引时效率更高：如果是 2 的 n 次幂可以使用位与运算代替取模"),g("li",null,"扩容时重新计算索引效率更高： hash & oldCap == 0 的元素留在原来位置 ，否则新位置 = 旧位置 + oldCap = 10 + 16")],-1),$i=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418204559461.png",alt:"image-20230418204559461",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ri=g("p",null,[g("strong",null,"注意")],-1),Gi=g("ul",null,[g("li",null,[k("二次 hash 是为了配合 "),g("strong",null,"容量是 2 的 n 次幂"),k(" 这一设计前提，如果 hash 表的容量不是 2 的 n 次幂，则不必二次 hash，即想要更好的hash分布性，容量值就选择质数")])],-1),Wi=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418210235261.png",alt:"image-20230418210235261",loading:"lazy",decoding:"async",class:"lazy"})],-1),Zi=g("ul",null,[g("li",null,[g("strong",null,"容量是 2 的 n 次幂"),k(" 这一设计计算索引效率更好（追求性能），但 hash 的分散性就不好，需要二次 hash 来作为补偿，没有采用这一设计的典型例子是 Hashtable，以下为Hashtable的扩容规律")])],-1),Qi=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418210834027.png",alt:"image-20230418210834027",loading:"lazy",decoding:"async",class:"lazy"})],-1),Xi=g("h3",{id:"_4-put-与扩容",tabindex:"-1"},[k("4）put 与扩容 "),g("a",{class:"header-anchor",href:"#_4-put-与扩容","aria-label":'Permalink to "4）put 与扩容"'},"​")],-1),Yi=g("p",null,[g("strong",null,"put 流程")],-1),il=g("ul",null,[g("li",null,"1.8put流程")],-1),ll=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419110228837.png",alt:"image-20230419110228837",loading:"lazy",decoding:"async",class:"lazy"})],-1),sl=g("ol",null,[g("li",null,"HashMap 是懒惰创建数组的，首次使用才创建数组"),g("li",null,"计算索引（桶下标）"),g("li",null,"如果桶下标还没人占用，创建 Node 占位返回"),g("li",null,[k("如果桶下标已经有人占用 "),g("ol",null,[g("li",null,"已经是 TreeNode 走红黑树的添加或更新逻辑"),g("li",null,"是普通 Node，走链表的添加或更新逻辑，如果链表长度超过树化阈值，走树化逻辑")])]),g("li",null,"返回前检查容量是否超过阈值，一旦超过进行扩容")],-1),al=g("p",null,[g("strong",null,"1.7 与 1.8 的区别")],-1),nl=g("ol",null,[g("li",null,[g("p",null,"链表插入节点时"),g("ol",null,[g("li",null,"1.7 是头插法")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419110745737.png",alt:"image-20230419110745737",loading:"lazy",decoding:"async",class:"lazy"})]),g("ol",{start:"2"},[g("li",null,"1.8 是尾插法")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419110538952.png",alt:"image-20230419110538952",loading:"lazy",decoding:"async",class:"lazy"})])]),g("li",null,[g("p",null,"1.7 是大于等于阈值且没有空位时才扩容"),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419112014919.png",alt:"image-20230419112014919",loading:"lazy",decoding:"async",class:"lazy"})])]),g("li",null,[g("p",null,"而 1.8 是大于阈值就扩容")]),g("li",null,[g("p",null,"1.8 在扩容计算 Node 索引时，会优化"),g("ul",null,[g("li",null,"hash & oldCap == 0 的元素留在原来位置 ，否则新位置 = 旧位置 + oldCap = 10 + 16")])])],-1),tl=g("p",null,[g("strong",null,"扩容（加载）因子为何默认是 0.75f")],-1),hl=g("ol",null,[g("li",null,[g("p",null,"在空间占用与查询时间之间取得较好的权衡")]),g("li",null,[g("p",null,"大于这个值，空间节省了，但链表就会比较长影响性能"),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419112518996.png",alt:"image-20230419112518996",loading:"lazy",decoding:"async",class:"lazy"})])]),g("li",null,[g("p",null,"小于这个值，冲突减少了，但扩容就会更频繁，空间占用也更多")])],-1),el=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419112817313.png",alt:"image-20230419112817313",loading:"lazy",decoding:"async",class:"lazy"})],-1),gl=g("blockquote",null,[g("p",null,[k("计算桶下标：hash()→"),g("code",null,"(hashcode >>> 16 ^ hashcode )&(capacity-1)"),k(" capacity为2的n次幂，计算索引效率更高，但哈希分布不均匀；capacity为质数时哈希分布均匀（hashtable）。 hashmap1.8:超过容量扩容阈值（＞¾），先创建扩容新数组再将数据迁移到新数组；链表插入方式为尾插法 1.7:链表插入方式为头插法；")])],-1),kl=g("h3",{id:"_5-并发问题",tabindex:"-1"},[k("5）并发问题 "),g("a",{class:"header-anchor",href:"#_5-并发问题","aria-label":'Permalink to "5）并发问题"'},"​")],-1),rl=g("p",null,"1.7链表迁移过程(a和b迁移前后都是同一个对象，只是改变了它们的一些引用地址，并没有发生对象的创建)",-1),pl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419121302636.png",alt:"image-20230419121302636",loading:"lazy",decoding:"async",class:"lazy"})],-1),dl=g("p",null,[g("strong",null,"扩容死链（1.7 会存在）")],-1),cl=g("p",null,"1.7 源码如下：",-1),ul=g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," transfer"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Entry"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] newTable, "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rehash) {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newCapacity "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newTable.length;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Entry<"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table) {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," !="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e) {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Entry<"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> next "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (rehash) {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                e.hash "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.key "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," :"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," hash"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e.key);")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            int"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," indexFor"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e.hash, newCapacity);")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            e.next "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newTable[i];")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            newTable[i] "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            e "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," next;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),g("button",{class:"collapse"})],-1),ol=g("ul",null,[g("li",null,"e 和 next 都是局部变量，用来指向当前节点和下一个节点"),g("li",null,"线程1（绿色）的临时变量 e 和 next 刚引用了这俩节点，还未来得及移动节点，发生了线程切换，由线程2（蓝色）完成扩容和迁移")],-1),El=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20210831084325075.png",alt:"image-20210831084325075",loading:"lazy",decoding:"async",class:"lazy"})],-1),yl=g("ul",null,[g("li",null,"线程2 扩容完成，由于头插法，链表顺序颠倒。但线程1 的临时变量 e 和 next 还引用了这俩节点，还要再来一遍迁移")],-1),ml=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20210831084723383.png",alt:"image-20210831084723383",loading:"lazy",decoding:"async",class:"lazy"})],-1),Fl=g("ul",null,[g("li",null,[g("p",null,"第一次循环"),g("ul",null,[g("li",null,"循环接着线程切换前运行，注意此时 e 指向的是节点 a，next 指向的是节点 b"),g("li",null,"e 头插 a 节点，注意图中画了两份 a 节点，但事实上只有一个（为了不让箭头特别乱画了两份）")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20210831084855348.png",alt:"image-20210831084855348",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"当循环结束是 e 会指向 next 也就是 b 节点")])])],-1),bl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419121935915.png",alt:"image-20230419121935915",loading:"lazy",decoding:"async",class:"lazy"})],-1),fl=g("ul",null,[g("li",null,[g("p",null,"第二次循环"),g("ul",null,[g("li",null,"第二轮开始，next 指向了节点 a"),g("li",null,"e 头插节点 b")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20210831085329449.png",alt:"image-20210831085329449",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"当循环结束时，e 指向 next 也就是节点 a")])])],-1),Cl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419122220312.png",alt:"image-20230419122220312",loading:"lazy",decoding:"async",class:"lazy"})],-1),Al=g("ul",null,[g("li",null,[g("p",null,"第三次循环"),g("ul",null,[g("li",null,"next 指向了 null")]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419133332478.png",alt:"image-20230419133332478",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,[k("e 头插节点 a，"),g("strong",null,"a 的 next 指向了 b"),k("（之前 a.next 一直是 null），b 的 next 指向 a，死链已成")])]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20210831085543224.png",alt:"image-20210831085543224",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"当循环结束时，e 指向 next 也就是 null，因此第四次循环时会正常退出")])])],-1),zl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419133643654.png",alt:"image-20230419133643654",loading:"lazy",decoding:"async",class:"lazy"})],-1),Sl=g("p",null,[g("strong",null,"数据错乱（1.7，1.8 都会存在）")],-1),Dl=g("ul",null,[g("li",null,[k("代码参考 "),g("code",null,"day01.map.HashMapMissData"),k("，具体调试步骤参考视频")])],-1),Ll=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419115103985.png",alt:"image-20230419115103985",loading:"lazy",decoding:"async",class:"lazy"})],-1),vl=g("blockquote",null,[g("p",null,[g("em",null,[g("strong",null,"补充代码说明")])]),g("ul",null,[g("li",null,"day01.map.HashMapDistribution 演示 map 中链表长度符合泊松分布"),g("li",null,[k("day01.map.DistributionAffectedByCapacity 演示容量及 hashCode 取值对分布的影响 "),g("ul",null,[g("li",null,"day01.map.DistributionAffectedByCapacity#hashtableGrowRule 演示了 Hashtable 的扩容规律"),g("li",null,"day01.sort.Utils#randomArray 如果 hashCode 足够随机，容量是否是 2 的 n 次幂影响不大"),g("li",null,"day01.sort.Utils#lowSameArray 如果 hashCode 低位一样的多，容量是 2 的 n 次幂会导致分布不均匀"),g("li",null,"day01.sort.Utils#evenArray 如果 hashCode 偶数的多，容量是 2 的 n 次幂会导致分布不均匀"),g("li",null,"由此得出对于容量是 2 的 n 次幂的设计来讲，二次 hash 非常重要")])]),g("li",null,"day01.map.HashMapVsHashtable 演示了对于同样数量的单词字符串放入 HashMap 和 Hashtable 分布上的区别")])],-1),jl=g("h3",{id:"_6-key-的设计",tabindex:"-1"},[k("6）key 的设计 "),g("a",{class:"header-anchor",href:"#_6-key-的设计","aria-label":'Permalink to "6）key 的设计"'},"​")],-1),Bl=g("p",null,[g("strong",null,"key 的设计要求")],-1),Kl=g("ol",null,[g("li",null,[g("p",null,"HashMap 的 key 可以为 null，但 Map 的其他实现则不然")]),g("li",null,[g("p",null,[k("作为 key 的对象，必须实现 hashCode 和 equals，并且 "),g("strong",null,"key 的内容不能修改（不可变）")]),g("ul",null,[g("li",null,"重写hashCode方法是为了让我们的key在整个HashMap中有更好的分布性，提高查询性能"),g("li",null,"重写equals方法是为了将来如果计算两个对象的key的索引都一样，进一步需要用equals进行比较，看看是不是两个相同的对象"),g("li",null,"两个对象的hashCode相等，equals不一定相等；两个对象的equals相等，hashCode一定相等")])]),g("li",null,[g("p",null,"key 的 hashCode 应该有良好的散列性")])],-1),xl=g("p",null,"如果 key 可变，例如修改了 age 会导致再次查询时查询不到，因此平时用整数、字符串等作为key，这些类的内容不可变",-1),_l=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419134838699.png",alt:"image-20230419134838699",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ml=g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," HashMapMutableKey"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," main"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] "),g("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"args"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        HashMap<"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Student"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> map "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HashMap<>();")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Student stu "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Student"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"张三"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"18"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        map."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(stu, "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Object"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(map."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(stu));")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        stu.age "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 19"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(map."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(stu));")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Student"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String name;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," age;")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Student"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),g("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"name"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),g("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," age"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"            this"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".name "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," name;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"            this"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".age "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," age;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getName"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," name;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," setName"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),g("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"name"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"            this"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".name "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," name;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getAge"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," age;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," setAge"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),g("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," age"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"            this"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".age "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," age;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        @"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," equals"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object "),g("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"o"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o) "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (o "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getClass"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," o."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getClass"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Student student "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Student) o;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," age "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," student.age "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Objects."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(name, student.name);")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        @"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," hashCode"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Objects."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hash"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(name, age);")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),g("button",{class:"collapse"})],-1),Nl=g("p",null,[g("strong",null,"String 对象的 hashCode() 设计")],-1),wl=g("ul",null,[g("li",null,"目标是达到较为均匀的散列效果，每个字符串的 hashCode 足够独特"),g("li",null,[k("字符串中的每个字符都可以表现为一个数字，称为 S_i"),g("em",null,"S**i"),k("，其中 i 的范围是 0 ~ n - 1")]),g("li",null,[k("散列公式为： S_0∗31^{(n-1)}+ S_1∗31^{(n-2)}+ … S_i ∗ 31^{(n-1-i)}+ …S_{(n-1)}∗31^0"),g("em",null,"S"),k("0∗31("),g("em",null,"n"),k("−1)+"),g("em",null,"S"),k("1∗31("),g("em",null,"n"),k("−2)+…"),g("em",null,"S**i"),k("∗31("),g("em",null,"n"),k("−1−"),g("em",null,"i"),k(")+…"),g("em",null,"S"),k("("),g("em",null,"n"),k("−1)∗310")]),g("li",null,[k("31 代入公式有较好的散列特性，并且 31 * h 可以被优化为 "),g("ul",null,[g("li",null,[k("即 32 ∗h -h32∗"),g("em",null,"h"),k("−"),g("em",null,"h")]),g("li",null,[k("即 2^5 ∗h -h25∗"),g("em",null,"h"),k("−"),g("em",null,"h")]),g("li",null,[k("即 h≪5 -h"),g("em",null,"h"),k("≪5−"),g("em",null,"h")])])])],-1),Hl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419135639704.png",alt:"image-20230419135639704",loading:"lazy",decoding:"async",class:"lazy"})],-1),Pl=g("h2",{id:"_4-1-hashmap-快速查找",tabindex:"-1"},[k("4.1. HashMap-快速查找 "),g("a",{class:"header-anchor",href:"#_4-1-hashmap-快速查找","aria-label":'Permalink to "4.1. HashMap-快速查找"'},"​")],-1),Tl=g("ul",null,[g("li",null,"ArrayList查找效率较低")],-1),Il=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418161635803.png",alt:"image-20230418161635803",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ol=g("ul",null,[g("li",null,"HashMap通过索引计算直接找到元素(hash运算)，无链表情况查找时间复杂度为O(1)，有链表情况就看链表长度了，时间复杂度为O(n)")],-1),Ul=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418161857746.png",alt:"image-20230418161857746",loading:"lazy",decoding:"async",class:"lazy"})],-1),Vl=g("h2",{id:"_4-2-hashmap-链表过长的解决方案",tabindex:"-1"},[k("4.2. HashMap-链表过长的解决方案 "),g("a",{class:"header-anchor",href:"#_4-2-hashmap-链表过长的解决方案","aria-label":'Permalink to "4.2. HashMap-链表过长的解决方案"'},"​")],-1),ql=g("ul",null,[g("li",null,"形成链表：keys相同的固定hash；keys的hash%容量相同")],-1),Jl=g("h3",{id:"_4-2-1-扩容",tabindex:"-1"},[k("4.2.1.扩容 "),g("a",{class:"header-anchor",href:"#_4-2-1-扩容","aria-label":'Permalink to "4.2.1.扩容"'},"​")],-1),$l=g("ul",null,[g("li",null,"正常情况")],-1),Rl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418162855531.png",alt:"image-20230418162855531",loading:"lazy",decoding:"async",class:"lazy"})],-1),Gl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418162904156.png",alt:"image-20230418162904156",loading:"lazy",decoding:"async",class:"lazy"})],-1),Wl=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418162909932.png",alt:"image-20230418162909932",loading:"lazy",decoding:"async",class:"lazy"})],-1),Zl=g("ul",null,[g("li",null,"极端情况，只能树化为红黑树了")],-1),Ql=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418162935840.png",alt:"image-20230418162935840",loading:"lazy",decoding:"async",class:"lazy"})],-1),Xl=g("h3",{id:"_4-2-2-树化",tabindex:"-1"},[k("4.2.2. 树化 "),g("a",{class:"header-anchor",href:"#_4-2-2-树化","aria-label":'Permalink to "4.2.2. 树化"'},"​")],-1),Yl=g("ul",null,[g("li",null,"链表->红黑树：当容量为16，在某个桶下标形成链表的8个元素添加元素，仅进行扩容为32，再添加扩容到64才会树化")],-1),is=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418164530243.png",alt:"image-20230418164530243",loading:"lazy",decoding:"async",class:"lazy"})],-1),ls=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418165555721.png",alt:"image-20230418165555721",loading:"lazy",decoding:"async",class:"lazy"})],-1),ss=g("ul",null,[g("li",null,"满足树化条件(容量>=64且链表长度>8)，红黑树父节点左侧都是比它小的元素，右侧都是比它大的元素，子节点同理，hash码相同时才比较，按照key的字符串值比较，查找的时间复杂度为O(log2(n))")],-1),as=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418165707584.png",alt:"image-20230418165707584",loading:"lazy",decoding:"async",class:"lazy"})],-1),ns=g("ul",null,[g("li",null,"链表长度是可能出现超过8的情况")],-1),ts=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418170758857.png",alt:"image-20230418170758857",loading:"lazy",decoding:"async",class:"lazy"})],-1),hs=g("h4",{id:"红黑树的意义-树化阈值",tabindex:"-1"},[k("红黑树的意义-树化阈值 "),g("a",{class:"header-anchor",href:"#红黑树的意义-树化阈值","aria-label":'Permalink to "红黑树的意义-树化阈值"'},"​")],-1),es=g("ul",null,[g("li",null,[g("p",null,"为何要用红黑树，为何一上来不树化，树化阈值为何是8，何时会树化，何时会退化为链表？"),g("ul",null,[g("li",null,[g("p",null,"因为链表较长时会影响整个HashMap的性能，1.8之后引入红黑树，即使链表较长也不会对性能有太大的影响")]),g("li",null,[g("p",null,"链表->红黑树：当容量为16，在某个桶下标形成链表的8个元素添加元素，仅进行扩容为32，再添加扩容到64才会树化")]),g("li",null,[g("p",null,"链表短的时候，链表性能大于红黑树，链表长时性能才远远不如红黑树，且红黑树占用内存比链表大得多，非必要不树化")]),g("li",null,[g("p",null,"红黑树是一种非正常情况，下图为23W多个正常单词的hash分布情况，若没有刻意构造hash码，在负载因子0.75的情况下，链表出现8的概率非常低，为0.00000006")])]),g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418181214309.png",alt:"image-20230418181214309",loading:"lazy",decoding:"async",class:"lazy"})]),g("ul",null,[g("li",null,"红黑树用来避免 DoS 攻击，防止链表超长时性能下降，树化应当是偶然情况，是保底策略")])])],-1),gs=g("h4",{id:"树退化链表-情况1",tabindex:"-1"},[k("树退化链表-情况1 "),g("a",{class:"header-anchor",href:"#树退化链表-情况1","aria-label":'Permalink to "树退化链表-情况1"'},"​")],-1),ks=g("ul",null,[g("li",null,"在扩容时如果拆分树时，树元素个数 <= 6 则会退化链表")],-1),rs=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418183806555.png",alt:"image-20230418183806555",loading:"lazy",decoding:"async",class:"lazy"})],-1),ps=g("ul",null,[g("li",null,"在扩容时如果拆分树时，树元素个数 > 6 则不会退化链表")],-1),ds=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418184454141.png",alt:"image-20230418184454141",loading:"lazy",decoding:"async",class:"lazy"})],-1),cs=g("h4",{id:"树退化链表-情况2",tabindex:"-1"},[k("树退化链表-情况2 "),g("a",{class:"header-anchor",href:"#树退化链表-情况2","aria-label":'Permalink to "树退化链表-情况2"'},"​")],-1),us=g("ul",null,[g("li",null,"remove 树节点时，若 root(爷)、root.left(左孩子)、root.right(右孩子)、root.left.left(左孙子) 有一个为 null ，也会退化为链表")],-1),os=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418192832140.png",alt:"image-20230418192832140",loading:"lazy",decoding:"async",class:"lazy"})],-1),Es=g("ul",null,[g("li",null,"例子2")],-1),ys=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230418193518600.png",alt:"image-20230418193518600",loading:"lazy",decoding:"async",class:"lazy"})],-1),ms=g("h2",{id:"_5-单例模式",tabindex:"-1"},[k("5. 单例模式 "),g("a",{class:"header-anchor",href:"#_5-单例模式","aria-label":'Permalink to "5. 单例模式"'},"​")],-1),Fs=g("p",null,[g("strong",null,"要求")],-1),bs=g("ul",null,[g("li",null,"掌握五种单例模式的实现方式"),g("li",null,"理解为何 DCL 实现时要使用 volatile 修饰静态变量"),g("li",null,"了解 jdk 中用到单例的场景")],-1),fs=g("h3",{id:"饿汉式",tabindex:"-1"},[g("strong",null,"饿汉式"),k(),g("a",{class:"header-anchor",href:"#饿汉式","aria-label":'Permalink to "**饿汉式**"'},"​")],-1),Cs=g("ul",null,[g("li",null,"提前创建单例对象")],-1),As=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419141144975.png",alt:"image-20230419141144975",loading:"lazy",decoding:"async",class:"lazy"})],-1),zs=g("ul",null,[g("li",null,"实现Serializable接口利用反射破坏单例")],-1),Ss=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419141539054.png",alt:"image-20230419141539054",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ds=g("ul",null,[g("li",null,"反序列化破坏单例")],-1),Ls=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419142100218.png",alt:"image-20230419142100218",loading:"lazy",decoding:"async",class:"lazy"})],-1),vs=g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton1"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Serializable"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton1"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            throw"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," RuntimeException"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"单例对象不能重复创建"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"private Singleton1()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton1 INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton1"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton1 "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInstance"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," INSTANCE;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," otherMethod"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"otherMethod()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"readResolve"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," INSTANCE;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),g("button",{class:"collapse"})],-1),js=g("ul",null,[g("li",null,"构造方法抛出异常是防止反射破坏单例")],-1),Bs=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419141740516.png",alt:"image-20230419141740516",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ks=g("ul",null,[g("li",null,[g("code",null,"readResolve()"),k(" 是防止反序列化破坏单例")])],-1),xs=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419142253512.png",alt:"image-20230419142253512",loading:"lazy",decoding:"async",class:"lazy"})],-1),_s=g("ul",null,[g("li",null,"unsafe破坏单例")],-1),Ms=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419142613493.png",alt:"image-20230419142613493",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ns=g("h3",{id:"枚举饿汉式",tabindex:"-1"},[g("strong",null,"枚举饿汉式"),k(),g("a",{class:"header-anchor",href:"#枚举饿汉式","aria-label":'Permalink to "**枚举饿汉式**"'},"​")],-1),ws=g("ul",null,[g("li",null,"枚举类一加载并初始化，就会把枚举对象创建出来")],-1),Hs=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419143438750.png",alt:"image-20230419143438750",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ps=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419143148474.png",alt:"image-20230419143148474",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ts=g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," enum"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton2"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    INSTANCE"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton2"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"private Singleton2()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toString"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getClass"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getName"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "@"'),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Integer."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toHexString"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hashCode"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton2 "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInstance"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," INSTANCE;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," otherMethod"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"otherMethod()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),g("button",{class:"collapse"})],-1),Is=g("ul",null,[g("li",null,"枚举饿汉式能天然防止反射、反序列化破坏单例")],-1),Os=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419144121454.png",alt:"image-20230419144121454",loading:"lazy",decoding:"async",class:"lazy"})],-1),Us=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419143856798.png",alt:"image-20230419143856798",loading:"lazy",decoding:"async",class:"lazy"})],-1),Vs=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419143639529.png",alt:"image-20230419143639529",loading:"lazy",decoding:"async",class:"lazy"})],-1),qs=g("ul",null,[g("li",null,"unsafe依旧可以破坏枚举单例")],-1),Js=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419144327173.png",alt:"image-20230419144327173",loading:"lazy",decoding:"async",class:"lazy"})],-1),$s=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419144146527.png",alt:"image-20230419144146527",loading:"lazy",decoding:"async",class:"lazy"})],-1),Rs=g("h3",{id:"懒汉式",tabindex:"-1"},[g("strong",null,"懒汉式"),k(),g("a",{class:"header-anchor",href:"#懒汉式","aria-label":'Permalink to "**懒汉式**"'},"​")],-1),Gs=g("ul",null,[g("li",null,"第一次调用getInstance方法时才创建单例对象(非线程安全)")],-1),Ws=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419144620623.png",alt:"image-20230419144620623",loading:"lazy",decoding:"async",class:"lazy"})],-1),Zs=g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton3"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Serializable"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton3"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"private Singleton3()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton3 INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // Singleton3.class  synchronized加在方法上，性能不是特别好，因为单例对象创建好以后，其他线程来访问该同步方法时无需再加锁了，后续的操作不用再进行同步和互斥保护了，不然就影响性能了，只有首次创建单例是才进行线程安全的保护")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," synchronized"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton3 "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInstance"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton3"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," INSTANCE;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," otherMethod"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"otherMethod()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),g("button",{class:"collapse"})],-1),Qs=g("ul",null,[g("li",null,"其实只有首次创建单例对象时才需要同步，但该代码实际上每次调用都会同步"),g("li",null,"因此有了下面的双检锁改进")],-1),Xs=g("h3",{id:"双检锁懒汉式",tabindex:"-1"},[g("strong",null,"双检锁懒汉式"),k(),g("a",{class:"header-anchor",href:"#双检锁懒汉式","aria-label":'Permalink to "**双检锁懒汉式**"'},"​")],-1),Ys=g("ul",null,[g("li",null,"少了内层判断还是会重复创建对象")],-1),ia=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419145814990.png",alt:"image-20230419145814990",loading:"lazy",decoding:"async",class:"lazy"})],-1),la=g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton4"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Serializable"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton4"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"private Singleton4()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton4 INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),g("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 可见性，有序性")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton4 "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInstance"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            synchronized"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Singleton4.class) {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),g("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton4"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," INSTANCE;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," otherMethod"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"otherMethod()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),g("button",{class:"collapse"})],-1),sa=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419145942353.png",alt:"image-20230419145942353",loading:"lazy",decoding:"async",class:"lazy"})],-1),aa=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419151419398.png",alt:"image-20230419151419398",loading:"lazy",decoding:"async",class:"lazy"})],-1),na=g("p",null,"为何必须加 volatile：",-1),ta=g("ul",null,[g("li",null,[g("code",null,"INSTANCE = new Singleton4()"),k(" 不是原子的，分成 3 步：创建对象、调用构造、给静态变量赋值，其中后两步可能被指令重排序优化，变成先赋值、再调用构造")]),g("li",null,[k("如果线程1 先执行了赋值，线程2 执行到第一个 "),g("code",null,"INSTANCE == null"),k(" 时发现 INSTANCE 已经不为 null，此时就会返回一个未完全构造的对象")])],-1),ha=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419153459527.png",alt:"image-20230419153459527",loading:"lazy",decoding:"async",class:"lazy"})],-1),ea=g("h3",{id:"内部类懒汉式",tabindex:"-1"},[g("strong",null,"内部类懒汉式"),k(),g("a",{class:"header-anchor",href:"#内部类懒汉式","aria-label":'Permalink to "**内部类懒汉式**"'},"​")],-1),ga=g("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[g("button",{title:"Copy Code",class:"copy"}),g("span",{class:"lang"},"java"),g("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[g("code",{"v-pre":""},[g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton5"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Serializable"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton5"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"private Singleton5()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Holder"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        static"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton5 INSTANCE "),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton5"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton5 "),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInstance"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Holder.INSTANCE;")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"}),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),g("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," otherMethod"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),g("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),g("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"otherMethod()"'),g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),k("\n"),g("span",{class:"line"},[g("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),g("button",{class:"collapse"})],-1),ka=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419154215932.png",alt:"image-20230419154215932",loading:"lazy",decoding:"async",class:"lazy"})],-1),ra=g("ul",null,[g("li",null,"避免了双检锁的缺点")],-1),pa=g("blockquote",null,[g("p",null,"volatile修饰共享变量可以解决指令重排序(懒汉单例-DCL(双检索)) 给静态变量赋值肯定会放到静态代码块里执行，静态代码块里的代码由JVM来保证，则饿汉式不用考虑线程安全问题，枚举饿汉式同理")],-1),da=g("h3",{id:"jdk-中单例的体现",tabindex:"-1"},[g("strong",null,"JDK 中单例的体现"),k(),g("a",{class:"header-anchor",href:"#jdk-中单例的体现","aria-label":'Permalink to "**JDK 中单例的体现**"'},"​")],-1),ca=g("ul",null,[g("li",null,"Runtime 体现了饿汉式单例")],-1),ua=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419154748392.png",alt:"image-20230419154748392",loading:"lazy",decoding:"async",class:"lazy"})],-1),oa=g("ul",null,[g("li",null,"Console 体现了双检锁懒汉式单例")],-1),Ea=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419154859774.png",alt:"image-20230419154859774",loading:"lazy",decoding:"async",class:"lazy"})],-1),ya=g("ul",null,[g("li",null,"Collections 中的 EmptyNavigableSet 内部类懒汉式单例")],-1),ma=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419155254327.png",alt:"image-20230419155254327",loading:"lazy",decoding:"async",class:"lazy"})],-1),Fa=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419155346324.png",alt:"image-20230419155346324",loading:"lazy",decoding:"async",class:"lazy"})],-1),ba=g("ul",null,[g("li",null,"其他内部类懒汉式例子")],-1),fa=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419155525101.png",alt:"image-20230419155525101",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ca=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419155558145.png",alt:"image-20230419155558145",loading:"lazy",decoding:"async",class:"lazy"})],-1),Aa=g("ul",null,[g("li",null,"ReverseComparator.REVERSE_ORDER 内部类懒汉式单例")],-1),za=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419155823830.png",alt:"image-20230419155823830",loading:"lazy",decoding:"async",class:"lazy"})],-1),Sa=g("ul",null,[g("li",null,"Comparators.NaturalOrderComparator.INSTANCE 枚举饿汉式单例")],-1),Da=g("figure",null,[g("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230419160119770.png",alt:"image-20230419160119770",loading:"lazy",decoding:"async",class:"lazy"})],-1),La={__name:"Java_Interview_Topics-Basic",setup(g,{expose:k}){const La=JSON.parse('{"title":"Java面试专题-基础篇","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wallhaven-g8oee3_1920x1080.png","title":"Java面试专题-基础篇","date":"2023-04-18T14:52:05.000Z","categories":"Java","tags":["ArrayList","LinkedList","HashMap","Hashtable","Singleton"],"top":121,"outline":"deep"},"headers":[{"level":2,"title":"1. ArrayList","slug":"_1-arraylist","link":"#_1-arraylist","children":[{"level":3,"title":"补充","slug":"补充","link":"#补充","children":[]}]},{"level":2,"title":"2. Iterator","slug":"_2-iterator","link":"#_2-iterator","children":[]},{"level":2,"title":"3. LinkedList VS ArrayList","slug":"_3-linkedlist-vs-arraylist","link":"#_3-linkedlist-vs-arraylist","children":[]},{"level":2,"title":"4. HashMap","slug":"_4-hashmap","link":"#_4-hashmap","children":[{"level":3,"title":"1）基本数据结构","slug":"_1-基本数据结构","link":"#_1-基本数据结构","children":[]},{"level":3,"title":"2）树化与退化","slug":"_2-树化与退化","link":"#_2-树化与退化","children":[]},{"level":3,"title":"3）索引计算","slug":"_3-索引计算","link":"#_3-索引计算","children":[]},{"level":3,"title":"4）put 与扩容","slug":"_4-put-与扩容","link":"#_4-put-与扩容","children":[]},{"level":3,"title":"5）并发问题","slug":"_5-并发问题","link":"#_5-并发问题","children":[]},{"level":3,"title":"6）key 的设计","slug":"_6-key-的设计","link":"#_6-key-的设计","children":[]}]},{"level":2,"title":"4.1. HashMap-快速查找","slug":"_4-1-hashmap-快速查找","link":"#_4-1-hashmap-快速查找","children":[]},{"level":2,"title":"4.2. HashMap-链表过长的解决方案","slug":"_4-2-hashmap-链表过长的解决方案","link":"#_4-2-hashmap-链表过长的解决方案","children":[{"level":3,"title":"4.2.1.扩容","slug":"_4-2-1-扩容","link":"#_4-2-1-扩容","children":[]},{"level":3,"title":"4.2.2. 树化","slug":"_4-2-2-树化","link":"#_4-2-2-树化","children":[]}]},{"level":2,"title":"5. 单例模式","slug":"_5-单例模式","link":"#_5-单例模式","children":[{"level":3,"title":"饿汉式","slug":"饿汉式","link":"#饿汉式","children":[]},{"level":3,"title":"枚举饿汉式","slug":"枚举饿汉式","link":"#枚举饿汉式","children":[]},{"level":3,"title":"懒汉式","slug":"懒汉式","link":"#懒汉式","children":[]},{"level":3,"title":"双检锁懒汉式","slug":"双检锁懒汉式","link":"#双检锁懒汉式","children":[]},{"level":3,"title":"内部类懒汉式","slug":"内部类懒汉式","link":"#内部类懒汉式","children":[]},{"level":3,"title":"JDK 中单例的体现","slug":"jdk-中单例的体现","link":"#jdk-中单例的体现","children":[]}]}],"relativePath":"pages/posts/Java_Interview_Topics-Basic.md","path":"D:/Learning/myblog/valaxy-lastest/imklaus-valaxy-blog/pages/posts/Java_Interview_Topics-Basic.md","lastUpdated":null}'),va=i(),ja=La.frontmatter||{};va.meta.frontmatter=Object.assign(va.meta.frontmatter||{},La.frontmatter||{}),l("pageData",La),l("valaxy:frontmatter",ja),globalThis.$frontmatter=ja;return k({frontmatter:{cover:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wallhaven-g8oee3_1920x1080.png",title:"Java面试专题-基础篇",date:"2023-04-18T14:52:05.000Z",categories:"Java",tags:["ArrayList","LinkedList","HashMap","Hashtable","Singleton"],top:121,outline:"deep"}}),(i,l)=>{const g=h;return s(),a(g,{frontmatter:t(ja)},{"main-content-md":n((()=>[r,p,d,c,u,o,E,y,m,F,b,f,C,A,z,S,D,L,v,j,B,K,x,_,M,N,w,H,P,T,I,O,U,V,q,J,$,R,G,W,Z,Q,X,Y,ii,li,si,ai,ni,ti,hi,ei,gi,ki,ri,pi,di,ci,ui,oi,Ei,yi,mi,Fi,bi,fi,Ci,Ai,zi,Si,Di,Li,vi,ji,Bi,Ki,xi,_i,Mi,Ni,wi,Hi,Pi,Ti,Ii,Oi,Ui,Vi,qi,Ji,$i,Ri,Gi,Wi,Zi,Qi,Xi,Yi,il,ll,sl,al,nl,tl,hl,el,gl,kl,rl,pl,dl,cl,ul,ol,El,yl,ml,Fl,bl,fl,Cl,Al,zl,Sl,Dl,Ll,vl,jl,Bl,Kl,xl,_l,Ml,Nl,wl,Hl,Pl,Tl,Il,Ol,Ul,Vl,ql,Jl,$l,Rl,Gl,Wl,Zl,Ql,Xl,Yl,is,ls,ss,as,ns,ts,hs,es,gs,ks,rs,ps,ds,cs,us,os,Es,ys,ms,Fs,bs,fs,Cs,As,zs,Ss,Ds,Ls,vs,js,Bs,Ks,xs,_s,Ms,Ns,ws,Hs,Ps,Ts,Is,Os,Us,Vs,qs,Js,$s,Rs,Gs,Ws,Zs,Qs,Xs,Ys,ia,la,sa,aa,na,ta,ha,ea,ga,ka,ra,pa,da,ca,ua,oa,Ea,ya,ma,Fa,ba,fa,Ca,Aa,za,Sa,Da])),"main-header":n((()=>[e(i.$slots,"main-header")])),"main-header-after":n((()=>[e(i.$slots,"main-header-after")])),"main-nav":n((()=>[e(i.$slots,"main-nav")])),"main-content":n((()=>[e(i.$slots,"main-content")])),"main-content-after":n((()=>[e(i.$slots,"main-content-after")])),"main-nav-before":n((()=>[e(i.$slots,"main-nav-before")])),"main-nav-after":n((()=>[e(i.$slots,"main-nav-after")])),comment:n((()=>[e(i.$slots,"comment")])),footer:n((()=>[e(i.$slots,"footer")])),aside:n((()=>[e(i.$slots,"aside")])),"aside-custom":n((()=>[e(i.$slots,"aside-custom")])),default:n((()=>[e(i.$slots,"default")])),_:3},8,["frontmatter"])}}};export{La as default};
