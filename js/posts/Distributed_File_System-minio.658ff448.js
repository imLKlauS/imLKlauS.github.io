import{_ as s,u as l,p as o,c as n,w as a,a as e,o as c,b as t,d as p,e as r,r as E,f as y}from"../../assets/app-f772c525.js";const i=JSON.parse('{"title":"分布式文件系统-minio","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/planet_clouds_light_94996_1920x1080.jpg","title":"分布式文件系统-minio","date":"2023-07-04T21:21:17.000Z","author":"imklaus","categories":"Java","tags":["Spring Cloud","Spring Boot","minio"],"top":240,"outline":"deep"},"headers":[{"level":2,"title":"一 分布式文件系统","slug":"一-分布式文件系统","link":"#一-分布式文件系统","children":[{"level":3,"title":"1.1 什么是分布式文件系统","slug":"_1-1-什么是分布式文件系统","link":"#_1-1-什么是分布式文件系统","children":[]},{"level":3,"title":"1.2 MinIO","slug":"_1-2-minio","link":"#_1-2-minio","children":[]}]},{"level":2,"title":"二 上传图片","slug":"二-上传图片","link":"#二-上传图片","children":[{"level":3,"title":"2.1 需求分析","slug":"_2-1-需求分析","link":"#_2-1-需求分析","children":[]},{"level":3,"title":"2.2 准备环境","slug":"_2-2-准备环境","link":"#_2-2-准备环境","children":[]},{"level":3,"title":"2.3 接口定义","slug":"_2-3-接口定义","link":"#_2-3-接口定义","children":[]},{"level":3,"title":"2.4 接口开发","slug":"_2-4-接口开发","link":"#_2-4-接口开发","children":[]}]},{"level":2,"title":"三 上传视频","slug":"三-上传视频","link":"#三-上传视频","children":[{"level":3,"title":"3.1 需求分析","slug":"_3-1-需求分析","link":"#_3-1-需求分析","children":[]},{"level":3,"title":"3.2 断点续传技术","slug":"_3-2-断点续传技术","link":"#_3-2-断点续传技术","children":[]},{"level":3,"title":"3.3 接口定义","slug":"_3-3-接口定义","link":"#_3-3-接口定义","children":[]},{"level":3,"title":"3.4 上传分块开发","slug":"_3-4-上传分块开发","link":"#_3-4-上传分块开发","children":[]},{"level":3,"title":"3.5 合并分块开发","slug":"_3-5-合并分块开发","link":"#_3-5-合并分块开发","children":[]}]},{"level":2,"title":"四 绑定媒资","slug":"四-绑定媒资","link":"#四-绑定媒资","children":[{"level":3,"title":"4.1 需求分析","slug":"_4-1-需求分析","link":"#_4-1-需求分析","children":[]},{"level":3,"title":"4.2 接口定义","slug":"_4-2-接口定义","link":"#_4-2-接口定义","children":[]},{"level":3,"title":"4.3 接口开发","slug":"_4-3-接口开发","link":"#_4-3-接口开发","children":[]},{"level":3,"title":"4.4 实战","slug":"_4-4-实战","link":"#_4-4-实战","children":[]}]}],"relativePath":"pages/posts/Distributed_File_System-minio.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-lastest\\\\imklaus-valaxy-blog\\\\pages\\\\posts\\\\Distributed_File_System-minio.md","lastUpdated":null}'),F=JSON.parse('{"title":"分布式文件系统-minio","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/planet_clouds_light_94996_1920x1080.jpg","title":"分布式文件系统-minio","date":"2023-07-04T21:21:17.000Z","author":"imklaus","categories":"Java","tags":["Spring Cloud","Spring Boot","minio"],"top":240,"outline":"deep"},"headers":[{"level":2,"title":"一 分布式文件系统","slug":"一-分布式文件系统","link":"#一-分布式文件系统","children":[{"level":3,"title":"1.1 什么是分布式文件系统","slug":"_1-1-什么是分布式文件系统","link":"#_1-1-什么是分布式文件系统","children":[]},{"level":3,"title":"1.2 MinIO","slug":"_1-2-minio","link":"#_1-2-minio","children":[]}]},{"level":2,"title":"二 上传图片","slug":"二-上传图片","link":"#二-上传图片","children":[{"level":3,"title":"2.1 需求分析","slug":"_2-1-需求分析","link":"#_2-1-需求分析","children":[]},{"level":3,"title":"2.2 准备环境","slug":"_2-2-准备环境","link":"#_2-2-准备环境","children":[]},{"level":3,"title":"2.3 接口定义","slug":"_2-3-接口定义","link":"#_2-3-接口定义","children":[]},{"level":3,"title":"2.4 接口开发","slug":"_2-4-接口开发","link":"#_2-4-接口开发","children":[]}]},{"level":2,"title":"三 上传视频","slug":"三-上传视频","link":"#三-上传视频","children":[{"level":3,"title":"3.1 需求分析","slug":"_3-1-需求分析","link":"#_3-1-需求分析","children":[]},{"level":3,"title":"3.2 断点续传技术","slug":"_3-2-断点续传技术","link":"#_3-2-断点续传技术","children":[]},{"level":3,"title":"3.3 接口定义","slug":"_3-3-接口定义","link":"#_3-3-接口定义","children":[]},{"level":3,"title":"3.4 上传分块开发","slug":"_3-4-上传分块开发","link":"#_3-4-上传分块开发","children":[]},{"level":3,"title":"3.5 合并分块开发","slug":"_3-5-合并分块开发","link":"#_3-5-合并分块开发","children":[]}]},{"level":2,"title":"四 绑定媒资","slug":"四-绑定媒资","link":"#四-绑定媒资","children":[{"level":3,"title":"4.1 需求分析","slug":"_4-1-需求分析","link":"#_4-1-需求分析","children":[]},{"level":3,"title":"4.2 接口定义","slug":"_4-2-接口定义","link":"#_4-2-接口定义","children":[]},{"level":3,"title":"4.3 接口开发","slug":"_4-3-接口开发","link":"#_4-3-接口开发","children":[]},{"level":3,"title":"4.4 实战","slug":"_4-4-实战","link":"#_4-4-实战","children":[]}]}],"relativePath":"pages/posts/Distributed_File_System-minio.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-lastest\\\\imklaus-valaxy-blog\\\\pages\\\\posts\\\\Distributed_File_System-minio.md","lastUpdated":null}'),u={name:"pages/posts/Distributed_File_System-minio.md",data:()=>({data:F,frontmatter:F.frontmatter,$frontmatter:F.frontmatter}),setup(){const s=l();s.meta.frontmatter=Object.assign(s.meta.frontmatter,F.frontmatter),o("pageData",F)}},d={id:"一-分布式文件系统",tabindex:"-1"},m=t("strong",null,"一 分布式文件系统",-1),D={id:"_1-1-什么是分布式文件系统",tabindex:"-1"},A=t("strong",null,"1.1 什么是分布式文件系统",-1),g=t("p",null,"要理解分布式文件系统首先了解什么是文件系统。",-1),h=t("p",null,"查阅百度百科：",-1),C=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps49.jpg"})],-1),b=t("p",null,"​ 文件系统是负责管理和存储文件的系统软件，操作系统通过文件系统提供的接口去存取文件，用户通过操作系统访问磁盘上的文件。",-1),B=t("p",null,"下图指示了文件系统所处的位置：",-1),f=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps50.jpg"})],-1),k=t("p",null,"常见的文件系统：FAT16/FAT32、NTFS、HFS、UFS、APFS、XFS、Ext4等 。",-1),S=t("p",null,"现在有个问题，一此短视频平台拥有大量的视频、图片，这些视频文件、图片文件该如何存储呢？如何存储可以满足互联网上海量用户的浏览。",-1),v=t("p",null,"今天讲的分布式文件系统就是海量用户查阅海量文件的方案。",-1),M=t("p",null,"我们阅读百度百科去理解分布式文件系统的定义：",-1),j=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps51.jpg"})],-1),P=t("p",null,"通过概念可以简单理解为：一个计算机无法存储海量的文件，通过网络将若干计算机组织起来共同去存储海量的文件，去接收海量用户的请求，这些组织起来的计算机通过网络进行通信，如下图：",-1),_=t("figure",null,[t("img",{alt:"image-20230704215201202",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704215201202.png"})],-1),x=t("p",null,"好处：",-1),I=t("blockquote",null,[t("p",null,"1、一台计算机的文件系统处理能力扩充到多台计算机同时处理。"),t("p",null,"2、一台计算机挂了还有另外副本计算机提供数据。"),t("p",null,"3、每台计算机可以放在不同的地域，这样用户就可以就近访问，提高访问速度。")],-1),T=t("p",null,"市面上有哪些分布式文件系统的产品呢？",-1),O=t("p",null,"1、NFS",-1),R=t("p",null,"阅读百度百科：",-1),w=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps53.jpg"})],-1),L=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps54.jpg"})],-1),N=t("p",null,"特点：",-1),U=t("p",null,"1）在客户端上映射NFS服务器的驱动器。",-1),z=t("p",null,"2）客户端通过网络访问NFS服务器的硬盘完全透明。",-1),K=t("p",null,"2、GFS",-1),q=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps55.jpg"})],-1),H=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps56.jpg"})],-1),W=t("p",null,"1）GFS采用主从结构，一个GFS集群由一个master和大量的chunkserver组成。",-1),G=t("p",null,"2）master存储了数据文件的元数据，一个文件被分成了若干块存储在多个chunkserver中。",-1),$=t("p",null,"3）用户从master中获取数据元信息，向chunkserver存储数据。",-1),V=t("p",null,"3、HDFS",-1),X=t("p",null,"HDFS，是Hadoop Distributed File System的简称，是Hadoop抽象文件系统的一种实现。HDFS是一个高度容错性的系统，适合部署在廉价的机器上。HDFS能提供高吞吐量的数据访问，非常适合大规模数据集上的应用。 HDFS的文件分布在集群机器上，同时提供副本进行容错及可靠性保证。例如客户端写入读取文件的直接操作都是分布在集群各个机器上的，没有单点性能压力。",-1),J=t("p",null,"下图是HDFS的架构图：",-1),Q=t("figure",null,[t("img",{alt:"image-20230704215636100",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704215636100.png"})],-1),Y=t("p",null,"1）HDFS采用主从结构，一个HDFS集群由一个名称结点和若干数据结点组成。",-1),Z=t("p",null,"2）名称结点存储数据的元信息，一个完整的数据文件分成若干块存储在数据结点。",-1),ss=t("p",null,"3）客户端从名称结点获取数据的元信息及数据分块的信息，得到信息客户端即可从数据块来存取数据。",-1),ls=t("p",null,[t("strong",null,"4、云计算厂家")],-1),os=t("p",null,"阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。其数据设计持久性不低于 99.9999999999%（12 个 9），服务设计可用性（或业务连续性）不低于 99.995%。",-1),ns=t("em",null,"官方网站：",-1),as=t("em",null,"https://www.aliyun.com/product/oss",-1),es=t("p",null,"百度对象存储BOS提供稳定、安全、高效、高可扩展的云存储服务。您可以将任意数量和形式的非结构化数据存入BOS，并对数据进行管理和处理。BOS支持标准、低频、冷和归档存储等多种存储类型，满足多场景的存储需求。",-1),cs=t("em",null,"官方网站：",-1),ts=t("em",null,"https://cloud.baidu.com/product/bos.html",-1),ps={id:"_1-2-minio",tabindex:"-1"},rs=t("strong",null,"1.2 MinIO",-1),Es={id:"_1-2-1-介绍",tabindex:"-1"},ys=t("strong",null,"1.2.1 介绍",-1),is=t("p",null,"本项目采用MinIO构建分布式文件系统，MinIO 是一个非常轻量的服务,可以很简单的和其他应用的结合使用，它兼容亚马逊 S3 云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等。",-1),Fs=t("p",null,"它一大特点就是轻量，使用简单，功能强大，支持各种平台，单个文件最大5TB，兼容 Amazon S3接口，提供了 Java、Python、GO等多版本SDK支持。",-1),us=t("p",null,"MinIO集群采用去中心化共享架构，每个结点是对等关系，通过Nginx可对MinIO进行负载均衡访问。",-1),ds=t("p",null,"去中心化有什么好处？",-1),ms=t("p",null,"在大数据领域，通常的设计理念都是无中心和分布式。Minio分布式模式可以帮助你搭建一个高可用的对象存储服务，你可以使用这些存储设备，而不用考虑其真实物理位置。",-1),Ds=t("p",null,"它将分布在不同服务器上的多块硬盘组成一个对象存储服务。由于硬盘分布在不同的节点上，分布式Minio避免了单点故障。如下图：",-1),As=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps58.jpg"})],-1),gs=t("p",null,"Minio使用纠删码技术来保护数据，它是一种恢复丢失和损坏数据的数学算法，它将数据分块冗余的分散存储在各各节点的磁盘上，所有的可用磁盘组成一个集合，上图由8块硬盘组成一个集合，当上传一个文件时会通过纠删码算法计算对文件进行分块存储，除了将文件本身分成4个数据块，还会生成4个校验块，数据块和校验块会分散的存储在这8块硬盘上。",-1),hs=t("p",null,"使用纠删码的好处是即便丢失一半数量（N/2）的硬盘，仍然可以恢复数据。 比如上边集合中有4个以内的硬盘损害仍可保证数据恢复，不影响上传和下载，如果多于一半的硬盘坏了则无法恢复。",-1),Cs={id:"_1-2-2-数据恢复演示",tabindex:"-1"},bs=t("strong",null,"1.2.2 数据恢复演示",-1),Bs=t("p",null,"下边在本机演示MinIO恢复数据的过程，在本地创建4个目录表示4个硬盘。",-1),fs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps59.jpg"})],-1),ks=t("div",{style:{"max-height":"300px"},class:"language-shell"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"shell"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#B392F0"}},"minio.exe"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"server"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"D:"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"evelop"),t("span",{style:{color:"#79B8FF"}},"\\m"),t("span",{style:{color:"#9ECBFF"}},"inio_data"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"ata1"),t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#9ECBFF"}},"D:"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"evelop"),t("span",{style:{color:"#79B8FF"}},"\\m"),t("span",{style:{color:"#9ECBFF"}},"inio_data"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"ata2"),t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#9ECBFF"}},"D:"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"evelop"),t("span",{style:{color:"#79B8FF"}},"\\m"),t("span",{style:{color:"#9ECBFF"}},"inio_data"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"ata3"),t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#9ECBFF"}},"D:"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"evelop"),t("span",{style:{color:"#79B8FF"}},"\\m"),t("span",{style:{color:"#9ECBFF"}},"inio_data"),t("span",{style:{color:"#79B8FF"}},"\\d"),t("span",{style:{color:"#9ECBFF"}},"ata4")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6F42C1"}},"minio.exe"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"server"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"D:"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"evelop"),t("span",{style:{color:"#005CC5"}},"\\m"),t("span",{style:{color:"#032F62"}},"inio_data"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"ata1"),t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#032F62"}},"D:"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"evelop"),t("span",{style:{color:"#005CC5"}},"\\m"),t("span",{style:{color:"#032F62"}},"inio_data"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"ata2"),t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#032F62"}},"D:"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"evelop"),t("span",{style:{color:"#005CC5"}},"\\m"),t("span",{style:{color:"#032F62"}},"inio_data"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"ata3"),t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#032F62"}},"D:"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"evelop"),t("span",{style:{color:"#005CC5"}},"\\m"),t("span",{style:{color:"#032F62"}},"inio_data"),t("span",{style:{color:"#005CC5"}},"\\d"),t("span",{style:{color:"#032F62"}},"ata4")])])]),t("button",{class:"collapse"})],-1),Ss=t("p",null,"启动结果如下：",-1),vs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps60.jpg"})],-1),Ms=t("p",null,"说明如下：",-1),js=t("p",null,[t("code",null,"WARNING: MINIO_ACCESS_KEY and MINIO_SECRET_KEY are deprecated. Please use MINIO_ROOT_USER and MINIO_ROOT_PASSWORD Formatting 1st pool, 1 set(s), 4 drives per set. WARNING: Host local has more than 2 drives of set. A host failure will result in data becoming unavailable. WARNING: Detected default credentials 'minioadmin:minioadmin', we recommend that you change these values with 'MINIO_ROOT_USER' and 'MINIO_ROOT_PASSWORD' environment variables")],-1),Ps=t("p",null,"1）老版本使用的MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY不推荐使用，推荐使用MINIO_ROOT_USER 和MINIO_ROOT_PASSWORD设置账号和密码。",-1),_s=t("p",null,"2）pool即minio节点组成的池子，当前有一个pool和4个硬盘组成的set集合",-1),xs=t("p",null,"3）因为集合是4个硬盘，大于2的硬盘损坏数据将无法恢复。",-1),Is=t("p",null,"4）账号和密码默认为minioadmin、minioadmin，可以在环境变量中设置通过'MINIO_ROOT_USER' and 'MINIO_ROOT_PASSWORD' 进行设置。",-1),Ts=t("p",null,"下边输入http://localhost:9000进行登录，账号和密码为：minioadmin/minioadmin",-1),Os=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps61.jpg"})],-1),Rs=t("p",null,"登录成功：",-1),ws=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps62.jpg"})],-1),Ls=t("p",null,"下一步创建bucket，桶，它相当于存储文件的目录，可以创建若干的桶。",-1),Ns=t("figure",null,[t("img",{alt:"image-20230704220604232",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704220604232.png"})],-1),Us=t("p",null,"输入bucket的名称，点击“CreateBucket”，创建成功",-1),zs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps64.jpg"})],-1),Ks=t("p",null,"点击“upload”上传文件。",-1),qs=t("p",null,"下边上传几个文件",-1),Hs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps65.jpg"})],-1),Ws=t("p",null,"下边去四个目录观察文件的存储情况",-1),Gs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps66.jpg"})],-1),$s=t("p",null,"我们发现上传的1.mp4文件存储在了四个目录，即四个硬盘上。",-1),Vs=t("p",null,"下边测试minio的数据恢复过程：",-1),Xs=t("p",null,"1、首先删除一个目录。",-1),Js=t("p",null,"删除目录后仍然可以在web控制台上传文件和下载文件。",-1),Qs=t("p",null,"稍等片刻删除的目录自动恢复。",-1),Ys=t("p",null,"2、删除两个目录。",-1),Zs=t("p",null,"删除两个目录也会自动恢复。",-1),sl=t("p",null,"3、删除三个目录 。",-1),ll=t("p",null,"由于 集合中共有4块硬盘，有大于一半的硬盘损坏数据无法恢复。",-1),ol=t("p",null,[p("此时报错："),t("code",null,"We encountered an internal error, please try again. (Read failed. Insufficient number of drives online)"),p("在线驱动器数量不足。")],-1),nl={id:"_1-2-3-测试docker环境",tabindex:"-1"},al=t("strong",null,"1.2.3 测试Docker环境",-1),el=t("p",null,"开发阶段和生产阶段统一使用Docker下的MINIO。",-1),cl=t("p",null,"在下发的虚拟机中已安装了MinIO的镜像和容器，执行sh /data/soft /restart.sh启动Docker下的MinIO",-1),tl=t("p",null,"启动完成登录MinIO查看是否正常。",-1),pl=t("figure",null,[t("img",{alt:"image-20230704221009748",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704221009748.png"})],-1),rl=t("p",null,"本项目创建两个buckets：",-1),El=t("p",null,"mediafiles： 普通文件",-1),yl=t("p",null,"video：视频文件",-1),il={id:"_1-2-4-sdk",tabindex:"-1"},Fl=t("strong",null,"1.2.4 SDK",-1),ul={id:"_1-2-4-1上传文件",tabindex:"-1"},dl=t("strong",null,"1.2.4.1上传文件",-1),ml=t("p",null,"MinIO提供多个语言版本SDK的支持，下边找到java版本的文档：",-1),Dl=t("p",null,"最低需求Java 1.8或更高版本:",-1),Al=t("p",null,"maven依赖如下：",-1),gl=t("div",{style:{"max-height":"300px"},class:"language-xml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"xml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">io.minio</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">minio</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"version"),t("span",{style:{color:"#E1E4E8"}},">8.4.3</"),t("span",{style:{color:"#85E89D"}},"version"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">com.squareup.okhttp3</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">okhttp</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"version"),t("span",{style:{color:"#E1E4E8"}},">4.8.1</"),t("span",{style:{color:"#85E89D"}},"version"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">io.minio</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">minio</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"version"),t("span",{style:{color:"#24292E"}},">8.4.3</"),t("span",{style:{color:"#22863A"}},"version"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">com.squareup.okhttp3</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">okhttp</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"version"),t("span",{style:{color:"#24292E"}},">4.8.1</"),t("span",{style:{color:"#22863A"}},"version"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")])])]),t("button",{class:"collapse"})],-1),hl=t("p",null,"在media-service工程添加此依赖。",-1),Cl=t("p",null,"参数说明：",-1),bl=t("p",null,"需要三个参数才能连接到minio服务。",-1),Bl=t("table",null,[t("thead",null,[t("tr",null,[t("th",null,"参数"),t("th",null,"说明")])]),t("tbody",null,[t("tr",null,[t("td",null,"Endpoint"),t("td",null,"对象存储服务的URL")]),t("tr",null,[t("td",null,"Access Key"),t("td",null,"Access key就像用户ID，可以唯一标识你的账户。")]),t("tr",null,[t("td",null,"Secret Key"),t("td",null,"Secret key是你账户的密码。")])])],-1),fl=t("p",null,"官方的示例代码如下：",-1),kl=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.BucketExistsArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.MakeBucketArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.MinioClient;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.UploadObjectArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.errors.MinioException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," java.io.IOException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," java.security.InvalidKeyException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," java.security.NoSuchAlgorithmException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileUploader"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"static"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"main"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"[] "),t("span",{style:{color:"#FFAB70"}},"args"),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," IOException, NoSuchAlgorithmException, InvalidKeyException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#6A737D"}},"// Create a minioClient with the MinIO server playground, its access key and secret key.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      MinioClient minioClient "),t("span",{style:{color:"#F97583"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"          MinioClient."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              ."),t("span",{style:{color:"#B392F0"}},"endpoint"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"https://play.min.io"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              ."),t("span",{style:{color:"#B392F0"}},"credentials"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"Q3AM3UQ867SPQQA43P2F"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#6A737D"}},"// Make 'asiatrip' bucket if not exist.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," found "),t("span",{style:{color:"#F97583"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"          minioClient."),t("span",{style:{color:"#B392F0"}},"bucketExists"),t("span",{style:{color:"#E1E4E8"}},"(BucketExistsArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"asiatrip"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," ("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"found) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"// Make a new bucket called 'asiatrip'.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        minioClient."),t("span",{style:{color:"#B392F0"}},"makeBucket"),t("span",{style:{color:"#E1E4E8"}},"(MakeBucketArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"asiatrip"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      } "),t("span",{style:{color:"#F97583"}},"else"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},"\"Bucket 'asiatrip' already exists.\""),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#6A737D"}},"// Upload '/home/user/Photos/asiaphotos.zip' as object name 'asiaphotos-2015.zip' to bucket")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#6A737D"}},"// 'asiatrip'.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      minioClient."),t("span",{style:{color:"#B392F0"}},"uploadObject"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"          UploadObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"asiatrip"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"asiaphotos-2015.zip"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              ."),t("span",{style:{color:"#B392F0"}},"filename"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/home/user/Photos/asiaphotos.zip"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"          "),t("span",{style:{color:"#9ECBFF"}},"\"'/home/user/Photos/asiaphotos.zip' is successfully uploaded as \"")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"              "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"\"object 'asiaphotos-2015.zip' to bucket 'asiatrip'.\""),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (MinioException "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"Error occurred: "'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"HTTP trace: "'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," e."),t("span",{style:{color:"#B392F0"}},"httpTrace"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.BucketExistsArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.MakeBucketArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.MinioClient;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.UploadObjectArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.errors.MinioException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," java.io.IOException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," java.security.InvalidKeyException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," java.security.NoSuchAlgorithmException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileUploader"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"static"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"main"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"[] "),t("span",{style:{color:"#E36209"}},"args"),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," IOException, NoSuchAlgorithmException, InvalidKeyException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#6A737D"}},"// Create a minioClient with the MinIO server playground, its access key and secret key.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      MinioClient minioClient "),t("span",{style:{color:"#D73A49"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"          MinioClient."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              ."),t("span",{style:{color:"#6F42C1"}},"endpoint"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"https://play.min.io"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              ."),t("span",{style:{color:"#6F42C1"}},"credentials"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"Q3AM3UQ867SPQQA43P2F"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#6A737D"}},"// Make 'asiatrip' bucket if not exist.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," found "),t("span",{style:{color:"#D73A49"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"          minioClient."),t("span",{style:{color:"#6F42C1"}},"bucketExists"),t("span",{style:{color:"#24292E"}},"(BucketExistsArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"asiatrip"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," ("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"found) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"// Make a new bucket called 'asiatrip'.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        minioClient."),t("span",{style:{color:"#6F42C1"}},"makeBucket"),t("span",{style:{color:"#24292E"}},"(MakeBucketArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"asiatrip"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      } "),t("span",{style:{color:"#D73A49"}},"else"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},"\"Bucket 'asiatrip' already exists.\""),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#6A737D"}},"// Upload '/home/user/Photos/asiaphotos.zip' as object name 'asiaphotos-2015.zip' to bucket")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#6A737D"}},"// 'asiatrip'.")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      minioClient."),t("span",{style:{color:"#6F42C1"}},"uploadObject"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"          UploadObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"asiatrip"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"asiaphotos-2015.zip"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              ."),t("span",{style:{color:"#6F42C1"}},"filename"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/home/user/Photos/asiaphotos.zip"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"          "),t("span",{style:{color:"#032F62"}},"\"'/home/user/Photos/asiaphotos.zip' is successfully uploaded as \"")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"              "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"\"object 'asiaphotos-2015.zip' to bucket 'asiatrip'.\""),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (MinioException "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"Error occurred: "'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"HTTP trace: "'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," e."),t("span",{style:{color:"#6F42C1"}},"httpTrace"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Sl=t("p",null,"参考示例在media-service工程中 测试上传文件功能，首先创建一个用于测试的bucket",-1),vl=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps68.jpg"})],-1),Ml=t("p",null,"点击“Manage”修改bucket的访问权限",-1),jl=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps69.jpg"})],-1),Pl=t("p",null,"选择public权限",-1),_l=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps70.jpg"})],-1),xl=t("p",null,"在xuecheng-plus-media-service工程 的test下编写测试代码如下：",-1),Il=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.BucketExistsArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.MakeBucketArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.MinioClient;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.UploadObjectArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," io.minio.errors.MinioException;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," java.io.IOException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," java.security.InvalidKeyException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," java.security.NoSuchAlgorithmException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"MinioTest"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    MinioClient minioClient "),t("span",{style:{color:"#F97583"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            MinioClient."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"endpoint"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"http://192.168.2.203:9000"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"credentials"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"minioadmin"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"minioadmin"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"test_upload"),t("span",{style:{color:"#E1E4E8"}},"() "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            UploadObjectArgs testbucket "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"filename"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1.mp4"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"test/01/1.mp4"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"contentType"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"video/mp4"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//默认根据扩展名确定文件内容类型，也可以指定")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            minioClient."),t("span",{style:{color:"#B392F0"}},"uploadObject"),t("span",{style:{color:"#E1E4E8"}},"(testbucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传成功"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传失败"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.BucketExistsArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.MakeBucketArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.MinioClient;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.UploadObjectArgs;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," io.minio.errors.MinioException;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," java.io.IOException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," java.security.InvalidKeyException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," java.security.NoSuchAlgorithmException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"MinioTest"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    MinioClient minioClient "),t("span",{style:{color:"#D73A49"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            MinioClient."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"endpoint"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"http://192.168.2.203:9000"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"credentials"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"minioadmin"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"minioadmin"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"test_upload"),t("span",{style:{color:"#24292E"}},"() "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            UploadObjectArgs testbucket "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," UploadObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"filename"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1.mp4"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"test/01/1.mp4"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"contentType"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"video/mp4"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//默认根据扩展名确定文件内容类型，也可以指定")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            minioClient."),t("span",{style:{color:"#6F42C1"}},"uploadObject"),t("span",{style:{color:"#24292E"}},"(testbucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传成功"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传失败"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Tl=t("p",null,"执行upload方法，分别测试向桶的根目录上传文件以及子目录上传文件。",-1),Ol=t("p",null,"上传成功，通过web控制台查看文件，并预览文件。",-1),Rl=t("p",null,"说明：",-1),wl=t("p",null,"设置contentType可以通过com.j256.simplemagic.ContentType枚举类查看常用的mimeType（媒体类型）",-1),Ll=t("p",null,"通过扩展名得到mimeType，代码如下：",-1),Nl=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"\t"),t("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ContentInfo extensionMatch "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," ContentInfoUtil."),t("span",{style:{color:"#B392F0"}},"findExtensionMatch"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'".mp4"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),t("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"\t"),t("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ContentInfo extensionMatch "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," ContentInfoUtil."),t("span",{style:{color:"#6F42C1"}},"findExtensionMatch"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'".mp4"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),t("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")])])]),t("button",{class:"collapse"})],-1),Ul=t("p",null,"完善上边的代码 如下：",-1),zl=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"\t@"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"test_upload"),t("span",{style:{color:"#E1E4E8"}},"() throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//通过扩展名得到媒体资源类型 mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ContentInfo extensionMatch "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," ContentInfoUtil."),t("span",{style:{color:"#B392F0"}},"findExtensionMatch"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'".mp4"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),t("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(extensionMatch"),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," extensionMatch."),t("span",{style:{color:"#B392F0"}},"getMimeType"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UploadObjectArgs uploadObjectArgs "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"filename"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1.mp4"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"test/01/1.mp4"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"contentType"),t("span",{style:{color:"#E1E4E8"}},"(mimeType)"),t("span",{style:{color:"#6A737D"}},"//设置媒体文件类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        minioClient."),t("span",{style:{color:"#B392F0"}},"uploadObject"),t("span",{style:{color:"#E1E4E8"}},"(uploadObjectArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"\t@"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"test_upload"),t("span",{style:{color:"#24292E"}},"() throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//通过扩展名得到媒体资源类型 mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ContentInfo extensionMatch "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," ContentInfoUtil."),t("span",{style:{color:"#6F42C1"}},"findExtensionMatch"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'".mp4"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;"),t("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(extensionMatch"),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," extensionMatch."),t("span",{style:{color:"#6F42C1"}},"getMimeType"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UploadObjectArgs uploadObjectArgs "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," UploadObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"filename"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1.mp4"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//                .object("1.mp4")//对象名 在桶下存储该文件')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"test/01/1.mp4"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"contentType"),t("span",{style:{color:"#24292E"}},"(mimeType)"),t("span",{style:{color:"#6A737D"}},"//设置媒体文件类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        minioClient."),t("span",{style:{color:"#6F42C1"}},"uploadObject"),t("span",{style:{color:"#24292E"}},"(uploadObjectArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),Kl={id:"_1-2-4-2-删除文件",tabindex:"-1"},ql=t("strong",null,"1.2.4.2 删除文件",-1),Hl=t("p",null,"下边测试删除文件",-1),Wl=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"delete"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        minioClient."),t("span",{style:{color:"#B392F0"}},"removeObject"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"               RemoveObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"001/test001.mp4"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"删除成功"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"       e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"删除失败"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"delete"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        minioClient."),t("span",{style:{color:"#6F42C1"}},"removeObject"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"               RemoveObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"001/test001.mp4"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"删除成功"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"       e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"删除失败"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Gl={id:"_1-2-4-3-查询文件",tabindex:"-1"},$l=t("strong",null,"1.2.4.3 查询文件",-1),Vl=t("p",null,"通过查询文件查看文件是否存在minio中。",-1),Xl=t("p",null,"校验文件的完整性，对文件计算出md5值，比较原始文件的md5和目标文件的md5，一致则说明完整",-1),Jl=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//查询文件 从minio中下载")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"test_getFile"),t("span",{style:{color:"#E1E4E8"}},"() throws Exception {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    GetObjectArgs getObjectArgs "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," GetObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"test/01/1.mp4"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//查询远程服务获取到一个流对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    FilterInputStream inputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," minioClient."),t("span",{style:{color:"#B392F0"}},"getObject"),t("span",{style:{color:"#E1E4E8"}},"(getObjectArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//指定输出流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    FileOutputStream outputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileOutputStream"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1a.mp4"'),t("span",{style:{color:"#E1E4E8"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    IOUtils."),t("span",{style:{color:"#B392F0"}},"copy"),t("span",{style:{color:"#E1E4E8"}},"(inputStream,outputStream);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//校验文件的完整性对文件的内容进行md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream1 "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileInputStream"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1.mp4"'),t("span",{style:{color:"#E1E4E8"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String source_md5 "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," DigestUtils."),t("span",{style:{color:"#B392F0"}},"md5Hex"),t("span",{style:{color:"#E1E4E8"}},"(fileInputStream1);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileInputStream"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1a.mp4"'),t("span",{style:{color:"#E1E4E8"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String local_md5 "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," DigestUtils."),t("span",{style:{color:"#B392F0"}},"md5Hex"),t("span",{style:{color:"#E1E4E8"}},"(fileInputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(source_md5."),t("span",{style:{color:"#B392F0"}},"equals"),t("span",{style:{color:"#E1E4E8"}},"(local_md5)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"下载成功"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//查询文件 从minio中下载")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"test_getFile"),t("span",{style:{color:"#24292E"}},"() throws Exception {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    GetObjectArgs getObjectArgs "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," GetObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"test/01/1.mp4"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//查询远程服务获取到一个流对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    FilterInputStream inputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," minioClient."),t("span",{style:{color:"#6F42C1"}},"getObject"),t("span",{style:{color:"#24292E"}},"(getObjectArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//指定输出流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    FileOutputStream outputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileOutputStream"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1a.mp4"'),t("span",{style:{color:"#24292E"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    IOUtils."),t("span",{style:{color:"#6F42C1"}},"copy"),t("span",{style:{color:"#24292E"}},"(inputStream,outputStream);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//校验文件的完整性对文件的内容进行md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream1 "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileInputStream"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1.mp4"'),t("span",{style:{color:"#24292E"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String source_md5 "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," DigestUtils."),t("span",{style:{color:"#6F42C1"}},"md5Hex"),t("span",{style:{color:"#24292E"}},"(fileInputStream1);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileInputStream"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1a.mp4"'),t("span",{style:{color:"#24292E"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String local_md5 "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," DigestUtils."),t("span",{style:{color:"#6F42C1"}},"md5Hex"),t("span",{style:{color:"#24292E"}},"(fileInputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(source_md5."),t("span",{style:{color:"#6F42C1"}},"equals"),t("span",{style:{color:"#24292E"}},"(local_md5)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"下载成功"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ql={id:"二-上传图片",tabindex:"-1"},Yl=t("strong",null,"二 上传图片",-1),Zl={id:"_2-1-需求分析",tabindex:"-1"},so=t("strong",null,"2.1 需求分析",-1),lo={id:"_2-1-1-业务流程",tabindex:"-1"},oo=t("strong",null,"2.1.1 业务流程",-1),no=t("p",null,"课程图片是宣传课程非常重要的信息，在新增课程界面上传课程图片，也可以修改课程图片。",-1),ao=t("p",null,"如下图：",-1),eo=t("figure",null,[t("img",{alt:"image-20230704224229162",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704224229162.png"})],-1),co=t("p",null,"上传课程图片总体上包括两部分：",-1),to=t("p",null,"1、上传课程图片前端请求媒资管理服务将文件上传至分布式文件系统，并且在媒资管理数据库保存文件信息。",-1),po=t("p",null,"2、上传图片成功保存图片地址到课程基本信息表中。",-1),ro=t("p",null,"详细流程如下：",-1),Eo=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps72.jpg"})],-1),yo=t("p",null,"1、前端进入上传图片界面",-1),io=t("p",null,"2、上传图片，请求媒资管理服务。",-1),Fo=t("p",null,"3、媒资管理服务将图片文件存储在MinIO。",-1),uo=t("p",null,"4、媒资管理记录文件信息到数据库。",-1),mo=t("p",null,"5、前端请求内容管理服务保存课程信息，在内容管理数据库保存图片地址。",-1),Do={id:"_2-1-2-数据模型",tabindex:"-1"},Ao=t("strong",null,"2.1.2 数据模型",-1),go=t("p",null,"涉及到的数据表有：课程信息表中的图片字段、媒资数据库的文件表，下边主要看媒资数据库的文件表。",-1),ho=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps73.jpg"})],-1),Co=t("p",null,"各字段描述如下：",-1),bo=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps74.jpg"})],-1),Bo={id:"_2-2-准备环境",tabindex:"-1"},fo=t("strong",null,"2.2 准备环境",-1),ko=t("p",null,"首先在minio配置bucket，bucket名称为：mediafiles，并设置bucket的权限为公开。",-1),So=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps75.jpg"})],-1),vo=t("p",null,[p("在nacos配置中minio的相关信息，进入"),t("code",null,"media-service-dev.yaml"),p(":")],-1),Mo=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps76.jpg"})],-1),jo=t("p",null,"配置信息如下：",-1),Po=t("div",{style:{"max-height":"300px"},class:"language-yaml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"yaml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"minio"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"endpoint"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"http://192.168.2.203:9000")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"accessKey"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"minioadmin")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"secretKey"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"minioadmin")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"files"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"mediafiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"videofiles"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"video")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"minio"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"endpoint"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"http://192.168.2.203:9000")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"accessKey"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"minioadmin")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"secretKey"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"minioadmin")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"bucket"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"files"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"mediafiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"videofiles"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"video")])])]),t("button",{class:"collapse"})],-1),_o=t("p",null,"在media-service工程编写minio的配置类：",-1),xo=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"MinioConfig"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Value"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"${minio.endpoint}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String endpoint;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Value"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"${minio.accessKey}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String accessKey;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Value"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"${minio.secretKey}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String secretKey;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," MinioClient "),t("span",{style:{color:"#B392F0"}},"minioClient"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  MinioClient minioClient "),t("span",{style:{color:"#F97583"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"          MinioClient."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                  ."),t("span",{style:{color:"#B392F0"}},"endpoint"),t("span",{style:{color:"#E1E4E8"}},"(endpoint)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                  ."),t("span",{style:{color:"#B392F0"}},"credentials"),t("span",{style:{color:"#E1E4E8"}},"(accessKey, secretKey)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                  ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," minioClient;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"MinioConfig"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Value"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"${minio.endpoint}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String endpoint;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Value"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"${minio.accessKey}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String accessKey;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Value"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"${minio.secretKey}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String secretKey;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," MinioClient "),t("span",{style:{color:"#6F42C1"}},"minioClient"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  MinioClient minioClient "),t("span",{style:{color:"#D73A49"}},"=")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"          MinioClient."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                  ."),t("span",{style:{color:"#6F42C1"}},"endpoint"),t("span",{style:{color:"#24292E"}},"(endpoint)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                  ."),t("span",{style:{color:"#6F42C1"}},"credentials"),t("span",{style:{color:"#24292E"}},"(accessKey, secretKey)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                  ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," minioClient;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Io={id:"_2-3-接口定义",tabindex:"-1"},To=t("strong",null,"2.3 接口定义",-1),Oo=t("p",null,"根据需求分析，下边进行接口定义，此接口定义为一个通用的上传文件接口，可以上传图片或其它文件。",-1),Ro=t("p",null,"首先分析接口：",-1),wo=t("blockquote",null,[t("p",null,"请求地址：/media/upload/coursefile"),t("p",null,[p("请求内容："),t("strong",null,"Content-Type:"),p(" multipart/form-data;")]),t("p",null,'form-data; name="filedata"; filename="具体的文件名称"')],-1),Lo=t("p",null,"响应参数：文件信息，如下",-1),No=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"id"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"a16da7a132559daf9e1193166b3e7f52"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"companyId"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"1232141425"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"companyName"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"filename"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"1.jpg"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"fileType"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"001001"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"tags"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"bucket"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"fileId"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"a16da7a132559daf9e1193166b3e7f52"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"url"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"timelength"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"username"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"createDate"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"2022-09-12T21:57:18"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"changeDate"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"status"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"1"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"remark"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"auditStatus"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"auditMind"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"fileSize"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"248329")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"id"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"a16da7a132559daf9e1193166b3e7f52"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"companyId"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"1232141425"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"companyName"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"filename"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"1.jpg"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"fileType"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"001001"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"tags"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"bucket"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"fileId"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"a16da7a132559daf9e1193166b3e7f52"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"url"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"/testbucket/2022/09/12/a16da7a132559daf9e1193166b3e7f52.jpg"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"timelength"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"username"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"createDate"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"2022-09-12T21:57:18"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"changeDate"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"status"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"1"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"remark"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"auditStatus"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"auditMind"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"fileSize"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"248329")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Uo=t("p",null,"定义上传响应模型类：",-1),zo=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 上传普通文件成功响应结果")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UploadFileResultDto"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"MediaFiles"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 上传普通文件成功响应结果")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UploadFileResultDto"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"MediaFiles"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ko=t("p",null,"定义接口如下：",-1),qo=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/upload/coursefile"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"consumes"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),t("span",{style:{color:"#B392F0"}},"upload"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestPart"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"filedata"'),t("span",{style:{color:"#E1E4E8"}},") MultipartFile upload) throws IOException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/upload/coursefile"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"consumes"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UploadFileResultDto "),t("span",{style:{color:"#6F42C1"}},"upload"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestPart"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"filedata"'),t("span",{style:{color:"#24292E"}},") MultipartFile upload) throws IOException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ho=t("p",null,"接口定义好后可以用httpclient工具测试一下",-1),Wo=t("p",null,"使用httpclient测试",-1),Go=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/upload/coursefile")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Content-Type"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"multipart/form-data; boundary=WebAppBoundary")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"--WebAppBoundary")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Content-Disposition"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'form-data; name="filedata"; filename="1.jpg"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Content-Type"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"application/octet-stream")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"< d:/develop/upload/1.jpg")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{media_host}}/media/upload/coursefile")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Content-Type"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"multipart/form-data; boundary=WebAppBoundary")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"--WebAppBoundary")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Content-Disposition"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'form-data; name="filedata"; filename="1.jpg"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Content-Type"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"application/octet-stream")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"< d:/develop/upload/1.jpg")])])]),t("button",{class:"collapse"})],-1),$o={id:"_2-4-接口开发",tabindex:"-1"},Vo=t("strong",null,"2.4 接口开发",-1),Xo={id:"_2-4-1-dao开发",tabindex:"-1"},Jo=t("strong",null,"2.4.1 DAO开发",-1),Qo=t("p",null,[p("根据需求分析DAO层实现向"),t("code",null,"media_files"),p("表插入一条记录，使用"),t("code",null,"media_files"),p("表生成的mapper即可。")],-1),Yo={id:"_2-4-2-service开发",tabindex:"-1"},Zo=t("strong",null,"2.4.2 Service开发",-1),sn=t("p",null,"Service方法需要提供一个更加通用的保存文件的方法。",-1),ln=t("p",null,"定义请求参数类：",-1),on=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 上传普通文件请求参数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String filename;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 文件类型（文档，音频，视频）")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String fileType;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," Long fileSize;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 标签")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String tags;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 上传人")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String username;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 备注")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String remark;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 上传普通文件请求参数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String filename;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 文件类型（文档，音频，视频）")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String fileType;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," Long fileSize;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 标签")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String tags;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 上传人")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String username;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  * 备注")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"  */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String remark;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),nn=t("p",null,"定义service方法：",-1),an=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"companyId"),t("span",{style:{color:"#6A737D"}}," 机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}}," 上传文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"localFilePath"),t("span",{style:{color:"#6A737D"}}," 文件磁盘路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," 文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),t("span",{style:{color:"#B392F0"}},"uploadFile"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//修改版")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),t("span",{style:{color:"#B392F0"}},"uploadFile"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName);")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"companyId"),t("span",{style:{color:"#6A737D"}}," 机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}}," 上传文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"localFilePath"),t("span",{style:{color:"#6A737D"}}," 文件磁盘路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," 文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UploadFileResultDto "),t("span",{style:{color:"#6F42C1"}},"uploadFile"),t("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//修改版")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UploadFileResultDto "),t("span",{style:{color:"#6F42C1"}},"uploadFile"),t("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName);")])])]),t("button",{class:"collapse"})],-1),en=t("p",null,"实现方法如下：",-1),cn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"MinioClient minioClient;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"MediaFilesMapper mediaFilesMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//普通文件桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Value"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"${minio.bucket.files}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String bucket_Files;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//获取文件默认存储目录路径 年/月/日")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"getDefaultFolderPath"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    SimpleDateFormat sdf "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"SimpleDateFormat"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"yyyy-MM-dd"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String folder "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," sdf."),t("span",{style:{color:"#B392F0"}},"format"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"Date"),t("span",{style:{color:"#E1E4E8"}},"())."),t("span",{style:{color:"#B392F0"}},"replace"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"-"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," folder;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//获取文件的md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"getFileMd5"),t("span",{style:{color:"#E1E4E8"}},"(File file) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," (FileInputStream fileInputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileInputStream"),t("span",{style:{color:"#E1E4E8"}},"(file)) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String fileMd5 "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," DigestUtils."),t("span",{style:{color:"#B392F0"}},"md5Hex"),t("span",{style:{color:"#E1E4E8"}},"(fileInputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," fileMd5;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"getMimeType"),t("span",{style:{color:"#E1E4E8"}},"(String extension){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(extension"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        extension "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ContentInfo extensionMatch "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," ContentInfoUtil."),t("span",{style:{color:"#B392F0"}},"findExtensionMatch"),t("span",{style:{color:"#E1E4E8"}},"(extension);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(extensionMatch"),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," extensionMatch."),t("span",{style:{color:"#B392F0"}},"getMimeType"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mimeType;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件写入minIO")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"localFilePath"),t("span",{style:{color:"#6A737D"}},"  文件地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," void")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#E1E4E8"}},"(String localFilePath,String mimeType,String bucket, String objectName) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UploadObjectArgs testbucket "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"(objectName)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"filename"),t("span",{style:{color:"#E1E4E8"}},"(localFilePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"contentType"),t("span",{style:{color:"#E1E4E8"}},"(mimeType)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        minioClient."),t("span",{style:{color:"#B392F0"}},"uploadObject"),t("span",{style:{color:"#E1E4E8"}},"(testbucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传文件到minio成功,bucket:{},objectName:{}"'),t("span",{style:{color:"#E1E4E8"}},",bucket,objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传成功"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"error"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传文件到minio出错,bucket:{},objectName:{},错误原因:{}"'),t("span",{style:{color:"#E1E4E8"}},",bucket,objectName,e."),t("span",{style:{color:"#B392F0"}},"getMessage"),t("span",{style:{color:"#E1E4E8"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),t("span",{style:{color:"#B392F0"}},"cast"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传文件到文件系统失败"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," MediaFiles "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//从数据库查询文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),t("span",{style:{color:"#B392F0"}},"selectById"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," (mediaFiles "),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"MediaFiles"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//拷贝基本信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        BeanUtils."),t("span",{style:{color:"#B392F0"}},"copyProperties"),t("span",{style:{color:"#E1E4E8"}},"(uploadFileParamsDto, mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setId"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setFileId"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setCompanyId"),t("span",{style:{color:"#E1E4E8"}},"(companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setUrl"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," bucket "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setBucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setFilePath"),t("span",{style:{color:"#E1E4E8"}},"(objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setCreateDate"),t("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),t("span",{style:{color:"#B392F0"}},"now"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setAuditStatus"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"002003"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setStatus"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"1"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//保存文件信息到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," insert "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),t("span",{style:{color:"#B392F0"}},"insert"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," (insert "),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            log."),t("span",{style:{color:"#B392F0"}},"error"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库失败,{}"'),t("span",{style:{color:"#E1E4E8"}},",mediaFiles."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            XueChengPlusException."),t("span",{style:{color:"#B392F0"}},"cast"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"保存文件信息失败"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库成功,{}"'),t("span",{style:{color:"#E1E4E8"}},",mediaFiles."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mediaFiles;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),t("span",{style:{color:"#B392F0"}},"uploadFile"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File file "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"(localFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," ("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"file."),t("span",{style:{color:"#B392F0"}},"exists"),t("span",{style:{color:"#E1E4E8"}},"()) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),t("span",{style:{color:"#B392F0"}},"cast"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"文件不存在"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String filename "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"getFilename"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String extension "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," filename."),t("span",{style:{color:"#B392F0"}},"substring"),t("span",{style:{color:"#E1E4E8"}},"(filename."),t("span",{style:{color:"#B392F0"}},"lastIndexOf"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"."'),t("span",{style:{color:"#E1E4E8"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getMimeType"),t("span",{style:{color:"#E1E4E8"}},"(extension);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件的md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String fileMd5 "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getFileMd5"),t("span",{style:{color:"#E1E4E8"}},"(file);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件的默认目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String defaultFolderPath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getDefaultFolderPath"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//存储到minio中的对象名(带目录)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String  objectName "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," defaultFolderPath "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," fileMd5 "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," exension;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件上传到minio")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," b "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#E1E4E8"}},"(localFilePath, mimeType, bucket_files, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileSize"),t("span",{style:{color:"#E1E4E8"}},"(file."),t("span",{style:{color:"#B392F0"}},"length"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件信息存储到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//准备返回数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UploadFileResultDto"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    BeanUtils."),t("span",{style:{color:"#B392F0"}},"copyProperties"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles, uploadFileResultDto);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"MinioClient minioClient;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"MediaFilesMapper mediaFilesMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//普通文件桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Value"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"${minio.bucket.files}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String bucket_Files;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//获取文件默认存储目录路径 年/月/日")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"getDefaultFolderPath"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    SimpleDateFormat sdf "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"SimpleDateFormat"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"yyyy-MM-dd"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String folder "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," sdf."),t("span",{style:{color:"#6F42C1"}},"format"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"Date"),t("span",{style:{color:"#24292E"}},"())."),t("span",{style:{color:"#6F42C1"}},"replace"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"-"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," folder;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//获取文件的md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"getFileMd5"),t("span",{style:{color:"#24292E"}},"(File file) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," (FileInputStream fileInputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileInputStream"),t("span",{style:{color:"#24292E"}},"(file)) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String fileMd5 "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," DigestUtils."),t("span",{style:{color:"#6F42C1"}},"md5Hex"),t("span",{style:{color:"#24292E"}},"(fileInputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," fileMd5;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"getMimeType"),t("span",{style:{color:"#24292E"}},"(String extension){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(extension"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        extension "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//根据扩展名取出mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ContentInfo extensionMatch "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," ContentInfoUtil."),t("span",{style:{color:"#6F42C1"}},"findExtensionMatch"),t("span",{style:{color:"#24292E"}},"(extension);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//通用mimeType，字节流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," MediaType.APPLICATION_OCTET_STREAM_VALUE;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(extensionMatch"),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," extensionMatch."),t("span",{style:{color:"#6F42C1"}},"getMimeType"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mimeType;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件写入minIO")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"localFilePath"),t("span",{style:{color:"#6A737D"}},"  文件地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," void")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#24292E"}},"(String localFilePath,String mimeType,String bucket, String objectName) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UploadObjectArgs testbucket "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," UploadObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"(bucket)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"(objectName)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"filename"),t("span",{style:{color:"#24292E"}},"(localFilePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"contentType"),t("span",{style:{color:"#24292E"}},"(mimeType)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        minioClient."),t("span",{style:{color:"#6F42C1"}},"uploadObject"),t("span",{style:{color:"#24292E"}},"(testbucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传文件到minio成功,bucket:{},objectName:{}"'),t("span",{style:{color:"#24292E"}},",bucket,objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传成功"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"error"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传文件到minio出错,bucket:{},objectName:{},错误原因:{}"'),t("span",{style:{color:"#24292E"}},",bucket,objectName,e."),t("span",{style:{color:"#6F42C1"}},"getMessage"),t("span",{style:{color:"#24292E"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XueChengPlusException."),t("span",{style:{color:"#6F42C1"}},"cast"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传文件到文件系统失败"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," MediaFiles "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//从数据库查询文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFilesMapper."),t("span",{style:{color:"#6F42C1"}},"selectById"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," (mediaFiles "),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"MediaFiles"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//拷贝基本信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        BeanUtils."),t("span",{style:{color:"#6F42C1"}},"copyProperties"),t("span",{style:{color:"#24292E"}},"(uploadFileParamsDto, mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setId"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setFileId"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setCompanyId"),t("span",{style:{color:"#24292E"}},"(companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setUrl"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," bucket "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setBucket"),t("span",{style:{color:"#24292E"}},"(bucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setFilePath"),t("span",{style:{color:"#24292E"}},"(objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setCreateDate"),t("span",{style:{color:"#24292E"}},"(LocalDateTime."),t("span",{style:{color:"#6F42C1"}},"now"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setAuditStatus"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"002003"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setStatus"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"1"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//保存文件信息到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," insert "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFilesMapper."),t("span",{style:{color:"#6F42C1"}},"insert"),t("span",{style:{color:"#24292E"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," (insert "),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            log."),t("span",{style:{color:"#6F42C1"}},"error"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"保存文件信息到数据库失败,{}"'),t("span",{style:{color:"#24292E"}},",mediaFiles."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            XueChengPlusException."),t("span",{style:{color:"#6F42C1"}},"cast"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"保存文件信息失败"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"保存文件信息到数据库成功,{}"'),t("span",{style:{color:"#24292E"}},",mediaFiles."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mediaFiles;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UploadFileResultDto "),t("span",{style:{color:"#6F42C1"}},"uploadFile"),t("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File file "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"(localFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," ("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"file."),t("span",{style:{color:"#6F42C1"}},"exists"),t("span",{style:{color:"#24292E"}},"()) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XueChengPlusException."),t("span",{style:{color:"#6F42C1"}},"cast"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"文件不存在"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String filename "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"getFilename"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String extension "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," filename."),t("span",{style:{color:"#6F42C1"}},"substring"),t("span",{style:{color:"#24292E"}},"(filename."),t("span",{style:{color:"#6F42C1"}},"lastIndexOf"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"."'),t("span",{style:{color:"#24292E"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getMimeType"),t("span",{style:{color:"#24292E"}},"(extension);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件的md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String fileMd5 "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getFileMd5"),t("span",{style:{color:"#24292E"}},"(file);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件的默认目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String defaultFolderPath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getDefaultFolderPath"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//存储到minio中的对象名(带目录)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String  objectName "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," defaultFolderPath "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," fileMd5 "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," exension;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件上传到minio")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," b "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#24292E"}},"(localFilePath, mimeType, bucket_files, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileSize"),t("span",{style:{color:"#24292E"}},"(file."),t("span",{style:{color:"#6F42C1"}},"length"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件信息存储到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//准备返回数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UploadFileResultDto"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    BeanUtils."),t("span",{style:{color:"#6F42C1"}},"copyProperties"),t("span",{style:{color:"#24292E"}},"(mediaFiles, uploadFileResultDto);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),tn=t("p",null,"修改版",-1),pn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//将文件信息添加到文件表添加到service接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"MediaFiles "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/*-----------------------------------------------------------------------------------------------------------------------*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//注入自身")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"MediaFileService currentProxy;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," MediaFiles "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        MediaFiles mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),t("span",{style:{color:"#B392F0"}},"selectById"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles "),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"MediaFiles"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            BeanUtils."),t("span",{style:{color:"#B392F0"}},"copyProperties"),t("span",{style:{color:"#E1E4E8"}},"(uploadFileParamsDto,mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//文件id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setId"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setCompanyId"),t("span",{style:{color:"#E1E4E8"}},"(companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setBucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//file_path")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setFilePath"),t("span",{style:{color:"#E1E4E8"}},"(objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//file_id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setFileId"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//url")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setUrl"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"bucket"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//上传时间")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setCreateDate"),t("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),t("span",{style:{color:"#B392F0"}},"now"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setStatus"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"1"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//审核状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            mediaFiles."),t("span",{style:{color:"#B392F0"}},"setAuditStatus"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"002003"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//插入数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," insert "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),t("span",{style:{color:"#B392F0"}},"insert"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(insert"),t("span",{style:{color:"#F97583"}},"<="),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),t("span",{style:{color:"#E1E4E8"}},",bucket,objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#B392F0"}},"addWaitingTask"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库成功,{}"'),t("span",{style:{color:"#E1E4E8"}},", mediaFiles."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mediaFiles;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),t("span",{style:{color:"#B392F0"}},"uploadFile"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String filename "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"getFilename"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//先得到扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String extension "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," filename."),t("span",{style:{color:"#B392F0"}},"substring"),t("span",{style:{color:"#E1E4E8"}},"(filename."),t("span",{style:{color:"#B392F0"}},"lastIndexOf"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"."'),t("span",{style:{color:"#E1E4E8"}},"));")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getMimeType"),t("span",{style:{color:"#E1E4E8"}},"(extension);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//子目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String defaultFolderPath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getDefaultFolderPath"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件的md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String fileMd5 "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getFileMd5"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"(localFilePath));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," (StringUtil."),t("span",{style:{color:"#B392F0"}},"isEmpty"),t("span",{style:{color:"#E1E4E8"}},"(objectName)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//                      2023/6/23/  adgfgetgwg24f4gr.jpg")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        objectName "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," defaultFolderPath"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"fileMd5"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"extension;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传文件到minio")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," result "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#E1E4E8"}},"(localFilePath, mimeType, bucket_mediafiles, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"result){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),t("span",{style:{color:"#B392F0"}},"cast"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传文件失败"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//入库文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," currentProxy."),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_mediafiles, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XueChengPlusException."),t("span",{style:{color:"#B392F0"}},"cast"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"文件上传后保存信息失败"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//准备返回的对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UploadFileResultDto"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    BeanUtils."),t("span",{style:{color:"#B392F0"}},"copyProperties"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles,uploadFileResultDto);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//将文件信息添加到文件表添加到service接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"MediaFiles "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/*-----------------------------------------------------------------------------------------------------------------------*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//注入自身")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"MediaFileService currentProxy;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," MediaFiles "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        MediaFiles mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFilesMapper."),t("span",{style:{color:"#6F42C1"}},"selectById"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(mediaFiles "),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"MediaFiles"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            BeanUtils."),t("span",{style:{color:"#6F42C1"}},"copyProperties"),t("span",{style:{color:"#24292E"}},"(uploadFileParamsDto,mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//文件id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setId"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setCompanyId"),t("span",{style:{color:"#24292E"}},"(companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setBucket"),t("span",{style:{color:"#24292E"}},"(bucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//file_path")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setFilePath"),t("span",{style:{color:"#24292E"}},"(objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//file_id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setFileId"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//url")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setUrl"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"bucket"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//上传时间")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setCreateDate"),t("span",{style:{color:"#24292E"}},"(LocalDateTime."),t("span",{style:{color:"#6F42C1"}},"now"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setStatus"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"1"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//审核状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setAuditStatus"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"002003"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//插入数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," insert "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFilesMapper."),t("span",{style:{color:"#6F42C1"}},"insert"),t("span",{style:{color:"#24292E"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(insert"),t("span",{style:{color:"#D73A49"}},"<="),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),t("span",{style:{color:"#24292E"}},",bucket,objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6F42C1"}},"addWaitingTask"),t("span",{style:{color:"#24292E"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"保存文件信息到数据库成功,{}"'),t("span",{style:{color:"#24292E"}},", mediaFiles."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mediaFiles;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UploadFileResultDto "),t("span",{style:{color:"#6F42C1"}},"uploadFile"),t("span",{style:{color:"#24292E"}},"(Long companyId, UploadFileParamsDto uploadFileParamsDto, String localFilePath, String objectName) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String filename "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"getFilename"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//先得到扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String extension "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," filename."),t("span",{style:{color:"#6F42C1"}},"substring"),t("span",{style:{color:"#24292E"}},"(filename."),t("span",{style:{color:"#6F42C1"}},"lastIndexOf"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"."'),t("span",{style:{color:"#24292E"}},"));")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getMimeType"),t("span",{style:{color:"#24292E"}},"(extension);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//子目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String defaultFolderPath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getDefaultFolderPath"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件的md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String fileMd5 "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getFileMd5"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"(localFilePath));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," (StringUtil."),t("span",{style:{color:"#6F42C1"}},"isEmpty"),t("span",{style:{color:"#24292E"}},"(objectName)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//                      2023/6/23/  adgfgetgwg24f4gr.jpg")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        objectName "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," defaultFolderPath"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"fileMd5"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"extension;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传文件到minio")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," result "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#24292E"}},"(localFilePath, mimeType, bucket_mediafiles, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"result){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XueChengPlusException."),t("span",{style:{color:"#6F42C1"}},"cast"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传文件失败"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//入库文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," currentProxy."),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_mediafiles, objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(mediaFiles"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XueChengPlusException."),t("span",{style:{color:"#6F42C1"}},"cast"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"文件上传后保存信息失败"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//准备返回的对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UploadFileResultDto"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    BeanUtils."),t("span",{style:{color:"#6F42C1"}},"copyProperties"),t("span",{style:{color:"#24292E"}},"(mediaFiles,uploadFileResultDto);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),rn={id:"_2-4-3-完善接口层",tabindex:"-1"},En=t("strong",null,"2.4.3 完善接口层",-1),yn=t("p",null,"完善接口层代码 ：",-1),Fn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/upload/coursefile"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"consumes"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ResponseBody")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),t("span",{style:{color:"#B392F0"}},"upload"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestPart"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"filedata"'),t("span",{style:{color:"#E1E4E8"}},") MultipartFile upload,@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"folder"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},") String folder,@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"objectName"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},") String objectName) throws IOException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        Long companyId "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"1232141425L"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    UploadFileParamsDto uploadFileParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileSize"),t("span",{style:{color:"#E1E4E8"}},"(filedata."),t("span",{style:{color:"#B392F0"}},"getSize"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//图片")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileType"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"001001"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFilename"),t("span",{style:{color:"#E1E4E8"}},"(filedata."),t("span",{style:{color:"#B392F0"}},"getOriginalFilename"),t("span",{style:{color:"#E1E4E8"}},"());"),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"long"),t("span",{style:{color:"#E1E4E8"}}," fileSize "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," filedata."),t("span",{style:{color:"#B392F0"}},"getSize"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileSize"),t("span",{style:{color:"#E1E4E8"}},"(fileSize);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//创建临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File tempFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," File."),t("span",{style:{color:"#B392F0"}},"createTempFile"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"minio"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"temp"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    filedata."),t("span",{style:{color:"#B392F0"}},"transferTo"),t("span",{style:{color:"#E1E4E8"}},"(tempFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String absolutePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," tempFile."),t("span",{style:{color:"#B392F0"}},"getAbsolutePath"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFileService."),t("span",{style:{color:"#B392F0"}},"uploadFile"),t("span",{style:{color:"#E1E4E8"}},"(companyId, uploadFileParamsDto, absolutePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"\t"),t("span",{style:{color:"#6A737D"}},"//修改版")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," \t@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传图片"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/upload/coursefile"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"consumes"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UploadFileResultDto "),t("span",{style:{color:"#B392F0"}},"upload"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestPart"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"filedata"'),t("span",{style:{color:"#E1E4E8"}},") MultipartFile filedata,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                      @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"objectName"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},") String objectName) throws IOException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//准备上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UploadFileParamsDto uploadFileParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//原始文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFilename"),t("span",{style:{color:"#E1E4E8"}},"(filedata."),t("span",{style:{color:"#B392F0"}},"getOriginalFilename"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileSize"),t("span",{style:{color:"#E1E4E8"}},"(filedata."),t("span",{style:{color:"#B392F0"}},"getSize"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileType"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"001001"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建一个临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        File tempFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," File."),t("span",{style:{color:"#B392F0"}},"createTempFile"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"minio"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'".temp"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//将本地要上传的文件拷贝到临时文件，拿到本地路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        filedata."),t("span",{style:{color:"#B392F0"}},"transferTo"),t("span",{style:{color:"#E1E4E8"}},"(tempFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        Long companyId "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"1232141425L"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String localFilePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," tempFile."),t("span",{style:{color:"#B392F0"}},"getAbsolutePath"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//调用service上传图片")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFileService."),t("span",{style:{color:"#B392F0"}},"uploadFile"),t("span",{style:{color:"#E1E4E8"}},"(companyId, uploadFileParamsDto, localFilePath, objectName);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/upload/coursefile"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"consumes"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ResponseBody")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UploadFileResultDto "),t("span",{style:{color:"#6F42C1"}},"upload"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestPart"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"filedata"'),t("span",{style:{color:"#24292E"}},") MultipartFile upload,@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"folder"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},") String folder,@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"objectName"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},") String objectName) throws IOException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        Long companyId "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"1232141425L"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    UploadFileParamsDto uploadFileParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileSize"),t("span",{style:{color:"#24292E"}},"(filedata."),t("span",{style:{color:"#6F42C1"}},"getSize"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//图片")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileType"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"001001"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFilename"),t("span",{style:{color:"#24292E"}},"(filedata."),t("span",{style:{color:"#6F42C1"}},"getOriginalFilename"),t("span",{style:{color:"#24292E"}},"());"),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"long"),t("span",{style:{color:"#24292E"}}," fileSize "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," filedata."),t("span",{style:{color:"#6F42C1"}},"getSize"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileSize"),t("span",{style:{color:"#24292E"}},"(fileSize);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//创建临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File tempFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," File."),t("span",{style:{color:"#6F42C1"}},"createTempFile"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"minio"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"temp"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    filedata."),t("span",{style:{color:"#6F42C1"}},"transferTo"),t("span",{style:{color:"#24292E"}},"(tempFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String absolutePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," tempFile."),t("span",{style:{color:"#6F42C1"}},"getAbsolutePath"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFileService."),t("span",{style:{color:"#6F42C1"}},"uploadFile"),t("span",{style:{color:"#24292E"}},"(companyId, uploadFileParamsDto, absolutePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"\t"),t("span",{style:{color:"#6A737D"}},"//修改版")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," \t@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传图片"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/upload/coursefile"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"consumes"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," MediaType.MULTIPART_FORM_DATA_VALUE)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UploadFileResultDto "),t("span",{style:{color:"#6F42C1"}},"upload"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestPart"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"filedata"'),t("span",{style:{color:"#24292E"}},") MultipartFile filedata,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                      @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"objectName"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},") String objectName) throws IOException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//准备上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UploadFileParamsDto uploadFileParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//原始文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFilename"),t("span",{style:{color:"#24292E"}},"(filedata."),t("span",{style:{color:"#6F42C1"}},"getOriginalFilename"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileSize"),t("span",{style:{color:"#24292E"}},"(filedata."),t("span",{style:{color:"#6F42C1"}},"getSize"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileType"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"001001"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建一个临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        File tempFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," File."),t("span",{style:{color:"#6F42C1"}},"createTempFile"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"minio"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'".temp"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//将本地要上传的文件拷贝到临时文件，拿到本地路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        filedata."),t("span",{style:{color:"#6F42C1"}},"transferTo"),t("span",{style:{color:"#24292E"}},"(tempFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        Long companyId "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"1232141425L"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String localFilePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," tempFile."),t("span",{style:{color:"#6F42C1"}},"getAbsolutePath"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//调用service上传图片")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UploadFileResultDto uploadFileResultDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFileService."),t("span",{style:{color:"#6F42C1"}},"uploadFile"),t("span",{style:{color:"#24292E"}},"(companyId, uploadFileParamsDto, localFilePath, objectName);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," uploadFileResultDto;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),un={id:"_2-4-4-接口测试",tabindex:"-1"},dn=t("strong",null,"2.4.4 接口测试",-1),mn=t("p",null,"1、首先使用httpclient测试",-1),Dn=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/upload/coursefile")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Content-Type"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"multipart/form-data; boundary=WebAppBoundary")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"--WebAppBoundary")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Content-Disposition"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'form-data; name="filedata"; filename="1.jpg"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Content-Type"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"application/octet-stream")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"< d:/develop/upload/1.jpg")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{media_host}}/media/upload/coursefile")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Content-Type"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"multipart/form-data; boundary=WebAppBoundary")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"--WebAppBoundary")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Content-Disposition"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'form-data; name="filedata"; filename="1.jpg"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Content-Type"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"application/octet-stream")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"< d:/develop/upload/1.jpg")])])]),t("button",{class:"collapse"})],-1),An=t("p",null,"2、再进行前后端联调测试",-1),gn=t("p",null,"在新增课程、编辑课程界面上传图，保存课程信息后再次进入编辑课程界面，查看是否可以正常保存课程图片信息。",-1),hn=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps77.jpg"})],-1),Cn=t("p",null,"上图图片完成后，进入媒资管理，查看文件列表中是否有刚刚上传的图片信息。",-1),bn=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps78.jpg"})],-1),Bn={id:"_2-4-5-service事务优化",tabindex:"-1"},fn=t("strong",null,"2.4.5 Service事务优化",-1),kn=t("p",null,"上边的service方法优化后并测试通过，现在思考关于uploadFile方法的是否应该开启事务。",-1),Sn=t("p",null,[p("目前是在uploadFile方法上添加"),t("code",null,"@Transactional"),p("，当调用uploadFile方法前会开启数据库事务，如果上传文件过程时间较长那么数据库的事务持续时间就会变长，这样数据库链接释放就慢，最终导致数据库链接不够用。")],-1),vn=t("p",null,[p("我们只将addMediaFilesToDb方法添加事务控制即可,uploadFile方法上的"),t("code",null,"@Transactional"),p("注解去掉。")],-1),Mn=t("p",null,"优化后如下：",-1),jn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," MediaFiles "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),t("span",{style:{color:"#B392F0"}},"selectById"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles "),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"MediaFiles"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        BeanUtils."),t("span",{style:{color:"#B392F0"}},"copyProperties"),t("span",{style:{color:"#E1E4E8"}},"(uploadFileParamsDto,mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setId"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setCompanyId"),t("span",{style:{color:"#E1E4E8"}},"(companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setBucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//file_path")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setFilePath"),t("span",{style:{color:"#E1E4E8"}},"(objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//file_id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setFileId"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//url")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setUrl"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"bucket"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传时间")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setCreateDate"),t("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),t("span",{style:{color:"#B392F0"}},"now"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setStatus"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"1"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//审核状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        mediaFiles."),t("span",{style:{color:"#B392F0"}},"setAuditStatus"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"002003"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//插入数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," insert "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),t("span",{style:{color:"#B392F0"}},"insert"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(insert"),t("span",{style:{color:"#F97583"}},"<="),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),t("span",{style:{color:"#E1E4E8"}},",bucket,objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#B392F0"}},"addWaitingTask"),t("span",{style:{color:"#E1E4E8"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"保存文件信息到数据库成功,{}"'),t("span",{style:{color:"#E1E4E8"}},", mediaFiles."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mediaFiles;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," MediaFiles "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件信息保存到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFilesMapper."),t("span",{style:{color:"#6F42C1"}},"selectById"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(mediaFiles "),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"MediaFiles"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        BeanUtils."),t("span",{style:{color:"#6F42C1"}},"copyProperties"),t("span",{style:{color:"#24292E"}},"(uploadFileParamsDto,mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setId"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setCompanyId"),t("span",{style:{color:"#24292E"}},"(companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setBucket"),t("span",{style:{color:"#24292E"}},"(bucket);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//file_path")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setFilePath"),t("span",{style:{color:"#24292E"}},"(objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//file_id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setFileId"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//url")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setUrl"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"bucket"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传时间")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setCreateDate"),t("span",{style:{color:"#24292E"}},"(LocalDateTime."),t("span",{style:{color:"#6F42C1"}},"now"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setStatus"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"1"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//审核状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        mediaFiles."),t("span",{style:{color:"#6F42C1"}},"setAuditStatus"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"002003"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//插入数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," insert "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFilesMapper."),t("span",{style:{color:"#6F42C1"}},"insert"),t("span",{style:{color:"#24292E"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(insert"),t("span",{style:{color:"#D73A49"}},"<="),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"向数据库保存文件失败,bucket:{},objectName:{}"'),t("span",{style:{color:"#24292E"}},",bucket,objectName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//添加到待处理任务表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6F42C1"}},"addWaitingTask"),t("span",{style:{color:"#24292E"}},"(mediaFiles);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"保存文件信息到数据库成功,{}"'),t("span",{style:{color:"#24292E"}},", mediaFiles."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mediaFiles;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Pn=t("p",null,[p("我们人为在"),t("code",null,"int insert = mediaFilesMapper.insert(mediaFiles);"),p("下边添加一个异常代码"),t("code",null,"int a=1/0;")],-1),_n=t("p",null,"测试是否事务控制。很遗憾，事务控制失败。",-1),xn=t("p",null,[p("方法上已经添加了"),t("code",null,"@Transactional"),p("注解为什么该方法不能被事务控制呢？")],-1),In=t("p",null,[p("如果是在uploadFile方法上添加"),t("code",null,"@Transactional"),p("注解就可以控制事务，去掉则不行。")],-1),Tn=t("p",null,"现在的问题其实是一个非事务方法调同类一个事务方法，事务无法控制，这是为什么？",-1),On=t("p",null,"下边分析原因：",-1),Rn=t("p",null,[p("如果在uploadFile方法上添加"),t("code",null,"@Transactional"),p("注解，代理对象执行此方法前会开启事务，如下图：")],-1),wn=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps79.jpg"})],-1),Ln=t("p",null,[p("如果在uploadFile方法上没有"),t("code",null,"@Transactional"),p("注解，代理对象执行此方法前不进行事务控制，如下图：")],-1),Nn=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps80.jpg"})],-1),Un=t("p",null,[p("所以判断该方法是否可以事务控制必须保证是通过代理对象调用此方法，且此方法上添加了"),t("code",null,"@Transactional"),p("注解。")],-1),zn=t("p",null,[p("现在在addMediaFilesToDb方法上添加"),t("code",null,"@Transactional"),p("注解，也不会进行事务控制是因为并不是通过代理对象执行的addMediaFilesToDb方法。为了判断在uploadFile方法中去调用addMediaFilesToDb方法是否是通过代理对象去调用，我们可以打断点跟踪。")],-1),Kn=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps81.jpg"})],-1),qn=t("p",null,"我们发现在uploadFile方法中去调用addMediaFilesToDb方法不是通过代理对象去调用。",-1),Hn=t("p",null,"如何解决呢？通过代理对象去调用addMediaFilesToDb方法即可解决。",-1),Wn=t("p",null,"在MediaFileService的实现类中注入MediaFileService的代理对象，如下：",-1),Gn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"MediaFileService currentProxy;")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"MediaFileService currentProxy;")])])]),t("button",{class:"collapse"})],-1),$n=t("p",null,"将addMediaFilesToDb方法提成接口。",-1),Vn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," MediaFiles "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 将文件信息添加到文件表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}},"  上传文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"bucket"),t("span",{style:{color:"#6A737D"}},"  桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.media.model.po.MediaFiles")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," MediaFiles "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,UploadFileParamsDto uploadFileParamsDto,String bucket,String objectName);")])])]),t("button",{class:"collapse"})],-1),Xn=t("p",null,"调用addMediaFilesToDb方法的代码处改为如下：",-1),Jn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"..... ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//写入文件表 ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," currentProxy."),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);  ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"....")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"..... ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//写入文件表 ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," currentProxy."),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(companyId, fileMd5, uploadFileParamsDto, bucket_files, objectName);  ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"....")])])]),t("button",{class:"collapse"})],-1),Qn=t("p",null,"再次测试事务是否可以正常控制。",-1),Yn={id:"三-上传视频",tabindex:"-1"},Zn=t("strong",null,"三 上传视频",-1),sa={id:"_3-1-需求分析",tabindex:"-1"},la=t("strong",null,"3.1 需求分析",-1),oa=t("p",null,"1、教学机构人员进入媒资管理列表查询自己上传的媒资文件。",-1),na=t("p",null,"点击“媒资管理”",-1),aa=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps82.jpg"})],-1),ea=t("p",null,"进入媒资管理列表页面查询本机构上传的媒资文件。",-1),ca=t("figure",null,[t("img",{alt:"image-20230704231746909",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704231746909.png"})],-1),ta=t("p",null,'2、教育机构用户在"媒资管理"页面中点击 "上传视频" 按钮。',-1),pa=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps84.jpg"})],-1),ra=t("p",null,"点击“上传视频”打开上传页面",-1),Ea=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps85.jpg"})],-1),ya=t("p",null,"3、选择要上传的文件，自动执行文件上传。",-1),ia=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps86.jpg"})],-1),Fa=t("p",null,"4、视频上传成功会自动处理，处理完成可以预览视频。",-1),ua=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps87.jpg"})],-1),da={id:"_3-2-断点续传技术",tabindex:"-1"},ma=t("strong",null,"3.2 断点续传技术",-1),Da={id:"_3-2-1-什么是断点续传",tabindex:"-1"},Aa=t("strong",null,"3.2.1 什么是断点续传",-1),ga=t("p",null,"通常视频文件都比较大，所以对于媒资系统上传文件的需求要满足大文件的上传要求。http协议本身对上传文件大小没有限制，但是客户的网络环境质量、电脑硬件环境等参差不齐，如果一个大文件快上传完了网断了没有上传完成，需要客户重新上传，用户体验非常差，所以对于大文件上传的要求最基本的是断点续传。",-1),ha=t("p",null,"什么是断点续传：",-1),Ca=t("p",null,"​ 引用百度百科：断点续传指的是在下载或上传时，将下载或上传任务（一个文件或一个压缩包）人为的划分为几个部分，每一个部分采用一个线程进行上传或下载，如果碰到网络故障，可以从已经上传或下载的部分开始继续上传下载未完成的部分，而没有必要从头开始上传下载，断点续传可以提高节省操作时间，提高用户体验性。",-1),ba=t("p",null,"断点续传流程如下图：",-1),Ba=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps88.jpg"})],-1),fa=t("p",null,"流程如下：",-1),ka=t("p",null,"1、前端上传前先把文件分成块",-1),Sa=t("p",null,"2、一块一块的上传，上传中断后重新上传，已上传的分块则不用再上传",-1),va=t("p",null,"3、各分块上传完成最后在服务端合并文件",-1),Ma={id:"_3-2-2-分块与合并测试",tabindex:"-1"},ja=t("strong",null,"3.2.2 分块与合并测试",-1),Pa=t("p",null,"为了更好的理解文件分块上传的原理，下边用java代码测试文件的分块与合并。",-1),_a=t("p",null,"文件分块的流程如下：",-1),xa=t("p",null,"1、获取源文件长度",-1),Ia=t("p",null,"2、根据设定的分块文件的大小计算出块数",-1),Ta=t("p",null,"3、从源文件读数据依次向每一个块文件写数据。",-1),Oa=t("p",null,"测试代码如下：",-1),Ra=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@author"),t("span",{style:{color:"#6A737D"}}," Klaus")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @date 2023/06/23 19:43")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 测试大文件上传方法")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"BigFileTest"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//分块测试")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"testChunk"),t("span",{style:{color:"#E1E4E8"}},"() "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//源文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        File sourceFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1.mkv"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//分块文件存储路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String chunkFilePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"chunk"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//分块文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//long chunkSize = 1024 * 1024 * 1;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkSize "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"1024"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"*"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"1024"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"*"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"5"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//分块文件个数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkNum "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," ("),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}},") Math."),t("span",{style:{color:"#B392F0"}},"ceil"),t("span",{style:{color:"#E1E4E8"}},"(sourceFile."),t("span",{style:{color:"#B392F0"}},"length"),t("span",{style:{color:"#E1E4E8"}},"() "),t("span",{style:{color:"#F97583"}},"*"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"1.0"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}}," chunkSize);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//使用流从源文件读数据，向分块文件中写数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        RandomAccessFile raf_r "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RandomAccessFile"),t("span",{style:{color:"#E1E4E8"}},"(sourceFile, "),t("span",{style:{color:"#9ECBFF"}},'"r"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//缓存区")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"byte"),t("span",{style:{color:"#E1E4E8"}},"[] bytes "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"byte"),t("span",{style:{color:"#E1E4E8"}},"["),t("span",{style:{color:"#79B8FF"}},"1024"),t("span",{style:{color:"#E1E4E8"}},"];")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"for"),t("span",{style:{color:"#E1E4E8"}}," ("),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," i "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},"; i "),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}}," chunkNum; i"),t("span",{style:{color:"#F97583"}},"++"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            File chunkFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"(chunkFilePath "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," i);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//分块文件写入流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            RandomAccessFile raf_rw "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RandomAccessFile"),t("span",{style:{color:"#E1E4E8"}},"(chunkFile, "),t("span",{style:{color:"#9ECBFF"}},'"rw"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," len "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"-"),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"while"),t("span",{style:{color:"#E1E4E8"}}," ((len"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"raf_r."),t("span",{style:{color:"#B392F0"}},"read"),t("span",{style:{color:"#E1E4E8"}},"(bytes))"),t("span",{style:{color:"#F97583"}},"!=-"),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                raf_rw."),t("span",{style:{color:"#B392F0"}},"write"),t("span",{style:{color:"#E1E4E8"}},"(bytes,"),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},",len);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(chunkFile."),t("span",{style:{color:"#B392F0"}},"length"),t("span",{style:{color:"#E1E4E8"}},"()"),t("span",{style:{color:"#F97583"}},">="),t("span",{style:{color:"#E1E4E8"}},"chunkSize){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    "),t("span",{style:{color:"#F97583"}},"break"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            raf_rw."),t("span",{style:{color:"#B392F0"}},"close"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        raf_r."),t("span",{style:{color:"#B392F0"}},"close"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@author"),t("span",{style:{color:"#6A737D"}}," Klaus")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @date 2023/06/23 19:43")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 测试大文件上传方法")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"BigFileTest"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//分块测试")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"testChunk"),t("span",{style:{color:"#24292E"}},"() "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//源文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        File sourceFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1.mkv"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//分块文件存储路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String chunkFilePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"chunk"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//分块文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//long chunkSize = 1024 * 1024 * 1;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkSize "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"1024"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"*"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"1024"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"*"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"5"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//分块文件个数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkNum "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," ("),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}},") Math."),t("span",{style:{color:"#6F42C1"}},"ceil"),t("span",{style:{color:"#24292E"}},"(sourceFile."),t("span",{style:{color:"#6F42C1"}},"length"),t("span",{style:{color:"#24292E"}},"() "),t("span",{style:{color:"#D73A49"}},"*"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"1.0"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}}," chunkSize);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//使用流从源文件读数据，向分块文件中写数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        RandomAccessFile raf_r "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),t("span",{style:{color:"#24292E"}},"(sourceFile, "),t("span",{style:{color:"#032F62"}},'"r"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//缓存区")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"byte"),t("span",{style:{color:"#24292E"}},"[] bytes "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"byte"),t("span",{style:{color:"#24292E"}},"["),t("span",{style:{color:"#005CC5"}},"1024"),t("span",{style:{color:"#24292E"}},"];")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"for"),t("span",{style:{color:"#24292E"}}," ("),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," i "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},"; i "),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}}," chunkNum; i"),t("span",{style:{color:"#D73A49"}},"++"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            File chunkFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"(chunkFilePath "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," i);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//分块文件写入流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            RandomAccessFile raf_rw "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),t("span",{style:{color:"#24292E"}},"(chunkFile, "),t("span",{style:{color:"#032F62"}},'"rw"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," len "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"-"),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"while"),t("span",{style:{color:"#24292E"}}," ((len"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"raf_r."),t("span",{style:{color:"#6F42C1"}},"read"),t("span",{style:{color:"#24292E"}},"(bytes))"),t("span",{style:{color:"#D73A49"}},"!=-"),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                raf_rw."),t("span",{style:{color:"#6F42C1"}},"write"),t("span",{style:{color:"#24292E"}},"(bytes,"),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},",len);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(chunkFile."),t("span",{style:{color:"#6F42C1"}},"length"),t("span",{style:{color:"#24292E"}},"()"),t("span",{style:{color:"#D73A49"}},">="),t("span",{style:{color:"#24292E"}},"chunkSize){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    "),t("span",{style:{color:"#D73A49"}},"break"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            raf_rw."),t("span",{style:{color:"#6F42C1"}},"close"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        raf_r."),t("span",{style:{color:"#6F42C1"}},"close"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),wa=t("p",null,"文件合并流程：",-1),La=t("p",null,"1、找到要合并的文件并按文件合并的先后进行排序。",-1),Na=t("p",null,"2、创建合并文件",-1),Ua=t("p",null,"3、依次从合并的文件中读取数据向合并文件写入数",-1),za=t("p",null,"文件合并的测试代码 ：",-1),Ka=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//将分块进行合并")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"testMerge"),t("span",{style:{color:"#E1E4E8"}},"() throws IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//块文件目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File chunkFolder "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'chunk"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//源文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File sourceFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1.mkv"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并后的文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File mergeFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"File"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'1_1.mkv"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出所有分块文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"File"),t("span",{style:{color:"#E1E4E8"}},"[] files "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," chunkFolder."),t("span",{style:{color:"#B392F0"}},"listFiles"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将数组转成list")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    List<"),t("span",{style:{color:"#F97583"}},"File"),t("span",{style:{color:"#E1E4E8"}},"> filesList "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," Arrays."),t("span",{style:{color:"#B392F0"}},"asList"),t("span",{style:{color:"#E1E4E8"}},"(files);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//对分块文件排序")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Collections."),t("span",{style:{color:"#B392F0"}},"sort"),t("span",{style:{color:"#E1E4E8"}},"(filesList, "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," Comparator<"),t("span",{style:{color:"#F97583"}},"File"),t("span",{style:{color:"#E1E4E8"}},">() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"compare"),t("span",{style:{color:"#E1E4E8"}},"(File "),t("span",{style:{color:"#FFAB70"}},"o1"),t("span",{style:{color:"#E1E4E8"}},", File "),t("span",{style:{color:"#FFAB70"}},"o2"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," Integer."),t("span",{style:{color:"#B392F0"}},"parseInt"),t("span",{style:{color:"#E1E4E8"}},"(o1."),t("span",{style:{color:"#B392F0"}},"getName"),t("span",{style:{color:"#E1E4E8"}},"())"),t("span",{style:{color:"#F97583"}},"-"),t("span",{style:{color:"#E1E4E8"}},"Integer."),t("span",{style:{color:"#B392F0"}},"parseInt"),t("span",{style:{color:"#E1E4E8"}},"(o2."),t("span",{style:{color:"#B392F0"}},"getName"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//向合并文件写的流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    RandomAccessFile raf_rw "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RandomAccessFile"),t("span",{style:{color:"#E1E4E8"}},"(mergeFile, "),t("span",{style:{color:"#9ECBFF"}},'"rw"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//缓存区")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"byte"),t("span",{style:{color:"#E1E4E8"}},"[] bytes "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"byte"),t("span",{style:{color:"#E1E4E8"}},"["),t("span",{style:{color:"#79B8FF"}},"1024"),t("span",{style:{color:"#E1E4E8"}},"];")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//遍历分块文件，向合并 的文件写")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"for"),t("span",{style:{color:"#E1E4E8"}}," (File file "),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," filesList) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//读分块的流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        RandomAccessFile raf_r "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RandomAccessFile"),t("span",{style:{color:"#E1E4E8"}},"(file, "),t("span",{style:{color:"#9ECBFF"}},'"r"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," len "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"-"),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"while"),t("span",{style:{color:"#E1E4E8"}}," ((len"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"raf_r."),t("span",{style:{color:"#B392F0"}},"read"),t("span",{style:{color:"#E1E4E8"}},"(bytes))"),t("span",{style:{color:"#F97583"}},"!=-"),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            raf_rw."),t("span",{style:{color:"#B392F0"}},"write"),t("span",{style:{color:"#E1E4E8"}},"(bytes,"),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},",len);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        raf_r."),t("span",{style:{color:"#B392F0"}},"close"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    raf_rw."),t("span",{style:{color:"#B392F0"}},"close"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并文件完成后对合并的文件md5校验")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream_merge "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileInputStream"),t("span",{style:{color:"#E1E4E8"}},"(mergeFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    FileInputStream fileInputStream_source "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileInputStream"),t("span",{style:{color:"#E1E4E8"}},"(sourceFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String md5_merge "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," DigestUtils."),t("span",{style:{color:"#B392F0"}},"md5Hex"),t("span",{style:{color:"#E1E4E8"}},"(fileInputStream_merge);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String md5_source "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," DigestUtils."),t("span",{style:{color:"#B392F0"}},"md5Hex"),t("span",{style:{color:"#E1E4E8"}},"(fileInputStream_source);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(md5_merge."),t("span",{style:{color:"#B392F0"}},"equals"),t("span",{style:{color:"#E1E4E8"}},"(md5_source)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"文件合并成功"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//将分块进行合并")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"testMerge"),t("span",{style:{color:"#24292E"}},"() throws IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//块文件目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File chunkFolder "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'chunk"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//源文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File sourceFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1.mkv"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并后的文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File mergeFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"File"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'1_1.mkv"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出所有分块文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"File"),t("span",{style:{color:"#24292E"}},"[] files "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," chunkFolder."),t("span",{style:{color:"#6F42C1"}},"listFiles"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将数组转成list")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    List<"),t("span",{style:{color:"#D73A49"}},"File"),t("span",{style:{color:"#24292E"}},"> filesList "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," Arrays."),t("span",{style:{color:"#6F42C1"}},"asList"),t("span",{style:{color:"#24292E"}},"(files);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//对分块文件排序")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Collections."),t("span",{style:{color:"#6F42C1"}},"sort"),t("span",{style:{color:"#24292E"}},"(filesList, "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," Comparator<"),t("span",{style:{color:"#D73A49"}},"File"),t("span",{style:{color:"#24292E"}},">() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"compare"),t("span",{style:{color:"#24292E"}},"(File "),t("span",{style:{color:"#E36209"}},"o1"),t("span",{style:{color:"#24292E"}},", File "),t("span",{style:{color:"#E36209"}},"o2"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," Integer."),t("span",{style:{color:"#6F42C1"}},"parseInt"),t("span",{style:{color:"#24292E"}},"(o1."),t("span",{style:{color:"#6F42C1"}},"getName"),t("span",{style:{color:"#24292E"}},"())"),t("span",{style:{color:"#D73A49"}},"-"),t("span",{style:{color:"#24292E"}},"Integer."),t("span",{style:{color:"#6F42C1"}},"parseInt"),t("span",{style:{color:"#24292E"}},"(o2."),t("span",{style:{color:"#6F42C1"}},"getName"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//向合并文件写的流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    RandomAccessFile raf_rw "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),t("span",{style:{color:"#24292E"}},"(mergeFile, "),t("span",{style:{color:"#032F62"}},'"rw"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//缓存区")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"byte"),t("span",{style:{color:"#24292E"}},"[] bytes "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"byte"),t("span",{style:{color:"#24292E"}},"["),t("span",{style:{color:"#005CC5"}},"1024"),t("span",{style:{color:"#24292E"}},"];")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//遍历分块文件，向合并 的文件写")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"for"),t("span",{style:{color:"#24292E"}}," (File file "),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," filesList) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//读分块的流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        RandomAccessFile raf_r "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RandomAccessFile"),t("span",{style:{color:"#24292E"}},"(file, "),t("span",{style:{color:"#032F62"}},'"r"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," len "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"-"),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"while"),t("span",{style:{color:"#24292E"}}," ((len"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"raf_r."),t("span",{style:{color:"#6F42C1"}},"read"),t("span",{style:{color:"#24292E"}},"(bytes))"),t("span",{style:{color:"#D73A49"}},"!=-"),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            raf_rw."),t("span",{style:{color:"#6F42C1"}},"write"),t("span",{style:{color:"#24292E"}},"(bytes,"),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},",len);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        raf_r."),t("span",{style:{color:"#6F42C1"}},"close"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    raf_rw."),t("span",{style:{color:"#6F42C1"}},"close"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并文件完成后对合并的文件md5校验")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream_merge "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileInputStream"),t("span",{style:{color:"#24292E"}},"(mergeFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    FileInputStream fileInputStream_source "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileInputStream"),t("span",{style:{color:"#24292E"}},"(sourceFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String md5_merge "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," DigestUtils."),t("span",{style:{color:"#6F42C1"}},"md5Hex"),t("span",{style:{color:"#24292E"}},"(fileInputStream_merge);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String md5_source "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," DigestUtils."),t("span",{style:{color:"#6F42C1"}},"md5Hex"),t("span",{style:{color:"#24292E"}},"(fileInputStream_source);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(md5_merge."),t("span",{style:{color:"#6F42C1"}},"equals"),t("span",{style:{color:"#24292E"}},"(md5_source)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"文件合并成功"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),qa={id:"_3-2-3-视频上传流程",tabindex:"-1"},Ha=t("strong",null,"3.2.3 视频上传流程",-1),Wa=t("p",null,"下图是上传视频的整体流程：",-1),Ga=t("figure",null,[t("img",{alt:"image-20230704232249335",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230704232249335.png"})],-1),$a=t("p",null,"1、前端对文件进行分块。",-1),Va=t("p",null,"2、前端上传分块文件前请求媒资服务检查文件是否存在，如果已经存在则不再上传。",-1),Xa=t("p",null,"3、如果分块文件不存在则前端开始上传",-1),Ja=t("p",null,"4、前端请求媒资服务上传分块。",-1),Qa=t("p",null,"5、媒资服务将分块上传至MinIO。",-1),Ya=t("p",null,"6、前端将分块上传完毕请求媒资服务合并分块。",-1),Za=t("p",null,"7、媒资服务判断分块上传完成则请求MinIO合并文件。",-1),se=t("p",null,"8、合并完成校验合并后的文件是否完整，如果完整则上传完成，否则删除文件。",-1),le={id:"_3-2-4-minio合并文件测试",tabindex:"-1"},oe=t("strong",null,"3.2.4 minio合并文件测试",-1),ne=t("p",null,"1、将分块文件上传至minio",-1),ae=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//将分块文件上传到minio")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"uploadChunk"),t("span",{style:{color:"#E1E4E8"}},"() throws IOException,  InsufficientDataException, ErrorResponseException, NoSuchAlgorithmException,  InvalidResponseException, XmlParserException, InternalException, ServerException, InvalidKeyException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"for"),t("span",{style:{color:"#E1E4E8"}}," ("),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," i "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},"; i "),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"3"),t("span",{style:{color:"#E1E4E8"}},"; i"),t("span",{style:{color:"#F97583"}},"++"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UploadObjectArgs uploadObjectArgs "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," UploadObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"filename"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"D:'),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"Learning"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"upload"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},"chunk"),t("span",{style:{color:"#79B8FF"}},"\\\\"),t("span",{style:{color:"#9ECBFF"}},'"'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"i) "),t("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunk/"'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"i)"),t("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        minioClient."),t("span",{style:{color:"#B392F0"}},"uploadObject"),t("span",{style:{color:"#E1E4E8"}},"(uploadObjectArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传分块"'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"i"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#9ECBFF"}},'"成功"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//将分块文件上传到minio")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"uploadChunk"),t("span",{style:{color:"#24292E"}},"() throws IOException,  InsufficientDataException, ErrorResponseException, NoSuchAlgorithmException,  InvalidResponseException, XmlParserException, InternalException, ServerException, InvalidKeyException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"for"),t("span",{style:{color:"#24292E"}}," ("),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," i "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},"; i "),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"3"),t("span",{style:{color:"#24292E"}},"; i"),t("span",{style:{color:"#D73A49"}},"++"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件的参数信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UploadObjectArgs uploadObjectArgs "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," UploadObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"filename"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"D:'),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"Learning"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"upload"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},"chunk"),t("span",{style:{color:"#005CC5"}},"\\\\"),t("span",{style:{color:"#032F62"}},'"'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"i) "),t("span",{style:{color:"#6A737D"}},"//指定本地文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunk/"'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"i)"),t("span",{style:{color:"#6A737D"}},"//对象名 放在子目录下")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//上传文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        minioClient."),t("span",{style:{color:"#6F42C1"}},"uploadObject"),t("span",{style:{color:"#24292E"}},"(uploadObjectArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传分块"'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"i"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#032F62"}},'"成功"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),ee=t("p",null,"2、通过minio的合并文件",-1),ce=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//合并文件，要求分块文件最小5M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"testMerge"),t("span",{style:{color:"#E1E4E8"}},"() throws Exception {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        List<ComposeSource> sources = new ArrayList<>();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        for (int i = 0; i < 30; i++) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//            //指定分块文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//            ComposeSource composeSource = ComposeSource.builder().bucket("testbucket").object("chunk/" + i).build();')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//            sources.add(composeSource);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        List<"),t("span",{style:{color:"#F97583"}},"ComposeSource"),t("span",{style:{color:"#E1E4E8"}},"> sources "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," Stream."),t("span",{style:{color:"#B392F0"}},"iterate"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},", i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"++"),t("span",{style:{color:"#E1E4E8"}},"i)."),t("span",{style:{color:"#B392F0"}},"limit"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"3"),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"map"),t("span",{style:{color:"#E1E4E8"}},"(i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," ComposeSource."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunk/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," i)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"())."),t("span",{style:{color:"#B392F0"}},"collect"),t("span",{style:{color:"#E1E4E8"}},"(Collectors."),t("span",{style:{color:"#B392F0"}},"toList"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//指定合并后的objectName等信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ComposeObjectArgs composeObjectArgs "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," ComposeObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"merge01.mp4"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"sources"),t("span",{style:{color:"#E1E4E8"}},"(sources)"),t("span",{style:{color:"#6A737D"}},"//指定源文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//合并文件,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//报错size 1048576 must be greater than 5242880，minio默认的分块文件大小为5M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        minioClient."),t("span",{style:{color:"#B392F0"}},"composeObject"),t("span",{style:{color:"#E1E4E8"}},"(composeObjectArgs);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//清除分块文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"test_removeObjects"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并分块完成将分块文件清除")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    List<"),t("span",{style:{color:"#F97583"}},"DeleteObject"),t("span",{style:{color:"#E1E4E8"}},"> deleteObjects "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," Stream."),t("span",{style:{color:"#B392F0"}},"iterate"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},", i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"++"),t("span",{style:{color:"#E1E4E8"}},"i)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            ."),t("span",{style:{color:"#B392F0"}},"limit"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"6"),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            ."),t("span",{style:{color:"#B392F0"}},"map"),t("span",{style:{color:"#E1E4E8"}},"(i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"DeleteObject"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunk/"'),t("span",{style:{color:"#E1E4E8"}},"."),t("span",{style:{color:"#B392F0"}},"concat"),t("span",{style:{color:"#E1E4E8"}},"(Integer."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"(i))))")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            ."),t("span",{style:{color:"#B392F0"}},"collect"),t("span",{style:{color:"#E1E4E8"}},"(Collectors."),t("span",{style:{color:"#B392F0"}},"toList"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    RemoveObjectsArgs removeObjectsArgs "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," RemoveObjectsArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"testbucket"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"objects"),t("span",{style:{color:"#E1E4E8"}},"(deleteObjects)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Iterable<Result<"),t("span",{style:{color:"#F97583"}},"DeleteError"),t("span",{style:{color:"#E1E4E8"}},">> results "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," minioClient."),t("span",{style:{color:"#B392F0"}},"removeObjects"),t("span",{style:{color:"#E1E4E8"}},"(removeObjectsArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    results."),t("span",{style:{color:"#B392F0"}},"forEach"),t("span",{style:{color:"#E1E4E8"}},"(r"),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        DeleteError deleteError "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            deleteError "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," r."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//合并文件，要求分块文件最小5M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"testMerge"),t("span",{style:{color:"#24292E"}},"() throws Exception {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        List<ComposeSource> sources = new ArrayList<>();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        for (int i = 0; i < 30; i++) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//            //指定分块文件的信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//            ComposeSource composeSource = ComposeSource.builder().bucket("testbucket").object("chunk/" + i).build();')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//            sources.add(composeSource);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        List<"),t("span",{style:{color:"#D73A49"}},"ComposeSource"),t("span",{style:{color:"#24292E"}},"> sources "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," Stream."),t("span",{style:{color:"#6F42C1"}},"iterate"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},", i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"++"),t("span",{style:{color:"#24292E"}},"i)."),t("span",{style:{color:"#6F42C1"}},"limit"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"3"),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"map"),t("span",{style:{color:"#24292E"}},"(i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," ComposeSource."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunk/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," i)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"())."),t("span",{style:{color:"#6F42C1"}},"collect"),t("span",{style:{color:"#24292E"}},"(Collectors."),t("span",{style:{color:"#6F42C1"}},"toList"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//指定合并后的objectName等信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ComposeObjectArgs composeObjectArgs "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," ComposeObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"merge01.mp4"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"sources"),t("span",{style:{color:"#24292E"}},"(sources)"),t("span",{style:{color:"#6A737D"}},"//指定源文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//合并文件,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//报错size 1048576 must be greater than 5242880，minio默认的分块文件大小为5M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        minioClient."),t("span",{style:{color:"#6F42C1"}},"composeObject"),t("span",{style:{color:"#24292E"}},"(composeObjectArgs);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//清除分块文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Test")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"test_removeObjects"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并分块完成将分块文件清除")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    List<"),t("span",{style:{color:"#D73A49"}},"DeleteObject"),t("span",{style:{color:"#24292E"}},"> deleteObjects "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," Stream."),t("span",{style:{color:"#6F42C1"}},"iterate"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},", i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"++"),t("span",{style:{color:"#24292E"}},"i)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            ."),t("span",{style:{color:"#6F42C1"}},"limit"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"6"),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            ."),t("span",{style:{color:"#6F42C1"}},"map"),t("span",{style:{color:"#24292E"}},"(i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"DeleteObject"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunk/"'),t("span",{style:{color:"#24292E"}},"."),t("span",{style:{color:"#6F42C1"}},"concat"),t("span",{style:{color:"#24292E"}},"(Integer."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"(i))))")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            ."),t("span",{style:{color:"#6F42C1"}},"collect"),t("span",{style:{color:"#24292E"}},"(Collectors."),t("span",{style:{color:"#6F42C1"}},"toList"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    RemoveObjectsArgs removeObjectsArgs "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," RemoveObjectsArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"testbucket"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"objects"),t("span",{style:{color:"#24292E"}},"(deleteObjects)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Iterable<Result<"),t("span",{style:{color:"#D73A49"}},"DeleteError"),t("span",{style:{color:"#24292E"}},">> results "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," minioClient."),t("span",{style:{color:"#6F42C1"}},"removeObjects"),t("span",{style:{color:"#24292E"}},"(removeObjectsArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    results."),t("span",{style:{color:"#6F42C1"}},"forEach"),t("span",{style:{color:"#24292E"}},"(r"),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        DeleteError deleteError "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            deleteError "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," r."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),te=t("p",null,[p("使用minio合并文件报错："),t("code",null,"java.lang.IllegalArgumentException: source testbucket/chunk/0: size 1048576 must be greater than 5242880")],-1),pe=t("p",null,"minio合并文件默认分块最小5M，我们将分块改为5M再次测试。",-1),re={id:"_3-3-接口定义",tabindex:"-1"},Ee=t("strong",null,"3.3 接口定义",-1),ye=t("p",null,[p("根据上传视频流程，定义接口，与前端的约定是操作成功返回"),t("code",null,"{code:0}"),p("否则返回"),t("code",null,"{code:-1}")],-1),ie=t("p",null,[p("从课程资料中拷贝"),t("code",null,"RestResponse.java"),p("类到base工程下的model包下。")],-1),Fe=t("p",null,"定义接口如下：",-1),ue=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Api"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"大文件上传接口"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"tags"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"大文件上传接口"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"BigFilesController"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"文件上传前检查文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/checkfile"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse<"),t("span",{style:{color:"#F97583"}},"Boolean"),t("span",{style:{color:"#E1E4E8"}},"> "),t("span",{style:{color:"#B392F0"}},"checkfile"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"fileMd5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ) "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"分块文件上传前的检测"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/checkchunk"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse<"),t("span",{style:{color:"#F97583"}},"Boolean"),t("span",{style:{color:"#E1E4E8"}},"> "),t("span",{style:{color:"#B392F0"}},"checkchunk"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                            @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunk"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#FFAB70"}},"chunk"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"       "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"上传分块文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/uploadchunk"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"uploadchunk"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"file"'),t("span",{style:{color:"#E1E4E8"}},") MultipartFile "),t("span",{style:{color:"#FFAB70"}},"file"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                    @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                    @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunk"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#FFAB70"}},"chunk"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"合并文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/mergechunks"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"mergechunks"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                    @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileName"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"fileName"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                    @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunkTotal"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#FFAB70"}},"chunkTotal"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Api"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"大文件上传接口"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"tags"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"大文件上传接口"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"BigFilesController"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"文件上传前检查文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/checkfile"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse<"),t("span",{style:{color:"#D73A49"}},"Boolean"),t("span",{style:{color:"#24292E"}},"> "),t("span",{style:{color:"#6F42C1"}},"checkfile"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"fileMd5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ) "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"分块文件上传前的检测"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/checkchunk"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse<"),t("span",{style:{color:"#D73A49"}},"Boolean"),t("span",{style:{color:"#24292E"}},"> "),t("span",{style:{color:"#6F42C1"}},"checkchunk"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                            @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunk"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#E36209"}},"chunk"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"       "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"上传分块文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/uploadchunk"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"uploadchunk"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"file"'),t("span",{style:{color:"#24292E"}},") MultipartFile "),t("span",{style:{color:"#E36209"}},"file"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                    @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                    @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunk"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#E36209"}},"chunk"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"合并文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/mergechunks"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"mergechunks"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                    @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileName"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"fileName"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                    @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunkTotal"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#E36209"}},"chunkTotal"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),de={id:"_3-4-上传分块开发",tabindex:"-1"},me=t("strong",null,"3.4 上传分块开发",-1),De={id:"_3-4-1-dao开发",tabindex:"-1"},Ae=t("strong",null,"3.4.1 DAO开发",-1),ge=t("p",null,"向媒资数据库的文件表插入记录，使用自动生成的Mapper接口即可满足要求。",-1),he={id:"_3-4-2-service开发",tabindex:"-1"},Ce=t("strong",null,"3.4.2 Service开发",-1),be={id:"_3-4-2-1-检查文件和分块",tabindex:"-1"},Be=t("strong",null,"3.4.2.1 检查文件和分块",-1),fe=t("p",null,"接口完成进行接口实现，首先实现检查文件方法和检查分块方法。",-1),ke=t("p",null,"在MediaFileService中定义service接口如下：",-1),Se=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 检查文件是否存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}}," 文件的md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"Boolean"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"checkFile"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 检查分块是否存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件的md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"chunkIndex"),t("span",{style:{color:"#6A737D"}},"  分块序号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"Boolean"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"checkChunk"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5, "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkIndex);")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 检查文件是否存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}}," 文件的md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"Boolean"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"checkFile"),t("span",{style:{color:"#24292E"}},"(String fileMd5);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 检查分块是否存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件的md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"chunkIndex"),t("span",{style:{color:"#6A737D"}},"  分块序号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse<java.lang.Boolean> false不存在，true存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"Boolean"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"checkChunk"),t("span",{style:{color:"#24292E"}},"(String fileMd5, "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkIndex);")])])]),t("button",{class:"collapse"})],-1),ve=t("p",null,"service接口实现方法：",-1),Me=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"Boolean"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"checkFile"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//查询文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFilesMapper."),t("span",{style:{color:"#B392F0"}},"selectById"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," (mediaFiles "),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String bucket "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFiles."),t("span",{style:{color:"#B392F0"}},"getBucket"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//存储目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String filePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," mediaFiles."),t("span",{style:{color:"#B392F0"}},"getFilePath"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        InputStream stream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            stream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," minioClient."),t("span",{style:{color:"#B392F0"}},"getObject"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    GetObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                            ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                            ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"(filePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                            ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," (stream "),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#6A737D"}},"//文件已存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"success"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"           ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"success"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"Boolean"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"checkChunk"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5, "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkIndex) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String chunkFileFolderPath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String chunkFilePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," chunkFileFolderPath "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," chunkIndex;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    InputStream fileInputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        fileInputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," minioClient."),t("span",{style:{color:"#B392F0"}},"getObject"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                GetObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                        ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                        ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"(chunkFilePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                        ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," (fileInputStream "),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//分块已存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"success"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//分块未存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"success"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//得到分块文件的目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," fileMd5."),t("span",{style:{color:"#B392F0"}},"substring"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," fileMd5."),t("span",{style:{color:"#B392F0"}},"substring"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"2"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," fileMd5 "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"chunk"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"Boolean"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"checkFile"),t("span",{style:{color:"#24292E"}},"(String fileMd5) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//查询文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    MediaFiles mediaFiles "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFilesMapper."),t("span",{style:{color:"#6F42C1"}},"selectById"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," (mediaFiles "),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String bucket "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFiles."),t("span",{style:{color:"#6F42C1"}},"getBucket"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//存储目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String filePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," mediaFiles."),t("span",{style:{color:"#6F42C1"}},"getFilePath"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        InputStream stream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            stream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," minioClient."),t("span",{style:{color:"#6F42C1"}},"getObject"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    GetObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                            ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"(bucket)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                            ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"(filePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                            ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," (stream "),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#6A737D"}},"//文件已存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"success"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"           ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"success"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"Boolean"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"checkChunk"),t("span",{style:{color:"#24292E"}},"(String fileMd5, "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkIndex) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String chunkFileFolderPath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String chunkFilePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," chunkFileFolderPath "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," chunkIndex;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件流")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    InputStream fileInputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        fileInputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," minioClient."),t("span",{style:{color:"#6F42C1"}},"getObject"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                GetObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                        ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"(bucket_videoFiles)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                        ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"(chunkFilePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                        ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," (fileInputStream "),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//分块已存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"success"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//分块未存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"success"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//得到分块文件的目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),t("span",{style:{color:"#24292E"}},"(String fileMd5) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," fileMd5."),t("span",{style:{color:"#6F42C1"}},"substring"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," fileMd5."),t("span",{style:{color:"#6F42C1"}},"substring"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"2"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," fileMd5 "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"chunk"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),je={id:"_3-4-2-2-上传分块",tabindex:"-1"},Pe=t("strong",null,"3.4.2.2 上传分块",-1),_e=t("p",null,"定义service接口",-1),xe=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 上传分块")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"chunk"),t("span",{style:{color:"#6A737D"}},"  分块序号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"localChunkFilePath"),t("span",{style:{color:"#6A737D"}},"  分块文件本地路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"uploadChunk"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5,"),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunk,String localChunkFilePath);")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 上传分块")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"chunk"),t("span",{style:{color:"#6A737D"}},"  分块序号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"localChunkFilePath"),t("span",{style:{color:"#6A737D"}},"  分块文件本地路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"uploadChunk"),t("span",{style:{color:"#24292E"}},"(String fileMd5,"),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunk,String localChunkFilePath);")])])]),t("button",{class:"collapse"})],-1),Ie=t("p",null,"接口实现：",-1),Te=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"uploadChunk"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5, "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunk, String localChunkFilePath) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件的目录路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String chunkFileFolderPath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String chunkFilePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," chunkFileFolderPath "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," chunk;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String mimeType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getMimeType"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件存储至minIO")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," b "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#E1E4E8"}},"(localChunkFilePath, mimeType, bucket_videoFiles, chunkFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," ("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"b) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传分块文件失败:{}"'),t("span",{style:{color:"#E1E4E8"}},", chunkFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"validfail"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"上传分块失败"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"上传分块文件成功:{}"'),t("span",{style:{color:"#E1E4E8"}},",chunkFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"success"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"uploadChunk"),t("span",{style:{color:"#24292E"}},"(String fileMd5, "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunk, String localChunkFilePath) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件的目录路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String chunkFileFolderPath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//得到分块文件的路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String chunkFilePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," chunkFileFolderPath "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," chunk;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//mimeType")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String mimeType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getMimeType"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将文件存储至minIO")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," b "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToMinIO"),t("span",{style:{color:"#24292E"}},"(localChunkFilePath, mimeType, bucket_videoFiles, chunkFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," ("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"b) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传分块文件失败:{}"'),t("span",{style:{color:"#24292E"}},", chunkFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"validfail"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"上传分块失败"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"上传分块文件成功:{}"'),t("span",{style:{color:"#24292E"}},",chunkFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"success"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Oe={id:"_3-4-2-3-上传分块测试",tabindex:"-1"},Re=t("strong",null,"3.4.2.3 上传分块测试",-1),we=t("p",null,"完善接口层：",-1),Le=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"文件上传前检查文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/checkfile"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"Boolean"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"checkfile"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String fileMd5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},") throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mediaFileService."),t("span",{style:{color:"#B392F0"}},"checkFile"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"分块文件上传前的检测"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/checkchunk"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"Boolean"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"checkchunk"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String fileMd5,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                        @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunk"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunk) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mediaFileService."),t("span",{style:{color:"#B392F0"}},"checkChunk"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5,chunk);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"上传分块文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/uploadchunk"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"uploadchunk"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"file"'),t("span",{style:{color:"#E1E4E8"}},") MultipartFile file,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String fileMd5,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunk"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunk) throws Exception {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//创建临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File tempFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," File."),t("span",{style:{color:"#B392F0"}},"createTempFile"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"minio"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"temp"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    file."),t("span",{style:{color:"#B392F0"}},"transferTo"),t("span",{style:{color:"#E1E4E8"}},"(tempFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String absolutePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," tempFile."),t("span",{style:{color:"#B392F0"}},"getAbsolutePath"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mediaFileService."),t("span",{style:{color:"#B392F0"}},"uploadChunk"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5,chunk,absolutePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"文件上传前检查文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/checkfile"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"Boolean"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"checkfile"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String fileMd5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},") throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mediaFileService."),t("span",{style:{color:"#6F42C1"}},"checkFile"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"分块文件上传前的检测"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/checkchunk"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"Boolean"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"checkchunk"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String fileMd5,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                        @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunk"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunk) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mediaFileService."),t("span",{style:{color:"#6F42C1"}},"checkChunk"),t("span",{style:{color:"#24292E"}},"(fileMd5,chunk);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"上传分块文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/uploadchunk"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"uploadchunk"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"file"'),t("span",{style:{color:"#24292E"}},") MultipartFile file,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String fileMd5,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunk"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunk) throws Exception {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//创建临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File tempFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," File."),t("span",{style:{color:"#6F42C1"}},"createTempFile"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"minio"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"temp"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//上传的文件拷贝到临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    file."),t("span",{style:{color:"#6F42C1"}},"transferTo"),t("span",{style:{color:"#24292E"}},"(tempFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String absolutePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," tempFile."),t("span",{style:{color:"#6F42C1"}},"getAbsolutePath"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mediaFileService."),t("span",{style:{color:"#6F42C1"}},"uploadChunk"),t("span",{style:{color:"#24292E"}},"(fileMd5,chunk,absolutePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ne=t("p",null,"启动前端工程，进入上传视频界面进行前后端联调测试。",-1),Ue=t("p",null,"前端对文件分块的大小为5MB，SpringBoot web默认上传文件的大小限制为1MB，这里需要在media-api工程修改配置如下：",-1),ze=t("div",{style:{"max-height":"300px"},class:"language-yaml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"yaml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"spring"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"servlet"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"multipart"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#85E89D"}},"max-file-size"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"50MB")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#85E89D"}},"max-request-size"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"50MB")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"spring"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"servlet"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"multipart"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#22863A"}},"max-file-size"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"50MB")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#22863A"}},"max-request-size"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"50MB")])])]),t("button",{class:"collapse"})],-1),Ke=t("p",null,[t("code",null,"max-file-size"),p("：单个文件的大小限制")],-1),qe=t("p",null,[t("code",null,"Max-request-size"),p(": 单次请求的大小限制")],-1),He=t("p",null,[p("上传分块时被限制大小，在本地"),t("code",null,"nginx.conf"),p("配置：")],-1),We=t("div",{style:{"max-height":"300px"},class:"language-apl"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"apl"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"gzip  on"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"文件服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"client_max_body_size "),t("span",{style:{color:"#79B8FF"}},"50m"),t("span",{style:{color:"#F97583"}},";")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"gzip  on"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"文件服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"client_max_body_size "),t("span",{style:{color:"#005CC5"}},"50m"),t("span",{style:{color:"#D73A49"}},";")])])]),t("button",{class:"collapse"})],-1),Ge={id:"_3-5-合并分块开发",tabindex:"-1"},$e=t("strong",null,"3.5 合并分块开发",-1),Ve={id:"_3-5-1-service开发",tabindex:"-1"},Xe=t("strong",null,"3.5.1 service开发",-1),Je=t("p",null,"定义service接口：",-1),Qe=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 合并分块")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"chunkTotal"),t("span",{style:{color:"#6A737D"}}," 分块总和")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}}," 文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"mergechunks"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId,String fileMd5,"),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkTotal,UploadFileParamsDto uploadFileParamsDto);")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 合并分块")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"companyId"),t("span",{style:{color:"#6A737D"}},"  机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}},"  文件md5")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"chunkTotal"),t("span",{style:{color:"#6A737D"}}," 分块总和")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"uploadFileParamsDto"),t("span",{style:{color:"#6A737D"}}," 文件信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.base.model.RestResponse")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"mergechunks"),t("span",{style:{color:"#24292E"}},"(Long companyId,String fileMd5,"),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkTotal,UploadFileParamsDto uploadFileParamsDto);")])])]),t("button",{class:"collapse"})],-1),Ye=t("p",null,"service实现：",-1),Ze=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"Java")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"mergechunks"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId, String fileMd5, "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkTotal, UploadFileParamsDto uploadFileParamsDto) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//=====获取分块文件路径=====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String chunkFileFolderPath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getChunkFileFolderPath"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//组成将分块文件路径组成 List<ComposeSource>")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    List<"),t("span",{style:{color:"#F97583"}},"ComposeSource"),t("span",{style:{color:"#E1E4E8"}},"> sourceObjectList "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," Stream."),t("span",{style:{color:"#B392F0"}},"iterate"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},", i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"++"),t("span",{style:{color:"#E1E4E8"}},"i)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            ."),t("span",{style:{color:"#B392F0"}},"limit"),t("span",{style:{color:"#E1E4E8"}},"(chunkTotal)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            ."),t("span",{style:{color:"#B392F0"}},"map"),t("span",{style:{color:"#E1E4E8"}},"(i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," ComposeSource."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"(chunkFileFolderPath."),t("span",{style:{color:"#B392F0"}},"concat"),t("span",{style:{color:"#E1E4E8"}},"(Integer."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"(i)))")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                    ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"())")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            ."),t("span",{style:{color:"#B392F0"}},"collect"),t("span",{style:{color:"#E1E4E8"}},"(Collectors."),t("span",{style:{color:"#B392F0"}},"toList"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//=====合并=====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String fileName "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"getFilename"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String extName "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," fileName."),t("span",{style:{color:"#B392F0"}},"substring"),t("span",{style:{color:"#E1E4E8"}},"(fileName."),t("span",{style:{color:"#B392F0"}},"lastIndexOf"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"."'),t("span",{style:{color:"#E1E4E8"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String mergeFilePath "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getFilePathByMd5"),t("span",{style:{color:"#E1E4E8"}},"(fileMd5, extName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//合并文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ObjectWriteResponse response "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," minioClient."),t("span",{style:{color:"#B392F0"}},"composeObject"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ComposeObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                        ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                        ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"(mergeFilePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                        ."),t("span",{style:{color:"#B392F0"}},"sources"),t("span",{style:{color:"#E1E4E8"}},"(sourceObjectList)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                        ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"合并文件成功:{}"'),t("span",{style:{color:"#E1E4E8"}},",mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"合并文件失败,fileMd5:{},异常:{}"'),t("span",{style:{color:"#E1E4E8"}},",fileMd5,e."),t("span",{style:{color:"#B392F0"}},"getMessage"),t("span",{style:{color:"#E1E4E8"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"validfail"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"合并文件失败。"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"// ====验证md5====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//下载合并后的文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File minioFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"downloadFileFromMinIO"),t("span",{style:{color:"#E1E4E8"}},"(bucket_videoFiles,mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(minioFile "),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"下载合并后文件失败,mergeFilePath:{}"'),t("span",{style:{color:"#E1E4E8"}},",mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"validfail"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"下载合并后文件失败。"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," (InputStream newFileInputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileInputStream"),t("span",{style:{color:"#E1E4E8"}},"(minioFile)) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//minio上文件的md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String md5Hex "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," DigestUtils."),t("span",{style:{color:"#B392F0"}},"md5Hex"),t("span",{style:{color:"#E1E4E8"}},"(newFileInputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//比较md5值，不一致则说明文件不完整")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"fileMd5."),t("span",{style:{color:"#B392F0"}},"equals"),t("span",{style:{color:"#E1E4E8"}},"(md5Hex)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"validfail"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"文件合并校验失败，最终上传失败。"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileSize"),t("span",{style:{color:"#E1E4E8"}},"(minioFile."),t("span",{style:{color:"#B392F0"}},"length"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }"),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"校验文件失败,fileMd5:{},异常:{}"'),t("span",{style:{color:"#E1E4E8"}},",fileMd5,e."),t("span",{style:{color:"#B392F0"}},"getMessage"),t("span",{style:{color:"#E1E4E8"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"validfail"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"文件合并校验失败，最终上传失败。"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }"),t("span",{style:{color:"#F97583"}},"finally"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"       "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(minioFile"),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"           minioFile."),t("span",{style:{color:"#B392F0"}},"delete"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"       }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件入库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    currentProxy."),t("span",{style:{color:"#B392F0"}},"addMediaFilesToDb"),t("span",{style:{color:"#E1E4E8"}},"(companyId,fileMd5,uploadFileParamsDto,bucket_videoFiles,mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//=====清除分块文件=====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#B392F0"}},"clearChunkFiles"),t("span",{style:{color:"#E1E4E8"}},"(chunkFileFolderPath,chunkTotal);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," RestResponse."),t("span",{style:{color:"#B392F0"}},"success"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 从minio下载文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"bucket"),t("span",{style:{color:"#6A737D"}}," 桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," 下载后的文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," File "),t("span",{style:{color:"#B392F0"}},"downloadFileFromMinIO"),t("span",{style:{color:"#E1E4E8"}},"(String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    File minioFile "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    FileOutputStream outputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        InputStream stream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," minioClient."),t("span",{style:{color:"#B392F0"}},"getObject"),t("span",{style:{color:"#E1E4E8"}},"(GetObjectArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"(bucket)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"object"),t("span",{style:{color:"#E1E4E8"}},"(objectName)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        minioFile"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"File."),t("span",{style:{color:"#B392F0"}},"createTempFile"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"minio"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'".merge"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        outputStream "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FileOutputStream"),t("span",{style:{color:"#E1E4E8"}},"(minioFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        IOUtils."),t("span",{style:{color:"#B392F0"}},"copy"),t("span",{style:{color:"#E1E4E8"}},"(stream,outputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," minioFile;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"       e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }"),t("span",{style:{color:"#F97583"}},"finally"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(outputStream"),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                outputStream."),t("span",{style:{color:"#B392F0"}},"close"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (IOException "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 得到合并后的文件的地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileMd5"),t("span",{style:{color:"#6A737D"}}," 文件id即md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"fileExt"),t("span",{style:{color:"#6A737D"}}," 文件扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"getFilePathByMd5"),t("span",{style:{color:"#E1E4E8"}},"(String fileMd5,String fileExt){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}},"   fileMd5."),t("span",{style:{color:"#B392F0"}},"substring"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," fileMd5."),t("span",{style:{color:"#B392F0"}},"substring"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"1"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"2"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," fileMd5 "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/"'),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"fileMd5 "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"fileExt;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 清除分块文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"chunkFileFolderPath"),t("span",{style:{color:"#6A737D"}}," 分块文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"chunkTotal"),t("span",{style:{color:"#6A737D"}}," 分块文件总数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"clearChunkFiles"),t("span",{style:{color:"#E1E4E8"}},"(String chunkFileFolderPath,"),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkTotal){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        List<"),t("span",{style:{color:"#F97583"}},"DeleteObject"),t("span",{style:{color:"#E1E4E8"}},"> deleteObjects "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," Stream."),t("span",{style:{color:"#B392F0"}},"iterate"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},", i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"++"),t("span",{style:{color:"#E1E4E8"}},"i)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"limit"),t("span",{style:{color:"#E1E4E8"}},"(chunkTotal)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"map"),t("span",{style:{color:"#E1E4E8"}},"(i "),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"DeleteObject"),t("span",{style:{color:"#E1E4E8"}},"(chunkFileFolderPath."),t("span",{style:{color:"#B392F0"}},"concat"),t("span",{style:{color:"#E1E4E8"}},"(Integer."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"(i))))")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"collect"),t("span",{style:{color:"#E1E4E8"}},"(Collectors."),t("span",{style:{color:"#B392F0"}},"toList"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        RemoveObjectsArgs removeObjectsArgs "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," RemoveObjectsArgs."),t("span",{style:{color:"#B392F0"}},"builder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"bucket"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"video"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"objects"),t("span",{style:{color:"#E1E4E8"}},"(deleteObjects)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        Iterable<Result<"),t("span",{style:{color:"#F97583"}},"DeleteError"),t("span",{style:{color:"#E1E4E8"}},">> results "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," minioClient."),t("span",{style:{color:"#B392F0"}},"removeObjects"),t("span",{style:{color:"#E1E4E8"}},"(removeObjectsArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        results."),t("span",{style:{color:"#B392F0"}},"forEach"),t("span",{style:{color:"#E1E4E8"}},"(r"),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            DeleteError deleteError "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                deleteError "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," r."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                log."),t("span",{style:{color:"#B392F0"}},"error"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"清楚分块文件失败,objectname:{}"'),t("span",{style:{color:"#E1E4E8"}},",deleteError."),t("span",{style:{color:"#B392F0"}},"objectName"),t("span",{style:{color:"#E1E4E8"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"error"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"清楚分块文件失败,chunkFileFolderPath:{}"'),t("span",{style:{color:"#E1E4E8"}},",chunkFileFolderPath,e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"Java")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"mergechunks"),t("span",{style:{color:"#24292E"}},"(Long companyId, String fileMd5, "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkTotal, UploadFileParamsDto uploadFileParamsDto) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//=====获取分块文件路径=====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String chunkFileFolderPath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getChunkFileFolderPath"),t("span",{style:{color:"#24292E"}},"(fileMd5);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//组成将分块文件路径组成 List<ComposeSource>")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    List<"),t("span",{style:{color:"#D73A49"}},"ComposeSource"),t("span",{style:{color:"#24292E"}},"> sourceObjectList "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," Stream."),t("span",{style:{color:"#6F42C1"}},"iterate"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},", i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"++"),t("span",{style:{color:"#24292E"}},"i)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            ."),t("span",{style:{color:"#6F42C1"}},"limit"),t("span",{style:{color:"#24292E"}},"(chunkTotal)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            ."),t("span",{style:{color:"#6F42C1"}},"map"),t("span",{style:{color:"#24292E"}},"(i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," ComposeSource."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"(bucket_videoFiles)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"(chunkFileFolderPath."),t("span",{style:{color:"#6F42C1"}},"concat"),t("span",{style:{color:"#24292E"}},"(Integer."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"(i)))")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                    ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"())")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            ."),t("span",{style:{color:"#6F42C1"}},"collect"),t("span",{style:{color:"#24292E"}},"(Collectors."),t("span",{style:{color:"#6F42C1"}},"toList"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//=====合并=====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String fileName "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"getFilename"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String extName "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," fileName."),t("span",{style:{color:"#6F42C1"}},"substring"),t("span",{style:{color:"#24292E"}},"(fileName."),t("span",{style:{color:"#6F42C1"}},"lastIndexOf"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"."'),t("span",{style:{color:"#24292E"}},"));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//合并文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String mergeFilePath "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getFilePathByMd5"),t("span",{style:{color:"#24292E"}},"(fileMd5, extName);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//合并文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ObjectWriteResponse response "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," minioClient."),t("span",{style:{color:"#6F42C1"}},"composeObject"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ComposeObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                        ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"(bucket_videoFiles)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                        ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"(mergeFilePath)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                        ."),t("span",{style:{color:"#6F42C1"}},"sources"),t("span",{style:{color:"#24292E"}},"(sourceObjectList)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                        ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"合并文件成功:{}"'),t("span",{style:{color:"#24292E"}},",mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"合并文件失败,fileMd5:{},异常:{}"'),t("span",{style:{color:"#24292E"}},",fileMd5,e."),t("span",{style:{color:"#6F42C1"}},"getMessage"),t("span",{style:{color:"#24292E"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"validfail"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"合并文件失败。"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"// ====验证md5====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//下载合并后的文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File minioFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"downloadFileFromMinIO"),t("span",{style:{color:"#24292E"}},"(bucket_videoFiles,mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(minioFile "),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"下载合并后文件失败,mergeFilePath:{}"'),t("span",{style:{color:"#24292E"}},",mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"validfail"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"下载合并后文件失败。"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," (InputStream newFileInputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileInputStream"),t("span",{style:{color:"#24292E"}},"(minioFile)) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//minio上文件的md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String md5Hex "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," DigestUtils."),t("span",{style:{color:"#6F42C1"}},"md5Hex"),t("span",{style:{color:"#24292E"}},"(newFileInputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//比较md5值，不一致则说明文件不完整")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"fileMd5."),t("span",{style:{color:"#6F42C1"}},"equals"),t("span",{style:{color:"#24292E"}},"(md5Hex)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"validfail"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"文件合并校验失败，最终上传失败。"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//文件大小")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileSize"),t("span",{style:{color:"#24292E"}},"(minioFile."),t("span",{style:{color:"#6F42C1"}},"length"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }"),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"校验文件失败,fileMd5:{},异常:{}"'),t("span",{style:{color:"#24292E"}},",fileMd5,e."),t("span",{style:{color:"#6F42C1"}},"getMessage"),t("span",{style:{color:"#24292E"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"validfail"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"文件合并校验失败，最终上传失败。"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }"),t("span",{style:{color:"#D73A49"}},"finally"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"       "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(minioFile"),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"           minioFile."),t("span",{style:{color:"#6F42C1"}},"delete"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"       }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//文件入库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    currentProxy."),t("span",{style:{color:"#6F42C1"}},"addMediaFilesToDb"),t("span",{style:{color:"#24292E"}},"(companyId,fileMd5,uploadFileParamsDto,bucket_videoFiles,mergeFilePath);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//=====清除分块文件=====")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6F42C1"}},"clearChunkFiles"),t("span",{style:{color:"#24292E"}},"(chunkFileFolderPath,chunkTotal);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," RestResponse."),t("span",{style:{color:"#6F42C1"}},"success"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 从minio下载文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"bucket"),t("span",{style:{color:"#6A737D"}}," 桶")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"objectName"),t("span",{style:{color:"#6A737D"}}," 对象名称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," 下载后的文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," File "),t("span",{style:{color:"#6F42C1"}},"downloadFileFromMinIO"),t("span",{style:{color:"#24292E"}},"(String bucket,String objectName){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    File minioFile "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    FileOutputStream outputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        InputStream stream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," minioClient."),t("span",{style:{color:"#6F42C1"}},"getObject"),t("span",{style:{color:"#24292E"}},"(GetObjectArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"(bucket)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"object"),t("span",{style:{color:"#24292E"}},"(objectName)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建临时文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        minioFile"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"File."),t("span",{style:{color:"#6F42C1"}},"createTempFile"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"minio"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'".merge"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        outputStream "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FileOutputStream"),t("span",{style:{color:"#24292E"}},"(minioFile);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        IOUtils."),t("span",{style:{color:"#6F42C1"}},"copy"),t("span",{style:{color:"#24292E"}},"(stream,outputStream);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," minioFile;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"       e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }"),t("span",{style:{color:"#D73A49"}},"finally"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(outputStream"),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                outputStream."),t("span",{style:{color:"#6F42C1"}},"close"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (IOException "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 得到合并后的文件的地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileMd5"),t("span",{style:{color:"#6A737D"}}," 文件id即md5值")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"fileExt"),t("span",{style:{color:"#6A737D"}}," 文件扩展名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"getFilePathByMd5"),t("span",{style:{color:"#24292E"}},"(String fileMd5,String fileExt){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}},"   fileMd5."),t("span",{style:{color:"#6F42C1"}},"substring"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," fileMd5."),t("span",{style:{color:"#6F42C1"}},"substring"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"1"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"2"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," fileMd5 "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/"'),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"fileMd5 "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"fileExt;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 清除分块文件")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"chunkFileFolderPath"),t("span",{style:{color:"#6A737D"}}," 分块文件路径")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"chunkTotal"),t("span",{style:{color:"#6A737D"}}," 分块文件总数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"clearChunkFiles"),t("span",{style:{color:"#24292E"}},"(String chunkFileFolderPath,"),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkTotal){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        List<"),t("span",{style:{color:"#D73A49"}},"DeleteObject"),t("span",{style:{color:"#24292E"}},"> deleteObjects "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," Stream."),t("span",{style:{color:"#6F42C1"}},"iterate"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},", i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"++"),t("span",{style:{color:"#24292E"}},"i)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"limit"),t("span",{style:{color:"#24292E"}},"(chunkTotal)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"map"),t("span",{style:{color:"#24292E"}},"(i "),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"DeleteObject"),t("span",{style:{color:"#24292E"}},"(chunkFileFolderPath."),t("span",{style:{color:"#6F42C1"}},"concat"),t("span",{style:{color:"#24292E"}},"(Integer."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"(i))))")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"collect"),t("span",{style:{color:"#24292E"}},"(Collectors."),t("span",{style:{color:"#6F42C1"}},"toList"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        RemoveObjectsArgs removeObjectsArgs "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," RemoveObjectsArgs."),t("span",{style:{color:"#6F42C1"}},"builder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"bucket"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"video"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"objects"),t("span",{style:{color:"#24292E"}},"(deleteObjects)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        Iterable<Result<"),t("span",{style:{color:"#D73A49"}},"DeleteError"),t("span",{style:{color:"#24292E"}},">> results "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," minioClient."),t("span",{style:{color:"#6F42C1"}},"removeObjects"),t("span",{style:{color:"#24292E"}},"(removeObjectsArgs);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        results."),t("span",{style:{color:"#6F42C1"}},"forEach"),t("span",{style:{color:"#24292E"}},"(r"),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            DeleteError deleteError "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                deleteError "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," r."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                log."),t("span",{style:{color:"#6F42C1"}},"error"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"清楚分块文件失败,objectname:{}"'),t("span",{style:{color:"#24292E"}},",deleteError."),t("span",{style:{color:"#6F42C1"}},"objectName"),t("span",{style:{color:"#24292E"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"error"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"清楚分块文件失败,chunkFileFolderPath:{}"'),t("span",{style:{color:"#24292E"}},",chunkFileFolderPath,e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),sc={id:"_3-5-2-接口层完善",tabindex:"-1"},lc=t("strong",null,"3.5.2 接口层完善",-1),oc=t("p",null,"下边完善接口层",-1),nc=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"合并文件"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/upload/mergechunks"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestResponse "),t("span",{style:{color:"#B392F0"}},"mergechunks"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileMd5"'),t("span",{style:{color:"#E1E4E8"}},") String fileMd5,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"fileName"'),t("span",{style:{color:"#E1E4E8"}},") String fileName,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                                @"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"chunkTotal"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," chunkTotal) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Long companyId "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"1232141425L"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    UploadFileParamsDto uploadFileParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UploadFileParamsDto"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFileType"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"001002"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setTags"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"课程视频"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setRemark"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    uploadFileParamsDto."),t("span",{style:{color:"#B392F0"}},"setFilename"),t("span",{style:{color:"#E1E4E8"}},"(fileName);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," mediaFileService."),t("span",{style:{color:"#B392F0"}},"mergechunks"),t("span",{style:{color:"#E1E4E8"}},"(companyId,fileMd5,chunkTotal,uploadFileParamsDto);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"合并文件"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/upload/mergechunks"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestResponse "),t("span",{style:{color:"#6F42C1"}},"mergechunks"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileMd5"'),t("span",{style:{color:"#24292E"}},") String fileMd5,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"fileName"'),t("span",{style:{color:"#24292E"}},") String fileName,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                                @"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"chunkTotal"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," chunkTotal) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Long companyId "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"1232141425L"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    UploadFileParamsDto uploadFileParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UploadFileParamsDto"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFileType"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"001002"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setTags"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"课程视频"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setRemark"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    uploadFileParamsDto."),t("span",{style:{color:"#6F42C1"}},"setFilename"),t("span",{style:{color:"#24292E"}},"(fileName);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," mediaFileService."),t("span",{style:{color:"#6F42C1"}},"mergechunks"),t("span",{style:{color:"#24292E"}},"(companyId,fileMd5,chunkTotal,uploadFileParamsDto);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),ac={id:"_3-5-3-合并分块测试",tabindex:"-1"},ec=t("strong",null,"3.5.3 合并分块测试",-1),cc=t("p",null,"下边进行前后端联调：",-1),tc=t("p",null,"1、上传一个视频测试合并分块的执行逻辑",-1),pc=t("p",null,"进入service方法逐行跟踪。",-1),rc=t("p",null,"2、断点续传测试",-1),Ec=t("p",null,"上传一部分后，停止刷新浏览器再重新上传，通过浏览器日志发现已经上传过的分块不再重新上传",-1),yc=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps90.jpg"})],-1),ic={id:"四-绑定媒资",tabindex:"-1"},Fc=t("strong",null,"四 绑定媒资",-1),uc={id:"_4-1-需求分析",tabindex:"-1"},dc=t("strong",null,"4.1 需求分析",-1),mc={id:"_4-1-1-业务流程",tabindex:"-1"},Dc=t("strong",null,"4.1.1 业务流程",-1),Ac=t("p",null,"到目前为止，媒资管理已完成文件上传、视频处理、我的媒资功能等基本功能，其它模块可以使用媒资文件，本节要讲解课程计划绑定媒资文件。",-1),gc=t("p",null,"如何将课程计划绑定媒资呢？",-1),hc=t("p",null,"首先进入课程计划界面，然后选择要绑定的视频进行绑定即可。",-1),Cc=t("p",null,"具体的业务流程如下：",-1),bc=t("p",null,'1.教育机构用户进入课程管理页面并编辑某一个课程，在"课程大纲"标签页的某一小节后可点击”添加视频“。',-1),Bc=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps139.jpg"})],-1),fc=t("p",null,"2.弹出添加视频对话框，可通过视频关键字搜索已审核通过的视频媒资。",-1),kc=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps140.jpg"})],-1),Sc=t("p",null,"3.选择视频媒资，点击提交按钮，完成课程计划绑定媒资流程。",-1),vc=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps141.jpg"})],-1),Mc=t("p",null,"课程计划关联视频后如下图：",-1),jc=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps142.jpg"})],-1),Pc=t("p",null,"点击已经绑定的视频名称即可解除绑定。",-1),_c=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps143.jpg"})],-1),xc={id:"_4-1-2-数据模型",tabindex:"-1"},Ic=t("strong",null,"4.1.2 数据模型",-1),Tc=t("p",null,"课程计划绑定媒资文件后存储至课程计划绑定媒资表",-1),Oc=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps144.jpg"})],-1),Rc={id:"_4-2-接口定义",tabindex:"-1"},wc=t("strong",null,"4.2 接口定义",-1),Lc=t("p",null,"根据业务流程，用户进入课程计划列表，首先确定向哪个课程计划添加视频，点击”添加视频“后用户选择视频，选择视频，点击提交，前端以json格式请求以下参数：",-1),Nc=t("p",null,"提交媒资文件id、文件名称、教学计划id",-1),Uc=t("p",null,"示例如下：",-1),zc=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"mediaId"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"70a98b4a2fffc89e50b101f959cc33ca"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"fileName"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"22-Hmily实现TCC事务-开发bank2的confirm方法.avi"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"teachplanId"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"257")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"mediaId"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"70a98b4a2fffc89e50b101f959cc33ca"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"fileName"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"22-Hmily实现TCC事务-开发bank2的confirm方法.avi"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"teachplanId"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"257")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Kc=t("p",null,"此接口在内容管理模块提供。",-1),qc=t("p",null,"在内容管理模块定义请求参数模型类型：",-1),Hc=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiModel"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"BindTeachplanMediaDto"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"description"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"教学计划-媒资绑定提交数据"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"BindTeachplanMediaDto"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiModelProperty"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"媒资文件id"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String mediaId;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiModelProperty"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"媒资文件名称"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String fileName;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"ApiModelProperty"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"课程计划标识"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," Long teachplanId;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiModel"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"BindTeachplanMediaDto"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"description"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"教学计划-媒资绑定提交数据"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"BindTeachplanMediaDto"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiModelProperty"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"媒资文件id"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String mediaId;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiModelProperty"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"媒资文件名称"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String fileName;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"ApiModelProperty"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"课程计划标识"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," Long teachplanId;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Wc=t("p",null,"在TeachplanController类中定义接口如下：",-1),Gc=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"课程计划和媒资信息绑定"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/teachplan/association/media"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"associationMedia"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestBody"),t("span",{style:{color:"#E1E4E8"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"课程计划和媒资信息绑定"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/teachplan/association/media"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"associationMedia"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestBody"),t("span",{style:{color:"#24292E"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),$c={id:"_4-3-接口开发",tabindex:"-1"},Vc=t("strong",null,"4.3 接口开发",-1),Xc={id:"_4-3-1-dao开发",tabindex:"-1"},Jc=t("strong",null,"4.3.1 DAO开发",-1),Qc=t("p",null,"对teachplanMedia表自动生成Mapper。",-1),Yc={id:"_4-3-2-service开发",tabindex:"-1"},Zc=t("strong",null,"4.3.2 Service开发",-1),st=t("p",null,"根据需求定义service接口",-1),lt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 教学计划绑定媒资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"bindTeachplanMediaDto")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.content.model.po.TeachplanMedia")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#F97583"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @date 2022/9/14 22:20")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," TeachplanMedia "),t("span",{style:{color:"#B392F0"}},"associationMedia"),t("span",{style:{color:"#E1E4E8"}},"(BindTeachplanMediaDto bindTeachplanMediaDto);")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 教学计划绑定媒资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"bindTeachplanMediaDto")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.content.model.po.TeachplanMedia")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * "),t("span",{style:{color:"#D73A49"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @date 2022/9/14 22:20")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," TeachplanMedia "),t("span",{style:{color:"#6F42C1"}},"associationMedia"),t("span",{style:{color:"#24292E"}},"(BindTeachplanMediaDto bindTeachplanMediaDto);")])])]),t("button",{class:"collapse"})],-1),ot=t("p",null,"定义接口实现",-1),nt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," TeachplanMedia "),t("span",{style:{color:"#B392F0"}},"associationMedia"),t("span",{style:{color:"#E1E4E8"}},"(BindTeachplanMediaDto bindTeachplanMediaDto) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#6A737D"}},"//教学计划id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," Long teachplanId "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," bindTeachplanMediaDto."),t("span",{style:{color:"#B392F0"}},"getTeachplanId"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," Teachplan teachplan "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," teachplanMapper."),t("span",{style:{color:"#B392F0"}},"selectById"),t("span",{style:{color:"#E1E4E8"}},"(teachplanId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(teachplan"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  XueChengPlusException."),t("span",{style:{color:"#B392F0"}},"cast"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"教学计划不存在"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," Integer grade "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," teachplan."),t("span",{style:{color:"#B392F0"}},"getGrade"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(grade"),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#79B8FF"}},"2"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  XueChengPlusException."),t("span",{style:{color:"#B392F0"}},"cast"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"只允许第二级教学计划绑定媒资文件"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#6A737D"}},"//课程id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," Long courseId "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," teachplan."),t("span",{style:{color:"#B392F0"}},"getCourseId"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#6A737D"}},"//先删除原来该教学计划绑定的媒资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," teachplanMediaMapper."),t("span",{style:{color:"#B392F0"}},"delete"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"TeachplanMedia"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(TeachplanMedia"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getTeachplanId,teachplanId));")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#6A737D"}},"//再添加教学计划与媒资的绑定关系")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," TeachplanMedia teachplanMedia "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"TeachplanMedia"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),t("span",{style:{color:"#B392F0"}},"setCourseId"),t("span",{style:{color:"#E1E4E8"}},"(courseId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),t("span",{style:{color:"#B392F0"}},"setTeachplanId"),t("span",{style:{color:"#E1E4E8"}},"(teachplanId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),t("span",{style:{color:"#B392F0"}},"setMediaFilename"),t("span",{style:{color:"#E1E4E8"}},"(bindTeachplanMediaDto."),t("span",{style:{color:"#B392F0"}},"getFileName"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),t("span",{style:{color:"#B392F0"}},"setMediaId"),t("span",{style:{color:"#E1E4E8"}},"(bindTeachplanMediaDto."),t("span",{style:{color:"#B392F0"}},"getMediaId"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," teachplanMedia."),t("span",{style:{color:"#B392F0"}},"setCreateDate"),t("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),t("span",{style:{color:"#B392F0"}},"now"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," teachplanMediaMapper."),t("span",{style:{color:"#B392F0"}},"insert"),t("span",{style:{color:"#E1E4E8"}},"(teachplanMedia);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," teachplanMedia;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," TeachplanMedia "),t("span",{style:{color:"#6F42C1"}},"associationMedia"),t("span",{style:{color:"#24292E"}},"(BindTeachplanMediaDto bindTeachplanMediaDto) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6A737D"}},"//教学计划id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," Long teachplanId "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," bindTeachplanMediaDto."),t("span",{style:{color:"#6F42C1"}},"getTeachplanId"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," Teachplan teachplan "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," teachplanMapper."),t("span",{style:{color:"#6F42C1"}},"selectById"),t("span",{style:{color:"#24292E"}},"(teachplanId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(teachplan"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  XueChengPlusException."),t("span",{style:{color:"#6F42C1"}},"cast"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"教学计划不存在"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," Integer grade "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," teachplan."),t("span",{style:{color:"#6F42C1"}},"getGrade"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(grade"),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#005CC5"}},"2"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  XueChengPlusException."),t("span",{style:{color:"#6F42C1"}},"cast"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"只允许第二级教学计划绑定媒资文件"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6A737D"}},"//课程id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," Long courseId "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," teachplan."),t("span",{style:{color:"#6F42C1"}},"getCourseId"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6A737D"}},"//先删除原来该教学计划绑定的媒资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," teachplanMediaMapper."),t("span",{style:{color:"#6F42C1"}},"delete"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"TeachplanMedia"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(TeachplanMedia"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getTeachplanId,teachplanId));")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6A737D"}},"//再添加教学计划与媒资的绑定关系")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," TeachplanMedia teachplanMedia "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"TeachplanMedia"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," teachplanMedia."),t("span",{style:{color:"#6F42C1"}},"setCourseId"),t("span",{style:{color:"#24292E"}},"(courseId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," teachplanMedia."),t("span",{style:{color:"#6F42C1"}},"setTeachplanId"),t("span",{style:{color:"#24292E"}},"(teachplanId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," teachplanMedia."),t("span",{style:{color:"#6F42C1"}},"setMediaFilename"),t("span",{style:{color:"#24292E"}},"(bindTeachplanMediaDto."),t("span",{style:{color:"#6F42C1"}},"getFileName"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," teachplanMedia."),t("span",{style:{color:"#6F42C1"}},"setMediaId"),t("span",{style:{color:"#24292E"}},"(bindTeachplanMediaDto."),t("span",{style:{color:"#6F42C1"}},"getMediaId"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," teachplanMedia."),t("span",{style:{color:"#6F42C1"}},"setCreateDate"),t("span",{style:{color:"#24292E"}},"(LocalDateTime."),t("span",{style:{color:"#6F42C1"}},"now"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," teachplanMediaMapper."),t("span",{style:{color:"#6F42C1"}},"insert"),t("span",{style:{color:"#24292E"}},"(teachplanMedia);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," teachplanMedia;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),at={id:"_4-3-3-接口层完善",tabindex:"-1"},et=t("strong",null,"4.3.3 接口层完善",-1),ct=t("p",null,"完善接口层调用Service层的代码",-1),tt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"课程计划和媒资信息绑定"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/teachplan/association/media"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"associationMedia"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestBody"),t("span",{style:{color:"#E1E4E8"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    teachplanService."),t("span",{style:{color:"#B392F0"}},"associationMedia"),t("span",{style:{color:"#E1E4E8"}},"(bindTeachplanMediaDto);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"课程计划和媒资信息绑定"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/teachplan/association/media"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"associationMedia"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestBody"),t("span",{style:{color:"#24292E"}}," BindTeachplanMediaDto bindTeachplanMediaDto){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    teachplanService."),t("span",{style:{color:"#6F42C1"}},"associationMedia"),t("span",{style:{color:"#24292E"}},"(bindTeachplanMediaDto);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),pt={id:"_4-3-4-接口测试",tabindex:"-1"},rt=t("strong",null,"4.3.4 接口测试",-1),Et=t("p",null,"1、使用httpclient测试",-1),yt=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 课程计划绑定视频")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/teachplan/association/media")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Content-Type"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"application/json")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"mediaId"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"fileName"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"teachplanId"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'""')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 课程计划绑定视频")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{media_host}}/media/teachplan/association/media")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Content-Type"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"application/json")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"mediaId"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"fileName"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"teachplanId"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'""')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),it=t("p",null,"2、前后端联调",-1),Ft=t("p",null,"此功能较为简单推荐直接前后端联调",-1),ut=t("p",null,"向指定课程计划添加视频",-1),dt={id:"_4-4-实战",tabindex:"-1"},mt=t("strong",null,"4.4 实战",-1),Dt=t("p",null,"根据接口定义实现解除绑定功能。",-1),At=t("p",null,"点击已经绑定的视频名称即可解除绑定。",-1),gt=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps145.jpg"})],-1),ht=t("p",null,"接口定义如下：",-1),Ct=t("p",null,[t("code",null,"delete /teachplan/association/media/{teachPlanId}/{mediaId} 返回200状态码表示成功。")],-1),bt=t("p",null,"开发完成使用httpclient测试、前后端联调",-1),Bt=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 课程计划接触视频绑定")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"DELETE"),t("span",{style:{color:"#E1E4E8"}}," {{media_host}}/media/teachplan/association/media/{teachPlanId}/{mediaId}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 课程计划接触视频绑定")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"DELETE"),t("span",{style:{color:"#24292E"}}," {{media_host}}/media/teachplan/association/media/{teachPlanId}/{mediaId}")])])]),t("button",{class:"collapse"})],-1);const ft=s(u,[["render",function(s,l,o,i,F,u){const ft=y,kt=e;return c(),n(kt,{frontmatter:F.frontmatter,data:F.data},{"main-content-md":a((()=>[t("h2",d,[m,p(),r(ft,{class:"header-anchor",href:"#一-分布式文件系统","aria-label":'Permalink to "**一 分布式文件系统**"'},{default:a((()=>[p("​")])),_:1})]),t("h3",D,[A,p(),r(ft,{class:"header-anchor",href:"#_1-1-什么是分布式文件系统","aria-label":'Permalink to "**1.1 什么是分布式文件系统**"'},{default:a((()=>[p("​")])),_:1})]),g,h,C,b,B,f,k,S,v,M,j,P,_,x,I,T,O,R,w,L,N,U,z,K,q,H,W,G,$,V,X,J,Q,Y,Z,ss,ls,os,t("p",null,[ns,r(ft,{href:"https://www.aliyun.com/product/oss",target:"_blank",rel:"noreferrer"},{default:a((()=>[as])),_:1})]),es,t("p",null,[cs,r(ft,{href:"https://cloud.baidu.com/product/bos.html",target:"_blank",rel:"noreferrer"},{default:a((()=>[ts])),_:1})]),t("h3",ps,[rs,p(),r(ft,{class:"header-anchor",href:"#_1-2-minio","aria-label":'Permalink to "**1.2 MinIO**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",Es,[ys,p(),r(ft,{class:"header-anchor",href:"#_1-2-1-介绍","aria-label":'Permalink to "**1.2.1 介绍**"'},{default:a((()=>[p("​")])),_:1})]),is,Fs,t("p",null,[p("官网："),r(ft,{href:"https://min.io",target:"_blank",rel:"noreferrer"},{default:a((()=>[p("https://min.io")])),_:1})]),t("p",null,[p("中文："),r(ft,{href:"https://www.minio.org.cn/%EF%BC%8Chttp://docs.minio.org.cn/docs/",target:"_blank",rel:"noreferrer"},{default:a((()=>[p("https://www.minio.org.cn/，http://docs.minio.org.cn/docs/")])),_:1})]),us,ds,ms,Ds,As,gs,hs,t("h4",Cs,[bs,p(),r(ft,{class:"header-anchor",href:"#_1-2-2-数据恢复演示","aria-label":'Permalink to "**1.2.2 数据恢复演示**"'},{default:a((()=>[p("​")])),_:1})]),Bs,fs,t("p",null,[p("下载minio，下载地址在"),r(ft,{href:"https://dl.min.io/server/minio/release/%EF%BC%8C%E5%8F%AF%E4%BB%8E%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%96%99%E6%89%BE%E5%88%B0MinIO%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6minio.zip%E8%A7%A3%E5%8E%8B%E5%8D%B3%E5%8F%AF%E4%BD%BF%E7%94%A8%EF%BC%8CCMD%E8%BF%9B%E5%85%A5%E6%9C%89minio.exe%E7%9A%84%E7%9B%AE%E5%BD%95%EF%BC%8C%E8%BF%90%E8%A1%8C%E4%B8%8B%E8%BE%B9%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%9A",target:"_blank",rel:"noreferrer"},{default:a((()=>[p("https://dl.min.io/server/minio/release/，可从课程资料找到MinIO的安装文件minio.zip解压即可使用，CMD进入有minio.exe的目录，运行下边的命令：")])),_:1})]),ks,Ss,vs,Ms,js,Ps,_s,xs,Is,Ts,Os,Rs,ws,Ls,Ns,Us,zs,Ks,qs,Hs,Ws,Gs,$s,Vs,Xs,Js,Qs,Ys,Zs,sl,ll,ol,t("h4",nl,[al,p(),r(ft,{class:"header-anchor",href:"#_1-2-3-测试docker环境","aria-label":'Permalink to "**1.2.3 测试Docker环境**"'},{default:a((()=>[p("​")])),_:1})]),el,cl,tl,t("p",null,[p("访问"),r(ft,{href:"http://192.168.2.203:9000",target:"_blank",rel:"noreferrer"},{default:a((()=>[p("http://192.168.2.203:9000")])),_:1})]),pl,rl,El,yl,t("h4",il,[Fl,p(),r(ft,{class:"header-anchor",href:"#_1-2-4-sdk","aria-label":'Permalink to "**1.2.4 SDK**"'},{default:a((()=>[p("​")])),_:1})]),t("h5",ul,[dl,p(),r(ft,{class:"header-anchor",href:"#_1-2-4-1上传文件","aria-label":'Permalink to "**1.2.4.1上传文件**"'},{default:a((()=>[p("​")])),_:1})]),ml,t("p",null,[p("地址："),r(ft,{href:"https://docs.min.io/docs/java-client-quickstart-guide.html",target:"_blank",rel:"noreferrer"},{default:a((()=>[p("https://docs.min.io/docs/java-client-quickstart-guide.html")])),_:1})]),Dl,Al,gl,hl,Cl,bl,Bl,fl,kl,Sl,vl,Ml,jl,Pl,_l,xl,Il,Tl,Ol,Rl,wl,Ll,Nl,Ul,zl,t("h5",Kl,[ql,p(),r(ft,{class:"header-anchor",href:"#_1-2-4-2-删除文件","aria-label":'Permalink to "**1.2.4.2 删除文件**"'},{default:a((()=>[p("​")])),_:1})]),Hl,t("p",null,[p("参考："),r(ft,{href:"https://docs.min.io/docs/java-client-api-reference#removeObject",target:"_blank",rel:"noreferrer"},{default:a((()=>[p("https://docs.min.io/docs/java-client-api-reference#removeObject")])),_:1})]),Wl,t("h5",Gl,[$l,p(),r(ft,{class:"header-anchor",href:"#_1-2-4-3-查询文件","aria-label":'Permalink to "**1.2.4.3 查询文件**"'},{default:a((()=>[p("​")])),_:1})]),Vl,t("p",null,[p("参考："),r(ft,{href:"https://docs.min.io/docs/java-client-api-reference#getObject",target:"_blank",rel:"noreferrer"},{default:a((()=>[p("https://docs.min.io/docs/java-client-api-reference#getObject")])),_:1})]),Xl,Jl,t("h2",Ql,[Yl,p(),r(ft,{class:"header-anchor",href:"#二-上传图片","aria-label":'Permalink to "**二 上传图片**"'},{default:a((()=>[p("​")])),_:1})]),t("h3",Zl,[so,p(),r(ft,{class:"header-anchor",href:"#_2-1-需求分析","aria-label":'Permalink to "**2.1 需求分析**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",lo,[oo,p(),r(ft,{class:"header-anchor",href:"#_2-1-1-业务流程","aria-label":'Permalink to "**2.1.1 业务流程**"'},{default:a((()=>[p("​")])),_:1})]),no,ao,eo,co,to,po,ro,Eo,yo,io,Fo,uo,mo,t("h4",Do,[Ao,p(),r(ft,{class:"header-anchor",href:"#_2-1-2-数据模型","aria-label":'Permalink to "**2.1.2 数据模型**"'},{default:a((()=>[p("​")])),_:1})]),go,ho,Co,bo,t("h3",Bo,[fo,p(),r(ft,{class:"header-anchor",href:"#_2-2-准备环境","aria-label":'Permalink to "**2.2 准备环境**"'},{default:a((()=>[p("​")])),_:1})]),ko,So,vo,Mo,jo,Po,_o,xo,t("h3",Io,[To,p(),r(ft,{class:"header-anchor",href:"#_2-3-接口定义","aria-label":'Permalink to "**2.3 接口定义**"'},{default:a((()=>[p("​")])),_:1})]),Oo,Ro,wo,Lo,No,Uo,zo,Ko,qo,Ho,Wo,Go,t("h3",$o,[Vo,p(),r(ft,{class:"header-anchor",href:"#_2-4-接口开发","aria-label":'Permalink to "**2.4 接口开发**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",Xo,[Jo,p(),r(ft,{class:"header-anchor",href:"#_2-4-1-dao开发","aria-label":'Permalink to "**2.4.1 DAO开发**"'},{default:a((()=>[p("​")])),_:1})]),Qo,t("h4",Yo,[Zo,p(),r(ft,{class:"header-anchor",href:"#_2-4-2-service开发","aria-label":'Permalink to "**2.4.2 Service开发**"'},{default:a((()=>[p("​")])),_:1})]),sn,ln,on,nn,an,en,cn,tn,pn,t("h4",rn,[En,p(),r(ft,{class:"header-anchor",href:"#_2-4-3-完善接口层","aria-label":'Permalink to "**2.4.3 完善接口层**"'},{default:a((()=>[p("​")])),_:1})]),yn,Fn,t("h4",un,[dn,p(),r(ft,{class:"header-anchor",href:"#_2-4-4-接口测试","aria-label":'Permalink to "**2.4.4 接口测试**"'},{default:a((()=>[p("​")])),_:1})]),mn,Dn,An,gn,hn,Cn,bn,t("h4",Bn,[fn,p(),r(ft,{class:"header-anchor",href:"#_2-4-5-service事务优化","aria-label":'Permalink to "**2.4.5 Service事务优化**"'},{default:a((()=>[p("​")])),_:1})]),kn,Sn,vn,Mn,jn,Pn,_n,xn,In,Tn,On,Rn,wn,Ln,Nn,Un,zn,Kn,qn,Hn,Wn,Gn,$n,Vn,Xn,Jn,Qn,t("h2",Yn,[Zn,p(),r(ft,{class:"header-anchor",href:"#三-上传视频","aria-label":'Permalink to "**三 上传视频**"'},{default:a((()=>[p("​")])),_:1})]),t("h3",sa,[la,p(),r(ft,{class:"header-anchor",href:"#_3-1-需求分析","aria-label":'Permalink to "**3.1 需求分析**"'},{default:a((()=>[p("​")])),_:1})]),oa,na,aa,ea,ca,ta,pa,ra,Ea,ya,ia,Fa,ua,t("h3",da,[ma,p(),r(ft,{class:"header-anchor",href:"#_3-2-断点续传技术","aria-label":'Permalink to "**3.2 断点续传技术**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",Da,[Aa,p(),r(ft,{class:"header-anchor",href:"#_3-2-1-什么是断点续传","aria-label":'Permalink to "**3.2.1 什么是断点续传**"'},{default:a((()=>[p("​")])),_:1})]),ga,ha,Ca,ba,Ba,fa,ka,Sa,va,t("h4",Ma,[ja,p(),r(ft,{class:"header-anchor",href:"#_3-2-2-分块与合并测试","aria-label":'Permalink to "**3.2.2 分块与合并测试**"'},{default:a((()=>[p("​")])),_:1})]),Pa,_a,xa,Ia,Ta,Oa,Ra,wa,La,Na,Ua,za,Ka,t("h4",qa,[Ha,p(),r(ft,{class:"header-anchor",href:"#_3-2-3-视频上传流程","aria-label":'Permalink to "**3.2.3 视频上传流程**"'},{default:a((()=>[p("​")])),_:1})]),Wa,Ga,$a,Va,Xa,Ja,Qa,Ya,Za,se,t("h4",le,[oe,p(),r(ft,{class:"header-anchor",href:"#_3-2-4-minio合并文件测试","aria-label":'Permalink to "**3.2.4 minio合并文件测试**"'},{default:a((()=>[p("​")])),_:1})]),ne,ae,ee,ce,te,pe,t("h3",re,[Ee,p(),r(ft,{class:"header-anchor",href:"#_3-3-接口定义","aria-label":'Permalink to "**3.3 接口定义**"'},{default:a((()=>[p("​")])),_:1})]),ye,ie,Fe,ue,t("h3",de,[me,p(),r(ft,{class:"header-anchor",href:"#_3-4-上传分块开发","aria-label":'Permalink to "**3.4 上传分块开发**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",De,[Ae,p(),r(ft,{class:"header-anchor",href:"#_3-4-1-dao开发","aria-label":'Permalink to "**3.4.1 DAO开发**"'},{default:a((()=>[p("​")])),_:1})]),ge,t("h4",he,[Ce,p(),r(ft,{class:"header-anchor",href:"#_3-4-2-service开发","aria-label":'Permalink to "**3.4.2 Service开发**"'},{default:a((()=>[p("​")])),_:1})]),t("h5",be,[Be,p(),r(ft,{class:"header-anchor",href:"#_3-4-2-1-检查文件和分块","aria-label":'Permalink to "**3.4.2.1 检查文件和分块**"'},{default:a((()=>[p("​")])),_:1})]),fe,ke,Se,ve,Me,t("h5",je,[Pe,p(),r(ft,{class:"header-anchor",href:"#_3-4-2-2-上传分块","aria-label":'Permalink to "**3.4.2.2 上传分块**"'},{default:a((()=>[p("​")])),_:1})]),_e,xe,Ie,Te,t("h5",Oe,[Re,p(),r(ft,{class:"header-anchor",href:"#_3-4-2-3-上传分块测试","aria-label":'Permalink to "**3.4.2.3 上传分块测试**"'},{default:a((()=>[p("​")])),_:1})]),we,Le,Ne,Ue,ze,Ke,qe,He,We,t("h3",Ge,[$e,p(),r(ft,{class:"header-anchor",href:"#_3-5-合并分块开发","aria-label":'Permalink to "**3.5 合并分块开发**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",Ve,[Xe,p(),r(ft,{class:"header-anchor",href:"#_3-5-1-service开发","aria-label":'Permalink to "**3.5.1 service开发**"'},{default:a((()=>[p("​")])),_:1})]),Je,Qe,Ye,Ze,t("h4",sc,[lc,p(),r(ft,{class:"header-anchor",href:"#_3-5-2-接口层完善","aria-label":'Permalink to "**3.5.2 接口层完善**"'},{default:a((()=>[p("​")])),_:1})]),oc,nc,t("h4",ac,[ec,p(),r(ft,{class:"header-anchor",href:"#_3-5-3-合并分块测试","aria-label":'Permalink to "**3.5.3 合并分块测试**"'},{default:a((()=>[p("​")])),_:1})]),cc,tc,pc,rc,Ec,yc,t("h2",ic,[Fc,p(),r(ft,{class:"header-anchor",href:"#四-绑定媒资","aria-label":'Permalink to "**四 绑定媒资**"'},{default:a((()=>[p("​")])),_:1})]),t("h3",uc,[dc,p(),r(ft,{class:"header-anchor",href:"#_4-1-需求分析","aria-label":'Permalink to "**4.1 需求分析**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",mc,[Dc,p(),r(ft,{class:"header-anchor",href:"#_4-1-1-业务流程","aria-label":'Permalink to "**4.1.1 业务流程**"'},{default:a((()=>[p("​")])),_:1})]),Ac,gc,hc,Cc,bc,Bc,fc,kc,Sc,vc,Mc,jc,Pc,_c,t("h4",xc,[Ic,p(),r(ft,{class:"header-anchor",href:"#_4-1-2-数据模型","aria-label":'Permalink to "**4.1.2 数据模型**"'},{default:a((()=>[p("​")])),_:1})]),Tc,Oc,t("h3",Rc,[wc,p(),r(ft,{class:"header-anchor",href:"#_4-2-接口定义","aria-label":'Permalink to "**4.2 接口定义**"'},{default:a((()=>[p("​")])),_:1})]),Lc,Nc,Uc,zc,Kc,qc,Hc,Wc,Gc,t("h3",$c,[Vc,p(),r(ft,{class:"header-anchor",href:"#_4-3-接口开发","aria-label":'Permalink to "**4.3 接口开发**"'},{default:a((()=>[p("​")])),_:1})]),t("h4",Xc,[Jc,p(),r(ft,{class:"header-anchor",href:"#_4-3-1-dao开发","aria-label":'Permalink to "**4.3.1 DAO开发**"'},{default:a((()=>[p("​")])),_:1})]),Qc,t("h4",Yc,[Zc,p(),r(ft,{class:"header-anchor",href:"#_4-3-2-service开发","aria-label":'Permalink to "**4.3.2 Service开发**"'},{default:a((()=>[p("​")])),_:1})]),st,lt,ot,nt,t("h4",at,[et,p(),r(ft,{class:"header-anchor",href:"#_4-3-3-接口层完善","aria-label":'Permalink to "**4.3.3 接口层完善**"'},{default:a((()=>[p("​")])),_:1})]),ct,tt,t("h4",pt,[rt,p(),r(ft,{class:"header-anchor",href:"#_4-3-4-接口测试","aria-label":'Permalink to "**4.3.4 接口测试**"'},{default:a((()=>[p("​")])),_:1})]),Et,yt,it,Ft,ut,t("h3",dt,[mt,p(),r(ft,{class:"header-anchor",href:"#_4-4-实战","aria-label":'Permalink to "**4.4 实战**"'},{default:a((()=>[p("​")])),_:1})]),Dt,At,gt,ht,Ct,bt,Bt])),"main-header":a((()=>[E(s.$slots,"main-header")])),"main-header-after":a((()=>[E(s.$slots,"main-header-after")])),"main-nav":a((()=>[E(s.$slots,"main-nav")])),"main-content":a((()=>[E(s.$slots,"main-content")])),"main-content-after":a((()=>[E(s.$slots,"main-content-after")])),"main-nav-before":a((()=>[E(s.$slots,"main-nav-before")])),"main-nav-after":a((()=>[E(s.$slots,"main-nav-after")])),comment:a((()=>[E(s.$slots,"comment")])),footer:a((()=>[E(s.$slots,"footer")])),aside:a((()=>[E(s.$slots,"aside")])),"aside-custom":a((()=>[E(s.$slots,"aside-custom")])),default:a((()=>[E(s.$slots,"default")])),_:3},8,["frontmatter","data"])}]]);export{i as __pageData,ft as default};
