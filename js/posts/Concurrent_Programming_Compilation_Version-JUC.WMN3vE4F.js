import{u as i,p as s,o as h,c as l,w as a,a as k,_ as t,r as n,b as e,d as E}from"../../assets/app-BJOH8xQC.js";const p=e("h1",{id:"并发编程整理版",tabindex:"-1"},[E("并发编程整理版 "),e("a",{class:"header-anchor",href:"#并发编程整理版","aria-label":'Permalink to "并发编程整理版"'},"​")],-1),r=e("p",null,[E("参考视频："),e("a",{href:"https://www.bilibili.com/video/BV16J411h7Rd",target:"_blank",rel:"noreferrer"},"https://www.bilibili.com/video/BV16J411h7Rd")],-1),d=e("p",null,"笔记的整体结构依据视频编写，并随着学习的深入补充了很多知识",-1),g=e("h2",{id:"并发包",tabindex:"-1"},[E("并发包 "),e("a",{class:"header-anchor",href:"#并发包","aria-label":'Permalink to "并发包"'},"​")],-1),y=e("h3",{id:"conhashmap",tabindex:"-1"},[E("ConHashMap "),e("a",{class:"header-anchor",href:"#conhashmap","aria-label":'Permalink to "ConHashMap"'},"​")],-1),F=e("h4",{id:"并发集合",tabindex:"-1"},[E("并发集合 "),e("a",{class:"header-anchor",href:"#并发集合","aria-label":'Permalink to "并发集合"'},"​")],-1),A=e("h5",{id:"集合对比",tabindex:"-1"},[E("集合对比 "),e("a",{class:"header-anchor",href:"#集合对比","aria-label":'Permalink to "集合对比"'},"​")],-1),D=e("p",null,"三种集合：",-1),c=e("ul",null,[e("li",null,"HashMap 是线程不安全的，性能好"),e("li",null,"Hashtable 线程安全基于 synchronized，综合性能差，已经被淘汰"),e("li",null,"ConcurrentHashMap 保证了线程安全，综合性能较好，不止线程安全，而且效率高，性能好")],-1),o=e("p",null,"集合对比：",-1),u=e("ol",null,[e("li",null,"Hashtable 继承 Dictionary 类，HashMap、ConcurrentHashMap 继承 AbstractMap，均实现 Map 接口"),e("li",null,"Hashtable 底层是数组 + 链表，JDK8 以后 HashMap 和 ConcurrentHashMap 底层是数组 + 链表 + 红黑树"),e("li",null,"HashMap 线程非安全，Hashtable 线程安全，Hashtable 的方法都加了 synchronized 关来确保线程同步"),e("li",null,[E("ConcurrentHashMap、Hashtable "),e("strong",null,"不允许 null 值"),E("，HashMap 允许 null 值")]),e("li",null,"ConcurrentHashMap、HashMap 的初始容量为 16，Hashtable 初始容量为11，填充因子默认都是 0.75，两种 Map 扩容是当前容量翻倍：capacity * 2，Hashtable 扩容时是容量翻倍 + 1：capacity*2 + 1")],-1),C=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175111596.png",alt:"image-20230824175111596",loading:"lazy",decoding:"async",class:"lazy"})],-1),b=e("p",null,"工作步骤：",-1),v=e("ol",null,[e("li",null,[e("p",null,"初始化，使用 cas 来保证并发安全，懒惰初始化 table")]),e("li",null,[e("p",null,[E("树化，当 table.length < 64 时，先尝试扩容，超过 64 时，并且 bin.length > 8 时，会将"),e("strong",null,"链表树化"),E("，树化过程会用 synchronized 锁住链表头")]),e("p",null,[E("说明：锁住某个槽位的对象头，是一种很好的"),e("strong",null,"细粒度的加锁"),E("方式，类似 MySQL 中的行锁")])]),e("li",null,[e("p",null,"put，如果该 bin 尚未创建，只需要使用 cas 创建 bin；如果已经有了，锁住链表头进行后续 put 操作，元素添加至 bin 的尾部")]),e("li",null,[e("p",null,"get，无锁操作仅需要保证可见性，扩容过程中 get 操作拿到的是 ForwardingNode 会让 get 操作在新 table 进行搜索")]),e("li",null,[e("p",null,"扩容，扩容时以 bin 为单位进行，需要对 bin 进行 synchronized，但这时其它竞争线程也不是无事可做，它们会帮助把其它 bin 进行扩容")]),e("li",null,[e("p",null,"size，元素个数保存在 baseCount 中，并发时的个数变动保存在 CounterCell[] 当中，最后统计数量时累加")])],-1),B=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//需求：多个线程同时往HashMap容器中存入数据会出现安全问题")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentHashMapDemo"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Map<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> map "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentHashMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," main"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"args"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AddMapDataThread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"start"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AddMapDataThread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"start"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Thread."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sleep"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//休息5秒，确保两个线程执行完毕")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        System.out."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Map大小："'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," map."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//20万")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AddMapDataThread"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Thread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," run"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ; i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1000000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ; i"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ){")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ConcurrentHashMapDemo.map."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"键："'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"i , "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"值"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"i);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),m=e("hr",null,null,-1),f=e("h5",{id:"并发死链",tabindex:"-1"},[E("并发死链 "),e("a",{class:"header-anchor",href:"#并发死链","aria-label":'Permalink to "并发死链"'},"​")],-1),x=e("p",null,"JDK1.7 的 HashMap 采用的头插法（拉链法）进行节点的添加，HashMap 的扩容长度为原来的 2 倍",-1),V=e("p",null,"resize() 中节点（Entry）转移的源代码：",-1),T=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," transfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Entry"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] newTable, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rehash) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newTable.length;"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//得到新数组的长度   ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 遍历整个数组对应下标下的链表，e代表一个节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Entry<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table) {   ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 当e == null时，则该链表遍历完了，继续遍历下一数组下标的链表 ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," !="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e) { ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 先把e节点的下一节点存起来")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Entry<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next; ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (rehash) {              "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//得到新的hash值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                e.hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," :"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," hash"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e.key);  ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 在新数组下得到新的数组下标")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," indexFor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e.hash, newCapacity);  ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"             // 将e的next指针指向新数组下标的位置")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            e.next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newTable[i];   ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 将该数组下标的节点变为e节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            newTable[i] "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e; ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 遍历链表的下一节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," next;                                   ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),j=e("p",null,"JDK 8 虽然将扩容算法做了调整，改用了尾插法，但仍不意味着能够在多线程环境下能够安全扩容，还会出现其它问题（如扩容丢数据）",-1),N=e("p",null,[E("B站视频解析："),e("a",{href:"https://www.bilibili.com/video/BV1n541177Ea",target:"_blank",rel:"noreferrer"},"https://www.bilibili.com/video/BV1n541177Ea")],-1),K=e("hr",null,null,-1),S=e("h4",{id:"成员属性",tabindex:"-1"},[E("成员属性 "),e("a",{class:"header-anchor",href:"#成员属性","aria-label":'Permalink to "成员属性"'},"​")],-1),I=e("h5",{id:"变量",tabindex:"-1"},[E("变量 "),e("a",{class:"header-anchor",href:"#变量","aria-label":'Permalink to "变量"'},"​")],-1),w=e("ul",null,[e("li",null,[e("p",null,"存储数组："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] table;")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"散列表的长度："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAXIMUM_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 30"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 最大长度")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DEFAULT_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 默认长度")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"并发级别，JDK7 遗留下来，1.8 中不代表并发级别："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DEFAULT_CONCURRENCY_LEVEL "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"负载因子，JDK1.8 的 ConcurrentHashMap 中是固定值："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," float"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," LOAD_FACTOR "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0.75f"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"阈值："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TREEIFY_THRESHOLD "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 8"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 链表树化的阈值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," UNTREEIFY_THRESHOLD "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 6"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 红黑树转化为链表的阈值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MIN_TREEIFY_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 64"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 当数组长度达到64且某个桶位中的链表长度超过8，才会真正树化")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"扩容相关："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MIN_TRANSFER_STRIDE "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 线程迁移数据【最小步长】，控制线程迁移任务的最小区间")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_BITS "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 用来计算扩容时生成的【标识戳】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAX_RESIZERS "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"32"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_BITS)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 65535-1并发扩容最多线程数")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_SHIFT "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 32"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_BITS;\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 扩容时使用")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"节点哈希值："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MOVED     "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; \t\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示当前节点是 FWD 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TREEBIN   "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; \t\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示当前节点已经树化，且当前节点为 TreeBin 对象")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESERVED  "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; \t\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示节点时临时节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HASH_BITS "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0x7fffffff"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; \t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 正常节点的哈希值的可用的位数")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"扩容过程：volatile 修饰保证多线程的可见性"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 扩容过程中，会将扩容中的新 table 赋值给 nextTable 保持引用，扩容结束之后，这里会被设置为 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] nextTable;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 记录扩容进度，所有线程都要从 0 - transferIndex 中分配区间任务，简单说就是老表转移到哪了，索引从高到低转移")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," transferIndex;")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"累加统计："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// LongAdder 中的 baseCount 未发生竞争时或者当前LongAdder处于加锁状态时，增量累到到 baseCount 中")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," baseCount;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// LongAdder 中的 cellsBuzy，0 表示当前 LongAdder 对象无锁状态，1 表示当前 LongAdder 对象加锁状态")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cellsBusy;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// LongAdder 中的 cells 数组，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," CounterCell"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] counterCells;")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"控制变量："),e("p",null,[e("strong",null,"sizeCtl"),E(" < 0：")]),e("ul",null,[e("li",null,[e("p",null,"-1 表示当前 table 正在初始化（有线程在创建 table 数组），当前线程需要自旋等待")]),e("li",null,[e("p",null,"其他负数表示当前 map 的 table 数组正在进行扩容，高 16 位表示扩容的标识戳；低 16 位表示 (1 + nThread) 当前参与并发扩容的线程数量 + 1")])]),e("p",null,"sizeCtl = 0，表示创建 table 数组时使用 DEFAULT_CAPACITY 为数组大小"),e("p",null,"sizeCtl > 0："),e("ul",null,[e("li",null,"如果 table 未初始化，表示初始化大小"),e("li",null,"如果 table 已经初始化，表示下次扩容时的触发条件（阈值，元素个数，不是数组的长度）")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sizeCtl;\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// volatile 保持可见性")])])]),e("button",{class:"collapse"})])])],-1),M=e("hr",null,null,-1),z=e("h5",{id:"内部类",tabindex:"-1"},[E("内部类 "),e("a",{class:"header-anchor",href:"#内部类","aria-label":'Permalink to "内部类"'},"​")],-1),H=e("ul",null,[e("li",null,[e("p",null,"Node 节点："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Node"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"implements"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Entry"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 节点哈希值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," K key;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 单向链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> next;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"TreeBin 节点："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," TreeBin"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extends"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Node"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 红黑树根节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"     TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> root;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 链表的头节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> first;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 等待者线程")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Thread waiter;")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     volatile"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lockState;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 写锁状态 写锁是独占状态，以散列表来看，真正进入到 TreeBin 中的写线程同一时刻只有一个线程")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," WRITER "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 等待者状态（写线程在等待），当 TreeBin 中有读线程目前正在读取数据时，写线程无法修改数据")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," WAITER "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 读锁状态是共享，同一时刻可以有多个线程 同时进入到 TreeBi 对象中获取数据，每一个线程都给 lockState + 4")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," READER "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 4"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"TreeNode 节点："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," TreeNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extends"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Node"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> parent;  "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// red-black tree links")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> left;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> right;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> prev;   "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//双向链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," red;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"ForwardingNode 节点：转移节点"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ForwardingNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extends"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Node"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 持有扩容后新的哈希表的引用")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] nextTable;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"     ForwardingNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"tab"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         // ForwardingNode 节点的 hash 值设为 -1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"         super"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(MOVED, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"         this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".nextTable "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"     }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")])])]),e("button",{class:"collapse"})])])],-1),L=e("hr",null,null,-1),P=e("h5",{id:"代码块",tabindex:"-1"},[E("代码块 "),e("a",{class:"header-anchor",href:"#代码块","aria-label":'Permalink to "代码块"'},"​")],-1),_=e("ul",null,[e("li",null,[e("p",null,"变量："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示sizeCtl属性在 ConcurrentHashMap 中内存偏移地址")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SIZECTL;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示transferIndex属性在 ConcurrentHashMap 中内存偏移地址")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TRANSFERINDEX;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示baseCount属性在 ConcurrentHashMap 中内存偏移地址")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," BASECOUNT;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示cellsBusy属性在 ConcurrentHashMap 中内存偏移地址")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CELLSBUSY;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示cellValue属性在 CounterCell 中内存偏移地址")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CELLVALUE;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示数组第一个元素的偏移地址")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ABASE;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 用位移运算替代乘法")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ASHIFT;")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"赋值方法："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示数组单元所占用空间大小，scale 表示 Node[] 数组中每一个单元所占用空间大小，int 是 4 字节")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," scale "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"arrayIndexScale"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ak);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 判断一个数是不是 2 的 n 次幂，比如 8：1000 & 0111 = 0000")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((scale "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (scale "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"data type scale not a power of two"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// numberOfLeadingZeros(n)：返回当前数值转换为二进制后，从高位到低位开始统计，看有多少个0连续在一起")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 8 → 1000 numberOfLeadingZeros(8) = 28")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 4 → 100 numberOfLeadingZeros(4) = 29   int 值就是占4个字节")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ASHIFT "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 31"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Integer."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"numberOfLeadingZeros"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(scale);")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ASHIFT = 31 - 29 = 2 ，int 的大小就是 2 的 2 次方，获取次方数")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ABASE + （5 << ASHIFT） 用位移运算替代了乘法，获取 arr[5] 的值")])])]),e("button",{class:"collapse"})])])],-1),R=e("hr",null,null,-1),O=e("h4",{id:"构造方法",tabindex:"-1"},[E("构造方法 "),e("a",{class:"header-anchor",href:"#构造方法","aria-label":'Permalink to "构造方法"'},"​")],-1),U=e("ul",null,[e("li",null,[e("p",null,"无参构造， 散列表结构延迟初始化，默认的数组大小是 16："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentHashMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"有参构造："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentHashMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," initialCapacity) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 指定容量初始化")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," IllegalArgumentException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cap "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MAXIMUM_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"               MAXIMUM_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"               // 假如传入的参数是 16，16 + 8 + 1 ，最后得到 32")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"               // 传入 12， 12 + 6 + 1 = 19，最后得到 32，尽可能的大，与 HashMap不一样")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"               tableSizeFor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"));")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // sizeCtl > 0，当目前 table 未初始化时，sizeCtl 表示初始化容量")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".sizeCtl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cap;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tableSizeFor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 4"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 8"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," :"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAXIMUM_CAPACITY) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAXIMUM_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("p",null,[E("HashMap 部分详解了该函数，核心思想就是"),e("strong",null,"把最高位是 1 的位以及右边的位全部置 1"),E("，结果加 1 后就是 2 的 n 次幂")])]),e("li",null,[e("p",null,"多个参数构造方法："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentHashMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," initialCapacity, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," loadFactor, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," concurrencyLevel) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(loadFactor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0.0f"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," concurrencyLevel "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," IllegalArgumentException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 初始容量小于并发级别")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," concurrencyLevel)  ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 把并发级别赋值给初始容量")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," concurrencyLevel; ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t// loadFactor 默认是 0.75")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," size "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1.0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")initialCapacity "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," loadFactor);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cap "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (size "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")MAXIMUM_CAPACITY) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        MAXIMUM_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tableSizeFor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")size);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // sizeCtl > 0，当目前 table 未初始化时，sizeCtl 表示初始化容量")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".sizeCtl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cap;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"集合构造方法："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentHashMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Map"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," extends K, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," extends V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," m) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".sizeCtl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DEFAULT_CAPACITY;\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 默认16")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    putAll"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(m);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," putAll"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Map"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," extends K, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," extends V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," m) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 尝试触发扩容")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    tryPresize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(m."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Entry<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," m."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"entrySet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        putVal"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tryPresize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," size) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 扩容为大于 2 倍的最小的 2 的 n 次幂")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (size "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MAXIMUM_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAXIMUM_CAPACITY "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    \ttableSizeFor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(size "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (size "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sizeCtl) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 数组还未初始化，【一般是调用集合构造方法才会成立，put 后调用该方法都是不成立的】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapInt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", SIZECTL, sc, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (table "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] nt "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[])"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[n];")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        table "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nt;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 扩容阈值：n - 1/4 n")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    sizeCtl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc;\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 扩容阈值赋值给sizeCtl")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 未达到扩容阈值或者数组长度已经大于最大长度")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAXIMUM_CAPACITY)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 与 addCount 逻辑相同")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),q=e("hr",null,null,-1),Z=e("h4",{id:"成员方法",tabindex:"-1"},[E("成员方法 "),e("a",{class:"header-anchor",href:"#成员方法","aria-label":'Permalink to "成员方法"'},"​")],-1),Y=e("h5",{id:"数据访存",tabindex:"-1"},[E("数据访存 "),e("a",{class:"header-anchor",href:"#数据访存","aria-label":'Permalink to "数据访存"'},"​")],-1),W=e("ul",null,[e("li",null,[e("p",null,[E("tabAt()：获取数组某个槽位的"),e("strong",null,"头节点"),E("，类似于数组中的直接寻址 arr[i]")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// i 是数组索引")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] tab, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // (i << ASHIFT) + ABASE == ABASE + i * 4 （一个 int 占 4 个字节），这就相当于寻址，替代了乘法")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getObjectVolatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, (("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ASHIFT) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ABASE);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"casTabAt()：指定数组索引位置修改原值为指定的值"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," casTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] tab, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i, Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c, Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapObject"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, (("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ASHIFT) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ABASE, c, v);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"setTabAt()：指定数组索引位置设置值"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] tab, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i, Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"putObjectVolatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, (("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ASHIFT) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ABASE, v);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),X=e("hr",null,null,-1),J=e("h5",{id:"添加方法",tabindex:"-1"},[E("添加方法 "),e("a",{class:"header-anchor",href:"#添加方法","aria-label":'Permalink to "添加方法"'},"​")],-1),$=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(K key, V value) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 第三个参数 onlyIfAbsent 为 false 表示哈希表中存在相同的 key 时【用当前数据覆盖旧数据】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," putVal"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),Q=e("ul",null,[e("li",null,[e("p",null,"putVal()"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"putVal"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(K key, V value, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," onlyIfAbsent) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 【ConcurrentHashMap 不能存放 null 值】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NullPointerException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 扰动运算，高低位都参与寻址运算")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," spread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hashCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 表示当前 k-v 封装成 node 后插入到指定桶位后，在桶位中的所属链表的下标位置")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," binCount "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // tab 引用当前 map 的数组 table，开始自旋")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // f 表示桶位的头节点，n 表示哈希表数组的长度")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // i 表示 key 通过寻址计算后得到的桶位下标，fh 表示桶位头结点的 hash 值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> f; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n, i, fh;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE1】：表示当前 map 中的 table 尚未初始化")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //【延迟初始化】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," initTable"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE2】：i 表示 key 使用【寻址算法】得到 key 对应数组的下标位置，tabAt 获取指定桶位的头结点f")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 对应的数组为 null 说明没有哈希冲突，直接新建节点添加到表中")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(hash, key, value, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE3】：逻辑说明数组已经被初始化，并且当前 key 对应的位置不为 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 条件成立表示当前桶位的头结点为 FWD 结点，表示目前 map 正处于扩容过程中")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((fh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f.hash) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MOVED)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 当前线程【需要去帮助哈希表完成扩容】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," helpTransfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, f);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE4】：哈希表没有在扩容，当前桶位可能是链表也可能是红黑树")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 当插入 key 存在时，会将旧值赋值给 oldVal 返回")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            V oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 【锁住当前 key 寻址的桶位的头节点】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            synchronized"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 这里重新获取一下桶的头节点有没有被修改，因为可能被其他线程修改过，这里是线程安全的获取")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 【头节点的哈希值大于 0 说明当前桶位是普通的链表节点】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (fh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 当前的插入操作没出现重复的 key，追加到链表的末尾，binCount表示链表长度 -1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 插入的key与链表中的某个元素的 key 一致，变成替换操作，binCount 表示第几个节点冲突")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        binCount "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 迭代循环当前桶位的链表，e 是每次循环处理节点，e 初始是头节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f;; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"binCount) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // 当前循环节点 key")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            K ek;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // key 的哈希值与当前节点的哈希一致，并且 key 的值也相同")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (e.hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                ((ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.key) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                 (ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ek)))) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 把当前节点的 value 赋值给 oldVal")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 允许覆盖")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"onlyIfAbsent)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                    // 新数据覆盖旧数据")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    e.val "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 跳出循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> pred "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // 如果下一个节点为空，把数据封装成节点插入链表尾部，【binCount 代表长度 - 1】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                pred.next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(hash, key,")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                                          value, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 当前桶位头节点是红黑树")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeBin) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        binCount "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((TreeBin"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")f)."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"putTreeVal"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(hash, key,")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                                              value)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"onlyIfAbsent)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                p.val "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 条件成立说明当前是链表或者红黑树")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (binCount "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 如果 binCount >= 8 表示处理的桶位一定是链表，说明长度是 9")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (binCount "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TREEIFY_THRESHOLD)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 树化")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    treeifyBin"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," oldVal;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 统计当前 table 一共有多少数据，判断是否达到扩容阈值标准，触发扩容")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // binCount = 0 表示当前桶位为 null，node 可以直接放入，2 表示当前桶位已经是红黑树")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    addCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1L"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", binCount);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"spread()：扰动函数"),e("p",null,[E("将 hashCode 无符号右移 16 位，高 16bit 和低 16bit 做异或，最后与 HASH_BITS 相与变成正数，"),e("strong",null,"与树化节点和转移节点区分"),E("，把高低位都利用起来减少哈希冲突，保证散列的均匀性")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," spread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"^"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HASH_BITS; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 0111 1111 1111 1111 1111 1111 1111 1111")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"initTable()：初始化数组，延迟初始化"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"initTable"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // tab 引用 map.table，sc 引用 sizeCtl")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] tab; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // table 尚未初始化，开始自旋")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // sc < 0 说明 table 正在初始化或者正在扩容，当前线程可以释放 CPU 资源")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sizeCtl) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Thread."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"yield"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // sizeCtl 设置为 -1，相当于加锁，【设置的是 SIZECTL 位置的数据】，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 因为是 sizeCtl 是基本类型，不是引用类型，所以 sc 保存的是数据的副本")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapInt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", SIZECTL, sc, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 线程安全的逻辑，再进行一次判断")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // sc > 0 创建 table 时使用 sc 为指定大小，否则使用 16 默认值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DEFAULT_CAPACITY;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 创建哈希表数组")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] nt "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[])"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[n];")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    table "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nt;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 扩容阈值，n >>> 2  => 等于 1/4 n ，n - (1/4)n = 3/4 n => 0.75 * n")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 解锁，把下一次扩容的阈值赋值给 sizeCtl")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                sizeCtl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"treeifyBin()：树化方法"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," treeifyBin"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] tab, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," index) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> b; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n, sc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 条件成立：【说明当前 table 数组长度未达到 64，此时不进行树化操作，进行扩容操作】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MIN_TREEIFY_CAPACITY)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 当前容量的 2 倍")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            tryPresize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 条件成立：说明当前桶位有数据，且是普通 node 数据。")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, index)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 【树化加锁】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            synchronized"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (b) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 条件成立：表示加锁没问题。")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, index) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> hd "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", tl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b; e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(e.hash, e.key, e.val,"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((p.prev "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tl) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            hd "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            tl.next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        tl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, index, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeBin<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(hd));")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,[E("addCount()：添加计数，"),e("strong",null,"代表哈希表中的数据总量")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," addCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," x, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," check) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 【上面这部分的逻辑就是 LongAdder 的累加逻辑】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    CounterCell"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] as; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b, s;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 判断累加数组 cells 是否初始化，没有就去累加 base 域，累加失败进入条件内逻辑")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((as "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," counterCells) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        !"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapLong"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", BASECOUNT, b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," baseCount, s "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," x)) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        CounterCell a; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," m;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // true 未竞争，false 发生竞争")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," uncontended "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 判断 cells 是否被其他线程初始化")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (as "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (m "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," as.length "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 前面的条件为 fasle 说明 cells 被其他线程初始化，通过 hash 寻址对应的槽位")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            (a "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," as[ThreadLocalRandom."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getProbe"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," m]) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 尝试去对应的槽位累加，累加失败进入 fullAddCount 进行重试或者扩容")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            !"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(uncontended "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapLong"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(a, CELLVALUE, v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a.value, v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," x))) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 与 Striped64#longAccumulate 方法相同")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            fullAddCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(x, uncontended);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 表示当前桶位是 null，或者一个链表节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (check "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")\t")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    \t// 【获取当前散列表元素个数】，这是一个期望值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        s "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," sumCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 表示一定 【是一个 put 操作调用的 addCount】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (check "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] tab, nt; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n, sc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 条件一：true 说明当前 sizeCtl 可能为一个负数表示正在扩容中，或者 sizeCtl 是一个正数，表示扩容阈值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //        false 表示哈希表的数据的数量没达到扩容条件")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 然后判断当前 table 数组是否初始化了，当前 table 长度是否小于最大值限制，就可以进行扩容")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (s "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")(sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sizeCtl) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"               (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAXIMUM_CAPACITY) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 16 -> 32 扩容 标识为：1000 0000 0001 1011，【负数，扩容批次唯一标识戳】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," resizeStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(n);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 表示当前 table，【正在扩容】，sc 高 16 位是扩容标识戳，低 16 位是线程数 + 1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 条件一：判断扩容标识戳是否一样，fasle 代表一样")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 勘误两个条件：")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 条件二是：sc == (rs << 16 ) + 1，true 代表扩容完成，因为低16位是1代表没有线程扩容了")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 条件三是：sc == (rs << 16) + MAX_RESIZERS，判断是否已经超过最大允许的并发扩容线程数")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 条件四：判断新表的引用是否是 null，代表扩容完成")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 条件五：【扩容是从高位到低位转移】，transferIndex < 0 说明没有区间需要扩容了")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_SHIFT) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAX_RESIZERS "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (nt "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextTable) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    transferIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 设置当前线程参与到扩容任务中，将 sc 低 16 位值加 1，表示多一个线程参与扩容")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 设置失败其他线程或者 transfer 内部修改了 sizeCtl 值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapInt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", SIZECTL, sc, sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    //【协助扩容线程】，持有nextTable参数")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    transfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, nt);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 逻辑到这说明当前线程是触发扩容的第一个线程，线程数量 + 2")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 1000 0000 0001 1011 0000 0000 0000 0000 +2 => 1000 0000 0001 1011 0000 0000 0000 0010")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapInt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", SIZECTL, sc,(rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_SHIFT) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //【触发扩容条件的线程】，不持有 nextTable，初始线程会新建 nextTable")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                transfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            s "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," sumCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,[E("resizeStamp()：扩容标识符，"),e("strong",null,"每次扩容都会产生一个，不是每个线程都产生"),E("，16 扩容到 32 产生一个，32 扩容到 64 产生一个")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 扩容的标识符")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 16 -> 32 从16扩容到32")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * numberOfLeadingZeros(16) => 1 0000 => 32 - 5 = 27 => 0000 0000 0001 1011")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * (1 << (RESIZE_STAMP_BITS - 1)) => 1000 0000 0000 0000 => 32768")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * ---------------------------------------------------------------")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 0000 0000 0001 1011")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 1000 0000 0000 0000")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 1000 0000 0001 1011")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 永远是负数")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," resizeStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 或运算")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Integer."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"numberOfLeadingZeros"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(n) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (RESIZE_STAMP_BITS "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// (16 -1 = 15)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),G=e("hr",null,null,-1),ii=e("h5",{id:"扩容方法",tabindex:"-1"},[E("扩容方法 "),e("a",{class:"header-anchor",href:"#扩容方法","aria-label":'Permalink to "扩容方法"'},"​")],-1),si=e("p",null,"扩容机制：",-1),hi=e("ul",null,[e("li",null,"当链表中元素个数超过 8 个，数组的大小还未超过 64 时，此时进行数组的扩容，如果超过则将链表转化成红黑树"),e("li",null,"put 数据后调用 addCount() 方法，判断当前哈希表的容量超过阈值 sizeCtl，超过进行扩容"),e("li",null,"增删改线程发现其他线程正在扩容，帮其扩容")],-1),li=e("p",null,"常见方法：",-1),ai=e("ul",null,[e("li",null,[e("p",null,"transfer()：数据转移到新表中，完成扩容"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," transfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] tab, Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] nextTab) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // n 表示扩容之前 table 数组的长度")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length, stride;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // stride 表示分配给线程任务的步长，默认就是 16 ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((stride "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (NCPU "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 3"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," NCPU "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MIN_TRANSFER_STRIDE)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        stride "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MIN_TRANSFER_STRIDE;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 如果当前线程为触发本次扩容的线程，需要做一些扩容准备工作，【协助线程不做这一步】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (nextTab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 创建一个容量是之前【二倍的 table 数组】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] nt "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[])"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"];")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            nextTab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nt;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Throwable "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"ex"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            sizeCtl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Integer.MAX_VALUE;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 把新表赋值给对象属性 nextTable，方便其他线程获取新表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        nextTable "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextTab;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 记录迁移数据整体位置的一个标记，transferIndex 计数从1开始不是 0，所以这里是长度，不是长度-1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        transferIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 新数组的长度")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextn "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextTab.length;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 当某个桶位数据处理完毕后，将此桶位设置为 fwd 节点，其它写线程或读线程看到后，可以从中获取到新表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ForwardingNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> fwd "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ForwardingNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(nextTab);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 推进标记")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 完成标记")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," finishing "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // i 表示分配给当前线程任务，执行到的桶位")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // bound 表示分配给当前线程任务的下界限制，因为是倒序迁移，16 迁移完 迁移 15，15完成去迁移14")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", bound "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> f; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," fh;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 给当前线程【分配任务区间】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (advance) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 分配任务的开始下标，分配任务的结束下标")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextIndex, nextBound;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"         ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // --i 让当前线程处理下一个索引，true说明当前的迁移任务尚未完成，false说明线程已经完成或者还未分配")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"--"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," bound "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," finishing)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 迁移的开始下标，小于0说明没有区间需要迁移了，设置当前线程的 i 变量为 -1 跳出循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((nextIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," transferIndex) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 逻辑到这说明还有区间需要分配，然后给当前线程分配任务，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapInt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TRANSFERINDEX, nextIndex,")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                      // 判断区间是否还够一个步长，不够就全部分配")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                      nextBound "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (nextIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," stride "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," stride "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 当前线程的结束下标")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                bound "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextBound;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 当前线程的开始下标，上一个线程结束的下标的下一个索引就是这个线程开始的下标")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 任务分配结束，跳出循环执行迁移操作")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【分配完成，开始数据迁移操作】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE1】：i < 0 成立表示当前线程未分配到任务，或者任务执行完了")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextn) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 如果迁移完成")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (finishing) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                nextTable "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// help GC")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                table "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextTab;\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 新表赋值给当前对象")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                sizeCtl "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 扩容阈值为 2n - n/2 = 3n/2 = 0.75*(2n)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 当前线程完成了分配的任务区间，可以退出，先把 sizeCtl 赋值给 sc 保留")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapInt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", SIZECTL, sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sizeCtl, sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 判断当前线程是不是最后一个线程，不是的话直接 return，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," resizeStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(n) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_SHIFT)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 所以最后一个线程退出的时候，sizeCtl 的低 16 位为 1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                finishing "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 【这里表示最后一个线程需要重新检查一遍是否有漏掉的区间】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE2】：当前桶位未存放数据，只需要将此处设置为 fwd 节点即可。")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," casTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", fwd);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE3】：说明当前桶位已经迁移过了，当前线程不用再处理了，直接处理下一个桶位即可")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((fh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f.hash) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MOVED)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE4】：当前桶位有数据，而且 node 节点不是 fwd 节点，说明这些数据需要迁移")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 【锁住头节点】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            synchronized"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 二次检查，防止头节点已经被修改了，因为这里才是线程安全的访问")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 【迁移数据的逻辑，和 HashMap 相似】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // ln 表示低位链表引用")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // hn 表示高位链表引用")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> ln, hn;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 哈希 > 0 表示当前桶位是链表桶位")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (fh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 和 HashMap 的处理方式一致，与老数组长度相与，16 是 10000")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 判断对应的 1 的位置上是 0 或 1 分成高低位链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," runBit "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," fh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> lastRun "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 遍历链表，寻找【逆序看】最长的对应位相同的链表，看下面的图更好的理解")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f.next; p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.next) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // 将当前节点的哈希 与 n")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // 如果当前值与前面节点的值 对应位 不同，则修改 runBit，把 lastRun 指向当前节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," runBit) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                runBit "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                lastRun "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 判断筛选出的链表是低位的还是高位的")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (runBit "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            ln "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lastRun;\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ln 指向该链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            hn "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// hn 为 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 说明 lastRun 引用的链表为高位链表，就让 hn 指向高位链表头节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            hn "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lastRun;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            ln "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 从头开始遍历所有的链表节点，迭代到 p == lastRun 节点跳出循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f; p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lastRun; p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.next) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ph "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.hash; K pk "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.key; V pv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((ph "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 【头插法】，从右往左看，首先 ln 指向的是上一个节点，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 所以这次新建的节点的 next 指向上一个节点，然后更新 ln 的引用")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                ln "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(ph, pk, pv, ln);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                hn "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(ph, pk, pv, hn);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 高低位链设置到新表中的指定位置")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(nextTab, i, ln);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(nextTab, i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n, hn);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 老表中的该桶位设置为 fwd 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i, fwd);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 条件成立：表示当前桶位是 红黑树结点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeBin) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        TreeBin<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (TreeBin"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")f;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> lo "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", loTail "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> hi "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", hiTail "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", hc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 迭代 TreeBin 中的双向链表，从头结点至尾节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t.first; e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // 迭代的当前元素的 hash")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.hash;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                (h, e.key, e.val, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // 条件成立表示当前循环节点属于低位链节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((p.prev "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," loTail) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    lo "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                    //【尾插法】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    loTail.next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // loTail 指向尾节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                loTail "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                ++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"lc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((p.prev "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hiTail) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    hi "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    hiTail.next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                hiTail "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                ++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"hc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 拆成的高位低位两个链，【判断是否需要需要转化为链表】，反之保持树化")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ln "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," UNTREEIFY_THRESHOLD) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," untreeify"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(lo) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        (hc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeBin<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(lo) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        hn "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (hc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," UNTREEIFY_THRESHOLD) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," untreeify"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(hi) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        (lc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeBin<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(hi) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(nextTab, i, ln);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(nextTab, i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n, hn);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i, fwd);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        advance "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("p",null,[E("链表处理的 LastRun 机制，"),e("strong",null,"可以减少节点的创建")]),e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175210854.png",alt:"image-20230824175210854",loading:"lazy",decoding:"async",class:"lazy"})])]),e("li",null,[e("p",null,"helpTransfer()：帮助扩容机制"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"helpTransfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] tab, Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] nextTab; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 数组不为空，节点是转发节点，获取转发节点指向的新表开始协助主线程扩容")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ForwardingNode) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        (nextTab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((ForwardingNode"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")f).nextTable) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 扩容标识戳")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," resizeStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab.length);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 判断数据迁移是否完成，迁移完成会把 新表赋值给 nextTable 属性")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (nextTab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextTable "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sizeCtl) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RESIZE_STAMP_SHIFT) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MAX_RESIZERS "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," transferIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 设置扩容线程数量 + 1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (U."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSwapInt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", SIZECTL, sc, sc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 协助扩容")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                transfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, nextTab);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextTab;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),ki=e("hr",null,null,-1),ti=e("h5",{id:"获取方法",tabindex:"-1"},[E("获取方法 "),e("a",{class:"header-anchor",href:"#获取方法","aria-label":'Permalink to "获取方法"'},"​")],-1),ni=e("p",null,"ConcurrentHashMap 使用 get() 方法获取指定 key 的数据",-1),ei=e("ul",null,[e("li",null,[e("p",null,"get()：获取指定数据的方法"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] tab; Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e, p; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n, eh; K ek;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 扰动运算，获取 key 的哈希值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," spread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hashCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 判断当前哈希表的数组是否初始化")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 如果 table 已经初始化，进行【哈希寻址】，映射到数组对应索引处，获取该索引处的头节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        (e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 对比头结点 hash 与查询 key 的 hash 是否一致")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((eh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.hash) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 进行值的判断，如果成功就说明当前节点就是要查询的节点，直接返回")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.key) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ek)))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 当前槽位的【哈希值小于0】说明是红黑树节点或者是正在扩容的 fwd 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (eh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"find"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, key)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.val "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 当前桶位是【链表】，循环遍历查找")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (e.hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ((ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.key) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ek))))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"ForwardingNode#find：转移节点的查找方法"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," find"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h, Object k) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 获取新表的引用")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    outer"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," nextTable;;)  {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // e 表示在扩容而创建新表使用寻址算法得到的桶位头结点，n 表示为扩容而创建的新表的长度")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (k "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 在新表中重新定位 hash 对应的头结点，表示在 oldTable 中对应的桶位在迁移之前就是 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            (e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," eh; K ek;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 【哈希相同值也相同】，表示新表当前命中桶位中的数据，即为查询想要数据")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((eh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.hash) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.key) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," k "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," k."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ek))))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e;")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // eh < 0 说明当前新表中该索引的头节点是 TreeBin 类型，或者是 FWD 类型")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (eh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 在并发很大的情况下新扩容的表还没完成可能【再次扩容】，在此方法处再次拿到 FWD 类型")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ForwardingNode) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 继续获取新的 fwd 指向的新数组的地址，递归了")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((ForwardingNode"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")e).nextTable;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," outer;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 说明此桶位为 TreeBin 节点，使用TreeBin.find 查找红黑树中相应节点。")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"find"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, k);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 逻辑到这说明当前桶位是链表，将当前元素指向链表的下一个元素，判断当前元素的下一个位置是否为空")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 条件成立说明迭代到链表末尾，【未找到对应的数据，返回 null】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),Ei=e("hr",null,null,-1),pi=e("h5",{id:"删除方法",tabindex:"-1"},[E("删除方法 "),e("a",{class:"header-anchor",href:"#删除方法","aria-label":'Permalink to "删除方法"'},"​")],-1),ri=e("ul",null,[e("li",null,[e("p",null,"remove()：删除指定元素"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"remove"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," replaceNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,[E("replaceNode()：替代指定的元素，会协助扩容，"),e("strong",null,"增删改（写）都会协助扩容，查询（读）操作不会"),E("，因为读操作不涉及加锁")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"replaceNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key, V value, Object cv) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 计算 key 扰动运算后的 hash")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," spread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hashCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 开始自旋")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," table;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> f; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n, i, fh;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE1】：table 还未初始化或者哈希寻址的数组索引处为 null，直接结束自旋，返回 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab.length) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE2】：条件成立说明当前 table 正在扩容，【当前是个写操作，所以当前线程需要协助 table 完成扩容】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((fh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f.hash) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MOVED)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," helpTransfer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, f);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【CASE3】：当前桶位可能是 链表 也可能是 红黑树 ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 保留替换之前数据引用")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            V oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 校验标记")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," validated "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 【加锁当前桶位头结点】，加锁成功之后会进入代码块")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            synchronized"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 双重检查")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 说明当前节点是链表节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (fh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        validated "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        //遍历所有的节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f, pred "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            K ek;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                            // hash 和值都相同，定位到了具体的节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (e.hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                ((ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.key) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                 (ek "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ek)))) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 当前节点的value")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                V ev "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (cv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ev "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    (ev "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cv."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ev))) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                    // 将当前节点的值 赋值给 oldVal 后续返回会用到")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ev;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 条件成立说明是替换操作")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                        e.val "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;\t")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                    else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (pred "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 非头节点删除操作，断开链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                        pred.next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next;\t")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                    else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                        // 说明当前节点即为头结点，将桶位头节点设置为以前头节点的下一个节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                                        setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i, e.next);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            pred "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e.next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 说明是红黑树节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TreeBin) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        validated "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        TreeBin<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (TreeBin"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")f;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        TreeNode<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> r, p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t.root) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," r."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"findTreeNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(hash, key, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            V pv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.val;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (cv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," pv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                (pv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cv."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(pv))) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," pv;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 条件成立说明替换操作")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    p.val "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                // 删除操作")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (t."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"removeTreeNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(p))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                                    setTabAt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(tab, i, "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"untreeify"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(t.first));")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 其他线程修改过桶位头结点时，当前线程 sync 头结点锁错对象，validated 为 false，会进入下次 for 自旋")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (validated) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (oldVal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 替换的值为 null，【说明当前是一次删除操作，更新当前元素个数计数器】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        addCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1L"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," oldVal;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),di=e("p",null,[E("参考视频："),e("a",{href:"https://space.bilibili.com/457326371/",target:"_blank",rel:"noreferrer"},"https://space.bilibili.com/457326371/")],-1),gi=e("hr",null,null,-1),yi=e("h4",{id:"jdk7原理",tabindex:"-1"},[E("JDK7原理 "),e("a",{class:"header-anchor",href:"#jdk7原理","aria-label":'Permalink to "JDK7原理"'},"​")],-1),Fi=e("p",null,[E("ConcurrentHashMap 对锁粒度进行了优化，"),e("strong",null,"分段锁技术"),E("，将整张表分成了多个数组（Segment），每个数组又是一个类似 HashMap 数组的结构。允许多个修改操作并发进行，Segment 是一种可重入锁，继承 ReentrantLock，并发时锁住的是每个 Segment，其他 Segment 还是可以操作的，这样不同 Segment 之间就可以实现并发，大大提高效率。")],-1),Ai=e("p",null,[E("底层结构： "),e("strong",null,"Segment 数组 + HashEntry 数组 + 链表"),E("（数组 + 链表是 HashMap 的结构）")],-1),Di=e("ul",null,[e("li",null,[e("p",null,"优点：如果多个线程访问不同的 segment，实际是没有冲突的，这与 JDK8 中是类似的")]),e("li",null,[e("p",null,"缺点：Segments 数组默认大小为16，这个容量初始化指定后就不能改变了，并且不是懒惰初始化"),e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175317393.png",alt:"image-20230824175317393",loading:"lazy",decoding:"async",class:"lazy"})])])],-1),ci=e("hr",null,null,-1),oi=e("h3",{id:"copyonwrite",tabindex:"-1"},[E("CopyOnWrite "),e("a",{class:"header-anchor",href:"#copyonwrite","aria-label":'Permalink to "CopyOnWrite"'},"​")],-1),ui=e("h4",{id:"原理分析",tabindex:"-1"},[E("原理分析 "),e("a",{class:"header-anchor",href:"#原理分析","aria-label":'Permalink to "原理分析"'},"​")],-1),Ci=e("p",null,[E("CopyOnWriteArrayList 采用了"),e("strong",null,"写入时拷贝"),E("的思想，增删改操作会将底层数组拷贝一份，在新数组上执行操作，不影响其它线程的"),e("strong",null,"并发读，读写分离")],-1),bi=e("p",null,"CopyOnWriteArraySet 底层对 CopyOnWriteArrayList 进行了包装，装饰器模式",-1),vi=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CopyOnWriteArraySet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    al "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CopyOnWriteArrayList<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),Bi=e("ul",null,[e("li",null,[e("p",null,"存储结构："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] array;\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// volatile 保证了读写线程之间的可见性")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"全局锁：保证线程的执行安全"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ReentrantLock lock "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ReentrantLock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,[E("新增数据：需要加锁，"),e("strong",null,"创建新的数组操作")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(E e) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ReentrantLock lock "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".lock;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 加锁，保证线程安全")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 获取旧的数组")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] elements "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," len "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," elements.length;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 【拷贝新的数组（这里是比较耗时的操作，但不影响其它读线程）】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] newElements "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Arrays."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"copyOf"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(elements, len "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 添加新元素")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        newElements[len] "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 替换旧的数组，【这个操作以后，其他线程获取数组就是获取的新数组了】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        setArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(newElements);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"unlock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,[E("读操作：不加锁，"),e("strong",null,"在原数组上操作")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," E "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," index) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), index);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," E "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] a, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," index) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (E) a[index];")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("p",null,"适合读多写少的应用场景")]),e("li",null,[e("p",null,[E("迭代器：CopyOnWriteArrayList 在返回迭代器时，"),e("strong",null,"创建一个内部数组当前的快照（引用）"),E("，即使其他线程替换了原始数组，迭代器遍历的快照依然引用的是创建快照时的数组，所以这种实现方式也存在一定的数据延迟性，对其他线程并行添加的数据不可见")]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Iterator"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"E"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," iterator"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 获取到数组引用，整个遍历的过程该数组都不会变，一直引用的都是老数组，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," COWIterator<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 迭代器会创建一个底层array的快照，故主类的修改不影响该快照")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," COWIterator"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"implements"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ListIterator"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 内部数组快照")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] snapshot;")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," COWIterator"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"elements"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," initialCursor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        cursor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," initialCursor;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 数组的引用在迭代过程不会改变")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        snapshot "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," elements;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 【不支持写操作】，因为是在快照上操作，无法同步回去")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," remove"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," UnsupportedOperationException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),mi=e("hr",null,null,-1),fi=e("h4",{id:"弱一致性",tabindex:"-1"},[E("弱一致性 "),e("a",{class:"header-anchor",href:"#弱一致性","aria-label":'Permalink to "弱一致性"'},"​")],-1),xi=e("p",null,"数据一致性就是读到最新更新的数据：",-1),Vi=e("ul",null,[e("li",null,[e("p",null,"强一致性：当更新操作完成之后，任何多个后续进程或者线程的访问都会返回最新的更新过的值")]),e("li",null,[e("p",null,"弱一致性：系统并不保证进程或者线程的访问都会返回最新的更新过的值，也不会承诺多久之后可以读到")])],-1),Ti=e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230720205728245.png",alt:"image-20230720205728245",style:{zoom:"50%"}},null,-1),ji=e("table",null,[e("thead",null,[e("tr",null,[e("th",null,"时间点"),e("th",null,"操作")])]),e("tbody",null,[e("tr",null,[e("td",null,"1"),e("td",null,"Thread-0 getArray()")]),e("tr",null,[e("td",null,"2"),e("td",null,"Thread-1 getArray()")]),e("tr",null,[e("td",null,"3"),e("td",null,"Thread-1 setArray(arrayCopy)")]),e("tr",null,[e("td",null,"4"),e("td",null,"Thread-0 array[index]")])])],-1),Ni=e("p",null,"Thread-0 读到了脏数据",-1),Ki=e("p",null,"不一定弱一致性就不好",-1),Si=e("ul",null,[e("li",null,[E("数据库的"),e("strong",null,"事务隔离级别"),E("就是弱一致性的表现")]),e("li",null,"并发高和一致性是矛盾的，需要权衡")],-1),Ii=e("hr",null,null,-1),wi=e("h4",{id:"安全失败",tabindex:"-1"},[E("安全失败 "),e("a",{class:"header-anchor",href:"#安全失败","aria-label":'Permalink to "安全失败"'},"​")],-1),Mi=e("p",null,"在 java.util 包的集合类就都是快速失败的，而 java.util.concurrent 包下的类都是安全失败",-1),zi=e("ul",null,[e("li",null,[e("p",null,[E("快速失败：在 A 线程使用"),e("strong",null,"迭代器"),E("对集合进行遍历的过程中，此时 B 线程对集合进行修改（增删改），或者 A 线程在遍历过程中对集合进行修改，都会导致 A 线程抛出 ConcurrentModificationException 异常")]),e("ul",null,[e("li",null,[E("AbstractList 类中的成员变量 modCount，用来记录 List 结构发生变化的次数，"),e("strong",null,"结构发生变化"),E("是指添加或者删除至少一个元素的操作，或者是调整内部数组的大小，仅仅设置元素的值不算结构发生变化")]),e("li",null,"在进行序列化或者迭代等操作时，需要比较操作前后 modCount 是否改变，如果改变了抛出 CME 异常")])]),e("li",null,[e("p",null,[E("安全失败：采用安全失败机制的集合容器，在"),e("strong",null,"迭代器"),E("遍历时直接在原集合数组内容上访问，但其他线程的增删改都会新建数组进行修改，就算修改了集合底层的数组容器，迭代器依然引用着以前的数组（"),e("strong",null,"快照思想"),E("），所以不会出现异常")]),e("p",null,"ConcurrentHashMap 不会出现并发时的迭代异常，因为在迭代过程中 CHM 的迭代器并没有判断结构的变化，迭代器还可以根据迭代的节点状态去寻找并发扩容时的新表进行迭代"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ConcurrentHashMap map "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentHashMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// KeyIterator")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Iterator iterator "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," map."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"keySet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"iterator"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),e("button",{class:"collapse"})]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Traverser"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] tab, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," size, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," index, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," limit) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 引用还是原来集合的 Node 数组，所以其他线程对数据的修改是可见的")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"     this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".tab "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tab;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"     this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".baseSize "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," size;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"     this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".baseIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".index "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," index;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"     this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".baseLimit "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," limit;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"     this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")])])]),e("button",{class:"collapse"})]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," hasNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() { "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," K "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"next"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NoSuchElementException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    K k "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.key;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    lastReturned "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 在方法中进行下一个节点的获取，会进行槽位头节点的状态判断")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    advance"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," k;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),Hi=e("hr",null,null,-1),Li=e("h3",{id:"collections",tabindex:"-1"},[E("Collections "),e("a",{class:"header-anchor",href:"#collections","aria-label":'Permalink to "Collections"'},"​")],-1),Pi=e("p",null,"Collections类是用来操作集合的工具类，提供了集合转换成线程安全的方法：",-1),_i=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"T"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Collection"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"T"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," synchronizedCollection"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collection"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"T"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SynchronizedCollection<>(c);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," <"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Map"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," synchronizedMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Map"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," m) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SynchronizedMap<>(m);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),Ri=e("p",null,"源码：底层也是对方法进行加锁",-1),Oi=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(E e) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    synchronized"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (mutex) {"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"add"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e);}")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),Ui=e("hr",null,null,-1),qi=e("h3",{id:"skiplistmap",tabindex:"-1"},[E("SkipListMap "),e("a",{class:"header-anchor",href:"#skiplistmap","aria-label":'Permalink to "SkipListMap"'},"​")],-1),Zi=e("h4",{id:"底层结构",tabindex:"-1"},[E("底层结构 "),e("a",{class:"header-anchor",href:"#底层结构","aria-label":'Permalink to "底层结构"'},"​")],-1),Yi=e("p",null,[E("跳表 SkipList 是一个"),e("strong",null,"有序的链表"),E("，默认升序，底层是链表加多级索引的结构。跳表可以对元素进行快速查询，类似于平衡树，是一种利用空间换时间的算法")],-1),Wi=e("p",null,[E("对于单链表，即使链表是有序的，如果查找数据也只能从头到尾遍历链表，所以采用链表上建索引的方式提高效率，跳表的查询时间复杂度是 "),e("strong",null,"O(logn)"),E("，空间复杂度 O(n)")],-1),Xi=e("p",null,"ConcurrentSkipListMap 提供了一种线程安全的并发访问的排序映射表，内部是跳表结构实现，通过 CAS + volatile 保证线程安全",-1),Ji=e("p",null,"平衡树和跳表的区别：",-1),$i=e("ul",null,[e("li",null,[E("对平衡树的插入和删除往往很可能导致平衡树进行一次全局的调整；而对跳表的插入和删除，"),e("strong",null,"只需要对整个结构的局部进行操作")]),e("li",null,"在高并发的情况下，保证整个平衡树的线程安全需要一个全局锁；对于跳表则只需要部分锁，拥有更好的性能")],-1),Qi=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175500066.png",alt:"image-20230824175500066",loading:"lazy",decoding:"async",class:"lazy"})],-1),Gi=e("p",null,[E("BaseHeader 存储数据，headIndex 存储索引，纵向上"),e("strong",null,"所有索引都指向链表最下面的节点")],-1),is=e("hr",null,null,-1),ss=e("h4",{id:"成员变量",tabindex:"-1"},[E("成员变量 "),e("a",{class:"header-anchor",href:"#成员变量","aria-label":'Permalink to "成员变量"'},"​")],-1),hs=e("ul",null,[e("li",null,[e("p",null,"标识索引头节点位置"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object BASE_HEADER "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"跳表的顶层索引"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> head;")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"比较器，为 null 则使用自然排序"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Comparator<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," super"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> comparator;")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"Node 节点"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Node"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">{")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," K key;  \t\t\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// key 是 final 的, 说明节点一旦定下来, 除了删除, 一般不会改动 key")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object value; \t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 对应的 value")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> next; \t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 下一个节点，单向链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"索引节点 Index，只有向下和向右的指针"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Index"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">{")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> node; \t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 索引指向的节点，每个都会指向数据节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> down; \t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 下边level层的Index，分层索引")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> right; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 右边的Index，单向")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 在 index 本身和 succ 之间插入一个新的节点 newSucc")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," link"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"succ"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"newSucc"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        newSucc.right "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," succ;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 把当前节点的右指针从 succ 改为 newSucc")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," casRight"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(succ, newSucc);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 断开当前节点和 succ 节点，将当前的节点 index 设置其的 right 为 succ.right，就是把 succ 删除")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," unlink"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"succ"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," node.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," casRight"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(succ, succ.right);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"头索引节点 HeadIndex"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," HeadIndex"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extends"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Index"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level;\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 表示索引层级，所有的 HeadIndex 都指向同一个 Base_header 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    HeadIndex"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"node"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"down"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"right"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," level"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        super"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(node, down, right);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),ls=e("hr",null,null,-1),as=e("h4",{id:"成员方法-1",tabindex:"-1"},[E("成员方法 "),e("a",{class:"header-anchor",href:"#成员方法-1","aria-label":'Permalink to "成员方法"'},"​")],-1),ks=e("h5",{id:"其他方法",tabindex:"-1"},[E("其他方法 "),e("a",{class:"header-anchor",href:"#其他方法","aria-label":'Permalink to "其他方法"'},"​")],-1),ts=e("ul",null,[e("li",null,[e("p",null,"构造方法："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentSkipListMap"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".comparator "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// comparator 为 null，使用 key 的自然序，如字典序")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    initialize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," initialize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    keySet "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    entrySet "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    values "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    descendingMap "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 初始化索引头节点，Node 的 key 为 null，value 为 BASE_HEADER 对象，下一个节点为 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // head 的分层索引 down 为 null，链表的后续索引 right 为 null，层级 level 为第 1 层")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    head "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", BASE_HEADER, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"), "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"cpr：排序"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//　x 是比较者，y 是被比较者，比较者大于被比较者 返回正数，小于返回负数，相等返回 0")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," cpr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Comparator c, Object x, Object y) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compare"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(x, y) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((Comparable)x)."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareTo"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(y);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),ns=e("hr",null,null,-1),es=e("h5",{id:"添加方法-1",tabindex:"-1"},[E("添加方法 "),e("a",{class:"header-anchor",href:"#添加方法-1","aria-label":'Permalink to "添加方法"'},"​")],-1),Es=e("ul",null,[e("li",null,[e("p",null,"findPredecessor()：寻找前置节点"),e("p",null,"从最上层的头索引开始向右查找（链表的后续索引），如果后续索引的节点的 key 大于要查找的 key，则头索引移到下层链表，在下层链表查找，以此反复，一直查找到没有下层的分层索引为止，返回该索引的节点。如果后续索引的节点的 key 小于要查找的 key，则在该层链表中向后查找。由于查找的 key 可能永远大于索引节点的 key，所以只能找到目标的前置索引节点。如果遇到空值索引的存在，通过 CAS 来断开索引"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," findPredecessor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key, Comparator"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," super"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," K"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cmp) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NullPointerException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// don't postpone errors")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1.初始数据 q 是 head，r 是最顶层 h 的右 Index 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," head, r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.right, d;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 2.右索引节点不为空，则进行向下查找")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," r.node;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                K k "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.key;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 3.n.value 为 null 说明节点 n 正在删除的过程中，此时【当前线程帮其删除索引】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 在 index 层直接删除 r 索引节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"q."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"unlink"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(r))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 删除失败重新从 head 节点开始查找，break 一个 for 到步骤 1，又从初始值开始")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 删除节点 r 成功，获取新的 r 节点,")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.right;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 回到步骤 2，还是从这层索引开始向右遍历")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 4.若参数 key > r.node.key，则继续向右遍历, continue 到步骤 2 处获取右节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //   若参数 key < r.node.key，说明需要进入下层索引，到步骤 5")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"cpr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cmp, key, k) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," r;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," r.right;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 5.先让 d 指向 q 的下一层，判断是否是 null，是则说明已经到了数据层，也就是第一层")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((d "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.down) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.node;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 6.未到数据层, 进行重新赋值向下扫描")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," d;\t\t"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// q 指向 d")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," d.right;"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// r 指向 q 的后续索引节点，此时(q.key < key < r.key)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175548648.png",alt:"image-20230824175548648",loading:"lazy",decoding:"async",class:"lazy"})])]),e("li",null,[e("p",null,"put()：添加数据"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(K key, V value) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 非空判断，value不能为空")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NullPointerException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," doPut"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"doPut"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(K key, V value, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," onlyIfAbsent) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> z;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 非空判断，key 不能为空")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NullPointerException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Comparator<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," super"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> cmp "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," comparator;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // outer 循环，【把待插入数据插入到数据层的合适的位置，并在扫描过程中处理已删除(value = null)的数据】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    outer"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //0.for (;;)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //1.将 key 对应的前继节点找到, b 为前继节点，是数据层的, n 是前继节点的 next, ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t\t//  若没发生条件竞争，最终 key 在 b 与 n 之间 (找到的 b 在 base_level 上)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," findPredecessor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, cmp), n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.next;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 2.n 不为 null 说明 b 不是链表的最后一个节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Object v; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 3.获取 n 的右节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.next;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 4.条件竞争，并发下其他线程在 b 之后插入节点或直接删除节点 n, break 到步骤 0")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.next)              ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //  若节点 n 已经删除, 则调用 helpDelete 进行【帮助删除节点】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.value) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    n."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"helpDelete"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(b, f);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 5.节点 b 被删除中，则 break 到步骤 0,")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t\t\t\t//  【调用findPredecessor帮助删除index层的数据, node层的数据会通过helpDelete方法进行删除】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (b.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n) ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 6.若 key > n.key，则进行向后扫描")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //   若 key < n.key，则证明 key 应该存储在 b 和 n 之间")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," cpr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cmp, key, n.key)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 7.key 的值和 n.key 相等，则可以直接覆盖赋值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // onlyIfAbsent 默认 false，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (onlyIfAbsent "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(v, value)) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SuppressWarnings"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"unchecked"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") V vv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (V)v;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 返回被覆盖的值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vv;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // cas失败，break 一层循环，返回 0 重试")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // else c < 0; fall through")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 8.此时的情况 b.key < key < n.key，对应流程图1中的7，创建z节点指向n")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            z "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(key, value, n);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 9.尝试把 b.next 从 n 设置成 z")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"b."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(n, z))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // cas失败，返回到步骤0，重试")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 10.break outer 后, 上面的 for 循环不会再执行, 而后执行下面的代码")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," outer;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t// 【以上插入节点已经完成，剩下的任务要根据随机数的值来表示是否向上增加层数与上层索引】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 随机数")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rnd "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadLocalRandom."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"nextSecondarySeed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 如果随机数的二进制与 10000000000000000000000000000001 进行与运算为 0")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 即随机数的二进制最高位与最末尾必须为 0，其他位无所谓，就进入该循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 如果随机数的二进制最高位与最末位不为 0，不增加新节点的层数")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 11.判断是否需要添加 level，32 位")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((rnd "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0x80000001"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 索引层 level，从 1 开始，就是最底层")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", max;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 12.判断最低位前面有几个 1，有几个leve就加几：0..0 0001 1110，这是4个，则1+4=5")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //    【最大有30个就是 1 + 30 = 31")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (((rnd "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">>>="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            ++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"level;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 最终会指向 z 节点，就是添加的节点 ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> idx "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 指向头索引节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," head;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 13.判断level是否比当前最高索引小，图中 max 为 3")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (max "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h.level)) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"i)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 根据层数level不断创建新增节点的上层索引，索引的后继索引留空")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 第一次idx为null，也就是下层索引为空，第二次把上次的索引作为下层索引，【类似头插法】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                idx "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(z, idx, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 循环以后的索引结构")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // index-3\t← idx")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //   ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // index-2")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //   ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // index-1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //   ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //  z-node")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 14.若 level > max，则【只增加一层 index 索引层】，3 + 1 = 4")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," max "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //创建一个 index 数组，长度是 level+1，假设 level 是 4，创建的数组长度为 5")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[] idxs "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Index"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[])"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">[level"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"];")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // index[0]的数组 slot 并没有使用，只使用 [1,level] 这些数组的 slot")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"i)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                idxs[i] "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," idx "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(z, idx, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"              \t\t// index-4   ← idx")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    //   ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                  \t// ......")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    //   ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // index-1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    //   ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    //  z-node")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," head;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 获取头索引的层数，3")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," oldLevel "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h.level;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 如果 level <= oldLevel，说明其他线程进行了 index 层增加操作，退出循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," oldLevel)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 定义一个新的头索引节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> newh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 获取头索引的节点，就是 BASE_HEADER")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> oldbase "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h.node;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 升级 baseHeader 索引，升高一级，并发下可能升高多级")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," j "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," oldLevel "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; j "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"j)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 参数1：底层node，参数二：down，为以前的头节点，参数三：right，新建")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    newh "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(oldbase, newh, idxs[j], j);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 执行完for循环之后，baseHeader 索引长这个样子，这里只升高一级")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // index-4             →             index-4\t← idx")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //   ↓                                  ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // index-3                           index-3     ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //   ↓                                  ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // index-2                           index-2")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //   ↓                                  ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // index-1                           index-1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                //   ↓                                  ↓")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // baseHeader    →    ....      →     z-node")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // cas 成功后，head 字段指向最新的 headIndex，baseHeader 的 index-4")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, newh)) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // h 指向最新的 index-4 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newh;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 让 idx 指向 z-node 的 index-3 节点，")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t\t\t\t\t// 因为从 index-3 - index-1 的这些 z-node 索引节点 都没有插入到索引链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    idx "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," idxs[level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," oldLevel];")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 15.【把新加的索引插入索引链表中】，有上述两种情况，一种索引高度不变，另一种是高度加 1")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 要插入的是第几层的索引")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        splice"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," insertionLevel "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 获取头索引的层数，情况 1 是 3，情况 2 是 4")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," j "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h.level;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 【遍历 insertionLevel 层的索引，找到合适的插入位置】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Index<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h, r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.right, t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," idx;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 如果头索引为 null 或者新增节点索引为 null，退出插入索引的总循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 此处表示有其他线程删除了头索引或者新增节点的索引")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," splice;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 头索引的链表后续索引存在，如果是新层则为新节点索引，如果是老层则为原索引")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 获取r的节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," r.node;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 插入的key和n.key的比较值")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," cpr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cmp, key, n.key);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 【删除空值索引】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"q."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"unlink"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(r))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.right;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // key > r.node.key，向右扫描")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," r;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," r.right;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 执行到这里，说明 key < r.node.key，判断是否是第 j 层插入新增节点的前置索引")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (j "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," insertionLevel) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 【将新索引节点 t 插入 q r 之间】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"q."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"link"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(r, t))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 如果新增节点的值为 null，表示该节点已经被其他线程删除")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (t.node.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 找到该节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        findNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," splice;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 插入层逐层自减，当为最底层时退出循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"--"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"insertionLevel "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," splice;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t\t\t\t// 其他节点随着插入节点的层数下移而下移")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"--"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"j "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," insertionLevel "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," j "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," level)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t.down;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.down;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                r "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q.right;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"findNode()"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," findNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 原理与doGet相同，无非是 findNode 返回节点，doGet 返回 value")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," cpr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cmp, key, n.key)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),ps=e("hr",null,null,-1),rs=e("h5",{id:"获取方法-1",tabindex:"-1"},[E("获取方法 "),e("a",{class:"header-anchor",href:"#获取方法-1","aria-label":'Permalink to "获取方法"'},"​")],-1),ds=e("ul",null,[e("li",null,[e("p",null,"get(key)：获取对应的数据"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," doGet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"doGet()：扫描过程会对已 value = null 的元素进行删除处理"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"doGet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NullPointerException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Comparator<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," super"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> cmp "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," comparator;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    outer"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1.找到最底层节点的前置节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," findPredecessor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, cmp), n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.next;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Object v; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 2.【如果该前置节点的链表后续节点为 null，说明不存在该节点】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," outer;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // b → n → f")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.next;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 3.如果n不为前置节点的后续节点，表示已经有其他线程删除了该节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.next) ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 4.如果后续节点的值为null，【需要帮助删除该节点】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.value) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                n."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"helpDelete"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(b, f);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 5.如果前置节点已被其他线程删除，重新循环")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (b.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"             // 6.如果要获取的key与后续节点的key相等，返回节点的value")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," cpr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cmp, key, n.key)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SuppressWarnings"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"unchecked"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") V vv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (V)v;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vv;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 7.key < n.key，因位 key > b.key，b 和 n 相连，说明不存在该节点或者被其他线程删除了")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," outer;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),gs=e("hr",null,null,-1),ys=e("h5",{id:"删除方法-1",tabindex:"-1"},[E("删除方法 "),e("a",{class:"header-anchor",href:"#删除方法-1","aria-label":'Permalink to "删除方法"'},"​")],-1),Fs=e("ul",null,[e("li",null,[e("p",null,"remove()"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"remove"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," doRemove"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," V "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"doRemove"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object key, Object value) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NullPointerException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Comparator<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," super"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> cmp "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," comparator;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    outer"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1.找到最底层目标节点的前置节点，b.key < key")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," findPredecessor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, cmp), n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.next;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Object v; "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 2.如果该前置节点的链表后续节点为 null，退出循环，说明不存在这个元素")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," outer;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // b → n → f")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.next;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.next)                    "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// inconsistent read")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n.value) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {        "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// n is deleted")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                n."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"helpDelete"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(b, f);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (b.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n)      "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// b is deleted")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //3.key < n.key，说明被其他线程删除了，或者不存在该节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," cpr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cmp, key, n.key)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," outer;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //4.key > n.key，继续向后扫描")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (c "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                b "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," n;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                n "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //5.到这里是 key = n.key，value 不为空的情况下判断 value 和 n.value 是否相等")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," !"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"value."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(v))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," outer;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //6.【把 n 节点的 value 置空】")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"n."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(v, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            //7.【给 n 添加一个删除标志 mark】，mark.next = f，然后把 b.next 设置为 f，成功后n出队")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"n."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"appendMarker"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(f) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," !"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"b."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(n, f))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 对 key 对应的 index 进行删除，调用了 findPredecessor 方法")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                findNode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 进行操作失败后通过 findPredecessor 中进行 index 的删除")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                findPredecessor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, cmp);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (head.right "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 进行headIndex 对应的index 层的删除")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    tryReduceLevel"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SuppressWarnings"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"unchecked"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") V vv "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (V)v;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vv;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})]),e("p",null,"经过 findPredecessor() 中的 unlink() 后索引已经被删除"),e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175621276.png",alt:"image-20230824175621276",loading:"lazy",decoding:"async",class:"lazy"})])]),e("li",null,[e("p",null,"appendMarker()：添加删除标记节点"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," appendMarker"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 通过 CAS 让 n.next 指向一个 key 为 null，value 为 this，next 为 f 的标记节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," casNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(f, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(f));")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"helpDelete()：将添加了删除标记的节点清除，参数是该节点的前驱和后继节点"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," helpDelete"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b, Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // this 节点的后续节点为 f，且本身为 b 的后续节点，一般都是正确的，除非被别的线程删除")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b.next) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 如果 n 还还没有被标记")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (f "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f.value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," f) ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            casNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(f, "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(f));")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 通过 CAS，将 b 的下一个节点 n 变成 f.next，即成为图中的样式")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            b."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", f.next);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"tryReduceLevel()：删除索引"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," tryReduceLevel"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," head;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> d;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    HeadIndex<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"K"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"V"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> e;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (h.level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 3"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        (d "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (HeadIndex"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")h.down) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        (e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (HeadIndex"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"K,V"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")d.down) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        e.right "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        d.right "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        h.right "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 设置头索引")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        casHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, d) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 重新检查")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        h.right "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 重新检查返回true，说明其他线程增加了索引层级，把索引头节点设置回来")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        casHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(d, h);   ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),As=e("p",null,[E("参考文章："),e("a",{href:"https://my.oschina.net/u/3768341/blog/3135659",target:"_blank",rel:"noreferrer"},"https://my.oschina.net/u/3768341/blog/3135659")],-1),Ds=e("p",null,[E("参考视频："),e("a",{href:"https://www.bilibili.com/video/BV1Er4y1P7k1",target:"_blank",rel:"noreferrer"},"https://www.bilibili.com/video/BV1Er4y1P7k1")],-1),cs=e("hr",null,null,-1),os=e("h3",{id:"noblocking",tabindex:"-1"},[E("NoBlocking "),e("a",{class:"header-anchor",href:"#noblocking","aria-label":'Permalink to "NoBlocking"'},"​")],-1),us=e("h4",{id:"非阻塞队列",tabindex:"-1"},[E("非阻塞队列 "),e("a",{class:"header-anchor",href:"#非阻塞队列","aria-label":'Permalink to "非阻塞队列"'},"​")],-1),Cs=e("p",null,"并发编程中，需要用到安全的队列，实现安全队列可以使用 2 种方式：",-1),bs=e("ul",null,[e("li",null,"加锁，这种实现方式是阻塞队列"),e("li",null,"使用循环 CAS 算法实现，这种方式是非阻塞队列")],-1),vs=e("p",null,"ConcurrentLinkedQueue 是一个基于链接节点的无界线程安全队列，采用先进先出的规则对节点进行排序，当添加一个元素时，会添加到队列的尾部，当获取一个元素时，会返回队列头部的元素",-1),Bs=e("p",null,"补充：ConcurrentLinkedDeque 是双向链表结构的无界并发队列",-1),ms=e("p",null,"ConcurrentLinkedQueue 使用约定：",-1),fs=e("ol",null,[e("li",null,"不允许 null 入列"),e("li",null,"队列中所有未删除的节点的 item 都不能为 null 且都能从 head 节点遍历到"),e("li",null,"删除节点是将 item 设置为 null，队列迭代时跳过 item 为 null 节点"),e("li",null,[E("head 节点跟 tail 不一定指向头节点或尾节点，可能"),e("strong",null,"存在滞后性")])],-1),xs=e("p",null,"ConcurrentLinkedQueue 由 head 节点和 tail 节点组成，每个节点由节点元素和指向下一个节点的引用组成，组成一张链表结构的队列",-1),Vs=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> head;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," transient"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> tail;")]),E("\n"),e("span",{class:"line"}),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Node"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," E item;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    volatile"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> next;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    //.....")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),Ts=e("hr",null,null,-1),js=e("h4",{id:"构造方法-1",tabindex:"-1"},[E("构造方法 "),e("a",{class:"header-anchor",href:"#构造方法-1","aria-label":'Permalink to "构造方法"'},"​")],-1),Ns=e("ul",null,[e("li",null,[e("p",null,"无参构造方法："),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentLinkedQueue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 默认情况下 head 节点存储的元素为空，dummy 节点，tail 节点等于 head 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    head "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tail "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"有参构造方法"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentLinkedQueue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collection"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," extends E"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 遍历节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (E e "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," c) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        checkNotNull"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> newNode "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(e);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newNode;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 单向链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            t."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lazySetNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(newNode);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newNode;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    head "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    tail "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),Ks=e("hr",null,null,-1),Ss=e("h4",{id:"入队方法",tabindex:"-1"},[E("入队方法 "),e("a",{class:"header-anchor",href:"#入队方法","aria-label":'Permalink to "入队方法"'},"​")],-1),Is=e("p",null,"与传统的链表不同，单线程入队的工作流程：",-1),ws=e("ul",null,[e("li",null,"将入队节点设置成当前队列尾节点的下一个节点"),e("li",null,[E("更新 tail 节点，如果 tail 节点的 next 节点不为空，则将入队节点设置成 tail 节点；如果 tail 节点的 next 节点为空，则将入队节点设置成 tail 的 next 节点，所以 tail 节点不总是尾节点，"),e("strong",null,"存在滞后性")])],-1),Ms=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," offer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(E e) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    checkNotNull"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 创建入队节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> newNode "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(e);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"\t")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 循环 CAS 直到入队成功")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tail, p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // p 用来表示队列的尾节点，初始情况下等于 tail 节点，q 是 p 的 next 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.next;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 条件成立说明 p 是尾节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // p 是尾节点，设置 p 节点的下一个节点为新节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 设置成功则 casNext 返回 true，否则返回 false，说明有其他线程更新过尾节点，继续寻找尾节点，继续 CAS")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", newNode)) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 首次添加时，p 等于 t，不进行尾节点更新，所以尾节点存在滞后性")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 将 tail 设置成新入队的节点，设置失败表示其他线程更新了 tail 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    casTail"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(t, newNode); ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 当 tail 不指向最后节点时，如果执行出列操作，可能将 tail 也移除，tail 不在链表中 ")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        \t// 此时需要对 tail 节点进行复位，复位到 head 节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tail)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," head;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 推动 tail 尾节点往队尾移动")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tail)) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," t "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),zs=e("p",null,"图解入队：",-1),Hs=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175705470.png",alt:"image-20230824175705470",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ls=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175745374.png",alt:"image-20230824175745374",loading:"lazy",decoding:"async",class:"lazy"})],-1),Ps=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824175937960.png",alt:"image-20230824175937960",loading:"lazy",decoding:"async",class:"lazy"})],-1),_s=e("p",null,[E("当 tail 节点和尾节点的距离"),e("strong",null,"大于等于 1"),E(" 时（每入队两次）更新 tail，可以减少 CAS 更新 tail 节点的次数，提高入队效率")],-1),Rs=e("p",null,"线程安全问题：",-1),Os=e("ul",null,[e("li",null,"线程 1 线程 2 同时入队，无论从哪个位置开始并发入队，都可以循环 CAS，直到入队成功，线程安全"),e("li",null,"线程 1 遍历，线程 2 入队，所以造成 ConcurrentLinkedQueue 的 size 是变化，需要加锁保证安全"),e("li",null,"线程 1 线程 2 同时出列，线程也是安全的")],-1),Us=e("hr",null,null,-1),qs=e("h4",{id:"出队方法",tabindex:"-1"},[E("出队方法 "),e("a",{class:"header-anchor",href:"#出队方法","aria-label":'Permalink to "出队方法"'},"​")],-1),Zs=e("p",null,"出队列的就是从队列里返回一个节点元素，并清空该节点对元素的引用，并不是每次出队都更新 head 节点",-1),Ys=e("ul",null,[e("li",null,"当 head 节点里有元素时，直接弹出 head 节点里的元素，而不会更新 head 节点"),e("li",null,"当 head 节点里没有元素时，出队操作才会更新 head 节点")],-1),Ws=e("p",null,[e("strong",null,"批处理方式"),E("可以减少使用 CAS 更新 head 节点的消耗，从而提高出队效率")],-1),Xs=e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," E "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"poll"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    restartFromHead"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // p 节点表示首节点，即需要出队的节点，FIFO")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," head, p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h, q;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            E item "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.item;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t\t\t// 如果 p 节点的元素不为 null，则通过 CAS 来设置 p 节点引用元素为 null，成功返回 item")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (item "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casItem"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(item, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h)\t")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                   \t// 对 head 进行移动")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    updateHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, ((q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," item;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"           \t// 逻辑到这说明头节点的元素为空或头节点发生了变化，头节点被另外一个线程修改了")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 那么获取 p 节点的下一个节点，如果 p 节点的下一节点也为 null，则表明队列已经空了")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                updateHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, p);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"      \t\t// 第一轮操作失败，下一轮继续，调回到循环前")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," restartFromHead;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 如果下一个元素不为空，则将头节点的下一个节点设置成头节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," updateHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"E"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h, Node"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"E"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," casHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, p))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 将旧结点 h 的 next 域指向为 h，help gc")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        h."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lazySetNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})],-1),Js=e("p",null,"在更新完 head 之后，会将旧的头结点 h 的 next 域指向为 h，图中所示的虚线也就表示这个节点的自引用，被移动的节点（item 为 null 的节点）会被 GC 回收",-1),$s=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824180023394.png",alt:"image-20230824180023394",loading:"lazy",decoding:"async",class:"lazy"})],-1),Qs=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824180101118.png",alt:"image-20230824180101118",loading:"lazy",decoding:"async",class:"lazy"})],-1),Gs=e("figure",null,[e("img",{src:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230824180122859.png",alt:"image-20230824180122859",loading:"lazy",decoding:"async",class:"lazy"})],-1),ih=e("p",null,"如果这时，有一个线程来添加元素，通过 tail 获取的 next 节点则仍然是它本身，这就出现了p == q 的情况，出现该种情况之后，则会触发执行 head 的更新，将 p 节点重新指向为 head",-1),sh=e("p",null,[E("参考文章："),e("a",{href:"https://www.jianshu.com/p/231caf90f30b",target:"_blank",rel:"noreferrer"},"https://www.jianshu.com/p/231caf90f30b")],-1),hh=e("hr",null,null,-1),lh=e("h4",{id:"成员方法-2",tabindex:"-1"},[E("成员方法 "),e("a",{class:"header-anchor",href:"#成员方法-2","aria-label":'Permalink to "成员方法"'},"​")],-1),ah=e("ul",null,[e("li",null,[e("p",null,"peek()：会改变 head 指向，执行 peek() 方法后 head 会指向第一个具有非空元素的节点"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 获取链表的首部元素，只读取而不移除")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," E "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"peek"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    restartFromHead"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> h "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," head, p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," h, q;;) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            E item "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.item;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (item "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ||"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (q "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.next) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 更改h的位置为非空元素节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                updateHead"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(h, p);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," item;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," restartFromHead;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            else")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," q;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"size()：用来获取当前队列的元素个数，因为整个过程都没有加锁，在并发环境中从调用 size 方法到返回结果期间有可能增删元素，导致统计的元素个数不精确"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," count "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // first() 获取第一个具有非空元素的节点，若不存在，返回 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // succ(p) 方法获取 p 的后继节点，若 p == p.next，则返回 head")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 类似遍历链表")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," first"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," succ"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(p))")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (p.item "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 最大返回Integer.MAX_VALUE")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"count "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Integer.MAX_VALUE)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," count;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])]),e("li",null,[e("p",null,"remove()：移除元素"),e("div",{style:{"max-height":"300px"},class:"language-java vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," remove"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object o) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 删除的元素不能为null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (o "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> next, pred "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Node<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"E"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," first"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; pred "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p, p "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," next) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," removed "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            E item "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p.item;")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 节点元素不为null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (item "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 若不匹配，则获取next节点继续匹配")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"o."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(item)) {")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," succ"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(p);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    continue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 若匹配，则通过 CAS 操作将对应节点元素置为 null")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                removed "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casItem"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(item, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 获取删除节点的后继节点")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," succ"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(p);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 将被删除的节点移除队列")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (pred "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," next "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// unlink")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                pred."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"casNext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(p, next);")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (removed)")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"collapse"})])])],-1),kh=e("hr",null,null,-1),th={__name:"Concurrent_Programming_Compilation_Version-JUC",setup(e,{expose:E}){const th=JSON.parse('{"title":"并发编程整理版-JUC","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wallhaven-v9vv3p_1920x1080.png","title":"并发编程整理版-JUC","top":304,"author":"imklaus","tags":["ConcurrentHashMap","CopyOnWriteArrayList","SkipListMap","ConcurrentLinkedQueue"],"categories":"Java","date":"2023-08-24T19:13:57.000Z","outline":"deep"},"headers":[{"level":2,"title":"并发包","slug":"并发包","link":"#并发包","children":[{"level":3,"title":"ConHashMap","slug":"conhashmap","link":"#conhashmap","children":[]},{"level":3,"title":"CopyOnWrite","slug":"copyonwrite","link":"#copyonwrite","children":[]},{"level":3,"title":"Collections","slug":"collections","link":"#collections","children":[]},{"level":3,"title":"SkipListMap","slug":"skiplistmap","link":"#skiplistmap","children":[]},{"level":3,"title":"NoBlocking","slug":"noblocking","link":"#noblocking","children":[]}]}],"relativePath":"pages/posts/Concurrent_Programming_Compilation_Version-JUC.md","path":"D:/Learning/myblog/valaxy-lastest/imklaus-valaxy-blog/pages/posts/Concurrent_Programming_Compilation_Version-JUC.md","lastUpdated":null}'),nh=i(),eh=th.frontmatter||{};nh.meta.frontmatter=Object.assign(nh.meta.frontmatter||{},th.frontmatter||{}),s("pageData",th),s("valaxy:frontmatter",eh),globalThis.$frontmatter=eh;return E({frontmatter:{cover:"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wallhaven-v9vv3p_1920x1080.png",title:"并发编程整理版-JUC",top:304,author:"imklaus",tags:["ConcurrentHashMap","CopyOnWriteArrayList","SkipListMap","ConcurrentLinkedQueue"],categories:"Java",date:"2023-08-24T19:13:57.000Z",outline:"deep"}}),(i,s)=>{const e=t;return h(),l(e,{frontmatter:k(eh)},{"main-content-md":a((()=>[p,r,d,g,y,F,A,D,c,o,u,C,b,v,B,m,f,x,V,T,j,N,K,S,I,w,M,z,H,L,P,_,R,O,U,q,Z,Y,W,X,J,$,Q,G,ii,si,hi,li,ai,ki,ti,ni,ei,Ei,pi,ri,di,gi,yi,Fi,Ai,Di,ci,oi,ui,Ci,bi,vi,Bi,mi,fi,xi,Vi,Ti,ji,Ni,Ki,Si,Ii,wi,Mi,zi,Hi,Li,Pi,_i,Ri,Oi,Ui,qi,Zi,Yi,Wi,Xi,Ji,$i,Qi,Gi,is,ss,hs,ls,as,ks,ts,ns,es,Es,ps,rs,ds,gs,ys,Fs,As,Ds,cs,os,us,Cs,bs,vs,Bs,ms,fs,xs,Vs,Ts,js,Ns,Ks,Ss,Is,ws,Ms,zs,Hs,Ls,Ps,_s,Rs,Os,Us,qs,Zs,Ys,Ws,Xs,Js,$s,Qs,Gs,ih,sh,hh,lh,ah,kh])),"main-header":a((()=>[n(i.$slots,"main-header")])),"main-header-after":a((()=>[n(i.$slots,"main-header-after")])),"main-nav":a((()=>[n(i.$slots,"main-nav")])),"main-content":a((()=>[n(i.$slots,"main-content")])),"main-content-after":a((()=>[n(i.$slots,"main-content-after")])),"main-nav-before":a((()=>[n(i.$slots,"main-nav-before")])),"main-nav-after":a((()=>[n(i.$slots,"main-nav-after")])),comment:a((()=>[n(i.$slots,"comment")])),footer:a((()=>[n(i.$slots,"footer")])),aside:a((()=>[n(i.$slots,"aside")])),"aside-custom":a((()=>[n(i.$slots,"aside-custom")])),default:a((()=>[n(i.$slots,"default")])),_:3},8,["frontmatter"])}}};export{th as default};
