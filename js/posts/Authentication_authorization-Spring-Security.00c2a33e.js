import{_ as s,u as l,p as o,c as n,w as e,a,o as c,b as t,d as p,e as r,r as E,f as y}from"../../assets/app-f772c525.js";const i=JSON.parse('{"title":"认证授权-Spring Security","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/girl_umbrella_anime_141156_1920x1080.jpg","title":"认证授权-Spring Security","top":260,"author":"imklaus","tags":["Spring Cloud","Spring Boot","Spring Security","JWT","OAuth2","Redis"],"categories":"Java","date":"2023-07-05T21:50:51.000Z","outline":"deep"},"headers":[{"level":2,"title":"1 模块需求分析","slug":"_1-模块需求分析","link":"#_1-模块需求分析","children":[{"level":3,"title":"1.1 什么是认证授权","slug":"_1-1-什么是认证授权","link":"#_1-1-什么是认证授权","children":[]},{"level":3,"title":"1.2 业务流程","slug":"_1-2-业务流程","link":"#_1-2-业务流程","children":[]}]},{"level":2,"title":"2 Spring Security 认证研究","slug":"_2-spring-security-认证研究","link":"#_2-spring-security-认证研究","children":[{"level":3,"title":"2.1 Spring Security介绍","slug":"_2-1-spring-security介绍","link":"#_2-1-spring-security介绍","children":[]},{"level":3,"title":"2.2 认证授权入门","slug":"_2-2-认证授权入门","link":"#_2-2-认证授权入门","children":[]},{"level":3,"title":"2.3 什么是OAuth2","slug":"_2-3-什么是oauth2","link":"#_2-3-什么是oauth2","children":[]},{"level":3,"title":"2.4 JWT","slug":"_2-4-jwt","link":"#_2-4-jwt","children":[]},{"level":3,"title":"2.5 网关认证","slug":"_2-5-网关认证","link":"#_2-5-网关认证","children":[]}]},{"level":2,"title":"3 用户认证","slug":"_3-用户认证","link":"#_3-用户认证","children":[{"level":3,"title":"3.1 需求分析","slug":"_3-1-需求分析","link":"#_3-1-需求分析","children":[]},{"level":3,"title":"3.2 连接用户中心数据库","slug":"_3-2-连接用户中心数据库","link":"#_3-2-连接用户中心数据库","children":[]},{"level":3,"title":"3.3 支持认证方式多样","slug":"_3-3-支持认证方式多样","link":"#_3-3-支持认证方式多样","children":[]},{"level":3,"title":"3.4 验证码服务","slug":"_3-4-验证码服务","link":"#_3-4-验证码服务","children":[]},{"level":3,"title":"3.5 账号密码认证","slug":"_3-5-账号密码认证","link":"#_3-5-账号密码认证","children":[]}]},{"level":2,"title":"4 微信扫码登录","slug":"_4-微信扫码登录","link":"#_4-微信扫码登录","children":[{"level":3,"title":"4.1 接入规范","slug":"_4-1-接入规范","link":"#_4-1-接入规范","children":[]},{"level":3,"title":"4.2 准备开发环境","slug":"_4-2-准备开发环境","link":"#_4-2-准备开发环境","children":[]},{"level":3,"title":"4.3 接入微信登录","slug":"_4-3-接入微信登录","link":"#_4-3-接入微信登录","children":[]}]},{"level":2,"title":"5 用户授权","slug":"_5-用户授权","link":"#_5-用户授权","children":[{"level":3,"title":"5.1 RBAC","slug":"_5-1-rbac","link":"#_5-1-rbac","children":[]},{"level":3,"title":"5.2 资源服务授权流程","slug":"_5-2-资源服务授权流程","link":"#_5-2-资源服务授权流程","children":[]},{"level":3,"title":"5.3 授权相关的数据模型","slug":"_5-3-授权相关的数据模型","link":"#_5-3-授权相关的数据模型","children":[]},{"level":3,"title":"5.4 查询用户权限","slug":"_5-4-查询用户权限","link":"#_5-4-查询用户权限","children":[]},{"level":3,"title":"5.5 授权测试","slug":"_5-5-授权测试","link":"#_5-5-授权测试","children":[]},{"level":3,"title":"5.6 细粒度授权","slug":"_5-6-细粒度授权","link":"#_5-6-细粒度授权","children":[]}]},{"level":2,"title":"6 实战","slug":"_6-实战","link":"#_6-实战","children":[{"level":3,"title":"6.1 找回密码(实战)","slug":"_6-1-找回密码-实战","link":"#_6-1-找回密码-实战","children":[]},{"level":3,"title":"6.2 注册(实战)","slug":"_6-2-注册-实战","link":"#_6-2-注册-实战","children":[]}]}],"relativePath":"pages/posts/Authentication_authorization-Spring-Security.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-lastest\\\\imklaus-valaxy-blog\\\\pages\\\\posts\\\\Authentication_authorization-Spring-Security.md","lastUpdated":null}'),u=JSON.parse('{"title":"认证授权-Spring Security","description":"","frontmatter":{"cover":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/girl_umbrella_anime_141156_1920x1080.jpg","title":"认证授权-Spring Security","top":260,"author":"imklaus","tags":["Spring Cloud","Spring Boot","Spring Security","JWT","OAuth2","Redis"],"categories":"Java","date":"2023-07-05T21:50:51.000Z","outline":"deep"},"headers":[{"level":2,"title":"1 模块需求分析","slug":"_1-模块需求分析","link":"#_1-模块需求分析","children":[{"level":3,"title":"1.1 什么是认证授权","slug":"_1-1-什么是认证授权","link":"#_1-1-什么是认证授权","children":[]},{"level":3,"title":"1.2 业务流程","slug":"_1-2-业务流程","link":"#_1-2-业务流程","children":[]}]},{"level":2,"title":"2 Spring Security 认证研究","slug":"_2-spring-security-认证研究","link":"#_2-spring-security-认证研究","children":[{"level":3,"title":"2.1 Spring Security介绍","slug":"_2-1-spring-security介绍","link":"#_2-1-spring-security介绍","children":[]},{"level":3,"title":"2.2 认证授权入门","slug":"_2-2-认证授权入门","link":"#_2-2-认证授权入门","children":[]},{"level":3,"title":"2.3 什么是OAuth2","slug":"_2-3-什么是oauth2","link":"#_2-3-什么是oauth2","children":[]},{"level":3,"title":"2.4 JWT","slug":"_2-4-jwt","link":"#_2-4-jwt","children":[]},{"level":3,"title":"2.5 网关认证","slug":"_2-5-网关认证","link":"#_2-5-网关认证","children":[]}]},{"level":2,"title":"3 用户认证","slug":"_3-用户认证","link":"#_3-用户认证","children":[{"level":3,"title":"3.1 需求分析","slug":"_3-1-需求分析","link":"#_3-1-需求分析","children":[]},{"level":3,"title":"3.2 连接用户中心数据库","slug":"_3-2-连接用户中心数据库","link":"#_3-2-连接用户中心数据库","children":[]},{"level":3,"title":"3.3 支持认证方式多样","slug":"_3-3-支持认证方式多样","link":"#_3-3-支持认证方式多样","children":[]},{"level":3,"title":"3.4 验证码服务","slug":"_3-4-验证码服务","link":"#_3-4-验证码服务","children":[]},{"level":3,"title":"3.5 账号密码认证","slug":"_3-5-账号密码认证","link":"#_3-5-账号密码认证","children":[]}]},{"level":2,"title":"4 微信扫码登录","slug":"_4-微信扫码登录","link":"#_4-微信扫码登录","children":[{"level":3,"title":"4.1 接入规范","slug":"_4-1-接入规范","link":"#_4-1-接入规范","children":[]},{"level":3,"title":"4.2 准备开发环境","slug":"_4-2-准备开发环境","link":"#_4-2-准备开发环境","children":[]},{"level":3,"title":"4.3 接入微信登录","slug":"_4-3-接入微信登录","link":"#_4-3-接入微信登录","children":[]}]},{"level":2,"title":"5 用户授权","slug":"_5-用户授权","link":"#_5-用户授权","children":[{"level":3,"title":"5.1 RBAC","slug":"_5-1-rbac","link":"#_5-1-rbac","children":[]},{"level":3,"title":"5.2 资源服务授权流程","slug":"_5-2-资源服务授权流程","link":"#_5-2-资源服务授权流程","children":[]},{"level":3,"title":"5.3 授权相关的数据模型","slug":"_5-3-授权相关的数据模型","link":"#_5-3-授权相关的数据模型","children":[]},{"level":3,"title":"5.4 查询用户权限","slug":"_5-4-查询用户权限","link":"#_5-4-查询用户权限","children":[]},{"level":3,"title":"5.5 授权测试","slug":"_5-5-授权测试","link":"#_5-5-授权测试","children":[]},{"level":3,"title":"5.6 细粒度授权","slug":"_5-6-细粒度授权","link":"#_5-6-细粒度授权","children":[]}]},{"level":2,"title":"6 实战","slug":"_6-实战","link":"#_6-实战","children":[{"level":3,"title":"6.1 找回密码(实战)","slug":"_6-1-找回密码-实战","link":"#_6-1-找回密码-实战","children":[]},{"level":3,"title":"6.2 注册(实战)","slug":"_6-2-注册-实战","link":"#_6-2-注册-实战","children":[]}]}],"relativePath":"pages/posts/Authentication_authorization-Spring-Security.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-lastest\\\\imklaus-valaxy-blog\\\\pages\\\\posts\\\\Authentication_authorization-Spring-Security.md","lastUpdated":null}'),F={name:"pages/posts/Authentication_authorization-Spring-Security.md",data:()=>({data:u,frontmatter:u.frontmatter,$frontmatter:u.frontmatter}),setup(){const s=l();s.meta.frontmatter=Object.assign(s.meta.frontmatter,u.frontmatter),o("pageData",u)}},d={id:"认证授权",tabindex:"-1"},g={id:"_1-模块需求分析",tabindex:"-1"},h=t("strong",null,"1 模块需求分析",-1),A={id:"_1-1-什么是认证授权",tabindex:"-1"},D=t("strong",null,"1.1 什么是认证授权",-1),C=t("p",null,"截至目前，项目已经完成了课程发布功能，课程发布后用户通过在线学习页面点播视频进行学习。如何去记录学生的学习过程呢？要想掌握学生的学习情况就需要知道用户的身份信息，记录哪个用户在什么时间学习什么课程，如果用户要购买课程也需要知道用户的身份信息。所以，去管理学生的学习过程最基本的要实现用户的身份认证。",-1),m=t("p",null,"认证授权模块实现平台所有用户的身份认证与用户授权功能。",-1),b=t("p",null,"什么是用户身份认证？",-1),B=t("p",null,"​ 用户身份认证即用户去访问系统资源时系统要求验证用户的身份信息，身份合法方可继续访问。常见的用户身份认证的表现形式有：用户名密码登录，微信扫码等方式。",-1),k=t("p",null,"项目包括学生、学习机构的老师、平台运营人员三类用户，不管哪一类用户在访问项目受保护资源时都需要进行身份认证。比如：发布课程操作，需要学习机构的老师首先登录系统成功，然后再执行发布课程操作。创建订单，需要学生用户首先登录系统，才可以创建订单。如下图：",-1),S=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps35.jpg"})],-1),v=t("p",null,"什么是用户授权？",-1),x=t("p",null,"​ 用户认证通过后去访问系统的资源，系统会判断用户是否拥有访问资源的权限，只允许访问有权限的系统资源，没有权限的资源将无法访问，这个过程叫用户授权。比如：用户去发布课程，系统首先进行用户身份认证，认证通过后继续判断用户是否有发布课程的权限，如果没有权限则拒绝继续访问系统，如果有权限则继续发布课程。如下图：",-1),f=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps36.jpg"})],-1),_={id:"_1-2-业务流程",tabindex:"-1"},w=t("strong",null,"1.2 业务流程",-1),U={id:"_1-2-1-统一认证",tabindex:"-1"},I=t("strong",null,"1.2.1 统一认证",-1),j=t("p",null,"项目包括学生、学习机构的老师、平台运营人员三类用户，三类用户将使用统一的认证入口，如下图：",-1),P=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps37.jpg"})],-1),M=t("p",null,"用户输入账号和密码提交认证，认证通过则继续操作。",-1),T=t("p",null,"项目由统一认证服务受理用户的认证请求，如下图：",-1),O=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps38.jpg"})],-1),z=t("p",null,"认证通过由认证服务向给用户颁发令牌，相当于访问系统的通行证，用户拿着令牌去访问系统的资源。",-1),R={id:"_1-2-2-单点登录",tabindex:"-1"},L=t("strong",null,"1.2.2 单点登录",-1),W=t("p",null,"本项目基于微服务架构构建，微服务包括：内容管理服务、媒资管理服务、学习中心服务、系统管理服务等，为了提高用户体验性，用户只需要认证一次便可以在多个拥有访问权限的系统中访问，这个功能叫做单点登录。",-1),N=t("p",null,"引用百度百科：单点登录（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。",-1),J=t("p",null,"如下图，用户只需要认证一次，便可以在多个拥有访问权限的系统中访问。",-1),X=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps39.jpg"})],-1),q={id:"_1-2-3-第三方认证",tabindex:"-1"},G=t("strong",null,"1.2.3 第三方认证",-1),K=t("p",null,"为了提高用户体验，很多网站有扫码登录的功能，如：微信扫码登录、QQ扫码登录等。扫码登录的好处是用户不用输入账号和密码，操作简便，另外一个好处就是有利于用户信息的共享，互联网的优势就是资源共享，用户也是一种资源，对于一个新网站如果让用户去注册是很困难的，如果提供了微信扫码登录将省去用户注册的成本，是一种非常有效的推广手段。",-1),V=t("p",null,"微信扫码登录其中的原理正是使用了第三方认证，如下图：",-1),H=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps40.jpg"})],-1),Z={id:"_2-spring-security-认证研究",tabindex:"-1"},Q=t("strong",null,"2 Spring Security 认证研究",-1),Y={id:"_2-1-spring-security介绍",tabindex:"-1"},$=t("strong",null,"2.1 Spring Security介绍",-1),ss=t("p",null,"认证功能几乎是每个项目都要具备的功能，并且它与业务无关，市面上有很多认证框架，如：Apache Shiro、CAS、Spring Security等。由于本项目基于Spring Cloud技术构建，Spring Security是spring家族的一份子且和Spring Cloud集成的很好，所以本项目选用Spring Security作为认证服务的技术框架。",-1),ls=t("p",null,"Spring Security 是一个功能强大且高度可定制的身份验证和访问控制框架，它是一个专注于为 Java 应用程序提供身份验证和授权的框架。",-1),os={id:"_2-2-认证授权入门",tabindex:"-1"},ns=t("strong",null,"2.2 认证授权入门",-1),es={id:"_2-2-1-创建认证服务工程",tabindex:"-1"},as=t("strong",null,"2.2.1 创建认证服务工程",-1),cs=t("p",null,"下边我们使用Spring Security框架快速构建认证授权功能体系。",-1),ts=t("p",null,"1、部署认证服务工程",-1),ps=t("p",null,"从课程资料中拷贝xuecheng-plus-auth工程到自己的工程目录下。",-1),rs=t("p",null,"此工程是一个普通的spring boot工程，可以连接数据库。",-1),Es=t("p",null,"此工程不具备认证授权的功能。",-1),ys=t("p",null,"2、创建数据库",-1),is=t("p",null,"创建xc_users数据库",-1),us=t("p",null,"导入课程资料中的xcplus_users.sql脚本。",-1),Fs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps41.jpg"})],-1),ds=t("p",null,[p("在nacos中新增"),t("code",null,"auth-service-dev.yaml"),p("：")],-1),gs=t("div",{style:{"max-height":"300px"},class:"language-yaml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"yaml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"server"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"servlet"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"context-path"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"/auth")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"port"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"63070")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"spring"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"datasource"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"driver-class-name"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"com.mysql.cj.jdbc.Driver")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"url"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"jdbc:mysql://192.168.2.203:3306/xc_users?serverTimezone=UTC&userUnicode=true&useSSL=false&")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"username"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"root")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"password"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"1234")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"server"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"servlet"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"context-path"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"/auth")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"port"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"63070")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"spring"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"datasource"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"driver-class-name"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"com.mysql.cj.jdbc.Driver")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"url"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"jdbc:mysql://192.168.2.203:3306/xc_users?serverTimezone=UTC&userUnicode=true&useSSL=false&")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"username"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"root")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"password"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"1234")])])]),t("button",{class:"collapse"})],-1),hs=t("p",null,"初始工程自带了一个Controller类，如下：",-1),As=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"LoginController"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  XcUserMapper userMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/login-success"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"loginSuccess"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"登录成功"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/user/{id}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"getuser"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"PathVariable"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"id"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"id"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUser xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," userMapper."),t("span",{style:{color:"#B392F0"}},"selectById"),t("span",{style:{color:"#E1E4E8"}},"(id);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/r/r1"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"r1"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"访问r1资源"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/r/r2"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"r2"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"访问r2资源"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"LoginController"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  XcUserMapper userMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/login-success"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"loginSuccess"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"登录成功"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/user/{id}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"getuser"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"PathVariable"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"id"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"id"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUser xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," userMapper."),t("span",{style:{color:"#6F42C1"}},"selectById"),t("span",{style:{color:"#24292E"}},"(id);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/r/r1"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"r1"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"访问r1资源"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/r/r2"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"r2"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"访问r2资源"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ds=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps42.jpg"})],-1),Cs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps43.jpg"})],-1),ms=t("p",null,"以上测试一切正常说明此工程部署成功。",-1),bs={id:"_2-2-2-认证测试",tabindex:"-1"},Bs=t("strong",null,"2.2.2 认证测试",-1),ks=t("p",null,"下边向auth认证工程集成Spring security，向pom.xml加入Spring Security所需要的依赖",-1),Ss=t("div",{style:{"max-height":"300px"},class:"language-xml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"xml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">org.springframework.cloud</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">spring-cloud-starter-security</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">org.springframework.cloud</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">spring-cloud-starter-oauth2</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">org.springframework.cloud</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">spring-cloud-starter-security</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">org.springframework.cloud</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">spring-cloud-starter-oauth2</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")])])]),t("button",{class:"collapse"})],-1),vs=t("p",null,[p("自动进入"),t("code",null,"/login"),p("登录页面，"),t("code",null,"/login"),p("是spring security提供的,此页面有几个css样式加载会稍微慢点，如下图：")],-1),xs=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps44.jpg"})],-1),fs=t("p",null,"账号和密码是多少呢？下一步需要进行安全配置。",-1),_s=t("p",null,[p("拷贝课程资料下的"),t("code",null,"WebSecurityConfig.java"),p("到config下需要三部分内容：")],-1),ws=t("p",null,"1、用户信息",-1),Us=t("p",null,[p("在内存配置两个用户："),t("code",null,"zhangsan、lisi")],-1),Is=t("p",null,"zhangsan用户拥有的权限为p1",-1),js=t("p",null,"lisi用户拥有的权限为p2",-1),Ps=t("p",null,"2、密码方式",-1),Ms=t("p",null,"暂时采用明文方式",-1),Ts=t("p",null,"3、安全拦截机制",-1),Os=t("p",null,[t("code",null,"/r/**"),p("开头的请求需要认证")],-1),zs=t("p",null,"登录成功到成功页面",-1),Rs=t("p",null,"代码如下：",-1),Ls=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//配置用户信息服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetailsService "),t("span",{style:{color:"#B392F0"}},"userDetailsService"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    InMemoryUserDetailsManager manager "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"zhangsan"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"123"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"lisi"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"456"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p2"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," PasswordEncoder "),t("span",{style:{color:"#B392F0"}},"passwordEncoder"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//密码为明文方式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," NoOpPasswordEncoder."),t("span",{style:{color:"#B392F0"}},"getInstance"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//配置安全拦截机制")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"protected"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(HttpSecurity http) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        http")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"authorizeRequests"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"antMatchers"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/r/**"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authenticated"),t("span",{style:{color:"#E1E4E8"}},"()"),t("span",{style:{color:"#6A737D"}},"//访问/r开始的请求需要认证通过")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"anyRequest"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"permitAll"),t("span",{style:{color:"#E1E4E8"}},"()"),t("span",{style:{color:"#6A737D"}},"//其它请求全部放行")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"and"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"formLogin"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"successForwardUrl"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/login-success"'),t("span",{style:{color:"#E1E4E8"}},");"),t("span",{style:{color:"#6A737D"}},"//登录成功跳转到/login-success")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                http."),t("span",{style:{color:"#B392F0"}},"logout"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"logoutUrl"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/logout"'),t("span",{style:{color:"#E1E4E8"}},");"),t("span",{style:{color:"#6A737D"}},"//退出地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//配置用户信息服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetailsService "),t("span",{style:{color:"#6F42C1"}},"userDetailsService"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    InMemoryUserDetailsManager manager "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"zhangsan"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"123"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"lisi"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"456"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p2"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," PasswordEncoder "),t("span",{style:{color:"#6F42C1"}},"passwordEncoder"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//密码为明文方式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," NoOpPasswordEncoder."),t("span",{style:{color:"#6F42C1"}},"getInstance"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//配置安全拦截机制")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"protected"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(HttpSecurity http) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        http")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"authorizeRequests"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"antMatchers"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/r/**"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authenticated"),t("span",{style:{color:"#24292E"}},"()"),t("span",{style:{color:"#6A737D"}},"//访问/r开始的请求需要认证通过")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"anyRequest"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"permitAll"),t("span",{style:{color:"#24292E"}},"()"),t("span",{style:{color:"#6A737D"}},"//其它请求全部放行")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"and"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"formLogin"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"successForwardUrl"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/login-success"'),t("span",{style:{color:"#24292E"}},");"),t("span",{style:{color:"#6A737D"}},"//登录成功跳转到/login-success")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                http."),t("span",{style:{color:"#6F42C1"}},"logout"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"logoutUrl"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/logout"'),t("span",{style:{color:"#24292E"}},");"),t("span",{style:{color:"#6A737D"}},"//退出地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),Ws=t("p",null,"重启工程",-1),Ns=t("p",null,"账号zhangsan，密码为123，如果输入的密码不正确会认证失败，输入正确显示登录成功。",-1),Js=t("p",null,[t("code",null,'http.logout().logoutUrl("/logout");'),p("配置了退出页面，认证成功后访问"),t("code",null,"/logout"),p("可退出登录。")],-1),Xs={id:"_2-2-3-授权测试",tabindex:"-1"},qs=t("strong",null,"2.2.3 授权测试",-1),Gs=t("p",null,"用户认证通过去访问系统资源时spring security进行授权控制，判断用户是否有该资源的访问权限，如果有则继续访问，如果没有则拒绝访问。",-1),Ks=t("p",null,"下边测试授权功能：",-1),Vs=t("p",null,"1、配置用户拥有哪些权限。",-1),Hs=t("p",null,"在WebSecurityConfig类配置zhangsan拥有p1权限，lisi拥有p2权限。",-1),Zs=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetailsService "),t("span",{style:{color:"#B392F0"}},"userDetailsService"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        InMemoryUserDetailsManager manager "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"zhangsan"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"123"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"lisi"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"456"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p2"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetailsService "),t("span",{style:{color:"#6F42C1"}},"userDetailsService"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        InMemoryUserDetailsManager manager "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"zhangsan"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"123"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"lisi"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"456"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p2"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),Qs=t("p",null,"2、指定资源与权限的关系。",-1),Ys=t("p",null,"什么是系统的资源？",-1),$s=t("p",null,"比如：查询一个用户的信息，用户信息就是系统的资源，要访问资源需要通过URL，所以我们在controller中定义的每个http的接口就是访问资源的接口。",-1),sl=t("p",null,[p("下边在controller中配置"),t("code",null,"/r/r1"),p("需要p1权限，"),t("code",null,"/r/r2"),p("需要p2权限。")],-1),ll=t("p",null,[t("code",null,"hasAuthority('p1')"),p("表示拥有p1权限方可访问。")],-1),ol=t("p",null,"代码如下：",-1),nl=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"LoginController"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ....")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/r/r1"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PreAuthorize"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},"\"hasAuthority('p1')\""),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//拥有p1权限方可访问")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"r1"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"访问r1资源"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/r/r2"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PreAuthorize"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},"\"hasAuthority('p2')\""),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//拥有p2权限方可访问")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"r2"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"访问r2资源"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ...")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"LoginController"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ....")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/r/r1"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PreAuthorize"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},"\"hasAuthority('p1')\""),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//拥有p1权限方可访问")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"r1"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"访问r1资源"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/r/r2"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PreAuthorize"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},"\"hasAuthority('p2')\""),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//拥有p2权限方可访问")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"r2"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"访问r2资源"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ...")])])]),t("button",{class:"collapse"})],-1),el=t("p",null,"现在重启工程。",-1),al=t("p",null,"当访问以/r/开头的url时会判断用户是否认证，如果没有认证则跳转到登录页面，如果已经认证则判断用户是否具有该URL的访问权限，如果具有该URL的访问权限则继续，否则拒绝访问。",-1),cl=t("p",null,"例如：",-1),tl=t("p",null,[p("访问"),t("code",null,"/r/r1"),p("，使用zhangsan登录可以正常访问，因为在"),t("code",null,"/r/r1"),p("的方法上指定了权限p1，zhangsan用户拥有权限p1,所以可以正常访问。")],-1),pl=t("p",null,[p("访问"),t("code",null,"/r/r1"),p("，使用lisi登录则拒绝访问，由于lisi用户不具有权限p1需要拒绝访问")],-1),rl=t("p",null,[p("注意：如果访问上不加"),t("code",null,"@PreAuthorize"),p("，此方法没有授权控制。")],-1),El=t("p",null,"整理授权的过程见下图所示：",-1),yl=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps45.jpg"})],-1),il={id:"_2-2-4-工作原理",tabindex:"-1"},ul=t("strong",null,"2.2.4 工作原理",-1),Fl=t("p",null,"通过测试认证和授权两个功能，我们了解了Spring Security的基本使用方法，下边了解它的工作流程。",-1),dl=t("p",null,[p("Spring Security所解决的问题就是"),t("strong",null,"安全访问控制"),p("，而安全访问控制功能其实就是对所有进入系统的请求进行拦截，校验每个请求是否能够访问它所期望的资源。根据前边知识的学习，可以通过Filter或AOP等技术来实现，Spring Security对Web资源的保护是靠Filter实现的，所以从这个Filter来入手，逐步深入Spring Security原理。")],-1),gl=t("p",null,[p("​ 当初始化Spring Security时，会创建一个名为SpringSecurityFilterChain的Servlet过滤器，类型为 "),t("code",null,"org.springframework.security.web.FilterChainProxy"),p("，它实现了"),t("code",null,"javax.servlet.Filter"),p("，因此外部的请求会经过此类，下图是Spring Security过虑器链结构图：")],-1),hl=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps46.jpg"})],-1),Al=t("p",null,[p("FilterChainProxy是一个代理，真正起作用的是FilterChainProxy中SecurityFilterChain所包含的各个Filter，同时这些Filter作为Bean被Spring管理，它们是Spring Security核心，各有各的职责，但他们并不直接处理用户的"),t("strong",null,"认证"),p("，也不直接处理用户的"),t("strong",null,"授权"),p("，而是把它们交给了认证管理器（AuthenticationManager）和决策管理器（AccessDecisionManager）进行处理。")],-1),Dl=t("p",null,"spring Security功能的实现主要是由一系列过滤器链相互配合完成。",-1),Cl=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps47.jpg"})],-1),ml=t("p",null,"下面介绍过滤器链中主要的几个过滤器及其作用：",-1),bl=t("p",null,[t("strong",null,"SecurityContextPersistenceFilter"),p(" 这个Filter是整个拦截过程的入口和出口（也就是第一个和最后一个拦截器），会在请求开始时从配置好的 SecurityContextRepository 中获取 SecurityContext，然后把它设置给 SecurityContextHolder。在请求完成后将 SecurityContextHolder 持有的 SecurityContext 再保存到配置好的 SecurityContextRepository，同时清除 securityContextHolder 所持有的 SecurityContext；")],-1),Bl=t("p",null,[t("strong",null,"UsernamePasswordAuthenticationFilter"),p(" 用于处理来自表单提交的认证。该表单必须提供对应的用户名和密码，其内部还有登录成功或失败后进行处理的 AuthenticationSuccessHandler 和 AuthenticationFailureHandler，这些都可以根据需求做相关改变；")],-1),kl=t("p",null,[t("strong",null,"FilterSecurityInterceptor"),p(" 是用于保护web资源的，使用AccessDecisionManager对当前用户进行授权访问，前面已经详细介绍过了；")],-1),Sl=t("p",null,[t("strong",null,"ExceptionTranslationFilter"),p(" 能够捕获来自 FilterChain 所有的异常，并进行处理。但是它只会处理两类异常：AuthenticationException 和 AccessDeniedException，其它的异常它会继续抛出。")],-1),vl=t("p",null,"Spring Security的执行流程如下：",-1),xl=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/wps48.jpg"})],-1),fl=t("ol",null,[t("li",null,[t("p",null,"用户提交用户名、密码被SecurityFilterChain中的UsernamePasswordAuthenticationFilter过滤器获取到，封装为请求Authentication，通常情况下是UsernamePasswordAuthenticationToken这个实现类。")]),t("li",null,[t("p",null,"然后过滤器将Authentication提交至认证管理器（AuthenticationManager）进行认证")]),t("li",null,[t("p",null,"认证成功后，AuthenticationManager身份管理器返回一个被填充满了信息的（包括上面提到的权限信息，身份信息，细节信息，但密码通常会被移除）Authentication实例。")]),t("li",null,[t("p",null,[p("SecurityContextHolder安全上下文容器将第3步填充了信息的Authentication，通过"),t("code",null,"SecurityContextHolder.getContext().setAuthentication(…)"),p("方法，设置到其中。")])]),t("li",null,[t("p",null,[p("可以看出AuthenticationManager接口（认证管理器）是认证相关的核心接口，也是发起认证的出发点，它的实现类为ProviderManager。而Spring Security支持多种认证方式，因此ProviderManager维护着一个"),t("code",null,"List<AuthenticationProvider>"),p("列表，存放多种认证方式，最终实际的认证工作是由AuthenticationProvider完成的。咱们知道web表单的对应的AuthenticationProvider实现类为DaoAuthenticationProvider，它的内部又维护着一个UserDetailsService负责UserDetails的获取。最终AuthenticationProvider将UserDetails填充至Authentication。")])])],-1),_l={id:"_2-3-什么是oauth2",tabindex:"-1"},wl=t("strong",null,"2.3 什么是OAuth2",-1),Ul={id:"_2-3-1-oauth2认证流程",tabindex:"-1"},Il=t("strong",null,"2.3.1 OAuth2认证流程",-1),jl=t("p",null,"在前边我们提到微信扫码认证，这是一种第三方认证的方式，这种认证方式是基于OAuth2协议实现，",-1),Pl=t("p",null,[p("OAUTH协议为用户资源的授权提供了一个安全的、开放而又简易的标准。同时，任何第三方都可以使用OAUTH认证服务，任何服务提供商都可以实现自身的OAUTH认证服务，因而OAUTH是开放的。业界提供了OAUTH的多种实现如"),t("code",null,"PHP、JavaScript，Java，Ruby"),p("等各种语言开发包，大大节约了程序员的时间，因而OAUTH是简易的。互联网很多服务如Open API，很多大公司如"),t("code",null,"Google，Yahoo，Microsoft"),p("等都提供了OAUTH认证服务，这些都足以说明OAUTH标准逐渐成为开放资源授权的标准。")],-1),Ml=t("p",null,"​ Oauth协议目前发展到2.0版本，1.0版本过于复杂，2.0版本已得到广泛应用。",-1),Tl=t("p",null,"下边分析一个Oauth2认证的例子，黑马程序员网站使用微信认证扫码登录的过程：",-1),Ol=t("figure",null,[t("img",{alt:"image-20230705222917841",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705222917841.png"})],-1),zl=t("p",null,"具体流程如下：",-1),Rl=t("p",null,"1、用户点击微信扫码",-1),Ll=t("p",null,"用户进入黑马程序的登录页面，点击微信的图标开打微信扫码界面。",-1),Wl=t("figure",null,[t("img",{alt:"image-20230705223020201",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223020201.png"})],-1),Nl=t("figure",null,[t("img",{alt:"image-20230705223055747",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223055747.png"})],-1),Jl=t("p",null,"微信扫码的目的是通过微信认证登录黑马程序员官网，黑马程序员网站需要从微信获取当前用户的身份信息才会让当前用户在黑马网站登录成功。",-1),Xl=t("p",null,"现在搞清楚几个概念：",-1),ql=t("p",null,"资源：用户信息，在微信中存储。",-1),Gl=t("p",null,"资源拥有者：用户是用户信息资源的拥有者。",-1),Kl=t("p",null,"认证服务：微信负责认证当前用户的身份，负责为客户端颁发令牌。",-1),Vl=t("p",null,"客户端：客户端会携带令牌请求微信获取用户信息，黑马程序员网站即客户端，黑马网站需要在浏览器打开。",-1),Hl=t("p",null,"2、用户授权黑马网站访问用户信息",-1),Zl=t("p",null,"资源拥有者扫描二维码表示资源拥有者请求微信进行认证，微信认证通过向用户手机返回授权页面，如下图：",-1),Ql=t("figure",null,[t("img",{alt:"image-20230705223223906",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223223906.png"})],-1),Yl=t("p",null,"询问用户是否授权黑马程序员访问自己在微信的用户信息，用户点击“确认登录”表示同意授权，微信认证服务器会颁发一个授权码给黑马程序员的网站。",-1),$l=t("p",null,"只有资源拥有者同意微信才允许黑马网站访问资源。",-1),so=t("p",null,"3、黑马程序员的网站获取到授权码",-1),lo=t("p",null,"4、携带授权码请求微信认证服务器申请令牌",-1),oo=t("p",null,"此交互过程用户看不到。",-1),no=t("p",null,"5、微信认证服务器向黑马程序员的网站响应令牌",-1),eo=t("p",null,"此交互过程用户看不到。",-1),ao=t("p",null,"6、黑马程序员网站请求微信资源服务器获取资源即用户信息。",-1),co=t("p",null,"黑马程序员网站携带令牌请求访问微信服务器获取用户的基本信息。",-1),to=t("p",null,"7、资源服务器返回受保护资源即用户信息",-1),po=t("p",null,"8、黑马网站接收到用户信息，此时用户在黑马网站登录成功。",-1),ro=t("p",null,"理解了微信扫码登录黑马网站的流程，接下来认识Oauth2.0的认证流程，如下：",-1),Eo=t("figure",null,[t("img",{alt:"image-20230705223310223",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223310223.png"})],-1),yo=t("p",null,"Oauth2包括以下角色：",-1),io=t("p",null,"1、客户端",-1),uo=t("p",null,"本身不存储资源，需要通过资源拥有者的授权去请求资源服务器的资源，比如：手机客户端、浏览器等。",-1),Fo=t("p",null,"上边示例中黑马网站即为客户端，它需要通过浏览器打开。",-1),go=t("p",null,"2、资源拥有者",-1),ho=t("p",null,"通常为用户，也可以是应用程序，即该资源的拥有者。",-1),Ao=t("p",null,"A表示 客户端请求资源拥有者授权。",-1),Do=t("p",null,"B表示 资源拥有者授权客户端即黑马网站访问自己的用户信息。",-1),Co=t("p",null,"3、授权服务器（也称认证服务器）",-1),mo=t("p",null,"认证服务器对资源拥有者进行认证，还会对客户端进行认证并颁发令牌。",-1),bo=t("p",null,"C 客户端即黑马网站携带授权码请求认证。",-1),Bo=t("p",null,"D认证通过颁发令牌。",-1),ko=t("p",null,"4、资源服务器",-1),So=t("p",null,"存储资源的服务器。",-1),vo=t("p",null,"E表示客户端即黑马网站携带令牌请求资源服务器获取资源。",-1),xo=t("p",null,"F表示资源服务器校验令牌通过后提供受保护资源。",-1),fo={id:"_2-3-2-oauth2在本项目的应用",tabindex:"-1"},_o=t("strong",null,"2.3.2 OAuth2在本项目的应用",-1),wo=t("p",null,"Oauth2是一个标准的开放的授权协议，应用程序可以根据自己的要求去使用Oauth2，本项目使用Oauth2实现如下目标：",-1),Uo=t("p",null,"1、学成在线访问第三方系统的资源。",-1),Io=t("p",null,"本项目要接入微信扫码登录所以本项目要使用OAuth2协议访问微信中的用户信息。",-1),jo=t("p",null,"2、外部系统访问学成在线的资源 。",-1),Po=t("p",null,"同样当第三方系统想要访问学成在线网站的资源也可以基于OAuth2协议。",-1),Mo=t("p",null,"3、学成在线前端（客户端） 访问学成在线微服务的资源。",-1),To=t("p",null,"本项目是前后端分离架构，前端访问微服务资源也可以基于OAuth2协议进行认证。",-1),Oo={id:"_2-3-3-oauth2的授权模式",tabindex:"-1"},zo=t("strong",null,"2.3.3 OAuth2的授权模式",-1),Ro=t("p",null,"Spring Security支持OAuth2认证，OAuth2提供授权码模式、密码模式、简化模式、客户端模式等四种授权模式，前边举的微信扫码登录的例子就是基于授权码模式，这四种模式中授权码模式和密码模式应用较多，本节使用Spring Security演示授权码模式、密码模式，其余两种请自行查阅相关资料。",-1),Lo={id:"_2-3-3-1-授权码模式",tabindex:"-1"},Wo=t("strong",null,"2.3.3.1 授权码模式",-1),No=t("p",null,"OAuth2的几个授权模式是根据不同的应用场景以不同的方式去获取令牌，最终目的是要获取认证服务颁发的令牌，最终通过令牌去获取资源。",-1),Jo=t("p",null,"授权码模式简单理解是使用授权码去获取令牌，要想获取令牌先要获取授权码，授权码的获取需要资源拥有者亲自授权同意才可以获取。",-1),Xo=t("p",null,"下图是授权码模式的交互图：",-1),qo=t("figure",null,[t("img",{alt:"image-20230705223355846",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223355846.png"})],-1),Go=t("p",null,"还以黑马网站微信扫码登录为例进行说明：",-1),Ko=t("p",null,"1、用户打开浏览器。",-1),Vo=t("p",null,"2、通过浏览器访问客户端即黑马网站。",-1),Ho=t("p",null,"3、用户通过浏览器向认证服务请求授权，请求授权时会携带客户端的URL，此URL为下发授权码的重定向地址。",-1),Zo=t("p",null,"4、认证服务向资源拥有者返回授权页面。",-1),Qo=t("p",null,"5、资源拥有者亲自授权同意。",-1),Yo=t("p",null,"6、通过浏览器向认证服务发送授权同意。",-1),$o=t("p",null,"7、认证服务向客户端地址重定向并携带授权码。",-1),sn=t("p",null,"8、客户端即黑马网站收到授权码。",-1),ln=t("p",null,"9、客户端携带授权码向认证服务申请令牌。",-1),on=t("p",null,"10、认证服务向客户端颁发令牌。",-1),nn={id:"_2-3-3-2授权码模式测试",tabindex:"-1"},en=t("strong",null,"2.3.3.2授权码模式测试",-1),an=t("p",null,"要想测试授权模式首先要配置授权服务器即上图中的认证服务器，需要配置授权服务及令牌策略。",-1),cn=t("p",null,[p("1、从课程资料中拷贝 "),t("code",null,"AuthorizationServer.java、TokenConfig.java"),p("到认证服务的config包下。")],-1),tn=t("blockquote",null,[t("p",null,[p("说明：AuthorizationServer用 "),t("code",null,"@EnableAuthorizationServer"),p(" 注解标识并继承AuthorizationServerConfigurerAdapter来配置OAuth2.0 授权服务器。")])],-1),pn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"EnableAuthorizationServer")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthorizationServer"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthorizationServerConfigurerAdapter"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," ...")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"EnableAuthorizationServer")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthorizationServer"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthorizationServerConfigurerAdapter"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," ...")])])]),t("button",{class:"collapse"})],-1),rn=t("p",null,"AuthorizationServerConfigurerAdapter要求配置以下几个类：",-1),En=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthorizationServerConfigurerAdapter"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthorizationServerConfigurer"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthorizationServerConfigurerAdapter"),t("span",{style:{color:"#E1E4E8"}},"() {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(AuthorizationServerSecurityConfigurer "),t("span",{style:{color:"#FFAB70"}},"security"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(ClientDetailsServiceConfigurer "),t("span",{style:{color:"#FFAB70"}},"clients"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(AuthorizationServerEndpointsConfigurer "),t("span",{style:{color:"#FFAB70"}},"endpoints"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthorizationServerConfigurerAdapter"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthorizationServerConfigurer"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthorizationServerConfigurerAdapter"),t("span",{style:{color:"#24292E"}},"() {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(AuthorizationServerSecurityConfigurer "),t("span",{style:{color:"#E36209"}},"security"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(ClientDetailsServiceConfigurer "),t("span",{style:{color:"#E36209"}},"clients"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(AuthorizationServerEndpointsConfigurer "),t("span",{style:{color:"#E36209"}},"endpoints"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),yn=t("p",null,[t("strong",null,"1）ClientDetailsServiceConfigurer"),p("：用来配置客户端详情服务（ClientDetailsService），")],-1),un=t("p",null,"随便一个客户端都可以随便接入到它的认证服务吗？答案是否定的，服务提供商会给批准接入的客户端一个身份，用于接入时的凭据，有客户端标识和客户端秘钥，在这里配置批准接入的客户端的详细信息。",-1),Fn=t("p",null,[t("strong",null,"2）AuthorizationServerEndpointsConfigurer"),p("：用来配置令牌（token）的访问端点和令牌服务(token services)。")],-1),dn=t("p",null,[t("strong",null,"3）AuthorizationServerSecurityConfigurer"),p("：用来配置令牌端点的安全约束.")],-1),gn=t("p",null,[t("strong",null,"2、TokenConfig为令牌策略配置类")],-1),hn=t("p",null,"暂时先使用InMemoryTokenStore在内存存储令牌，令牌的有效期等信息配置如下：",-1),An=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//令牌管理服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"name"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"authorizationServerTokenServicesCustom"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," AuthorizationServerTokenServices "),t("span",{style:{color:"#B392F0"}},"tokenService"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        DefaultTokenServices service"),t("span",{style:{color:"#F97583"}},"=new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"DefaultTokenServices"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setSupportRefreshToken"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},");"),t("span",{style:{color:"#6A737D"}},"//支持刷新令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setTokenStore"),t("span",{style:{color:"#E1E4E8"}},"(tokenStore);"),t("span",{style:{color:"#6A737D"}},"//令牌存储策略")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setAccessTokenValiditySeconds"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"7200"),t("span",{style:{color:"#E1E4E8"}},"); "),t("span",{style:{color:"#6A737D"}},"// 令牌默认有效期2小时")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setRefreshTokenValiditySeconds"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"259200"),t("span",{style:{color:"#E1E4E8"}},"); "),t("span",{style:{color:"#6A737D"}},"// 刷新令牌默认有效期3天")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," service;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//令牌管理服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"name"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"authorizationServerTokenServicesCustom"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," AuthorizationServerTokenServices "),t("span",{style:{color:"#6F42C1"}},"tokenService"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        DefaultTokenServices service"),t("span",{style:{color:"#D73A49"}},"=new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"DefaultTokenServices"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setSupportRefreshToken"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},");"),t("span",{style:{color:"#6A737D"}},"//支持刷新令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setTokenStore"),t("span",{style:{color:"#24292E"}},"(tokenStore);"),t("span",{style:{color:"#6A737D"}},"//令牌存储策略")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setAccessTokenValiditySeconds"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"7200"),t("span",{style:{color:"#24292E"}},"); "),t("span",{style:{color:"#6A737D"}},"// 令牌默认有效期2小时")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setRefreshTokenValiditySeconds"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"259200"),t("span",{style:{color:"#24292E"}},"); "),t("span",{style:{color:"#6A737D"}},"// 刷新令牌默认有效期3天")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," service;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),Dn=t("p",null,"3、配置认证管理bean",-1),Cn=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"EnableWebSecurity")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"EnableGlobalMethodSecurity"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"securedEnabled"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"prePostEnabled"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WebSecurityConfig"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WebSecurityConfigurerAdapter"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," AuthenticationManager "),t("span",{style:{color:"#B392F0"}},"authenticationManagerBean"),t("span",{style:{color:"#E1E4E8"}},"() "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"super"),t("span",{style:{color:"#E1E4E8"}},"."),t("span",{style:{color:"#B392F0"}},"authenticationManagerBean"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ....")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"EnableWebSecurity")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"EnableGlobalMethodSecurity"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"securedEnabled"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"prePostEnabled"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WebSecurityConfig"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WebSecurityConfigurerAdapter"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," AuthenticationManager "),t("span",{style:{color:"#6F42C1"}},"authenticationManagerBean"),t("span",{style:{color:"#24292E"}},"() "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"super"),t("span",{style:{color:"#24292E"}},"."),t("span",{style:{color:"#6F42C1"}},"authenticationManagerBean"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ....")])])]),t("button",{class:"collapse"})],-1),mn=t("p",null,"重启认证服务",-1),bn=t("p",null,"1、get请求获取授权码",-1),Bn=t("p",null,"参数列表如下：",-1),kn=t("p",null,[p("• "),t("code",null,"client_id"),p("：客户端准入标识。")],-1),Sn=t("p",null,[p("• "),t("code",null,"response_type"),p("：授权码模式固定为code。")],-1),vn=t("p",null,[p("• "),t("code",null,"scope"),p("：客户端权限。")],-1),xn=t("p",null,[p("• "),t("code",null,"redirect_uri"),p("：跳转uri，当授权码申请成功后会跳转到此地址，并在后边带上code参数（授权码）。")],-1),fn=t("p",null,[p("输入账号zhangsan、密码123登录成功，输入"),t("code",null,"/oauth/authorize?client_id=XcWebApp&response_type=code&scope=all&redirect_uri=http://www.51xuecheng.cn")],-1),_n=t("p",null,"显示授权页面",-1),wn=t("figure",null,[t("img",{alt:"image-20230705223440333",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223440333.png"})],-1),Un=t("p",null,"授权“XcWebApp”访问自己的受保护资源?",-1),In=t("p",null,"选择同意。",-1),jn=t("p",null,"3、使用httpclient工具post申请令牌",-1),Pn=t("p",null,[t("code",null,"/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=authorization_code&code=授权码&redirect_uri=http://www.51xuecheng.cn/")],-1),Mn=t("p",null,"参数列表如下",-1),Tn=t("p",null,[p("• "),t("code",null,"client_id"),p("：客户端准入标识。")],-1),On=t("p",null,[p("• "),t("code",null,"client_secret"),p("：客户端秘钥。")],-1),zn=t("p",null,[p("• "),t("code",null,"grant_type"),p("：授权类型，填写authorization_code，表示授权码模式")],-1),Rn=t("p",null,[p("• "),t("code",null,"code"),p("：授权码，就是刚刚获取的授权码，注意：授权码只使用一次就无效了，需要重新申请。")],-1),Ln=t("p",null,[p("• "),t("code",null,"redirect_uri"),p("：申请授权码时的跳转url，一定和申请授权码时用的redirect_uri一致。")],-1),Wn=t("p",null,"httpclient脚本如下：",-1),Nn=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 授权码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 第一步申请授权码(浏览器请求)/oauth/authorize?client_id=c1&response_type=code&scope=all&redirect_uri=http://www.51xuecheng.cn")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 第二步申请令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{auth_host}}/auth/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=authorization_code&code=CTvCrB&redirect_uri=http://www.51xuecheng.cn")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 授权码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 第一步申请授权码(浏览器请求)/oauth/authorize?client_id=c1&response_type=code&scope=all&redirect_uri=http://www.51xuecheng.cn")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 第二步申请令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{auth_host}}/auth/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=authorization_code&code=CTvCrB&redirect_uri=http://www.51xuecheng.cn")])])]),t("button",{class:"collapse"})],-1),Jn=t("p",null,"申请令牌成功如下所示：",-1),Xn=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"access_token"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"368b1ee7-a9ee-4e9a-aae6-0fcab243aad2"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"token_type"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"bearer"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"refresh_token"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"3d56e139-0ee6-4ace-8cbe-1311dfaa991f"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"expires_in"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"7199"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"scope"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"access_token"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"368b1ee7-a9ee-4e9a-aae6-0fcab243aad2"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"token_type"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"bearer"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"refresh_token"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"3d56e139-0ee6-4ace-8cbe-1311dfaa991f"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"expires_in"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"7199"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"scope"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),qn=t("p",null,"说明：",-1),Gn=t("p",null,[p("1、"),t("code",null,"access_token"),p("，访问令牌，用于访问资源使用。")],-1),Kn=t("p",null,[p("2、"),t("code",null,"token_type"),p("，bearer是在RFC6750中定义的一种token类型，在携带令牌访问资源时需要在head中加入bearer 空格 令牌内容")],-1),Vn=t("p",null,[p("3、"),t("code",null,"refresh_token"),p("，当令牌快过期时使用刷新令牌可以再次生成令牌。")],-1),Hn=t("p",null,[p("4、"),t("code",null,"expires_in"),p("：过期时间（秒）")],-1),Zn=t("p",null,[p("5、"),t("code",null,"scope"),p("：令牌的权限范围，服务端可以根据令牌的权限范围去对令牌授权。")],-1),Qn={id:"_2-3-3-3-密码模式",tabindex:"-1"},Yn=t("strong",null,"2.3.3.3 密码模式",-1),$n=t("p",null,"密码模式相对授权码模式简单，授权码模式需要借助浏览器供用户亲自授权，密码模式不用借助浏览器，如下图：",-1),se=t("figure",null,[t("img",{alt:"image-20230705223503678",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223503678.png"})],-1),le=t("p",null,"1、资源拥有者提供账号和密码",-1),oe=t("p",null,"2、客户端向认证服务申请令牌，请求中携带账号和密码",-1),ne=t("p",null,"3、认证服务校验账号和密码正确颁发令牌。",-1),ee=t("p",null,"开始测试：",-1),ae=t("p",null,"1、POST请求获取令牌",-1),ce=t("p",null,[t("code",null,"/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username=shangsan&password=123")],-1),te=t("p",null,"参数列表如下：",-1),pe=t("ul",null,[t("li",null,[t("code",null,"client_id"),p("：客户端准入标识。")]),t("li",null,[t("code",null,"client_secret"),p("：客户端秘钥。")]),t("li",null,[t("code",null,"grant_type"),p("：授权类型，填写password表示密码模式")]),t("li",null,[t("code",null,"username"),p("：资源拥有者用户名。")]),t("li",null,[t("code",null,"password"),p("：资源拥有者密码。")])],-1),re=t("p",null,[p("2、授权服务器将令牌（"),t("code",null,"access_token"),p("）发送给client")],-1),Ee=t("p",null,"使用httpclient进行测试",-1),ye=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{auth_host}}/auth/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username=zhangsan&password=123")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{auth_host}}/auth/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username=zhangsan&password=123")])])]),t("button",{class:"collapse"})],-1),ie=t("p",null,"返回示例：",-1),ue=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"access_token"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"368b1ee7-a9ee-4e9a-aae6-0fcab243aad2"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"token_type"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"bearer"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"refresh_token"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"3d56e139-0ee6-4ace-8cbe-1311dfaa991f"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"expires_in"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"6806"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"scope"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"access_token"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"368b1ee7-a9ee-4e9a-aae6-0fcab243aad2"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"token_type"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"bearer"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"refresh_token"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"3d56e139-0ee6-4ace-8cbe-1311dfaa991f"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"expires_in"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"6806"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"scope"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Fe=t("p",null,"​ 这种模式十分简单，但是却意味着直接将用户敏感信息泄漏给了client，因此这就说明这种模式只能用于client是我们自己开发的情况下。",-1),de={id:"_2-3-3-4-本项目的应用方式",tabindex:"-1"},ge=t("strong",null,"2.3.3.4 本项目的应用方式",-1),he=t("p",null,"通过演示授权码模式和密码模式，授权码模式适合客户端和认证服务非同一个系统的情况，所以本项目使用授权码模式完成微信扫码认证。本项目采用密码模式作为前端请求微服务的认证方式。",-1),Ae={id:"_2-4-jwt",tabindex:"-1"},De=t("strong",null,"2.4 JWT",-1),Ce={id:"_2-4-1-普通令牌的问题",tabindex:"-1"},me=t("strong",null,"2.4.1 普通令牌的问题",-1),be=t("p",null,"客户端申请到令牌，接下来客户端携带令牌去访问资源，到资源服务器将会校验令牌的合法性。",-1),Be=t("p",null,"资源服务器如何校验令牌的合法性？",-1),ke=t("p",null,"我们以OAuth2的密码模式为例进行说明：",-1),Se=t("figure",null,[t("img",{alt:"image-20230705223542073",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223542073.png"})],-1),ve=t("p",null,"从第4步开始说明：",-1),xe=t("p",null,"1、客户端携带令牌访问资源服务获取资源。",-1),fe=t("p",null,"2、资源服务远程请求认证服务校验令牌的合法性",-1),_e=t("p",null,"3、如果令牌合法资源服务向客户端返回资源。",-1),we=t("p",null,"这里存在一个问题：",-1),Ue=t("p",null,"就是校验令牌需要远程请求认证服务，客户端的每次访问都会远程校验，执行性能低。",-1),Ie=t("p",null,"如果能够让资源服务自己校验令牌的合法性将省去远程请求认证服务的成本，提高了性能。如下图：",-1),je=t("figure",null,[t("img",{alt:"image-20230705223607439",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223607439.png"})],-1),Pe=t("p",null,"如何解决上边的问题，实现资源服务自行校验令牌。",-1),Me=t("p",null,"令牌采用JWT格式即可解决上边的问题，用户认证通过后会得到一个JWT令牌，JWT令牌中已经包括了用户相关的信息，客户端只需要携带JWT访问资源服务，资源服务根据事先约定的算法自行完成令牌校验，无需每次都请求认证服务完成授权。",-1),Te={id:"_2-4-2-什么是jwt",tabindex:"-1"},Oe=t("strong",null,"2.4.2 什么是JWT",-1),ze=t("p",null,"什么是JWT？",-1),Re=t("p",null,"使用JWT可以实现无状态认证，什么是无状态认证？",-1),Le=t("p",null,"传统的基于session的方式是有状态认证，用户登录成功将用户的身份信息存储在服务端，这样加大了服务端的存储压力，并且这种方式不适合在分布式系统中应用。",-1),We=t("p",null,"如下图，当用户访问应用服务，每个应用服务都会去服务器查看session信息，如果session中没有该用户则说明用户没有登录，此时就会重新认证，而解决这个问题的方法是Session复制、Session黏贴。",-1),Ne=t("figure",null,[t("img",{alt:"image-20230705223645686",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223645686.png"})],-1),Je=t("p",null,"如果是基于令牌技术在分布式系统中实现认证则服务端不用存储session，可以将用户身份信息存储在令牌中，用户认证通过后认证服务颁发令牌给用户，用户将令牌存储在客户端，去访问应用服务时携带令牌去访问，服务端从jwt解析出用户信息。这个过程就是无状态认证。",-1),Xe=t("figure",null,[t("img",{alt:"image-20230705223829078",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223829078.png"})],-1),qe=t("p",null,"JWT令牌的优点：",-1),Ge=t("p",null,"1、jwt基于json，非常方便解析。",-1),Ke=t("p",null,"2、可以在令牌中自定义丰富的内容，易扩展。",-1),Ve=t("p",null,"3、通过非对称加密算法及数字签名技术，JWT防止篡改，安全性高。",-1),He=t("p",null,"4、资源服务使用JWT可不依赖认证服务即可完成授权。",-1),Ze=t("p",null,"缺点：",-1),Qe=t("p",null,"１、JWT令牌较长，占存储空间比较大。",-1),Ye=t("p",null,"下边是一个JWT令牌的示例：",-1),$e=t("div",{style:{"max-height":"300px"},class:"language-apl"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"apl"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"),t("span",{style:{color:"#79B8FF"}},".eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQyNTQ2NzIsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6Ijg4OTEyYjJkLTVkMDUtNGMxNC1iYmMzLWZkZTk5NzdmZWJjNiIsImNsaWVudF9pZCI6ImMxIn0"),t("span",{style:{color:"#F97583"}},"."),t("span",{style:{color:"#E1E4E8"}},"wkDBL7roLrvdBG2oGnXeoXq"),t("span",{style:{color:"#F97583"}},"-"),t("span",{style:{color:"#E1E4E8"}},"zZRgE9IVV2nxd"),t("span",{style:{color:"#F97583"}},"-"),t("span",{style:{color:"#E1E4E8"}},"ez_oA")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"),t("span",{style:{color:"#005CC5"}},".eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQyNTQ2NzIsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6Ijg4OTEyYjJkLTVkMDUtNGMxNC1iYmMzLWZkZTk5NzdmZWJjNiIsImNsaWVudF9pZCI6ImMxIn0"),t("span",{style:{color:"#D73A49"}},"."),t("span",{style:{color:"#24292E"}},"wkDBL7roLrvdBG2oGnXeoXq"),t("span",{style:{color:"#D73A49"}},"-"),t("span",{style:{color:"#24292E"}},"zZRgE9IVV2nxd"),t("span",{style:{color:"#D73A49"}},"-"),t("span",{style:{color:"#24292E"}},"ez_oA")])])]),t("button",{class:"collapse"})],-1),sa=t("p",null,[p("JWT令牌由三部分组成，每部分中间使用点（.）分隔，比如："),t("code",null,"xxxxx.yyyyy.zzzzz")],-1),la=t("ol",null,[t("li",null,"Header")],-1),oa=t("p",null,"头部包括令牌的类型（即JWT）及使用的哈希算法（如HMAC SHA256或RSA）",-1),na=t("p",null,"一个例子如下：",-1),ea=t("p",null,"下边是Header部分的内容",-1),aa=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#79B8FF"}},'"alg"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"HS256"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#79B8FF"}},'"typ"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"JWT"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#005CC5"}},'"alg"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"HS256"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#005CC5"}},'"typ"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"JWT"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")])])]),t("button",{class:"collapse"})],-1),ca=t("p",null,"将上边的内容使用Base64Url编码，得到一个字符串就是JWT令牌的第一部分。",-1),ta=t("ol",{start:"2"},[t("li",null,"Payload")],-1),pa=t("p",null,"第二部分是负载，内容也是一个json对象，它是存放有效信息的地方，它可以存放jwt提供的信息字段，比如：iss（签发者）,exp（过期时间戳）, sub（面向的用户）等，也可自定义字段。",-1),ra=t("p",null,"此部分不建议存放敏感信息，因为此部分可以解码还原原始内容。",-1),Ea=t("p",null,"最后将第二部分负载使用Base64Url编码，得到一个字符串就是JWT令牌的第二部分。",-1),ya=t("p",null,"一个例子：",-1),ia=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#79B8FF"}},'"sub"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"1234567890"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#79B8FF"}},'"name"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"456"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#79B8FF"}},'"admin"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"true")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#005CC5"}},'"sub"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"1234567890"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#005CC5"}},'"name"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"456"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#005CC5"}},'"admin"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"true")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")])])]),t("button",{class:"collapse"})],-1),ua=t("ol",{start:"3"},[t("li",null,"Signature")],-1),Fa=t("p",null,"第三部分是签名，此部分用于防止jwt内容被篡改。",-1),da=t("p",null,"这个部分使用base64url将前两部分进行编码，编码后使用点（.）连接组成字符串，最后使用header中声明的签名算法进行签名。",-1),ga=t("p",null,"一个例子：",-1),ha=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  HMACSHA"),t("span",{style:{color:"#79B8FF"}},"256"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    base"),t("span",{style:{color:"#79B8FF"}},"64"),t("span",{style:{color:"#E1E4E8"}},"UrlEncode(header) + "),t("span",{style:{color:"#9ECBFF"}},'"."'),t("span",{style:{color:"#E1E4E8"}}," +")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    base"),t("span",{style:{color:"#79B8FF"}},"64"),t("span",{style:{color:"#E1E4E8"}},"UrlEncode(payload),")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    secret)")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  HMACSHA"),t("span",{style:{color:"#005CC5"}},"256"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    base"),t("span",{style:{color:"#005CC5"}},"64"),t("span",{style:{color:"#24292E"}},"UrlEncode(header) + "),t("span",{style:{color:"#032F62"}},'"."'),t("span",{style:{color:"#24292E"}}," +")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    base"),t("span",{style:{color:"#005CC5"}},"64"),t("span",{style:{color:"#24292E"}},"UrlEncode(payload),")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    secret)")])])]),t("button",{class:"collapse"})],-1),Aa=t("p",null,"base64UrlEncode(header)：jwt令牌的第一部分。",-1),Da=t("p",null,"base64UrlEncode(payload)：jwt令牌的第二部分。",-1),Ca=t("p",null,"secret：签名所使用的密钥。",-1),ma=t("p",null,"为什么JWT可以防止篡改？",-1),ba=t("p",null,"第三部分使用签名算法对第一部分和第二部分的内容进行签名，常用的签名算法是 HS256，常见的还有md5,sha 等，签名算法需要使用密钥进行签名，密钥不对外公开，并且签名是不可逆的，如果第三方更改了内容那么服务器验证签名就会失败，要想保证验证签名正确必须保证内容、密钥与签名前一致。",-1),Ba=t("figure",null,[t("img",{alt:"image-20230705223925811",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223925811.png"})],-1),ka=t("p",null,"从上图可以看出认证服务和资源服务使用相同的密钥，这叫对称加密，对称加密效率高，如果一旦密钥泄露可以伪造jwt令牌。",-1),Sa=t("p",null,"JWT还可以使用非对称加密，认证服务自己保留私钥，将公钥下发给受信任的客户端、资源服务，公钥和私钥是配对的，成对的公钥和私钥才可以正常加密和解密，非对称加密效率低但相比对称加密非对称加密更安全一些。",-1),va={id:"_2-4-3-测试生成jwt令牌",tabindex:"-1"},xa=t("strong",null,"2.4.3 测试生成JWT令牌",-1),fa=t("p",null,"在认证服务中配置jwt令牌服务，即可实现生成jwt格式的令牌,",-1),_a=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"TokenConfig"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String SIGNING_KEY "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"mq123"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    TokenStore tokenStore;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    @Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    public TokenStore tokenStore() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        //使用内存存储令牌（普通令牌）")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        return new InMemoryTokenStore();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," JwtAccessTokenConverter accessTokenConverter;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," TokenStore "),t("span",{style:{color:"#B392F0"}},"tokenStore"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"JwtTokenStore"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#B392F0"}},"accessTokenConverter"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," JwtAccessTokenConverter "),t("span",{style:{color:"#B392F0"}},"accessTokenConverter"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        JwtAccessTokenConverter converter "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"JwtAccessTokenConverter"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        converter."),t("span",{style:{color:"#B392F0"}},"setSigningKey"),t("span",{style:{color:"#E1E4E8"}},"(SIGNING_KEY);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," converter;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//令牌管理服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"name"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"authorizationServerTokenServicesCustom"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," AuthorizationServerTokenServices "),t("span",{style:{color:"#B392F0"}},"tokenService"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        DefaultTokenServices service"),t("span",{style:{color:"#F97583"}},"=new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"DefaultTokenServices"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setSupportRefreshToken"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},");"),t("span",{style:{color:"#6A737D"}},"//支持刷新令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setTokenStore"),t("span",{style:{color:"#E1E4E8"}},"(tokenStore);"),t("span",{style:{color:"#6A737D"}},"//令牌存储策略")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        TokenEnhancerChain tokenEnhancerChain "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"TokenEnhancerChain"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        tokenEnhancerChain."),t("span",{style:{color:"#B392F0"}},"setTokenEnhancers"),t("span",{style:{color:"#E1E4E8"}},"(Arrays."),t("span",{style:{color:"#B392F0"}},"asList"),t("span",{style:{color:"#E1E4E8"}},"(accessTokenConverter));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setTokenEnhancer"),t("span",{style:{color:"#E1E4E8"}},"(tokenEnhancerChain);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setAccessTokenValiditySeconds"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"7200"),t("span",{style:{color:"#E1E4E8"}},"); "),t("span",{style:{color:"#6A737D"}},"// 令牌默认有效期2小时")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        service."),t("span",{style:{color:"#B392F0"}},"setRefreshTokenValiditySeconds"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"259200"),t("span",{style:{color:"#E1E4E8"}},"); "),t("span",{style:{color:"#6A737D"}},"// 刷新令牌默认有效期3天")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," service;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"TokenConfig"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String SIGNING_KEY "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"mq123"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    TokenStore tokenStore;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    @Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    public TokenStore tokenStore() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        //使用内存存储令牌（普通令牌）")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        return new InMemoryTokenStore();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," JwtAccessTokenConverter accessTokenConverter;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," TokenStore "),t("span",{style:{color:"#6F42C1"}},"tokenStore"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"JwtTokenStore"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#6F42C1"}},"accessTokenConverter"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," JwtAccessTokenConverter "),t("span",{style:{color:"#6F42C1"}},"accessTokenConverter"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        JwtAccessTokenConverter converter "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"JwtAccessTokenConverter"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        converter."),t("span",{style:{color:"#6F42C1"}},"setSigningKey"),t("span",{style:{color:"#24292E"}},"(SIGNING_KEY);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," converter;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//令牌管理服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"name"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"authorizationServerTokenServicesCustom"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," AuthorizationServerTokenServices "),t("span",{style:{color:"#6F42C1"}},"tokenService"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        DefaultTokenServices service"),t("span",{style:{color:"#D73A49"}},"=new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"DefaultTokenServices"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setSupportRefreshToken"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},");"),t("span",{style:{color:"#6A737D"}},"//支持刷新令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setTokenStore"),t("span",{style:{color:"#24292E"}},"(tokenStore);"),t("span",{style:{color:"#6A737D"}},"//令牌存储策略")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        TokenEnhancerChain tokenEnhancerChain "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"TokenEnhancerChain"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        tokenEnhancerChain."),t("span",{style:{color:"#6F42C1"}},"setTokenEnhancers"),t("span",{style:{color:"#24292E"}},"(Arrays."),t("span",{style:{color:"#6F42C1"}},"asList"),t("span",{style:{color:"#24292E"}},"(accessTokenConverter));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setTokenEnhancer"),t("span",{style:{color:"#24292E"}},"(tokenEnhancerChain);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setAccessTokenValiditySeconds"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"7200"),t("span",{style:{color:"#24292E"}},"); "),t("span",{style:{color:"#6A737D"}},"// 令牌默认有效期2小时")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        service."),t("span",{style:{color:"#6F42C1"}},"setRefreshTokenValiditySeconds"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"259200"),t("span",{style:{color:"#24292E"}},"); "),t("span",{style:{color:"#6A737D"}},"// 刷新令牌默认有效期3天")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," service;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),wa=t("p",null,"重启认证服务。",-1),Ua=t("p",null,"使用httpclient通过密码模式申请令牌",-1),Ia=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{auth_host}}/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username=zhangsan&password=123")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{auth_host}}/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username=zhangsan&password=123")])])]),t("button",{class:"collapse"})],-1),ja=t("p",null,"生成jwt的示例如下：",-1),Pa=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"access_token"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzMzE2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImU5ZDNkMGZkLTI0Y2ItNDRjOC04YzEwLTI1NmIzNGY4ZGZjYyIsImNsaWVudF9pZCI6ImMxIn0.-9SKI-qUqKhKcs8Gb80Rascx-JxqsNZxxXoPo82d8SM"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"token_type"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"bearer"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"refresh_token"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJhdGkiOiJlOWQzZDBmZC0yNGNiLTQ0YzgtOGMxMC0yNTZiMzRmOGRmY2MiLCJleHAiOjE2NjQ1ODM2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImRjNTRjNTRkLTA0YTMtNDIzNS04MmY3LTFkOWZkMmFjM2VmNSIsImNsaWVudF9pZCI6ImMxIn0.Wsw1Jc-Kd_GFqEugzdfoSsMY6inC8OQsraA21WjWtT8"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"expires_in"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"7199"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"scope"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"all"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"jti"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"e9d3d0fd-24cb-44c8-8c10-256b34f8dfcc"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"access_token"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzMzE2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImU5ZDNkMGZkLTI0Y2ItNDRjOC04YzEwLTI1NmIzNGY4ZGZjYyIsImNsaWVudF9pZCI6ImMxIn0.-9SKI-qUqKhKcs8Gb80Rascx-JxqsNZxxXoPo82d8SM"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"token_type"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"bearer"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"refresh_token"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJhdGkiOiJlOWQzZDBmZC0yNGNiLTQ0YzgtOGMxMC0yNTZiMzRmOGRmY2MiLCJleHAiOjE2NjQ1ODM2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImRjNTRjNTRkLTA0YTMtNDIzNS04MmY3LTFkOWZkMmFjM2VmNSIsImNsaWVudF9pZCI6ImMxIn0.Wsw1Jc-Kd_GFqEugzdfoSsMY6inC8OQsraA21WjWtT8"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"expires_in"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"7199"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"scope"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"all"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"jti"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"e9d3d0fd-24cb-44c8-8c10-256b34f8dfcc"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ma=t("p",null,[p("1、"),t("code",null,"access_token"),p("，生成的jwt令牌，用于访问资源使用。")],-1),Ta=t("p",null,[p("2、"),t("code",null,"token_type"),p("，bearer是在RFC6750中定义的一种token类型，在携带jwt访问资源时需要在head中加入bearer jwt令牌内容")],-1),Oa=t("p",null,[p("3、"),t("code",null,"refresh_token"),p("，当jwt令牌快过期时使用刷新令牌可以再次生成jwt令牌。")],-1),za=t("p",null,[p("4、"),t("code",null,"expires_in"),p("：过期时间（秒）")],-1),Ra=t("p",null,[p("5、"),t("code",null,"scope"),p("，令牌的权限范围，服务端可以根据令牌的权限范围去对令牌授权。")],-1),La=t("p",null,[p("6、"),t("code",null,"jti"),p("：令牌的唯一标识。")],-1),Wa=t("p",null,"我们可以通过check_token接口校验jwt令牌",-1),Na=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"###校验jwt令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{auth_host}}/oauth/check_token?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJzdHUxIiwic2NvcGUiOlsiYWxsIl0sImV4cCI6MTY2NDM3MTc4MCwiYXV0aG9yaXRpZXMiOlsicDEiXSwianRpIjoiZjBhM2NkZWItMzk5ZC00OGYwLTg4MDQtZWNhNjM4YWQ4ODU3IiwiY2xpZW50X2lkIjoiYzEifQ.qy46CSCJsH3eXWTHgdcntZhzcSzfRQlBU0dxAjZcsUw")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"###校验jwt令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{auth_host}}/oauth/check_token?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJzdHUxIiwic2NvcGUiOlsiYWxsIl0sImV4cCI6MTY2NDM3MTc4MCwiYXV0aG9yaXRpZXMiOlsicDEiXSwianRpIjoiZjBhM2NkZWItMzk5ZC00OGYwLTg4MDQtZWNhNjM4YWQ4ODU3IiwiY2xpZW50X2lkIjoiYzEifQ.qy46CSCJsH3eXWTHgdcntZhzcSzfRQlBU0dxAjZcsUw")])])]),t("button",{class:"collapse"})],-1),Ja=t("p",null,"响应示例如下：",-1),Xa=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"aud"'),t("span",{style:{color:"#E1E4E8"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#9ECBFF"}},'"res1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"user_name"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"zhangsan"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"scope"'),t("span",{style:{color:"#E1E4E8"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#9ECBFF"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"active"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"exp"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"1664371780"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"authorities"'),t("span",{style:{color:"#E1E4E8"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#9ECBFF"}},'"p1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"jti"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"f0a3cdeb-399d-48f0-8804-eca638ad8857"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"client_id"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"c1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"aud"'),t("span",{style:{color:"#24292E"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#032F62"}},'"res1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"user_name"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"zhangsan"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"scope"'),t("span",{style:{color:"#24292E"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#032F62"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"active"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"exp"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"1664371780"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"authorities"'),t("span",{style:{color:"#24292E"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#032F62"}},'"p1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"jti"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"f0a3cdeb-399d-48f0-8804-eca638ad8857"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"client_id"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"c1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),qa={id:"_2-4-4-测试资源服务校验令牌",tabindex:"-1"},Ga=t("strong",null,"2.4.4 测试资源服务校验令牌",-1),Ka=t("p",null,"拿到了jwt令牌下一步就要携带令牌去访问资源服务中的资源，本项目各个微服务就是资源服务，比如：内容管理服务，客户端申请到jwt令牌，携带jwt去内容管理服务查询课程信息，此时内容管理服务要对jwt进行校验，只有jwt合法才可以继续访问。如下图：",-1),Va=t("figure",null,[t("img",{alt:"image-20230705223951357",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223951357.png"})],-1),Ha=t("p",null,"1、在内容管理服务的content-api工程中添加依赖",-1),Za=t("div",{style:{"max-height":"300px"},class:"language-xml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"xml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"\x3c!--认证相关--\x3e")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">org.springframework.cloud</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">spring-cloud-starter-security</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">org.springframework.cloud</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">spring-cloud-starter-oauth2</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"\x3c!--认证相关--\x3e")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">org.springframework.cloud</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">spring-cloud-starter-security</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">org.springframework.cloud</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">spring-cloud-starter-oauth2</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")])])]),t("button",{class:"collapse"})],-1),Qa=t("p",null,"2、在内容管理服务的content-api工程中添加TokenConfig",-1),Ya=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"TokenConfig"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//jwt签名密钥,与认证服务保持一致")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String SIGNING_KEY "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"mq123"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," TokenStore "),t("span",{style:{color:"#B392F0"}},"tokenStore"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//JWT令牌存储方案")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"JwtTokenStore"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#B392F0"}},"accessTokenConverter"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," JwtAccessTokenConverter "),t("span",{style:{color:"#B392F0"}},"accessTokenConverter"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        JwtAccessTokenConverter converter "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"JwtAccessTokenConverter"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        converter."),t("span",{style:{color:"#B392F0"}},"setSigningKey"),t("span",{style:{color:"#E1E4E8"}},"(SIGNING_KEY);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," converter;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#6A737D"}},"/* @Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    public TokenStore tokenStore() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        //使用内存存储令牌（普通令牌）")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        return new InMemoryTokenStore();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    }*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"TokenConfig"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//jwt签名密钥,与认证服务保持一致")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String SIGNING_KEY "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"mq123"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," TokenStore "),t("span",{style:{color:"#6F42C1"}},"tokenStore"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//JWT令牌存储方案")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"JwtTokenStore"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#6F42C1"}},"accessTokenConverter"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," JwtAccessTokenConverter "),t("span",{style:{color:"#6F42C1"}},"accessTokenConverter"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        JwtAccessTokenConverter converter "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"JwtAccessTokenConverter"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        converter."),t("span",{style:{color:"#6F42C1"}},"setSigningKey"),t("span",{style:{color:"#24292E"}},"(SIGNING_KEY);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," converter;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#6A737D"}},"/* @Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    public TokenStore tokenStore() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        //使用内存存储令牌（普通令牌）")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        return new InMemoryTokenStore();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    }*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),$a=t("p",null,"3、添加资源服务配置",-1),sc=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"EnableResourceServer")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"EnableGlobalMethodSecurity"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"securedEnabled"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"prePostEnabled"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"ResouceServerConfig"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"ResourceServerConfigurerAdapter"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//资源服务标识")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"static"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"final"),t("span",{style:{color:"#E1E4E8"}}," String RESOURCE_ID "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"xuecheng-plus"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    TokenStore tokenStore;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(ResourceServerSecurityConfigurer "),t("span",{style:{color:"#FFAB70"}},"resources"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        resources."),t("span",{style:{color:"#B392F0"}},"resourceId"),t("span",{style:{color:"#E1E4E8"}},"(RESOURCE_ID)"),t("span",{style:{color:"#6A737D"}},"//资源 id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"tokenStore"),t("span",{style:{color:"#E1E4E8"}},"(tokenStore)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"stateless"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(HttpSecurity "),t("span",{style:{color:"#FFAB70"}},"http"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        http."),t("span",{style:{color:"#B392F0"}},"csrf"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"disable"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"authorizeRequests"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"antMatchers"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/r/**"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#9ECBFF"}},'"/course/**"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authenticated"),t("span",{style:{color:"#E1E4E8"}},"()"),t("span",{style:{color:"#6A737D"}},"//所有/r/**的请求必须认证通过")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"anyRequest"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"permitAll"),t("span",{style:{color:"#E1E4E8"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Configuration")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"EnableResourceServer")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"EnableGlobalMethodSecurity"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"securedEnabled"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"prePostEnabled"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"ResouceServerConfig"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"ResourceServerConfigurerAdapter"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//资源服务标识")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"static"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"final"),t("span",{style:{color:"#24292E"}}," String RESOURCE_ID "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"xuecheng-plus"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    TokenStore tokenStore;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(ResourceServerSecurityConfigurer "),t("span",{style:{color:"#E36209"}},"resources"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        resources."),t("span",{style:{color:"#6F42C1"}},"resourceId"),t("span",{style:{color:"#24292E"}},"(RESOURCE_ID)"),t("span",{style:{color:"#6A737D"}},"//资源 id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"tokenStore"),t("span",{style:{color:"#24292E"}},"(tokenStore)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"stateless"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(HttpSecurity "),t("span",{style:{color:"#E36209"}},"http"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        http."),t("span",{style:{color:"#6F42C1"}},"csrf"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"disable"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"authorizeRequests"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"antMatchers"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/r/**"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#032F62"}},'"/course/**"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authenticated"),t("span",{style:{color:"#24292E"}},"()"),t("span",{style:{color:"#6A737D"}},"//所有/r/**的请求必须认证通过")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"anyRequest"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"permitAll"),t("span",{style:{color:"#24292E"}},"()")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),lc=t("p",null,"根据配置可知/course/**开头的接口需要认证通过。",-1),oc=t("p",null,"重启内容管理服务",-1),nc=t("p",null,"使用httpclient测试：",-1),ec=t("p",null,"1、访问根据课程id查询课程接口",-1),ac=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"GET"),t("span",{style:{color:"#E1E4E8"}}," http://localhost:63040/content/course/2")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"GET"),t("span",{style:{color:"#24292E"}}," http://localhost:63040/content/course/2")])])]),t("button",{class:"collapse"})],-1),cc=t("p",null,"返回：",-1),tc=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"unauthorized"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error_description"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"Full authentication is required to access this resource"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"unauthorized"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error_description"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"Full authentication is required to access this resource"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),pc=t("p",null,"从返回信息可知当前没有认证。",-1),rc=t("p",null,"下边携带JWT令牌访问接口：",-1),Ec=t("p",null,"1、申请jwt令牌",-1),yc=t("p",null,"采用密码模式申请令牌。",-1),ic=t("p",null,"2、携带jwt令牌访问资源服务地址",-1),uc=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 携带token访问资源服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"GET"),t("span",{style:{color:"#E1E4E8"}}," http://localhost:63040/content/course/2")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Authorization"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzMzM0OTgsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6IjhhM2M2OTk1LWU1ZGEtNDQ1Yy05ZDAyLTEwNDFlYzk3NTkwOSIsImNsaWVudF9pZCI6ImMxIn0.73eNDxTX5ifttGCjwc7xrd-Sbp_mCfcIerI3lGetZto")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 携带token访问资源服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"GET"),t("span",{style:{color:"#24292E"}}," http://localhost:63040/content/course/2")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Authorization"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzMzM0OTgsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6IjhhM2M2OTk1LWU1ZGEtNDQ1Yy05ZDAyLTEwNDFlYzk3NTkwOSIsImNsaWVudF9pZCI6ImMxIn0.73eNDxTX5ifttGCjwc7xrd-Sbp_mCfcIerI3lGetZto")])])]),t("button",{class:"collapse"})],-1),Fc=t("p",null,"如果携带jwt令牌且jwt正确则正常访问资源服务的内容。",-1),dc=t("p",null,"如果不正确则报令牌无效的错误：",-1),gc=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"invalid_token"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error_description"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"Cannot convert access token to JSON"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"invalid_token"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error_description"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"Cannot convert access token to JSON"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),hc={id:"_2-4-5-测试获取用户身份",tabindex:"-1"},Ac=t("strong",null,"2.4.5 测试获取用户身份",-1),Dc=t("p",null,"jwt令牌中记录了用户身份信息，当客户端携带jwt访问资源服务，资源服务验签通过后将前两部分的内容还原即可取出用户的身份信息，并将用户身份信息放在了SecurityContextHolder上下文，SecurityContext与当前线程进行绑定，方便获取用户身份。",-1),Cc=t("p",null,"还以查询课程接口为例，进入查询课程接口的代码中，添加获取用户身份的代码",-1),mc=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"根据课程id查询课程基础信息"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"GetMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/course/{courseId}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," CourseBaseInfoDto "),t("span",{style:{color:"#B392F0"}},"getCourseBaseById"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"PathVariable"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"courseId"'),t("span",{style:{color:"#E1E4E8"}},") Long courseId){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出当前用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Object principal "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," SecurityContextHolder."),t("span",{style:{color:"#B392F0"}},"getContext"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"getAuthentication"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"getPrincipal"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"(principal);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," courseBaseInfoService."),t("span",{style:{color:"#B392F0"}},"getCourseBaseInfo"),t("span",{style:{color:"#E1E4E8"}},"(courseId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"根据课程id查询课程基础信息"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"GetMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/course/{courseId}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," CourseBaseInfoDto "),t("span",{style:{color:"#6F42C1"}},"getCourseBaseById"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"PathVariable"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"courseId"'),t("span",{style:{color:"#24292E"}},") Long courseId){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出当前用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Object principal "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," SecurityContextHolder."),t("span",{style:{color:"#6F42C1"}},"getContext"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"getAuthentication"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"getPrincipal"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"(principal);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," courseBaseInfoService."),t("span",{style:{color:"#6F42C1"}},"getCourseBaseInfo"),t("span",{style:{color:"#24292E"}},"(courseId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),bc=t("p",null,"测试时需要注意：",-1),Bc=t("p",null,[p("1、首先在资源服务配置中指定安全拦截机制 "),t("code",null,"/course/"),p("开头的请求需要认证，即请求"),t("code",null,"/course/{courseId}"),p("接口需要携带jwt令牌且签证通过。")],-1),kc=t("p",null,"2、认证服务生成jwt令牌将用户身份信息写入令牌，认证服务哪里获取用户身份。",-1),Sc=t("p",null,"目前还是将用户信息硬编码并暂放在内存中，如下：",-1),vc=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetailsService "),t("span",{style:{color:"#B392F0"}},"userDetailsService"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    InMemoryUserDetailsManager manager "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"zhangsan"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"123"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"lisi"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"456"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p2"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetailsService "),t("span",{style:{color:"#6F42C1"}},"userDetailsService"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    InMemoryUserDetailsManager manager "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"zhangsan"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"123"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"lisi"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"456"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p2"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),xc=t("p",null,"3、我们在使用密码模式生成jwt令牌时用的是zhangsan的信息，所以jwt令牌中存储了zhangsan的信息，那么在资源服务中应该取出zhangsan的信息才对。",-1),fc=t("p",null,"清楚了以上内容，下边重启内容管理服务，跟踪取到的用户身份是否正确。",-1),_c={id:"_2-5-网关认证",tabindex:"-1"},wc=t("strong",null,"2.5 网关认证",-1),Uc={id:"_2-5-1-技术方案",tabindex:"-1"},Ic=t("strong",null,"2.5.1 技术方案",-1),jc=t("p",null,"到目前为止，测试通过了认证服务颁发jwt令牌，客户端携带jwt访问资源服务，资源服务对jwt的合法性进行验证。如下图：",-1),Pc=t("figure",null,[t("img",{alt:"",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705223951357.png"})],-1),Mc=t("p",null,"仔细观察此图，遗漏了本项目架构中非常重要的组件：网关，加上网关并完善后如下图所示：",-1),Tc=t("figure",null,[t("img",{alt:"image-20230705224031161",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224031161.png"})],-1),Oc=t("blockquote",null,[t("p",null,"所有访问微服务的请求都要经过网关，在网关进行用户身份的认证可以将很多非法的请求拦截到微服务以外，这叫做网关认证。")],-1),zc=t("p",null,"下边需要明确网关的职责：",-1),Rc=t("p",null,"1、网站白名单维护",-1),Lc=t("p",null,"针对不用认证的URL全部放行。",-1),Wc=t("p",null,"2、校验jwt的合法性。",-1),Nc=t("p",null,"除了白名单剩下的就是需要认证的请求，网关需要验证jwt的合法性，jwt合法则说明用户身份合法，否则说明身份不合法则拒绝继续访问。",-1),Jc=t("p",null,"网关负责授权吗？",-1),Xc=t("p",null,"网关不负责授权，对请求的授权操作在各个微服务进行，因为微服务最清楚用户有哪些权限访问哪些接口。",-1),qc={id:"_2-5-2-实现网关认证",tabindex:"-1"},Gc=t("strong",null,"2.5.2 实现网关认证",-1),Kc=t("p",null,"下边实现网关认证，实现以下职责：",-1),Vc=t("p",null,"1、网站白名单维护",-1),Hc=t("p",null,"针对不用认证的URL全部放行。",-1),Zc=t("p",null,"2、校验jwt的合法性。",-1),Qc=t("p",null,"除了白名单剩下的就是需要认证的请求，网关需要验证jwt的合法性，jwt合法则说明用户身份合法，否则说明身份不合法则拒绝继续访问。",-1),Yc=t("p",null,"1、在网关工程添加依赖",-1),$c=t("div",{style:{"max-height":"300px"},class:"language-xml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"xml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">org.springframework.cloud</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">spring-cloud-starter-security</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">org.springframework.cloud</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">spring-cloud-starter-oauth2</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">org.projectlombok</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">lombok</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">com.alibaba</"),t("span",{style:{color:"#85E89D"}},"groupId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    <"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">fastjson</"),t("span",{style:{color:"#85E89D"}},"artifactId"),t("span",{style:{color:"#E1E4E8"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"</"),t("span",{style:{color:"#85E89D"}},"dependency"),t("span",{style:{color:"#E1E4E8"}},">")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">org.springframework.cloud</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">spring-cloud-starter-security</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">org.springframework.cloud</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">spring-cloud-starter-oauth2</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">org.projectlombok</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">lombok</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">com.alibaba</"),t("span",{style:{color:"#22863A"}},"groupId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    <"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">fastjson</"),t("span",{style:{color:"#22863A"}},"artifactId"),t("span",{style:{color:"#24292E"}},">")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"</"),t("span",{style:{color:"#22863A"}},"dependency"),t("span",{style:{color:"#24292E"}},">")])])]),t("button",{class:"collapse"})],-1),st=t("p",null,"2、拷贝课程资料下网关认证配置类到网关工程的config包下。",-1),lt=t("p",null,[p("3、配置白名单文件"),t("code",null,"security-whitelist.properties")],-1),ot=t("p",null,"内容如下（持续补充）",-1),nt=t("div",{style:{"max-height":"300px"},class:"language-properties"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"properties"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"/**=临时全部放行")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"/auth/**=认证地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"/content/open/**=内容管理公开访问接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"/media/open/**=媒资管理公开访问接口")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"/**=临时全部放行")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"/auth/**=认证地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"/content/open/**=内容管理公开访问接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"/media/open/**=媒资管理公开访问接口")])])]),t("button",{class:"collapse"})],-1),et=t("p",null,"重启网关工程，进行测试",-1),at=t("p",null,"1、申请令牌",-1),ct=t("p",null,"2、通过网关访问资源服务",-1),tt=t("p",null,"这里访问内容管理服务",-1),pt=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 通过网关访问资源服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"GET"),t("span",{style:{color:"#E1E4E8"}}," http://localhost:63010/content/course/2")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"Authorization"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzNjIzMTAsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6Ijc2OTkwMGNiLWM1ZjItNGRiNC1hZWJmLWY1MzgxZDQxZWMyZCIsImNsaWVudF9pZCI6ImMxIn0.lOITjUgYg2HCh5mDPK9EvJJqz-tIupKVfmP8yWJQIKs")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 通过网关访问资源服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"GET"),t("span",{style:{color:"#24292E"}}," http://localhost:63010/content/course/2")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"Authorization"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzNjIzMTAsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6Ijc2OTkwMGNiLWM1ZjItNGRiNC1hZWJmLWY1MzgxZDQxZWMyZCIsImNsaWVudF9pZCI6ImMxIn0.lOITjUgYg2HCh5mDPK9EvJJqz-tIupKVfmP8yWJQIKs")])])]),t("button",{class:"collapse"})],-1),rt=t("p",null,"当token正确时可以正常访问资源服务，token验证失败返回token无效：",-1),Et=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"errMessage"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"认证令牌无效"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"errMessage"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"认证令牌无效"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),yt=t("p",null,"注意：网关鉴权功能调试通过后，由于目前还没有开发认证功能，前端请求网关的URL不在白名单中间时会“没有认证”的错误，暂时在白名单中添加 全部放行配置，待认证功能开发完成再屏蔽全部放行配置，",-1),it=t("figure",null,[t("img",{alt:"image-20230705224115205",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224115205.png"})],-1),ut={id:"_3-用户认证",tabindex:"-1"},Ft=t("strong",null,"3 用户认证",-1),dt={id:"_3-1-需求分析",tabindex:"-1"},gt=t("strong",null,"3.1 需求分析",-1),ht=t("p",null,"至此我们了解了使用Spring Security进行认证授权的过程，本节实现用户认证功能。",-1),At=t("p",null,"目前各大网站的认证方式非常丰富：账号密码认证、手机验证码认证、扫码登录等。",-1),Dt=t("p",null,"本项目也要支持多种认证试。",-1),Ct={id:"_3-2-连接用户中心数据库",tabindex:"-1"},mt=t("strong",null,"3.2 连接用户中心数据库",-1),bt={id:"_3-2-1-连接数据库认证",tabindex:"-1"},Bt=t("strong",null,"3.2.1 连接数据库认证",-1),kt=t("p",null,"基于的认证流程在研究Spring Security过程中已经测试通过，到目前为止用户认证流程如下：",-1),St=t("figure",null,[t("img",{alt:"image-20230705224147514",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224147514.png"})],-1),vt=t("p",null,"认证所需要的用户信息存储在用户中心数据库，现在需要将认证服务连接数据库查询用户信息。",-1),xt=t("p",null,"在研究Spring Security的过程中是将用户信息硬编码，如下：",-1),ft=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetailsService "),t("span",{style:{color:"#B392F0"}},"userDetailsService"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    InMemoryUserDetailsManager manager "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"zhangsan"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"123"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    manager."),t("span",{style:{color:"#B392F0"}},"createUser"),t("span",{style:{color:"#E1E4E8"}},"(User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"lisi"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"456"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p2"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetailsService "),t("span",{style:{color:"#6F42C1"}},"userDetailsService"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    InMemoryUserDetailsManager manager "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"InMemoryUserDetailsManager"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"zhangsan"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"123"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    manager."),t("span",{style:{color:"#6F42C1"}},"createUser"),t("span",{style:{color:"#24292E"}},"(User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"lisi"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"456"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p2"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),_t=t("p",null,"我们要认证服务中连接用户中心数据库查询用户信息。",-1),wt=t("p",null,"如何使用Spring Security连接数据库认证吗？",-1),Ut=t("p",null,"前边学习Spring Security工作原理时有一张执行流程图，如下图：",-1),It=t("figure",null,[t("img",{alt:"image-20230705224242929",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224242929.png"})],-1),jt=t("p",null,[p("用户提交账号和密码由DaoAuthenticationProvider调用UserDetailsService的"),t("code",null,"loadUserByUsername()"),p("方法获取UserDetails用户信息。")],-1),Pt=t("p",null,"查询DaoAuthenticationProvider的源代码如下：",-1),Mt=t("figure",null,[t("img",{alt:"image-20230705224313517",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224313517.png"})],-1),Tt=t("p",null,"UserDetailsService是一个接口，如下：",-1),Ot=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"package"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.security.core.userdetails;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"interface"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetailsService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    UserDetails "),t("span",{style:{color:"#B392F0"}},"loadUserByUsername"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"var1"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," UsernameNotFoundException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"package"),t("span",{style:{color:"#24292E"}}," org.springframework.security.core.userdetails;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"interface"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetailsService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    UserDetails "),t("span",{style:{color:"#6F42C1"}},"loadUserByUsername"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"var1"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," UsernameNotFoundException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),zt=t("p",null,"UserDetails是用户信息接口",-1),Rt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"interface"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetails"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"Serializable"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Collection<"),t("span",{style:{color:"#F97583"}},"?"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"GrantedAuthority"),t("span",{style:{color:"#E1E4E8"}},"> "),t("span",{style:{color:"#B392F0"}},"getAuthorities"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String "),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String "),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isAccountNonExpired"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isAccountNonLocked"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isCredentialsNonExpired"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isEnabled"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"interface"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetails"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"Serializable"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Collection<"),t("span",{style:{color:"#D73A49"}},"?"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"GrantedAuthority"),t("span",{style:{color:"#24292E"}},"> "),t("span",{style:{color:"#6F42C1"}},"getAuthorities"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String "),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String "),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isAccountNonExpired"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isAccountNonLocked"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isCredentialsNonExpired"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isEnabled"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Lt=t("p",null,[p("我们只要实现UserDetailsService 接口查询数据库得到用户信息返回UserDetails 类型的用户信息即可,框架调用"),t("code",null,"loadUserByUsername()"),p("方法拿到用户信息之后是如何执行的，见下图：")],-1),Wt=t("figure",null,[t("img",{alt:"image-20230705224342435",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224342435.png"})],-1),Nt=t("p",null,"首先屏蔽原来定义的UserDetailsService。",-1),Jt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//配置用户信息服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    @Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    public UserDetailsService userDetailsService() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        //这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//        manager.createUser(User.withUsername("zhangsan").password("123").authorities("p1").build());')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//        manager.createUser(User.withUsername("lisi").password("456").authorities("p2").build());')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        return manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//配置用户信息服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    @Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    public UserDetailsService userDetailsService() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        //这里配置用户信息,这里暂时使用这种方式将用户存储在内存中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//        manager.createUser(User.withUsername("zhangsan").password("123").authorities("p1").build());')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//        manager.createUser(User.withUsername("lisi").password("456").authorities("p2").build());')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        return manager;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    }")])])]),t("button",{class:"collapse"})],-1),Xt=t("p",null,"下边自定义UserDetailsService",-1),qt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetailsService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 根据账号查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#6A737D"}},"  账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @date 2022/9/28 18:30")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetails "),t("span",{style:{color:"#B392F0"}},"loadUserByUsername"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUserMapper."),t("span",{style:{color:"#B392F0"}},"selectOne"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(XcUser"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getUsername, s));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(user"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String password  "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"user."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"[] authorities"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," {"),t("span",{style:{color:"#9ECBFF"}},'"test"'),t("span",{style:{color:"#E1E4E8"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象,权限信息待实现授权功能时再向UserDetail中加入")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UserDetails userDetails "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"(user."),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"())."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"(password)."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"(authorities)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetailsService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 根据账号查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#6A737D"}},"  账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @date 2022/9/28 18:30")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetails "),t("span",{style:{color:"#6F42C1"}},"loadUserByUsername"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"selectOne"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"XcUser"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(XcUser"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getUsername, s));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(user"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String password  "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"user."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"[] authorities"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," {"),t("span",{style:{color:"#032F62"}},'"test"'),t("span",{style:{color:"#24292E"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象,权限信息待实现授权功能时再向UserDetail中加入")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UserDetails userDetails "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"(user."),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"())."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"(password)."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"(authorities)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Gt=t("p",null,"数据库中的密码加过密的，用户输入的密码是明文，我们需要修改密码格式器PasswordEncoder，原来使用的是NoOpPasswordEncoder，它是通过明文方式比较密码，现在我们修改为BCryptPasswordEncoder，它是将用户输入的密码编码为BCrypt格式与数据库中的密码进行比对。",-1),Kt=t("p",null,"如下：",-1),Vt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," PasswordEncoder "),t("span",{style:{color:"#B392F0"}},"passwordEncoder"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        //密码为明文方式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        return NoOpPasswordEncoder.getInstance();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"BCryptPasswordEncoder"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," PasswordEncoder "),t("span",{style:{color:"#6F42C1"}},"passwordEncoder"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        //密码为明文方式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//        return NoOpPasswordEncoder.getInstance();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"BCryptPasswordEncoder"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),Ht=t("p",null,"我们通过测试代码测试BCryptPasswordEncoder，如下：",-1),Zt=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"static"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"main"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"[] args) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String password "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"111111"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    PasswordEncoder passwordEncoder "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"BCryptPasswordEncoder"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"for"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"int"),t("span",{style:{color:"#E1E4E8"}}," i"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},";i"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#79B8FF"}},"10"),t("span",{style:{color:"#E1E4E8"}},";i"),t("span",{style:{color:"#F97583"}},"++"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//每个计算出的Hash值都不一样")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String hashPass "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," passwordEncoder."),t("span",{style:{color:"#B392F0"}},"encode"),t("span",{style:{color:"#E1E4E8"}},"(password);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"(hashPass);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//虽然每次计算的密码Hash值不一样但是校验是通过的")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," f "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," passwordEncoder."),t("span",{style:{color:"#B392F0"}},"matches"),t("span",{style:{color:"#E1E4E8"}},"(password, hashPass);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"(f);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"static"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"main"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"[] args) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String password "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"111111"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    PasswordEncoder passwordEncoder "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"BCryptPasswordEncoder"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"for"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"int"),t("span",{style:{color:"#24292E"}}," i"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},";i"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#005CC5"}},"10"),t("span",{style:{color:"#24292E"}},";i"),t("span",{style:{color:"#D73A49"}},"++"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//每个计算出的Hash值都不一样")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String hashPass "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," passwordEncoder."),t("span",{style:{color:"#6F42C1"}},"encode"),t("span",{style:{color:"#24292E"}},"(password);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"(hashPass);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//虽然每次计算的密码Hash值不一样但是校验是通过的")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," f "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," passwordEncoder."),t("span",{style:{color:"#6F42C1"}},"matches"),t("span",{style:{color:"#24292E"}},"(password, hashPass);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"(f);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Qt=t("p",null,"修改数据库中的密码为Bcrypt格式，并且记录明文密码，稍后申请令牌时需要。",-1),Yt=t("p",null,"由于修改密码编码方式还需要将客户端的密钥更改为Bcrypt格式.",-1),$t=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(ClientDetailsServiceConfigurer clients)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"          throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        clients."),t("span",{style:{color:"#B392F0"}},"inMemory"),t("span",{style:{color:"#E1E4E8"}},"()"),t("span",{style:{color:"#6A737D"}},"// 使用in-memory存储")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"withClient"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"XcWebApp"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"// client_id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//                .secret("secret")//客户端密钥')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"secret"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"BCryptPasswordEncoder"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"encode"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"XcWebApp"'),t("span",{style:{color:"#E1E4E8"}},"))"),t("span",{style:{color:"#6A737D"}},"//客户端密钥")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"resourceIds"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"xuecheng-plus"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//资源列表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"authorizedGrantTypes"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"authorization_code"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#9ECBFF"}},'"password"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#9ECBFF"}},'"client_credentials"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#9ECBFF"}},'"implicit"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#9ECBFF"}},'"refresh_token"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"// 该client允许的授权类型authorization_code,password,refresh_token,implicit,client_credentials")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"scopes"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"all"'),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"// 允许的授权范围")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"autoApprove"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"false"),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//false跳转到授权页面")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#6A737D"}},"//客户端接收授权码的重定向地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                ."),t("span",{style:{color:"#B392F0"}},"redirectUris"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"http://www.51xuecheng.cn"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   ;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(ClientDetailsServiceConfigurer clients)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"          throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        clients."),t("span",{style:{color:"#6F42C1"}},"inMemory"),t("span",{style:{color:"#24292E"}},"()"),t("span",{style:{color:"#6A737D"}},"// 使用in-memory存储")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"withClient"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"XcWebApp"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"// client_id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},'//                .secret("secret")//客户端密钥')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"secret"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"BCryptPasswordEncoder"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"encode"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"XcWebApp"'),t("span",{style:{color:"#24292E"}},"))"),t("span",{style:{color:"#6A737D"}},"//客户端密钥")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"resourceIds"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"xuecheng-plus"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//资源列表")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"authorizedGrantTypes"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"authorization_code"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#032F62"}},'"password"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#032F62"}},'"client_credentials"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#032F62"}},'"implicit"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#032F62"}},'"refresh_token"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"// 该client允许的授权类型authorization_code,password,refresh_token,implicit,client_credentials")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"scopes"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"all"'),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"// 允许的授权范围")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"autoApprove"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"false"),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//false跳转到授权页面")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#6A737D"}},"//客户端接收授权码的重定向地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                ."),t("span",{style:{color:"#6F42C1"}},"redirectUris"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"http://www.51xuecheng.cn"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   ;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")])])]),t("button",{class:"collapse"})],-1),sp=t("p",null,"现在重启认证服务。",-1),lp=t("p",null,"下边使用httpclient进行测试：",-1),op=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{auth_host}}/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username=stu1&password=111111")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{auth_host}}/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username=stu1&password=111111")])])]),t("button",{class:"collapse"})],-1),np=t("p",null,"输入正确的账号和密码，申请令牌成功。",-1),ep=t("p",null,"输入错误的密码，报错：",-1),ap=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"invalid_grant"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error_description"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"用户名或密码错误"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"invalid_grant"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error_description"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"用户名或密码错误"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),cp=t("p",null,"输入错误的账号，报错：",-1),tp=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"unauthorized"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"error_description"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"UserDetailsService returned null, which is an interface contract violation"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"unauthorized"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"error_description"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"UserDetailsService returned null, which is an interface contract violation"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),pp={id:"_3-2-2-扩展用户身份信息",tabindex:"-1"},rp=t("strong",null,"3.2.2 扩展用户身份信息",-1),Ep=t("p",null,"用户表中存储了用户的账号、手机号、email，昵称、qq等信息，UserDetails接口只返回了username、密码等信息，如下：",-1),yp=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"interface"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetails"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"Serializable"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Collection<"),t("span",{style:{color:"#F97583"}},"?"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"GrantedAuthority"),t("span",{style:{color:"#E1E4E8"}},"> "),t("span",{style:{color:"#B392F0"}},"getAuthorities"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String "),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String "),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isAccountNonExpired"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isAccountNonLocked"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isCredentialsNonExpired"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"isEnabled"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"interface"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetails"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"Serializable"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Collection<"),t("span",{style:{color:"#D73A49"}},"?"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"GrantedAuthority"),t("span",{style:{color:"#24292E"}},"> "),t("span",{style:{color:"#6F42C1"}},"getAuthorities"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String "),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String "),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isAccountNonExpired"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isAccountNonLocked"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isCredentialsNonExpired"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"isEnabled"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),ip=t("p",null,"我们需要扩展用户身份的信息，在jwt令牌中存储用户的昵称、头像、qq等信息。",-1),up=t("p",null,"如何扩展Spring Security的用户身份信息呢？",-1),Fp=t("p",null,"在认证阶段DaoAuthenticationProvider会调用UserDetailService查询用户的信息，这里是可以获取到齐全的用户信息的。由于JWT令牌中用户身份信息来源于UserDetails，UserDetails中仅定义了username为用户的身份信息，这里有两个思路：第一是可以扩展UserDetails，使之包括更多的自定义属性，第二也可以扩展username的内容 ，比如存入json数据内容作为username的内容。相比较而言，方案二比较简单还不用破坏UserDetails的结构，我们采用方案二。",-1),dp=t("p",null,"修改UserServiceImpl如下：",-1),gp=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetailsService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 根据账号查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#6A737D"}},"  账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @date 2022/9/28 18:30")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetails "),t("span",{style:{color:"#B392F0"}},"loadUserByUsername"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUserMapper."),t("span",{style:{color:"#B392F0"}},"selectOne"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(XcUser"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getUsername, s));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(user"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String password  "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"user."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"[] authorities "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," {"),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"       "),t("span",{style:{color:"#6A737D"}},"//为了安全在令牌中不放密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        user."),t("span",{style:{color:"#B392F0"}},"setPassword"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String userString "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"toJSONString"),t("span",{style:{color:"#E1E4E8"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UserDetails userDetails "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"(userString)."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"(password)."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"(authorities)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetailsService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 根据账号查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#6A737D"}},"  账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @date 2022/9/28 18:30")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetails "),t("span",{style:{color:"#6F42C1"}},"loadUserByUsername"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"selectOne"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"XcUser"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(XcUser"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getUsername, s));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(user"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String password  "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"user."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"[] authorities "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," {"),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"       "),t("span",{style:{color:"#6A737D"}},"//为了安全在令牌中不放密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        user."),t("span",{style:{color:"#6F42C1"}},"setPassword"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String userString "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"toJSONString"),t("span",{style:{color:"#24292E"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UserDetails userDetails "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"(userString)."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"(password)."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"(authorities)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),hp=t("p",null,"重启认证服务，重新生成令牌，生成成功。",-1),Ap=t("p",null,[p("我们可以使用"),t("code",null,"check_token"),p("查询jwt的内容")],-1),Dp=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"###校验jwt令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{auth_host}}/oauth/check_token?token=")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"###校验jwt令牌")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{auth_host}}/oauth/check_token?token=")])])]),t("button",{class:"collapse"})],-1),Cp=t("p",null,"响应示例如下，",-1),mp=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"aud"'),t("span",{style:{color:"#E1E4E8"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#9ECBFF"}},'"res1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"user_name"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"{'),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"birthday"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"2022-09-28T19:28:46"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"createTime"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"2022-09-28T08:32:03"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"id"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"50"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"name"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"学生1"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"nickname"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"大水牛"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"password"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"$2a$10$0pt7WlfTbnPDTcWtp/.2Mu5CTXvohnNQhR628qq4RoKSc0dGAdEgm"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"sex"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"1"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"status"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"1"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"username"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"stu1"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"userpic"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"http://file.51xuecheng.cn/dddf"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},","),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"utype"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},":"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},"101001"),t("span",{style:{color:"#79B8FF"}},'\\"'),t("span",{style:{color:"#9ECBFF"}},'}"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"scope"'),t("span",{style:{color:"#E1E4E8"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#9ECBFF"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"active"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"exp"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"1664372184"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"authorities"'),t("span",{style:{color:"#E1E4E8"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#9ECBFF"}},'"p1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"jti"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"73da9f7b-bd8c-45ac-9add-46b711d11fb8"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},'"client_id"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"c1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"aud"'),t("span",{style:{color:"#24292E"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#032F62"}},'"res1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"user_name"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"{'),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"birthday"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"2022-09-28T19:28:46"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"createTime"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"2022-09-28T08:32:03"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"id"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"50"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"name"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"学生1"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"nickname"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"大水牛"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"password"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"$2a$10$0pt7WlfTbnPDTcWtp/.2Mu5CTXvohnNQhR628qq4RoKSc0dGAdEgm"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"sex"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"1"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"status"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"1"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"username"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"stu1"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"userpic"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"http://file.51xuecheng.cn/dddf"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},","),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"utype"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},":"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},"101001"),t("span",{style:{color:"#005CC5"}},'\\"'),t("span",{style:{color:"#032F62"}},'}"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"scope"'),t("span",{style:{color:"#24292E"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#032F62"}},'"all"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"active"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"exp"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"1664372184"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"authorities"'),t("span",{style:{color:"#24292E"}},": [")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#032F62"}},'"p1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"jti"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"73da9f7b-bd8c-45ac-9add-46b711d11fb8"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},'"client_id"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"c1"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),bp=t("p",null,[t("code",null,"user_name"),p("存储了用户信息的json格式，在资源服务中就可以取出该json格式的内容转为用户对象去使用。")],-1),Bp={id:"_3-2-3-资源服务获取用户身份",tabindex:"-1"},kp=t("strong",null,"3.2.3 资源服务获取用户身份",-1),Sp=t("p",null,"下边编写一个工具类在各个微服务中去使用，获取当前登录用户的对象。",-1),vp=t("p",null,[p("在"),t("code",null,"content-api"),p("中定义此类：")],-1),xp=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 获取当前用户身份工具类")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"SecurityUtil"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"static"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"getUser"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            Object principalObj "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," SecurityContextHolder."),t("span",{style:{color:"#B392F0"}},"getContext"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"getAuthentication"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"getPrincipal"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}}," (principalObj "),t("span",{style:{color:"#F97583"}},"instanceof"),t("span",{style:{color:"#E1E4E8"}}," String) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#6A737D"}},"//取出用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                String principal "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," principalObj."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#6A737D"}},"//将json转成对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"parseObject"),t("span",{style:{color:"#E1E4E8"}},"(principal, XcUser.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," user;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            log."),t("span",{style:{color:"#B392F0"}},"error"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"获取当前登录用户身份出错:{}"'),t("span",{style:{color:"#E1E4E8"}},", e."),t("span",{style:{color:"#B392F0"}},"getMessage"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"static"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"Serializable"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"static"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"final"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"long"),t("span",{style:{color:"#E1E4E8"}}," serialVersionUID "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"1L"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String id;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String username;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String password;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String salt;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String name;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String nickname;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String wxUnionid;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String companyId;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         * 头像")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String userpic;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String utype;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," LocalDateTime birthday;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String sex;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String email;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String cellphone;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String qq;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         * 用户状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String status;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," LocalDateTime createTime;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," LocalDateTime updateTime;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 获取当前用户身份工具类")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"SecurityUtil"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"static"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"getUser"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            Object principalObj "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," SecurityContextHolder."),t("span",{style:{color:"#6F42C1"}},"getContext"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"getAuthentication"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"getPrincipal"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}}," (principalObj "),t("span",{style:{color:"#D73A49"}},"instanceof"),t("span",{style:{color:"#24292E"}}," String) {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#6A737D"}},"//取出用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                String principal "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," principalObj."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#6A737D"}},"//将json转成对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"parseObject"),t("span",{style:{color:"#24292E"}},"(principal, XcUser.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," user;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            log."),t("span",{style:{color:"#6F42C1"}},"error"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"获取当前登录用户身份出错:{}"'),t("span",{style:{color:"#24292E"}},", e."),t("span",{style:{color:"#6F42C1"}},"getMessage"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"static"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUser"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"Serializable"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"static"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"final"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"long"),t("span",{style:{color:"#24292E"}}," serialVersionUID "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"1L"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String id;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String username;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String password;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String salt;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String name;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String nickname;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String wxUnionid;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String companyId;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         * 头像")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String userpic;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String utype;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," LocalDateTime birthday;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String sex;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String email;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String cellphone;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String qq;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"        /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         * 用户状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"         */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String status;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," LocalDateTime createTime;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," LocalDateTime updateTime;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),fp=t("p",null,"下边在内容管理服务中测试此工具类，以查询课程信息接口为例：",-1),_p=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"根据课程id查询课程基础信息"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"GetMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/course/{courseId}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," CourseBaseInfoDto "),t("span",{style:{color:"#B392F0"}},"getCourseBaseById"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"PathVariable"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"courseId"'),t("span",{style:{color:"#E1E4E8"}},") Long courseId){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出当前用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   SecurityUtil.XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," SecurityUtil."),t("span",{style:{color:"#B392F0"}},"getUser"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"(user);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," courseBaseInfoService."),t("span",{style:{color:"#B392F0"}},"getCourseBaseInfo"),t("span",{style:{color:"#E1E4E8"}},"(courseId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"根据课程id查询课程基础信息"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"GetMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/course/{courseId}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," CourseBaseInfoDto "),t("span",{style:{color:"#6F42C1"}},"getCourseBaseById"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"PathVariable"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"courseId"'),t("span",{style:{color:"#24292E"}},") Long courseId){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出当前用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   SecurityUtil.XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," SecurityUtil."),t("span",{style:{color:"#6F42C1"}},"getUser"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"(user);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," courseBaseInfoService."),t("span",{style:{color:"#6F42C1"}},"getCourseBaseInfo"),t("span",{style:{color:"#24292E"}},"(courseId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),wp=t("p",null,"重启内容管理服务：",-1),Up=t("p",null,"1、启动认证服务、网关、内容管理服务",-1),Ip=t("p",null,"2、生成新的令牌",-1),jp=t("p",null,"3、携带令牌访问内容管理服务的查询课程接口",-1),Pp=t("figure",null,[t("img",{alt:"image-20230705224419107",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224419107.png"})],-1),Mp={id:"_3-3-支持认证方式多样",tabindex:"-1"},Tp=t("strong",null,"3.3 支持认证方式多样",-1),Op={id:"_3-3-1-统一认证入口",tabindex:"-1"},zp=t("strong",null,"3.3.1 统一认证入口",-1),Rp=t("p",null,"目前各大网站的认证方式非常丰富：账号密码认证、手机验证码认证、扫码登录等。基于当前研究的Spring Security认证流程如何支持多样化的认证方式呢？",-1),Lp=t("p",null,"1、支持账号和密码认证",-1),Wp=t("p",null,"采用OAuth2协议的密码模式即可实现。",-1),Np=t("p",null,"2、支持手机号加验证码认证",-1),Jp=t("p",null,"用户认证提交的是手机号和验证码，并不是账号和密码。",-1),Xp=t("p",null,"3、微信扫码认证",-1),qp=t("p",null,"基于OAuth2协议与微信交互，学成在线网站向微信服务器申请到一个令牌，然后携带令牌去微信查询用户信息，查询成功则用户在学成在线项目认证通过。",-1),Gp=t("p",null,[p("目前我们测试通过OAuth2的密码模式，用户认证会提交账号和密码，由DaoAuthenticationProvider调用UserDetailsService的"),t("code",null,"loadUserByUsername()"),p("方法获取UserDetails用户信息。")],-1),Kp=t("p",null,[p("在前边我们自定义了UserDetailsService接口实现类，通过"),t("code",null,"loadUserByUsername()"),p("方法根据账号查询用户信息。")],-1),Vp=t("p",null,"而不同的认证方式提交的数据不一样，比如：手机加验证码方式会提交手机号和验证码，账号密码方式会提交账号、密码、验证码。",-1),Hp=t("p",null,[p("我们可以在"),t("code",null,"loadUserByUsername()"),p("方法上作文章，将用户原来提交的账号数据改为提交json数据，json数据可以扩展不同认证方式所提交的各种参数。")],-1),Zp=t("p",null,"首先创建一个DTO类表示认证的参数：",-1),Qp=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 认证用户请求参数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthParamsDto"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String username; "),t("span",{style:{color:"#6A737D"}},"//用户名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String password; "),t("span",{style:{color:"#6A737D"}},"//域  用于扩展")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String cellphone;"),t("span",{style:{color:"#6A737D"}},"//手机号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String checkcode;"),t("span",{style:{color:"#6A737D"}},"//验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String checkcodekey;"),t("span",{style:{color:"#6A737D"}},"//验证码key")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," String authType; "),t("span",{style:{color:"#6A737D"}},"// 认证的类型   password:用户名密码模式类型    sms:短信模式类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#F97583"}},"Object"),t("span",{style:{color:"#E1E4E8"}},"> payload "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," HashMap<>();"),t("span",{style:{color:"#6A737D"}},"//附加数据，作为扩展，不同认证类型可拥有不同的附加数据。如认证类型为短信时包含smsKey : sms:3d21042d054548b08477142bbca95cfa; 所有情况下都包含clientId")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 认证用户请求参数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthParamsDto"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String username; "),t("span",{style:{color:"#6A737D"}},"//用户名")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String password; "),t("span",{style:{color:"#6A737D"}},"//域  用于扩展")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String cellphone;"),t("span",{style:{color:"#6A737D"}},"//手机号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String checkcode;"),t("span",{style:{color:"#6A737D"}},"//验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String checkcodekey;"),t("span",{style:{color:"#6A737D"}},"//验证码key")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," String authType; "),t("span",{style:{color:"#6A737D"}},"// 认证的类型   password:用户名密码模式类型    sms:短信模式类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#D73A49"}},"Object"),t("span",{style:{color:"#24292E"}},"> payload "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," HashMap<>();"),t("span",{style:{color:"#6A737D"}},"//附加数据，作为扩展，不同认证类型可拥有不同的附加数据。如认证类型为短信时包含smsKey : sms:3d21042d054548b08477142bbca95cfa; 所有情况下都包含clientId")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Yp=t("p",null,[p("此时"),t("code",null,"loadUserByUsername()"),p("方法可以修改如下：")],-1),$p=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 自定义UserDetailsService用来对接Spring Security")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetailsService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息组成用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#6A737D"}},"  AuthParamsDto类型的json数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @date 2022/9/28 18:30")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetails "),t("span",{style:{color:"#B392F0"}},"loadUserByUsername"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        AuthParamsDto authParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//将认证参数转为AuthParamsDto类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            authParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"parseObject"),t("span",{style:{color:"#E1E4E8"}},"(s, AuthParamsDto.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            log."),t("span",{style:{color:"#B392F0"}},"info"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"认证请求不符合项目要求:{}"'),t("span",{style:{color:"#E1E4E8"}},",s);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"认证请求数据格式不对"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String username "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUserMapper."),t("span",{style:{color:"#B392F0"}},"selectOne"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(XcUser"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(user"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String password  "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"user."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"[] authorities "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," {"),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String userString "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"toJSONString"),t("span",{style:{color:"#E1E4E8"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UserDetails userDetails "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"(userString)."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"(password)."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"(authorities)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 自定义UserDetailsService用来对接Spring Security")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetailsService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息组成用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#6A737D"}},"  AuthParamsDto类型的json数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@author"),t("span",{style:{color:"#6A737D"}}," Mr.M")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @date 2022/9/28 18:30")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetails "),t("span",{style:{color:"#6F42C1"}},"loadUserByUsername"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        AuthParamsDto authParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//将认证参数转为AuthParamsDto类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            authParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"parseObject"),t("span",{style:{color:"#24292E"}},"(s, AuthParamsDto.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            log."),t("span",{style:{color:"#6F42C1"}},"info"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"认证请求不符合项目要求:{}"'),t("span",{style:{color:"#24292E"}},",s);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"认证请求数据格式不对"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String username "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"selectOne"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"XcUser"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(XcUser"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(user"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String password  "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"user."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"[] authorities "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," {"),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String userString "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"toJSONString"),t("span",{style:{color:"#24292E"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UserDetails userDetails "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"(userString)."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"(password)."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"(authorities)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),sr=t("p",null,"原来的DaoAuthenticationProvider 会进行密码校验，现在重新定义DaoAuthenticationProviderCustom类，重写类的additionalAuthenticationChecks方法。",-1),lr=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"package"),t("span",{style:{color:"#E1E4E8"}}," com.xuecheng.auth.config;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.security.authentication.BadCredentialsException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.security.authentication.UsernamePasswordAuthenticationToken;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.security.authentication.dao.DaoAuthenticationProvider;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.security.core.AuthenticationException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.security.core.userdetails.UserDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.security.core.userdetails.UserDetailsService;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"import"),t("span",{style:{color:"#E1E4E8"}}," org.springframework.stereotype.Component;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 自定义DaoAuthenticationProvider")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Component")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"DaoAuthenticationProviderCustom"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"DaoAuthenticationProvider"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"setUserDetailsService"),t("span",{style:{color:"#E1E4E8"}},"(UserDetailsService "),t("span",{style:{color:"#FFAB70"}},"userDetailsService"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#79B8FF"}},"super"),t("span",{style:{color:"#E1E4E8"}},"."),t("span",{style:{color:"#B392F0"}},"setUserDetailsService"),t("span",{style:{color:"#E1E4E8"}},"(userDetailsService);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#6A737D"}},"//屏蔽密码对比")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"protected"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"additionalAuthenticationChecks"),t("span",{style:{color:"#E1E4E8"}},"(UserDetails "),t("span",{style:{color:"#FFAB70"}},"userDetails"),t("span",{style:{color:"#E1E4E8"}},", UsernamePasswordAuthenticationToken "),t("span",{style:{color:"#FFAB70"}},"authentication"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," AuthenticationException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"package"),t("span",{style:{color:"#24292E"}}," com.xuecheng.auth.config;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," lombok.extern.slf4j.Slf4j;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.beans.factory.annotation.Autowired;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.security.authentication.BadCredentialsException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.security.authentication.UsernamePasswordAuthenticationToken;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.security.authentication.dao.DaoAuthenticationProvider;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.security.core.AuthenticationException;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.security.core.userdetails.UserDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.security.core.userdetails.UserDetailsService;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"import"),t("span",{style:{color:"#24292E"}}," org.springframework.stereotype.Component;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 自定义DaoAuthenticationProvider")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Component")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"DaoAuthenticationProviderCustom"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"DaoAuthenticationProvider"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"setUserDetailsService"),t("span",{style:{color:"#24292E"}},"(UserDetailsService "),t("span",{style:{color:"#E36209"}},"userDetailsService"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#005CC5"}},"super"),t("span",{style:{color:"#24292E"}},"."),t("span",{style:{color:"#6F42C1"}},"setUserDetailsService"),t("span",{style:{color:"#24292E"}},"(userDetailsService);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6A737D"}},"//屏蔽密码对比")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"protected"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"additionalAuthenticationChecks"),t("span",{style:{color:"#24292E"}},"(UserDetails "),t("span",{style:{color:"#E36209"}},"userDetails"),t("span",{style:{color:"#24292E"}},", UsernamePasswordAuthenticationToken "),t("span",{style:{color:"#E36209"}},"authentication"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," AuthenticationException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),or=t("p",null,"修改WebSecurityConfig类指定daoAuthenticationProviderCustom",-1),nr=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"DaoAuthenticationProviderCustom daoAuthenticationProviderCustom;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"protected"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"void"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"configure"),t("span",{style:{color:"#E1E4E8"}},"(AuthenticationManagerBuilder auth) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    auth."),t("span",{style:{color:"#B392F0"}},"authenticationProvider"),t("span",{style:{color:"#E1E4E8"}},"(daoAuthenticationProviderCustom);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"DaoAuthenticationProviderCustom daoAuthenticationProviderCustom;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"protected"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"void"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"configure"),t("span",{style:{color:"#24292E"}},"(AuthenticationManagerBuilder auth) throws Exception {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    auth."),t("span",{style:{color:"#6F42C1"}},"authenticationProvider"),t("span",{style:{color:"#24292E"}},"(daoAuthenticationProviderCustom);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),er=t("p",null,"此时可以重启认证服务，测试申请令牌接口，传入的账号信息改为json数据，如下：",-1),ar=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"################扩展认证请求参数后######################")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"###密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}},' {{auth_host}}/auth/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username={"username":"stu1","authType":"password","password":"111111"}')])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"################扩展认证请求参数后######################")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"###密码模式")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}},' {{auth_host}}/auth/oauth/token?client_id=XcWebApp&client_secret=XcWebApp&grant_type=password&username={"username":"stu1","authType":"password","password":"111111"}')])])]),t("button",{class:"collapse"})],-1),cr=t("p",null,[p("经过测试发现"),t("code",null,"loadUserByUsername()"),p("方法可以正常接收到认证请求中的json数据。")],-1),tr=t("p",null,"有了这些认证参数我们可以定义一个认证Service接口去进行各种方式的认证。",-1),pr=t("p",null,"定义用户信息，为了扩展性让它继承XcUser",-1),rr=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUserExt"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Data")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUserExt"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUser"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Er=t("p",null,"定义认证Service 接口",-1),yr=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 认证service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"interface"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"   /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    * @description 认证方法")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"authParamsDto"),t("span",{style:{color:"#6A737D"}}," 认证参数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.ucenter.model.po.XcUser 用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"   */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   XcUserExt "),t("span",{style:{color:"#B392F0"}},"execute"),t("span",{style:{color:"#E1E4E8"}},"(AuthParamsDto "),t("span",{style:{color:"#FFAB70"}},"authParamsDto"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 认证service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"interface"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"   /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    * @description 认证方法")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"authParamsDto"),t("span",{style:{color:"#6A737D"}}," 认证参数")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.ucenter.model.po.XcUser 用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"   */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   XcUserExt "),t("span",{style:{color:"#6F42C1"}},"execute"),t("span",{style:{color:"#24292E"}},"(AuthParamsDto "),t("span",{style:{color:"#E36209"}},"authParamsDto"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),ir=t("p",null,"loadUserByUsername()修改如下：",-1),ur=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetailsService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ApplicationContext applicationContext;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息组成用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#6A737D"}},"  AuthParamsDto类型的json数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetails "),t("span",{style:{color:"#B392F0"}},"loadUserByUsername"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        AuthParamsDto authParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//将认证参数转为AuthParamsDto类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            authParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"parseObject"),t("span",{style:{color:"#E1E4E8"}},"(s, AuthParamsDto.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            log."),t("span",{style:{color:"#B392F0"}},"info"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"认证请求不符合项目要求:{}"'),t("span",{style:{color:"#E1E4E8"}},",s);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"认证请求数据格式不对"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//开始认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        authService."),t("span",{style:{color:"#B392F0"}},"execute"),t("span",{style:{color:"#E1E4E8"}},"(authParamsDto);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        .....")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetailsService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ApplicationContext applicationContext;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息组成用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#6A737D"}},"  AuthParamsDto类型的json数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetails "),t("span",{style:{color:"#6F42C1"}},"loadUserByUsername"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        AuthParamsDto authParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//将认证参数转为AuthParamsDto类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            authParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"parseObject"),t("span",{style:{color:"#24292E"}},"(s, AuthParamsDto.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            log."),t("span",{style:{color:"#6F42C1"}},"info"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"认证请求不符合项目要求:{}"'),t("span",{style:{color:"#24292E"}},",s);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"认证请求数据格式不对"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//开始认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        authService."),t("span",{style:{color:"#6F42C1"}},"execute"),t("span",{style:{color:"#24292E"}},"(authParamsDto);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        .....")])])]),t("button",{class:"collapse"})],-1),Fr=t("p",null,"到此我们基于Spring Security认证流程修改为如下：",-1),dr=t("figure",null,[t("img",{alt:"image-20230705224445890",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224445890.png"})],-1),gr={id:"_3-3-2-实现账号密码认证",tabindex:"-1"},hr=t("strong",null,"3.3.2 实现账号密码认证",-1),Ar=t("p",null,"上节定义了AuthService认证接口，下边实现该接口实现账号密码认证",-1),Dr=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 账号密码认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Service"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"password_authservice"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"PasswordAuthServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," PasswordEncoder passwordEncoder;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUserExt "),t("span",{style:{color:"#B392F0"}},"execute"),t("span",{style:{color:"#E1E4E8"}},"(AuthParamsDto "),t("span",{style:{color:"#FFAB70"}},"authParamsDto"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String username "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUserMapper."),t("span",{style:{color:"#B392F0"}},"selectOne"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(XcUser"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(user"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"账号不存在"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  XcUserExt xcUserExt "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUserExt"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  BeanUtils."),t("span",{style:{color:"#B392F0"}},"copyProperties"),t("span",{style:{color:"#E1E4E8"}},"(user,xcUserExt);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#6A737D"}},"//校验密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String passwordDb  "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"user."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String passwordForm "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," matches "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," passwordEncoder."),t("span",{style:{color:"#B392F0"}},"matches"),t("span",{style:{color:"#E1E4E8"}},"(passwordForm, passwordDb);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"matches){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"账号或密码错误"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUserExt;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 账号密码认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Service"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"password_authservice"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"PasswordAuthServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," PasswordEncoder passwordEncoder;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUserExt "),t("span",{style:{color:"#6F42C1"}},"execute"),t("span",{style:{color:"#24292E"}},"(AuthParamsDto "),t("span",{style:{color:"#E36209"}},"authParamsDto"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String username "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"selectOne"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"XcUser"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(XcUser"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(user"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"账号不存在"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  XcUserExt xcUserExt "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUserExt"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  BeanUtils."),t("span",{style:{color:"#6F42C1"}},"copyProperties"),t("span",{style:{color:"#24292E"}},"(user,xcUserExt);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#6A737D"}},"//校验密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String passwordDb  "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"user."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String passwordForm "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," matches "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," passwordEncoder."),t("span",{style:{color:"#6F42C1"}},"matches"),t("span",{style:{color:"#24292E"}},"(passwordForm, passwordDb);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"matches){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"账号或密码错误"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUserExt;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Cr=t("p",null,"修改UserServiceImpl类，根据认证方式使用不同的认证bean",-1),mr=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 自定义UserDetailsService用来对接Spring Security")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"UserDetailsService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ApplicationContext applicationContext;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    @Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    AuthService authService;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息组成用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#6A737D"}},"  AuthParamsDto类型的json数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetails "),t("span",{style:{color:"#B392F0"}},"loadUserByUsername"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"s"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        AuthParamsDto authParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"try"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//将认证参数转为AuthParamsDto类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            authParamsDto "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"parseObject"),t("span",{style:{color:"#E1E4E8"}},"(s, AuthParamsDto.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } "),t("span",{style:{color:"#F97583"}},"catch"),t("span",{style:{color:"#E1E4E8"}}," (Exception "),t("span",{style:{color:"#FFAB70"}},"e"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            log."),t("span",{style:{color:"#B392F0"}},"info"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"认证请求不符合项目要求:{}"'),t("span",{style:{color:"#E1E4E8"}},",s);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"认证请求数据格式不对"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//认证方法")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String authType "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getAuthType"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        AuthService authService "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"  applicationContext."),t("span",{style:{color:"#B392F0"}},"getBean"),t("span",{style:{color:"#E1E4E8"}},"(authType "),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"_authservice"'),t("span",{style:{color:"#E1E4E8"}},",AuthService.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUserExt user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authService."),t("span",{style:{color:"#B392F0"}},"execute"),t("span",{style:{color:"#E1E4E8"}},"(authParamsDto);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getUserPrincipal"),t("span",{style:{color:"#E1E4E8"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#FFAB70"}},"user"),t("span",{style:{color:"#6A737D"}},"  用户id，主键")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#F97583"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.ucenter.model.po.XcUser 用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetails "),t("span",{style:{color:"#B392F0"}},"getUserPrincipal"),t("span",{style:{color:"#E1E4E8"}},"(XcUserExt "),t("span",{style:{color:"#FFAB70"}},"user"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"[] authorities "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," {"),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String password "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," user."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//为了安全在令牌中不放密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        user."),t("span",{style:{color:"#B392F0"}},"setPassword"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String userString "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"toJSONString"),t("span",{style:{color:"#E1E4E8"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        UserDetails userDetails "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"(userString)."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"(password )."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"(authorities)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 自定义UserDetailsService用来对接Spring Security")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Service")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"UserDetailsService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ApplicationContext applicationContext;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    @Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//    AuthService authService;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息组成用户身份信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#6A737D"}},"  AuthParamsDto类型的json数据")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," org.springframework.security.core.userdetails.UserDetails")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetails "),t("span",{style:{color:"#6F42C1"}},"loadUserByUsername"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"s"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," UsernameNotFoundException {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        AuthParamsDto authParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"try"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//将认证参数转为AuthParamsDto类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            authParamsDto "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"parseObject"),t("span",{style:{color:"#24292E"}},"(s, AuthParamsDto.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } "),t("span",{style:{color:"#D73A49"}},"catch"),t("span",{style:{color:"#24292E"}}," (Exception "),t("span",{style:{color:"#E36209"}},"e"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            log."),t("span",{style:{color:"#6F42C1"}},"info"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"认证请求不符合项目要求:{}"'),t("span",{style:{color:"#24292E"}},",s);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"认证请求数据格式不对"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//认证方法")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String authType "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getAuthType"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        AuthService authService "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"  applicationContext."),t("span",{style:{color:"#6F42C1"}},"getBean"),t("span",{style:{color:"#24292E"}},"(authType "),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"_authservice"'),t("span",{style:{color:"#24292E"}},",AuthService.class);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUserExt user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authService."),t("span",{style:{color:"#6F42C1"}},"execute"),t("span",{style:{color:"#24292E"}},"(authParamsDto);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getUserPrincipal"),t("span",{style:{color:"#24292E"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    /**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * @description 查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@param"),t("span",{style:{color:"#6A737D"}}," "),t("span",{style:{color:"#E36209"}},"user"),t("span",{style:{color:"#6A737D"}},"  用户id，主键")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"     * "),t("span",{style:{color:"#D73A49"}},"@return"),t("span",{style:{color:"#6A737D"}}," com.xuecheng.ucenter.model.po.XcUser 用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"    */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetails "),t("span",{style:{color:"#6F42C1"}},"getUserPrincipal"),t("span",{style:{color:"#24292E"}},"(XcUserExt "),t("span",{style:{color:"#E36209"}},"user"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"[] authorities "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," {"),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},"};")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String password "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," user."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//为了安全在令牌中不放密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        user."),t("span",{style:{color:"#6F42C1"}},"setPassword"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String userString "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"toJSONString"),t("span",{style:{color:"#24292E"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//创建UserDetails对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        UserDetails userDetails "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"(userString)."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"(password )."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"(authorities)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," userDetails;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),br=t("p",null,"重启认证服务，测试申请令牌接口。",-1),Br=t("p",null,"1、测试账号和密码都正确的情况是否可以申请令牌成功。",-1),kr=t("p",null,"2、测试密码错误的情况。",-1),Sr=t("p",null,"3、测试账号不存在情况。",-1),vr={id:"_3-4-验证码服务",tabindex:"-1"},xr=t("strong",null,"3.4 验证码服务",-1),fr={id:"_3-4-1-创建验证码服务工程",tabindex:"-1"},_r=t("strong",null,"3.4.1 创建验证码服务工程",-1),wr=t("p",null,"在认证时一般都需要输入验证码，验证码有什么用？",-1),Ur=t("p",null,"验证码可以防止恶性攻击，比如：XSS跨站脚本攻击、CSRF跨站请求伪造攻击，一些比较复杂的图形验证码可以有效的防止恶性攻击。",-1),Ir=t("p",null,"为了保护系统的安全在一些比较重要的操作都需要验证码。",-1),jr=t("figure",null,[t("img",{alt:"image-20230705224522221",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224522221.png"})],-1),Pr=t("p",null,"验证码的类型也有很多：图片、语音、手机短信验证码等。",-1),Mr=t("p",null,"本项目创建单独的验证码服务为各业务提供验证码的生成、校验等服务。",-1),Tr=t("p",null,"拷贝课程资料目录xuecheng-plus-checkcode验证码服务工程到自己的工程目录。",-1),Or=t("figure",null,[t("img",{alt:"image-20230705224535229",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224535229.png"})],-1),zr=t("p",null,"定义nacos配置文件",-1),Rr=t("div",{style:{"max-height":"300px"},class:"language-yaml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"yaml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"server"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"servlet"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"context-path"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"/checkcode")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"port"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"63075")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"server"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"servlet"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"context-path"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"/checkcode")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"port"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"63075")])])]),t("button",{class:"collapse"})],-1),Lr=t("p",null,"注意修改bootstrap.yml中的命名空间为自己定义的命名空间。",-1),Wr=t("p",null,"配置redis-dev.yaml，",-1),Nr=t("figure",null,[t("img",{alt:"image-20230705224558927",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224558927.png"})],-1),Jr=t("p",null,"内容如下：",-1),Xr=t("div",{style:{"max-height":"300px"},class:"language-yaml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"yaml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"spring"),t("span",{style:{color:"#E1E4E8"}},": ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"redis"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"host"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"192.168.101.65")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"port"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"6379")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"password"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"redis")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"database"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"0")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"lettuce"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#85E89D"}},"pool"),t("span",{style:{color:"#E1E4E8"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#85E89D"}},"max-active"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"20")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#85E89D"}},"max-idle"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"10")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#85E89D"}},"min-idle"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"0")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#85E89D"}},"timeout"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"10000")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"#redisson:")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#6A737D"}},"#配置文件目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#6A737D"}},"#config: classpath:singleServerConfig.yaml")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"spring"),t("span",{style:{color:"#24292E"}},": ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"redis"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"host"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"192.168.101.65")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"port"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"6379")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"password"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"redis")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"database"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"0")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"lettuce"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#22863A"}},"pool"),t("span",{style:{color:"#24292E"}},":")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#22863A"}},"max-active"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"20")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#22863A"}},"max-idle"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"10")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#22863A"}},"min-idle"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"0")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#22863A"}},"timeout"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"10000")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"#redisson:")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#6A737D"}},"#配置文件目录")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#6A737D"}},"#config: classpath:singleServerConfig.yaml")])])]),t("button",{class:"collapse"})],-1),qr={id:"_3-4-2-验证码接口测试",tabindex:"-1"},Gr=t("strong",null,"3.4.2 验证码接口测试",-1),Kr=t("p",null,"验证码服务对外提供的接口有：",-1),Vr=t("p",null,"1、生成验证码",-1),Hr=t("p",null,"2、校验验证码。",-1),Zr=t("p",null,"如下：",-1),Qr=t("figure",null,[t("img",{alt:"image-20230705224626767",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224626767.png"})],-1),Yr=t("p",null,"验证码服务如何生成并校验验证码？",-1),$r=t("p",null,"拿图片验证码举例：",-1),sE=t("p",null,"1、先生成一个指定位数的验证码，根据需要可能是数字、数字字母组合或文字。",-1),lE=t("p",null,"2、根据生成的验证码生成一个图片并返回给页面",-1),oE=t("p",null,"3、给生成的验证码分配一个key，将key和验证码一同存入缓存。这个key和图片一同返回给页面。",-1),nE=t("p",null,"4、用户输入验证码，连同key一同提交至认证服务。",-1),eE=t("p",null,"5、认证服务拿key和输入的验证码请求验证码服务去校验",-1),aE=t("p",null,"6、验证码服务根据key从缓存取出正确的验证码和用户输入的验证码进行比对，如果相同则校验通过，否则不通过。",-1),cE=t("figure",null,[t("img",{alt:"image-20230705224639354",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224639354.png"})],-1),tE=t("p",null,"根据接口分析，验证码服务接口如下：",-1),pE=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Api"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"验证码服务接口"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"CheckCodeController"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"生成验证信息"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"notes"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"生成验证信息"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/pic"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," CheckCodeResultDto "),t("span",{style:{color:"#B392F0"}},"generatePicCheckCode"),t("span",{style:{color:"#E1E4E8"}},"(CheckCodeParamsDto "),t("span",{style:{color:"#FFAB70"}},"checkCodeParamsDto"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"校验"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"notes"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"校验"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"ApiImplicitParams"),t("span",{style:{color:"#E1E4E8"}},"({")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            @"),t("span",{style:{color:"#F97583"}},"ApiImplicitParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"name"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"name"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"业务名称"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"dataType"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"String"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"paramType"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"query"'),t("span",{style:{color:"#E1E4E8"}},"),")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            @"),t("span",{style:{color:"#F97583"}},"ApiImplicitParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"name"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"key"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"验证key"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"dataType"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"String"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"paramType"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"query"'),t("span",{style:{color:"#E1E4E8"}},"),")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            @"),t("span",{style:{color:"#F97583"}},"ApiImplicitParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"name"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"code"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"验证码"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"required"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"dataType"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"String"'),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#79B8FF"}},"paramType"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#9ECBFF"}},'"query"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    })")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/verify"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," Boolean "),t("span",{style:{color:"#B392F0"}},"verify"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"key"),t("span",{style:{color:"#E1E4E8"}},", String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Api"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"验证码服务接口"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"RestController")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"CheckCodeController"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"生成验证信息"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"notes"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"生成验证信息"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/pic"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," CheckCodeResultDto "),t("span",{style:{color:"#6F42C1"}},"generatePicCheckCode"),t("span",{style:{color:"#24292E"}},"(CheckCodeParamsDto "),t("span",{style:{color:"#E36209"}},"checkCodeParamsDto"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"校验"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"notes"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"校验"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"ApiImplicitParams"),t("span",{style:{color:"#24292E"}},"({")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            @"),t("span",{style:{color:"#D73A49"}},"ApiImplicitParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"name"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"name"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"业务名称"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"dataType"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"String"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"paramType"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"query"'),t("span",{style:{color:"#24292E"}},"),")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            @"),t("span",{style:{color:"#D73A49"}},"ApiImplicitParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"name"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"key"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"验证key"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"dataType"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"String"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"paramType"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"query"'),t("span",{style:{color:"#24292E"}},"),")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            @"),t("span",{style:{color:"#D73A49"}},"ApiImplicitParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"name"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"code"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"验证码"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"required"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"dataType"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"String"'),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#005CC5"}},"paramType"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#032F62"}},'"query"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    })")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/verify"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," Boolean "),t("span",{style:{color:"#6F42C1"}},"verify"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"key"),t("span",{style:{color:"#24292E"}},", String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),rE=t("p",null,"1、生成验证码接口",-1),EE=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 申请验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{checkcode_host}}/checkcode/pic")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 申请验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{checkcode_host}}/checkcode/pic")])])]),t("button",{class:"collapse"})],-1),yE=t("p",null,"2、校验验证码接口",-1),iE=t("p",null,"根据生成验证码返回的key以及日志中输出正确的验证码去测试。",-1),uE=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 校验验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"POST"),t("span",{style:{color:"#E1E4E8"}}," {{checkcode_host}}/checkcode/verify?key=checkcode4506b95bddbe46cdb0d56810b747db1b&code=70dl")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"### 校验验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"POST"),t("span",{style:{color:"#24292E"}}," {{checkcode_host}}/checkcode/verify?key=checkcode4506b95bddbe46cdb0d56810b747db1b&code=70dl")])])]),t("button",{class:"collapse"})],-1),FE={id:"_3-5-账号密码认证",tabindex:"-1"},dE=t("strong",null,"3.5 账号密码认证",-1),gE={id:"_3-5-1-需求分析",tabindex:"-1"},hE=t("strong",null,"3.5.1 需求分析",-1),AE=t("p",null,"到目前为止账号和密码认证所需要的技术、组件都已开发完毕，下边实现账号密码认证，输出如下图：",-1),DE=t("figure",null,[t("img",{alt:"image-20230705224656789",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224656789.png"})],-1),CE=t("p",null,"执行流程如下：",-1),mE=t("figure",null,[t("img",{alt:"image-20230705224709647",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224709647.png"})],-1),bE={id:"_3-5-2-账号密码认证开发",tabindex:"-1"},BE=t("strong",null,"3.5.2 账号密码认证开发",-1),kE=t("p",null,"1、在认证服务定义远程调用验证码服务的接口",-1),SE=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 搜索服务远程接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"FeignClient"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"checkcode"'),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},"fallbackFactory"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," CheckCodeClientFactory.class)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/checkcode"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"interface"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"CheckCodeClient"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"value"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"/verify"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," Boolean "),t("span",{style:{color:"#B392F0"}},"verify"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"key"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"key"),t("span",{style:{color:"#E1E4E8"}},",@"),t("span",{style:{color:"#F97583"}},"RequestParam"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"code"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 搜索服务远程接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"FeignClient"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"checkcode"'),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},"fallbackFactory"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," CheckCodeClientFactory.class)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/checkcode"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"interface"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"CheckCodeClient"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"value"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"/verify"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," Boolean "),t("span",{style:{color:"#6F42C1"}},"verify"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"key"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"key"),t("span",{style:{color:"#24292E"}},",@"),t("span",{style:{color:"#D73A49"}},"RequestParam"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"code"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),vE=t("p",null,"CheckCodeClientFactory:",-1),xE=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Component")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"CheckCodeClientFactory"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"FallbackFactory"),t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#F97583"}},"CheckCodeClient"),t("span",{style:{color:"#E1E4E8"}},"> {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," CheckCodeClient "),t("span",{style:{color:"#B392F0"}},"create"),t("span",{style:{color:"#E1E4E8"}},"(Throwable "),t("span",{style:{color:"#FFAB70"}},"throwable"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"CheckCodeClient"),t("span",{style:{color:"#E1E4E8"}},"() {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," Boolean "),t("span",{style:{color:"#B392F0"}},"verify"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"key"),t("span",{style:{color:"#E1E4E8"}},", String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"调用验证码服务熔断异常:{}"'),t("span",{style:{color:"#E1E4E8"}},", throwable."),t("span",{style:{color:"#B392F0"}},"getMessage"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        };")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Component")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"CheckCodeClientFactory"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"FallbackFactory"),t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#D73A49"}},"CheckCodeClient"),t("span",{style:{color:"#24292E"}},"> {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," CheckCodeClient "),t("span",{style:{color:"#6F42C1"}},"create"),t("span",{style:{color:"#24292E"}},"(Throwable "),t("span",{style:{color:"#E36209"}},"throwable"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"CheckCodeClient"),t("span",{style:{color:"#24292E"}},"() {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," Boolean "),t("span",{style:{color:"#6F42C1"}},"verify"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"key"),t("span",{style:{color:"#24292E"}},", String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"调用验证码服务熔断异常:{}"'),t("span",{style:{color:"#24292E"}},", throwable."),t("span",{style:{color:"#6F42C1"}},"getMessage"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        };")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),fE=t("p",null,"启动类添加：",-1),_E=t("p",null,[t("code",null,'@EnableFeignClients(basePackages={"com.xuecheng.*.feignclient"})')],-1),wE=t("p",null,"配置文件引入feign-dev.yaml",-1),UE=t("div",{style:{"max-height":"300px"},class:"language-yaml"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"yaml"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"- "),t("span",{style:{color:"#85E89D"}},"data-id"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"feign-${spring.profiles.active}.yaml")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"group"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},"xuecheng-plus-common")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#85E89D"}},"refresh"),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#79B8FF"}},"true")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"- "),t("span",{style:{color:"#22863A"}},"data-id"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"feign-${spring.profiles.active}.yaml")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"group"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},"xuecheng-plus-common")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#22863A"}},"refresh"),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#005CC5"}},"true")])])]),t("button",{class:"collapse"})],-1),IE=t("p",null,"2、完善PasswordAuthServiceImpl",-1),jE=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 账号密码认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Service"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"password_authservice"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"PasswordAuthServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," PasswordEncoder passwordEncoder;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," CheckCodeClient checkCodeClient;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"execute"),t("span",{style:{color:"#E1E4E8"}},"(AuthParamsDto "),t("span",{style:{color:"#FFAB70"}},"authParamsDto"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#6A737D"}},"//校验验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String checkcode "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getCheckcode"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String checkcodekey "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getCheckcodekey"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(StringUtils."),t("span",{style:{color:"#B392F0"}},"isBlank"),t("span",{style:{color:"#E1E4E8"}},"(checkcodekey) "),t("span",{style:{color:"#F97583"}},"||"),t("span",{style:{color:"#E1E4E8"}}," StringUtils."),t("span",{style:{color:"#B392F0"}},"isBlank"),t("span",{style:{color:"#E1E4E8"}},"(checkcode)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"验证码为空"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  Boolean verify "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," checkCodeClient."),t("span",{style:{color:"#B392F0"}},"verify"),t("span",{style:{color:"#E1E4E8"}},"(checkcodekey, checkcode);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"verify){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"验证码输入错误"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String username "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUserMapper."),t("span",{style:{color:"#B392F0"}},"selectOne"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(XcUser"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(user"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"账号不存在"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#6A737D"}},"//校验密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String passwordDb  "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}},"user."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  String passwordForm "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"boolean"),t("span",{style:{color:"#E1E4E8"}}," matches "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," passwordEncoder."),t("span",{style:{color:"#B392F0"}},"matches"),t("span",{style:{color:"#E1E4E8"}},"(passwordForm, passwordDb);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"!"),t("span",{style:{color:"#E1E4E8"}},"matches){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"账号或密码错误"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," user;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 账号密码认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Service"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"password_authservice"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"PasswordAuthServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," PasswordEncoder passwordEncoder;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," CheckCodeClient checkCodeClient;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"execute"),t("span",{style:{color:"#24292E"}},"(AuthParamsDto "),t("span",{style:{color:"#E36209"}},"authParamsDto"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#6A737D"}},"//校验验证码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String checkcode "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getCheckcode"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String checkcodekey "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getCheckcodekey"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(StringUtils."),t("span",{style:{color:"#6F42C1"}},"isBlank"),t("span",{style:{color:"#24292E"}},"(checkcodekey) "),t("span",{style:{color:"#D73A49"}},"||"),t("span",{style:{color:"#24292E"}}," StringUtils."),t("span",{style:{color:"#6F42C1"}},"isBlank"),t("span",{style:{color:"#24292E"}},"(checkcode)){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"验证码为空"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  Boolean verify "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," checkCodeClient."),t("span",{style:{color:"#6F42C1"}},"verify"),t("span",{style:{color:"#24292E"}},"(checkcodekey, checkcode);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"verify){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"验证码输入错误"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String username "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"selectOne"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"XcUser"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(XcUser"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(user"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"账号不存在"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#6A737D"}},"//校验密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#6A737D"}},"//取出数据库存储的正确密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String passwordDb  "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}},"user."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  String passwordForm "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"boolean"),t("span",{style:{color:"#24292E"}}," matches "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," passwordEncoder."),t("span",{style:{color:"#6F42C1"}},"matches"),t("span",{style:{color:"#24292E"}},"(passwordForm, passwordDb);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"!"),t("span",{style:{color:"#24292E"}},"matches){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"账号或密码错误"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," user;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),PE=t("p",null,"小技巧：目前账号密码方式添加了验证码校验，为了后期获取令牌方便可以重新定义一个不需要验证码校验的认证类AuthService ，AuthService 中去掉验证码的校验，方便生成令牌。",-1),ME={id:"_3-5-3-账号密码认证测试",tabindex:"-1"},TE=t("strong",null,"3.5.3 账号密码认证测试",-1),OE=t("figure",null,[t("img",{alt:"image-20230705224731189",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224731189.png"})],-1),zE=t("p",null,"2、首先测试验证码，分别输入正确的验证码和错误的验证码进行测试",-1),RE=t("p",null,"3、输入正确的账号密码和错误的账号密码进行测试",-1),LE=t("p",null,"登录成功将jwt令牌存储cookie.",-1),WE=t("p",null,"4、测试自动登录",-1),NE=t("p",null,"勾选自动登录cookie生成时间为30天，不勾选自动登录关闭浏览器窗口后自动删除cookie。",-1),JE={id:"_4-微信扫码登录",tabindex:"-1"},XE=t("strong",null,"4 微信扫码登录",-1),qE={id:"_4-1-接入规范",tabindex:"-1"},GE=t("strong",null,"4.1 接入规范",-1),KE={id:"_4-1-1-接入流程",tabindex:"-1"},VE=t("strong",null,"4.1.1 接入流程",-1),HE=t("p",null,"微信扫码登录基于OAuth2协议的授权码模式，",-1),ZE=t("p",null,"接口文档：",-1),QE=t("p",null,"流程如下：",-1),YE=t("figure",null,[t("img",{alt:"image-20230705224756059",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224756059.png"})],-1),$E=t("p",null,"第三方应用获取access_token令牌后即可请求微信获取用户的信息，成功获取到用户的信息表示用户在第三方应用认证成功。",-1),sy={id:"_4-1-2-请求获取授权码",tabindex:"-1"},ly=t("strong",null,"4.1.2 请求获取授权码",-1),oy=t("code",null,"scope=snsapi_login",-1),ny=t("code",null,"redirect_uri",-1),ey=t("code",null,"snsapi_login",-1),ay=t("p",null,[t("strong",null,"参数说明")],-1),cy=t("figure",null,[t("img",{alt:"image-20230705224807325",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705224807325.png"})],-1),ty=t("p",null,[t("strong",null,"返回说明")],-1),py=t("p",null,[p("用户允许授权后，将会重定向到"),t("code",null,"redirect_uri"),p("的网址上，并且带上 code 和state参数")],-1),ry=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"redirect_uri?code=CODE&state=STATE")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"redirect_uri?code=CODE&state=STATE")])])]),t("button",{class:"collapse"})],-1),Ey=t("p",null,"若用户禁止授权，则不会发生重定向。",-1),yy=t("p",null,"步骤1：在页面中先引入如下 JS 文件（支持https）：",-1),iy=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js")])])]),t("button",{class:"collapse"})],-1),uy=t("p",null,"步骤2：在需要使用微信登录的地方实例以下 JS 对象：",-1),Fy=t("div",{style:{"max-height":"300px"},class:"language-js"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"js"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"var"),t("span",{style:{color:"#E1E4E8"}}," obj "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WxLogin"),t("span",{style:{color:"#E1E4E8"}},"({")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," self_redirect:"),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," id:"),t("span",{style:{color:"#9ECBFF"}},'"login_container"'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," appid: "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," scope: "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," redirect_uri: "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  state: "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," style: "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," href: "),t("span",{style:{color:"#9ECBFF"}},'""')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," });")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"var"),t("span",{style:{color:"#24292E"}}," obj "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WxLogin"),t("span",{style:{color:"#24292E"}},"({")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," self_redirect:"),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," id:"),t("span",{style:{color:"#032F62"}},'"login_container"'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," appid: "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," scope: "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," redirect_uri: "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  state: "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," style: "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," href: "),t("span",{style:{color:"#032F62"}},'""')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," });")])])]),t("button",{class:"collapse"})],-1),dy=t("figure",null,[t("img",{alt:"image-20230705225019477",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225019477.png"})],-1),gy={id:"_4-1-3-通过-code-获取access-token",tabindex:"-1"},hy=t("strong",null,"4.1.3 通过 code 获取access_token",-1),Ay=t("p",null,[p("通过 code 获取"),t("code",null,"access_token")],-1),Dy=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code")])])]),t("button",{class:"collapse"})],-1),Cy=t("figure",null,[t("img",{alt:"image-20230705225158430",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225158430.png"})],-1),my=t("p",null,[t("strong",null,"返回说明")],-1),by=t("p",null,"正确的返回：",-1),By=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{ ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},'"access_token"'),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#9ECBFF"}},'"ACCESS_TOKEN"'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},'"expires_in"'),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#79B8FF"}},"7200"),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},'"refresh_token"'),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#9ECBFF"}},'"REFRESH_TOKEN"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},'"openid"'),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#9ECBFF"}},'"OPENID"'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},'"scope"'),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#9ECBFF"}},'"SCOPE"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#79B8FF"}},'"unionid"'),t("span",{style:{color:"#E1E4E8"}},": "),t("span",{style:{color:"#9ECBFF"}},'"o6_bmasdasdsad6_2sgVt7hMZOPfL"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{ ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},'"access_token"'),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#032F62"}},'"ACCESS_TOKEN"'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},'"expires_in"'),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#005CC5"}},"7200"),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},'"refresh_token"'),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#032F62"}},'"REFRESH_TOKEN"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},'"openid"'),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#032F62"}},'"OPENID"'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},'"scope"'),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#032F62"}},'"SCOPE"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#005CC5"}},'"unionid"'),t("span",{style:{color:"#24292E"}},": "),t("span",{style:{color:"#032F62"}},'"o6_bmasdasdsad6_2sgVt7hMZOPfL"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),ky=t("p",null,[t("strong",null,"参数说明")],-1),Sy=t("figure",null,[t("img",{alt:"image-20230705225227368",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225227368.png"})],-1),vy=t("p",null,"错误返回样例：",-1),xy=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{"),t("span",{style:{color:"#79B8FF"}},'"errcode"'),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#79B8FF"}},"40029"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#79B8FF"}},'"errmsg"'),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#9ECBFF"}},'"invalid code"'),t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{"),t("span",{style:{color:"#005CC5"}},'"errcode"'),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#005CC5"}},"40029"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#005CC5"}},'"errmsg"'),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#032F62"}},'"invalid code"'),t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),fy={id:"_4-1-4-通过access-token调用接口",tabindex:"-1"},_y=t("strong",null,"4.1.4 通过access_token调用接口",-1),wy=t("p",null,"获取access_token后，进行接口调用，有以下前提：",-1),Uy=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"access_token有效且未超时；")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"微信用户已授权给第三方应用帐号相应接口作用域（scope）。")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"access_token有效且未超时；")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"微信用户已授权给第三方应用帐号相应接口作用域（scope）。")])])]),t("button",{class:"collapse"})],-1),Iy=t("p",null,"对于接口作用域（scope），能调用的接口有以下：",-1),jy=t("figure",null,[t("img",{alt:"image-20230705225242753",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225242753.png"})],-1),Py=t("code",null,"snsapi_base",-1),My=t("code",null,"snsapi_base",-1),Ty=t("code",null,"snsapi_base",-1),Oy=t("code",null,"snsapi_base",-1),zy=t("p",null,"接口地址",-1),Ry=t("div",{style:{"max-height":"300px"},class:"language-http"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"http"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#85E89D"}},"http请求方式"),t("span",{style:{color:"#F97583"}},":"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"GET")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&openid=OPENID")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#22863A"}},"http请求方式"),t("span",{style:{color:"#D73A49"}},":"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"GET")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&openid=OPENID")])])]),t("button",{class:"collapse"})],-1),Ly=t("p",null,"如下：",-1),Wy=t("figure",null,[t("img",{alt:"image-20230705225302910",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225302910.png"})],-1),Ny=t("p",null,"响应：",-1),Jy=t("figure",null,[t("img",{alt:"image-20230705225337018",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225337018.png"})],-1),Xy=t("p",null,"说明如下：",-1),qy=t("blockquote",null,[t("p",null,"参数 说明 openid 普通用户的标识，对当前开发者帐号唯一 nickname 普通用户昵称 sex 普通用户性别，1为男性，2为女性 province 普通用户个人资料填写的省份 city 普通用户个人资料填写的城市 country 国家，如中国为CN headimgurl 用户头像，最后一个数值代表正方形头像大小（有0、46、64、96、132数值可选，0代表640*640正方形头像），用户没有头像时该项为空 privilege 用户特权信息，json数组，如微信沃卡用户为（chinaunicom） unionid 用户统一标识。针对一个微信开放平台帐号下的应用，同一用户的 unionid 是唯一的。")],-1),Gy={id:"_4-2-准备开发环境",tabindex:"-1"},Ky=t("strong",null,"4.2 准备开发环境",-1),Vy={id:"_4-2-1-添加应用",tabindex:"-1"},Hy=t("strong",null,"4.2.1 添加应用",-1),Zy=t("p",null,"1、注册微信开放平台",-1),Qy=t("p",null,"2、添加应用",-1),Yy=t("p",null,"进入网站应用，添加应用",-1),$y=t("figure",null,[t("img",{alt:"img",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225407356.png"})],-1),si=t("p",null,"3、添加应用需要指定一个外网域名作为微信回调域名",-1),li=t("p",null,"审核通过后，生成app密钥。",-1),oi=t("p",null,"最终获取appID和AppSecret",-1),ni={id:"_4-2-2-内网穿透",tabindex:"-1"},ei=t("strong",null,"4.2.2 内网穿透",-1),ai=t("p",null,"我们的开发环境在局域网，微信回调指向一个公网域名。",-1),ci=t("p",null,"如何让微信回调请求至我们的开发计算机上呢？",-1),ti=t("p",null,"可以使用内网穿透技术，什么是内网穿透？",-1),pi=t("p",null,"内网穿透简单来说就是将内网外网通过隧道打通,让内网的数据让外网可以获取。比如常用的办公室软件等，一般在办公室或家里，通过拨号上网，这样办公软件只有在本地的局域网之内才能访问，那么问题来了，如果是手机上，或者公司外地的办公人员，如何访问到办公软件呢？这就需要内网穿透工具了。开启隧道之后，网穿透工具会分配一个专属域名/端口,办公软件就已经在公网上了,在外地的办公人员可以在任何地方愉快的访问办公软件了~~",-1),ri=t("figure",null,[t("img",{alt:"image-20230705225437784",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225437784.png"})],-1),Ei=t("p",null,"1、在内网穿透服务器上开通隧道，配置外网域名，配置穿透内网的端口即本地电脑上的端口。",-1),yi=t("figure",null,[t("img",{alt:"image-20230705225502880",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225502880.png"})],-1),ii=t("p",null,"这里我们配置认证服务端口，最终实现通过外网域名访问本地认证服务。",-1),ui=t("p",null,"2、在本地电脑上安装内网穿透的工具，工具上配置内网穿透服务器隧道token。",-1),Fi=t("p",null,"市面上做内网穿透的商家很多，需要时可以查阅资料了解下。",-1),di={id:"_4-2-3-无需使用内网穿透-固定端口",tabindex:"-1"},gi=t("p",null,"认证授权服务使用谷粒的固定端口8160",-1),hi=t("p",null,[p("在"),t("code",null,"nacos"),p("配置中心配置")],-1),Ai=t("div",{style:{"max-height":"300px"},class:"language-properties"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"properties"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"#微信相关配置")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"# 微信开放平台 appid")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"wx.open.app_id"),t("span",{style:{color:"#E1E4E8"}},"=wxed9954c01bb89b47")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"# 微信开放平台 appsecret")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"wx.open.app_secret"),t("span",{style:{color:"#E1E4E8"}},"=a7482517235173ddb4083788de60b90e")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"# 微信开放平台 重定向url")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"wx.open.redirect_url"),t("span",{style:{color:"#E1E4E8"}},"=http://localhost:8160/auth/wxLogin")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"#微信相关配置")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"# 微信开放平台 appid")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"wx.open.app_id"),t("span",{style:{color:"#24292E"}},"=wxed9954c01bb89b47")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"# 微信开放平台 appsecret")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"wx.open.app_secret"),t("span",{style:{color:"#24292E"}},"=a7482517235173ddb4083788de60b90e")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"# 微信开放平台 重定向url")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"wx.open.redirect_url"),t("span",{style:{color:"#24292E"}},"=http://localhost:8160/auth/wxLogin")])])]),t("button",{class:"collapse"})],-1),Di=t("p",null,[p("修改"),t("code",null,"wxsign.html"),p("中的"),t("code",null,"appid"),p("和"),t("code",null,"redirect_uri")],-1),Ci=t("div",{style:{"max-height":"300px"},class:"language-js"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"js"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//请用微信生成二维码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"function"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"generateWxQrcode"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#FFAB70"}},"token"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"var"),t("span",{style:{color:"#E1E4E8"}}," wxObj "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WxLogin"),t("span",{style:{color:"#E1E4E8"}},"({")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        self_redirect:"),t("span",{style:{color:"#79B8FF"}},"true"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        id:"),t("span",{style:{color:"#9ECBFF"}},'"login_container"'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        appid: "),t("span",{style:{color:"#9ECBFF"}},'"wxed9954c01bb89b47"'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        scope: "),t("span",{style:{color:"#9ECBFF"}},'"snsapi_login"'),t("span",{style:{color:"#E1E4E8"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},'// redirect_uri: "http://rcar79.natappfree.cc/xuecheng/auth/wxLogin",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},'// redirect_uri: "http://tjxt-user-t.itheima.net/api/auth/wxLogin",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        redirect_uri: "),t("span",{style:{color:"#9ECBFF"}},'"http://localhost:8160/auth/wxLogin"'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        state: token,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        style: "),t("span",{style:{color:"#9ECBFF"}},'""'),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        href: "),t("span",{style:{color:"#9ECBFF"}},'""')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//请用微信生成二维码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"function"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"generateWxQrcode"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#E36209"}},"token"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"var"),t("span",{style:{color:"#24292E"}}," wxObj "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WxLogin"),t("span",{style:{color:"#24292E"}},"({")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        self_redirect:"),t("span",{style:{color:"#005CC5"}},"true"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        id:"),t("span",{style:{color:"#032F62"}},'"login_container"'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        appid: "),t("span",{style:{color:"#032F62"}},'"wxed9954c01bb89b47"'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        scope: "),t("span",{style:{color:"#032F62"}},'"snsapi_login"'),t("span",{style:{color:"#24292E"}},", ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},'// redirect_uri: "http://rcar79.natappfree.cc/xuecheng/auth/wxLogin",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},'// redirect_uri: "http://tjxt-user-t.itheima.net/api/auth/wxLogin",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        redirect_uri: "),t("span",{style:{color:"#032F62"}},'"http://localhost:8160/auth/wxLogin"'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        state: token,")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        style: "),t("span",{style:{color:"#032F62"}},'""'),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        href: "),t("span",{style:{color:"#032F62"}},'""')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),mi=t("blockquote",null,[t("p",null,"在测试过程中，要么启动验证码服务，要么屏蔽验证码检验代码，否则登录二维码无法生成")],-1),bi={id:"_4-3-接入微信登录",tabindex:"-1"},Bi=t("strong",null,"4.3 接入微信登录",-1),ki={id:"_4-3-1-接入分析",tabindex:"-1"},Si=t("strong",null,"4.3.1 接入分析",-1),vi=t("p",null,"根据OAuth2协议授权码流程，结合本项目自身特点，分析接入微信扫码登录的流程如下：",-1),xi=t("figure",null,[t("img",{alt:"image-20230705225519898",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225519898.png"})],-1),fi=t("p",null,"本项目认证服务需要做哪些事？",-1),_i=t("p",null,"1、需要定义接口接收微信下发的授权码。",-1),wi=t("p",null,"2、收到授权码调用微信接口申请令牌。",-1),Ui=t("p",null,"3、申请到令牌调用微信获取用户信息",-1),Ii=t("p",null,"4、获取用户信息成功将其写入本项目用户中心数据库。",-1),ji=t("p",null,"5、最后重定向到浏览器自动登录。",-1),Pi={id:"_4-3-2-定义接口",tabindex:"-1"},Mi=t("strong",null,"4.3.2 定义接口",-1),Ti=t("p",null,"参考接口规范中“请求获取授权码” 定义接收微信下发的授权码接口，",-1),Oi=t("p",null,"定义WxLoginController类，如下：",-1),zi=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Controller")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WxLoginController"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/wxLogin"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"wxLogin"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},", String "),t("span",{style:{color:"#FFAB70"}},"state"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"微信扫码回调,code:{},state:{}"'),t("span",{style:{color:"#E1E4E8"}},",code,state);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//请求微信申请令牌，拿到令牌查询用户信息，将用户信息写入本项目数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUser xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//暂时硬编写，目的是调试环境")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        xcUser."),t("span",{style:{color:"#B392F0"}},"setUsername"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"t1"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(xcUser"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"redirect:http://www.51xuecheng.cn/error.html"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String username "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUser."),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"redirect:http://www.51xuecheng.cn/sign.html?username="'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"username"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#9ECBFF"}},'"&authType=wx"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Controller")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WxLoginController"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/wxLogin"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"wxLogin"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},", String "),t("span",{style:{color:"#E36209"}},"state"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"微信扫码回调,code:{},state:{}"'),t("span",{style:{color:"#24292E"}},",code,state);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//请求微信申请令牌，拿到令牌查询用户信息，将用户信息写入本项目数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUser xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUser"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//暂时硬编写，目的是调试环境")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        xcUser."),t("span",{style:{color:"#6F42C1"}},"setUsername"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"t1"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(xcUser"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"redirect:http://www.51xuecheng.cn/error.html"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String username "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUser."),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"redirect:http://www.51xuecheng.cn/sign.html?username="'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"username"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#032F62"}},'"&authType=wx"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ri=t("p",null,"定义微信认证的service",-1),Li=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 微信扫码认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Service"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"wx_authservice"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WxAuthServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUserExt "),t("span",{style:{color:"#B392F0"}},"execute"),t("span",{style:{color:"#E1E4E8"}},"(AuthParamsDto "),t("span",{style:{color:"#FFAB70"}},"authParamsDto"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String username "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," authParamsDto."),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUserMapper."),t("span",{style:{color:"#B392F0"}},"selectOne"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(XcUser"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(user"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"throw"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RuntimeException"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"账号不存在"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUserExt xcUserExt "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUserExt"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        BeanUtils."),t("span",{style:{color:"#B392F0"}},"copyProperties"),t("span",{style:{color:"#E1E4E8"}},"(user,xcUserExt);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUserExt;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 微信扫码认证")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Service"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"wx_authservice"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WxAuthServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUserExt "),t("span",{style:{color:"#6F42C1"}},"execute"),t("span",{style:{color:"#24292E"}},"(AuthParamsDto "),t("span",{style:{color:"#E36209"}},"authParamsDto"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//账号")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String username "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," authParamsDto."),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"selectOne"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"XcUser"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(XcUser"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getUsername, username));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(user"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#6A737D"}},"//返回空表示用户不存在")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"throw"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RuntimeException"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"账号不存在"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUserExt xcUserExt "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUserExt"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        BeanUtils."),t("span",{style:{color:"#6F42C1"}},"copyProperties"),t("span",{style:{color:"#24292E"}},"(user,xcUserExt);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUserExt;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Wi={id:"_4-3-3-接口环境测试",tabindex:"-1"},Ni=t("strong",null,"4.3.3 接口环境测试",-1),Ji=t("p",null,"接口定义好下边进行测试下，主要目的是测试接口调度的环境。",-1),Xi=t("p",null,"1、启动内网穿透工具",-1),qi=t("p",null,"2、在/wxLogin接口中打断点",-1),Gi=t("p",null,"3、打开前端微信扫码页面",-1),Ki=t("figure",null,[t("img",{alt:"image-20230705225557340",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225557340.png"})],-1),Vi=t("p",null,"点击微信图标打开二维码",-1),Hi=t("figure",null,[t("img",{alt:"image-20230705225604434",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225604434.png"})],-1),Zi=t("p",null,"用户扫码，确认授权",-1),Qi=t("code",null,"/wxLogin",-1),Yi={id:"_4-3-4-申请令牌",tabindex:"-1"},$i=t("strong",null,"4.3.4 申请令牌",-1),su=t("p",null,"接下来请求微信申请令牌。",-1),lu=t("p",null,"1、使用restTemplate请求微信，配置RestTemplate bean",-1),ou=t("p",null,"在启动类配置restTemplate",-1),nu=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    RestTemplate "),t("span",{style:{color:"#B392F0"}},"restTemplate"),t("span",{style:{color:"#E1E4E8"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        RestTemplate restTemplate "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RestTemplate"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"OkHttp3ClientHttpRequestFactory"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}},"  restTemplate;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Bean")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    RestTemplate "),t("span",{style:{color:"#6F42C1"}},"restTemplate"),t("span",{style:{color:"#24292E"}},"(){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        RestTemplate restTemplate "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RestTemplate"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"OkHttp3ClientHttpRequestFactory"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}},"  restTemplate;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")])])]),t("button",{class:"collapse"})],-1),eu=t("p",null,"定义与微信认证的service接口：",-1),au=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 微信认证接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"interface"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WxAuthService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"wxAuth"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * @description 微信认证接口")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," */")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"interface"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WxAuthService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"wxAuth"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),cu=t("p",null,"继续在WxAuthServiceImpl类写WxAuthService 接口的实现，在其中定义申请令牌的私有方法并由wxAuth方法去调用：",-1),tu=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Service"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"wx_authservice"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WxAuthServiceImpl"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"implements"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"AuthService"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#B392F0"}},"WxAuthService"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"RestTemplate restTemplate;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Value"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"${weixin.appid}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"String appid;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Value"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"${weixin.secret}"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"String secret;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"wxAuth"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//收到code调用微信接口申请access_token")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> access_token_map "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getAccess_token"),t("span",{style:{color:"#E1E4E8"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(access_token_map"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//获取用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//添加用户到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUser xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 申请访问令牌,响应示例")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "access_token":"ACCESS_TOKEN",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "expires_in":7200,')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "refresh_token":"REFRESH_TOKEN",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "openid":"OPENID",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "scope":"SCOPE",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "unionid": "o6_bmasdasdsad6_2sgVt7hMZOPfL"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> "),t("span",{style:{color:"#B392F0"}},"getAccess_token"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String wxUrl_template "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"https://api.weixin.qq.com/sns/oauth2/access_token?appid=%s&secret=%s&code=%s&grant_type=authorization_code"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//请求微信地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String wxUrl "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," String."),t("span",{style:{color:"#B392F0"}},"format"),t("span",{style:{color:"#E1E4E8"}},"(wxUrl_template, appid, secret, code);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    log."),t("span",{style:{color:"#B392F0"}},"info"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"调用微信接口申请access_token, url:{}"'),t("span",{style:{color:"#E1E4E8"}},", wxUrl);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ResponseEntity<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> exchange "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," restTemplate."),t("span",{style:{color:"#B392F0"}},"exchange"),t("span",{style:{color:"#E1E4E8"}},"(wxUrl, HttpMethod.POST, "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},", String.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String result "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," exchange."),t("span",{style:{color:"#B392F0"}},"getBody"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    log."),t("span",{style:{color:"#B392F0"}},"info"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"调用微信接口申请access_token: 返回值:{}"'),t("span",{style:{color:"#E1E4E8"}},", result);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> resultMap "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"parseObject"),t("span",{style:{color:"#E1E4E8"}},"(result, Map.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," resultMap;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"....")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Service"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"wx_authservice"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WxAuthServiceImpl"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"implements"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"AuthService"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#6F42C1"}},"WxAuthService"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"XcUserMapper xcUserMapper;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"RestTemplate restTemplate;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Value"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"${weixin.appid}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"String appid;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Value"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"${weixin.secret}"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"String secret;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"wxAuth"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//收到code调用微信接口申请access_token")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> access_token_map "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getAccess_token"),t("span",{style:{color:"#24292E"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(access_token_map"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//获取用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//添加用户到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUser xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," * 申请访问令牌,响应示例")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "access_token":"ACCESS_TOKEN",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "expires_in":7200,')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "refresh_token":"REFRESH_TOKEN",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "openid":"OPENID",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "scope":"SCOPE",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "unionid": "o6_bmasdasdsad6_2sgVt7hMZOPfL"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> "),t("span",{style:{color:"#6F42C1"}},"getAccess_token"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},") {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String wxUrl_template "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"https://api.weixin.qq.com/sns/oauth2/access_token?appid=%s&secret=%s&code=%s&grant_type=authorization_code"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//请求微信地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String wxUrl "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," String."),t("span",{style:{color:"#6F42C1"}},"format"),t("span",{style:{color:"#24292E"}},"(wxUrl_template, appid, secret, code);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    log."),t("span",{style:{color:"#6F42C1"}},"info"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"调用微信接口申请access_token, url:{}"'),t("span",{style:{color:"#24292E"}},", wxUrl);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ResponseEntity<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> exchange "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," restTemplate."),t("span",{style:{color:"#6F42C1"}},"exchange"),t("span",{style:{color:"#24292E"}},"(wxUrl, HttpMethod.POST, "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},", String.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String result "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," exchange."),t("span",{style:{color:"#6F42C1"}},"getBody"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    log."),t("span",{style:{color:"#6F42C1"}},"info"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"调用微信接口申请access_token: 返回值:{}"'),t("span",{style:{color:"#24292E"}},", result);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> resultMap "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"parseObject"),t("span",{style:{color:"#24292E"}},"(result, Map.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," resultMap;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"....")])])]),t("button",{class:"collapse"})],-1),pu=t("p",null,"下边在controller中调用wxAuth接口：",-1),ru=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Controller")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"class"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"WxLoginController"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    WxAuthService wxAuthService;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"RequestMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/wxLogin"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," String "),t("span",{style:{color:"#B392F0"}},"wxLogin"),t("span",{style:{color:"#E1E4E8"}},"(String "),t("span",{style:{color:"#FFAB70"}},"code"),t("span",{style:{color:"#E1E4E8"}},", String "),t("span",{style:{color:"#FFAB70"}},"state"),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"throws"),t("span",{style:{color:"#E1E4E8"}}," IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        log."),t("span",{style:{color:"#B392F0"}},"debug"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"微信扫码回调,code:{},state:{}"'),t("span",{style:{color:"#E1E4E8"}},",code,state);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//请求微信申请令牌，拿到令牌查询用户信息，将用户信息写入本项目数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        XcUser xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," wxAuthService."),t("span",{style:{color:"#B392F0"}},"wxAuth"),t("span",{style:{color:"#E1E4E8"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(xcUser"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"redirect:http://www.51xuecheng.cn/error.html"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        String username "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUser."),t("span",{style:{color:"#B392F0"}},"getUsername"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"redirect:http://www.51xuecheng.cn/sign.html?username="'),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#E1E4E8"}},"username"),t("span",{style:{color:"#F97583"}},"+"),t("span",{style:{color:"#9ECBFF"}},'"&authType=wx"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Slf4j")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Controller")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"class"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"WxLoginController"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    WxAuthService wxAuthService;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"RequestMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/wxLogin"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," String "),t("span",{style:{color:"#6F42C1"}},"wxLogin"),t("span",{style:{color:"#24292E"}},"(String "),t("span",{style:{color:"#E36209"}},"code"),t("span",{style:{color:"#24292E"}},", String "),t("span",{style:{color:"#E36209"}},"state"),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"throws"),t("span",{style:{color:"#24292E"}}," IOException {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        log."),t("span",{style:{color:"#6F42C1"}},"debug"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"微信扫码回调,code:{},state:{}"'),t("span",{style:{color:"#24292E"}},",code,state);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//请求微信申请令牌，拿到令牌查询用户信息，将用户信息写入本项目数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        XcUser xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," wxAuthService."),t("span",{style:{color:"#6F42C1"}},"wxAuth"),t("span",{style:{color:"#24292E"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(xcUser"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"redirect:http://www.51xuecheng.cn/error.html"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        String username "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUser."),t("span",{style:{color:"#6F42C1"}},"getUsername"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"redirect:http://www.51xuecheng.cn/sign.html?username="'),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#24292E"}},"username"),t("span",{style:{color:"#D73A49"}},"+"),t("span",{style:{color:"#032F62"}},'"&authType=wx"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Eu=t("p",null,"测试获取用户信息",-1),yu=t("p",null,"1、在wxAuthService中获取用户信息处打断点",-1),iu=t("p",null,"3、手机扫码并授权，观察是否成功申请到令牌",-1),uu={id:"_4-3-5-获取用户信息",tabindex:"-1"},Fu=t("strong",null,"4.3.5 获取用户信息",-1),du=t("p",null,"在WxAuthServiceImpl类中定义获取用户信息方法：",-1),gu=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**获取用户信息，示例如下：")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "openid":"OPENID",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "nickname":"NICKNAME",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "sex":1,')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "province":"PROVINCE",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "city":"CITY",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "country":"COUNTRY",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "headimgurl": "https://thirdwx.qlogo.cn/mmopen/g3MonUZtNHkdmzicIlibx6iaFqAc56vxLSUfpb6n5WKSYVY0ChQKkiaJSgQ1dZuTOgvLLrhJbERQQ4eMsv84eavHiaiceqxibJxCfHe/0",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "privilege":[')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "PRIVILEGE1",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "PRIVILEGE2"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "unionid": " o6_bmasdasdsad6_2sgVt7hMZOPfL"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"private"),t("span",{style:{color:"#E1E4E8"}}," Map"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"String,String"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getUserinfo"),t("span",{style:{color:"#E1E4E8"}},"(String access_token,String openid) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String wxUrl_template "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},'"https://api.weixin.qq.com/sns/userinfo?access_token=%s&openid=%s"'),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//请求微信地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String wxUrl "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," String."),t("span",{style:{color:"#B392F0"}},"format"),t("span",{style:{color:"#E1E4E8"}},"(wxUrl_template, access_token,openid);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    log."),t("span",{style:{color:"#B392F0"}},"info"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"调用微信接口申请access_token, url:{}"'),t("span",{style:{color:"#E1E4E8"}},", wxUrl);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ResponseEntity<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> exchange "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," restTemplate."),t("span",{style:{color:"#B392F0"}},"exchange"),t("span",{style:{color:"#E1E4E8"}},"(wxUrl, HttpMethod.POST, "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},", String.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//防止乱码进行转码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String result "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}},"     "),t("span",{style:{color:"#B392F0"}},"String"),t("span",{style:{color:"#E1E4E8"}},"(exchange."),t("span",{style:{color:"#B392F0"}},"getBody"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"getBytes"),t("span",{style:{color:"#E1E4E8"}},"(StandardCharsets.ISO_8859_1),StandardCharsets.UTF_8);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    log."),t("span",{style:{color:"#B392F0"}},"info"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"调用微信接口申请access_token: 返回值:{}"'),t("span",{style:{color:"#E1E4E8"}},", result);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},","),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> resultMap "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"parseObject"),t("span",{style:{color:"#E1E4E8"}},"(result, Map.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," resultMap;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"/**获取用户信息，示例如下：")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "openid":"OPENID",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "nickname":"NICKNAME",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "sex":1,')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "province":"PROVINCE",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "city":"CITY",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "country":"COUNTRY",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "headimgurl": "https://thirdwx.qlogo.cn/mmopen/g3MonUZtNHkdmzicIlibx6iaFqAc56vxLSUfpb6n5WKSYVY0ChQKkiaJSgQ1dZuTOgvLLrhJbERQQ4eMsv84eavHiaiceqxibJxCfHe/0",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "privilege":[')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "PRIVILEGE1",')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "PRIVILEGE2"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," ],")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},' "unionid": " o6_bmasdasdsad6_2sgVt7hMZOPfL"')]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}}," }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"*/")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"private"),t("span",{style:{color:"#24292E"}}," Map"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"String,String"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getUserinfo"),t("span",{style:{color:"#24292E"}},"(String access_token,String openid) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String wxUrl_template "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},'"https://api.weixin.qq.com/sns/userinfo?access_token=%s&openid=%s"'),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//请求微信地址")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String wxUrl "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," String."),t("span",{style:{color:"#6F42C1"}},"format"),t("span",{style:{color:"#24292E"}},"(wxUrl_template, access_token,openid);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    log."),t("span",{style:{color:"#6F42C1"}},"info"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"调用微信接口申请access_token, url:{}"'),t("span",{style:{color:"#24292E"}},", wxUrl);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ResponseEntity<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> exchange "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," restTemplate."),t("span",{style:{color:"#6F42C1"}},"exchange"),t("span",{style:{color:"#24292E"}},"(wxUrl, HttpMethod.POST, "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},", String.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//防止乱码进行转码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String result "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}},"     "),t("span",{style:{color:"#6F42C1"}},"String"),t("span",{style:{color:"#24292E"}},"(exchange."),t("span",{style:{color:"#6F42C1"}},"getBody"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"getBytes"),t("span",{style:{color:"#24292E"}},"(StandardCharsets.ISO_8859_1),StandardCharsets.UTF_8);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    log."),t("span",{style:{color:"#6F42C1"}},"info"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"调用微信接口申请access_token: 返回值:{}"'),t("span",{style:{color:"#24292E"}},", result);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},","),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> resultMap "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"parseObject"),t("span",{style:{color:"#24292E"}},"(result, Map.class);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," resultMap;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),hu=t("p",null,"调用获取用户信息。",-1),Au=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"wxAuth"),t("span",{style:{color:"#E1E4E8"}},"(String code){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//收到code调用微信接口申请access_token")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> access_token_map "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getAccess_token"),t("span",{style:{color:"#E1E4E8"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(access_token_map"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"(access_token_map);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String openid "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," access_token_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"openid"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String access_token "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," access_token_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"access_token"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//拿access_token查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> userinfo "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getUserinfo"),t("span",{style:{color:"#E1E4E8"}},"(access_token, openid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(userinfo"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//添加用户到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUser xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"wxAuth"),t("span",{style:{color:"#24292E"}},"(String code){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//收到code调用微信接口申请access_token")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> access_token_map "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getAccess_token"),t("span",{style:{color:"#24292E"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(access_token_map"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"(access_token_map);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String openid "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," access_token_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"openid"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String access_token "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," access_token_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"access_token"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//拿access_token查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> userinfo "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getUserinfo"),t("span",{style:{color:"#24292E"}},"(access_token, openid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(userinfo"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//添加用户到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUser xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Du=t("p",null,"测试获取用户信息",-1),Cu=t("p",null,"1、在获取用户信息处打断点",-1),mu=t("p",null,"3、手机扫码授权",-1),bu={id:"_4-3-6-保存用户信息",tabindex:"-1"},Bu=t("strong",null,"4.3.6 保存用户信息",-1),ku=t("p",null,"向数据库保存用户信息，如果用户不存在将其保存在数据库。",-1),Su=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"XcUserRoleMapper xcUserRoleMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"addWxUser"),t("span",{style:{color:"#E1E4E8"}},"(Map userInfo_map){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String unionid "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," userInfo_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"unionid"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//根据unionid查询数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUser xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," xcUserMapper."),t("span",{style:{color:"#B392F0"}},"selectOne"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},">()."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(XcUser"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getWxUnionid, unionid));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(xcUser"),t("span",{style:{color:"#F97583"}},"!="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String userId "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," UUID."),t("span",{style:{color:"#B392F0"}},"randomUUID"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUser"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setId"),t("span",{style:{color:"#E1E4E8"}},"(userId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setWxUnionid"),t("span",{style:{color:"#E1E4E8"}},"(unionid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//记录从微信得到的昵称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setNickname"),t("span",{style:{color:"#E1E4E8"}},"(userInfo_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"nickname"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setUserpic"),t("span",{style:{color:"#E1E4E8"}},"(userInfo_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"headimgurl"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setName"),t("span",{style:{color:"#E1E4E8"}},"(userInfo_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"nickname"'),t("span",{style:{color:"#E1E4E8"}},")."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setUsername"),t("span",{style:{color:"#E1E4E8"}},"(unionid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setPassword"),t("span",{style:{color:"#E1E4E8"}},"(unionid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setUtype"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"101001"'),t("span",{style:{color:"#E1E4E8"}},");"),t("span",{style:{color:"#6A737D"}},"//学生类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setStatus"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"1"'),t("span",{style:{color:"#E1E4E8"}},");"),t("span",{style:{color:"#6A737D"}},"//用户状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUser."),t("span",{style:{color:"#B392F0"}},"setCreateTime"),t("span",{style:{color:"#E1E4E8"}},"(LocalDateTime."),t("span",{style:{color:"#B392F0"}},"now"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUserMapper."),t("span",{style:{color:"#B392F0"}},"insert"),t("span",{style:{color:"#E1E4E8"}},"(xcUser);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUserRole xcUserRole "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcUserRole"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUserRole."),t("span",{style:{color:"#B392F0"}},"setId"),t("span",{style:{color:"#E1E4E8"}},"(UUID."),t("span",{style:{color:"#B392F0"}},"randomUUID"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"toString"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUserRole."),t("span",{style:{color:"#B392F0"}},"setUserId"),t("span",{style:{color:"#E1E4E8"}},"(userId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUserRole."),t("span",{style:{color:"#B392F0"}},"setRoleId"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"17"'),t("span",{style:{color:"#E1E4E8"}},");"),t("span",{style:{color:"#6A737D"}},"//学生角色")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    xcUserRoleMapper."),t("span",{style:{color:"#B392F0"}},"insert"),t("span",{style:{color:"#E1E4E8"}},"(xcUserRole);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"XcUserRoleMapper xcUserRoleMapper;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Transactional")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"addWxUser"),t("span",{style:{color:"#24292E"}},"(Map userInfo_map){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String unionid "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," userInfo_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"unionid"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//根据unionid查询数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUser xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"selectOne"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"XcUser"),t("span",{style:{color:"#24292E"}},">()."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(XcUser"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getWxUnionid, unionid));")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(xcUser"),t("span",{style:{color:"#D73A49"}},"!="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String userId "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," UUID."),t("span",{style:{color:"#6F42C1"}},"randomUUID"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUser"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setId"),t("span",{style:{color:"#24292E"}},"(userId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setWxUnionid"),t("span",{style:{color:"#24292E"}},"(unionid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//记录从微信得到的昵称")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setNickname"),t("span",{style:{color:"#24292E"}},"(userInfo_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"nickname"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setUserpic"),t("span",{style:{color:"#24292E"}},"(userInfo_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"headimgurl"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setName"),t("span",{style:{color:"#24292E"}},"(userInfo_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"nickname"'),t("span",{style:{color:"#24292E"}},")."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setUsername"),t("span",{style:{color:"#24292E"}},"(unionid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setPassword"),t("span",{style:{color:"#24292E"}},"(unionid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setUtype"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"101001"'),t("span",{style:{color:"#24292E"}},");"),t("span",{style:{color:"#6A737D"}},"//学生类型")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setStatus"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"1"'),t("span",{style:{color:"#24292E"}},");"),t("span",{style:{color:"#6A737D"}},"//用户状态")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUser."),t("span",{style:{color:"#6F42C1"}},"setCreateTime"),t("span",{style:{color:"#24292E"}},"(LocalDateTime."),t("span",{style:{color:"#6F42C1"}},"now"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUserMapper."),t("span",{style:{color:"#6F42C1"}},"insert"),t("span",{style:{color:"#24292E"}},"(xcUser);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUserRole xcUserRole "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcUserRole"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUserRole."),t("span",{style:{color:"#6F42C1"}},"setId"),t("span",{style:{color:"#24292E"}},"(UUID."),t("span",{style:{color:"#6F42C1"}},"randomUUID"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"toString"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUserRole."),t("span",{style:{color:"#6F42C1"}},"setUserId"),t("span",{style:{color:"#24292E"}},"(userId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUserRole."),t("span",{style:{color:"#6F42C1"}},"setRoleId"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"17"'),t("span",{style:{color:"#24292E"}},");"),t("span",{style:{color:"#6A737D"}},"//学生角色")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    xcUserRoleMapper."),t("span",{style:{color:"#6F42C1"}},"insert"),t("span",{style:{color:"#24292E"}},"(xcUserRole);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),vu=t("p",null,"调用保存用户信息",-1),xu=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"WxAuthServiceImpl currentProxy;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," XcUser "),t("span",{style:{color:"#B392F0"}},"wxAuth"),t("span",{style:{color:"#E1E4E8"}},"(String code){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//收到code调用微信接口申请access_token")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> access_token_map "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getAccess_token"),t("span",{style:{color:"#E1E4E8"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(access_token_map"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    System.out."),t("span",{style:{color:"#B392F0"}},"println"),t("span",{style:{color:"#E1E4E8"}},"(access_token_map);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String openid "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," access_token_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"openid"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String access_token "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," access_token_map."),t("span",{style:{color:"#B392F0"}},"get"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"access_token"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//拿access_token查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    Map<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},", "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> userinfo "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"getUserinfo"),t("span",{style:{color:"#E1E4E8"}},"(access_token, openid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(userinfo"),t("span",{style:{color:"#F97583"}},"=="),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将用户信息保存到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUser xcUser "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," currentProxy."),t("span",{style:{color:"#B392F0"}},"addWxUser"),t("span",{style:{color:"#E1E4E8"}},"(userinfo);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Autowired")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"WxAuthServiceImpl currentProxy;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," XcUser "),t("span",{style:{color:"#6F42C1"}},"wxAuth"),t("span",{style:{color:"#24292E"}},"(String code){")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//收到code调用微信接口申请access_token")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> access_token_map "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getAccess_token"),t("span",{style:{color:"#24292E"}},"(code);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(access_token_map"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    System.out."),t("span",{style:{color:"#6F42C1"}},"println"),t("span",{style:{color:"#24292E"}},"(access_token_map);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String openid "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," access_token_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"openid"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String access_token "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," access_token_map."),t("span",{style:{color:"#6F42C1"}},"get"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"access_token"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//拿access_token查询用户信息")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    Map<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},", "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> userinfo "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"getUserinfo"),t("span",{style:{color:"#24292E"}},"(access_token, openid);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(userinfo"),t("span",{style:{color:"#D73A49"}},"=="),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将用户信息保存到数据库")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUser xcUser "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," currentProxy."),t("span",{style:{color:"#6F42C1"}},"addWxUser"),t("span",{style:{color:"#24292E"}},"(userinfo);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," xcUser;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),fu=t("p",null,"测试保存用户信息",-1),_u=t("p",null,"1、在保存用户信息处打断点",-1),wu=t("p",null,"3、手机扫码授权",-1),Uu=t("p",null,"4、自动跳转到登录页面，提交认证成功。",-1),Iu={id:"_5-用户授权",tabindex:"-1"},ju=t("strong",null,"5 用户授权",-1),Pu={id:"_5-1-rbac",tabindex:"-1"},Mu=t("strong",null,"5.1 RBAC",-1),Tu=t("p",null,"如何实现授权？业界通常基于RBAC实现授权。",-1),Ou=t("p",null,"RBAC分为两种方式：",-1),zu=t("p",null,"基于角色的访问控制（Role-Based Access Control）",-1),Ru=t("p",null,"基于资源的访问控制（Resource-Based Access Control）",-1),Lu=t("p",null,"角色的访问控制（Role-Based Access Control）是按角色进行授权，比如：主体的角色为总经理可以查询企业运营报表，查询员工工资信息等，访问控制流程如下：",-1),Wu=t("figure",null,[t("img",{alt:"image-20230705225635823",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225635823.png"})],-1),Nu=t("p",null,"根据上图中的判断逻辑，授权代码可表示如下：",-1),Ju=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(主体."),t("span",{style:{color:"#B392F0"}},"hasRole"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"总经理角色id"'),t("span",{style:{color:"#E1E4E8"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"查询工资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(主体."),t("span",{style:{color:"#6F42C1"}},"hasRole"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"总经理角色id"'),t("span",{style:{color:"#24292E"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"查询工资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Xu=t("p",null,"如果上图中查询工资所需要的角色变化为总经理和部门经理，此时就需要修改判断逻辑为“判断用户的角色是否是总经理或部门经理”，修改代码如下：",-1),qu=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(主体."),t("span",{style:{color:"#B392F0"}},"hasRole"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"总经理角色id"'),t("span",{style:{color:"#E1E4E8"}},") "),t("span",{style:{color:"#F97583"}},"||"),t("span",{style:{color:"#E1E4E8"}},"  主体."),t("span",{style:{color:"#B392F0"}},"hasRole"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"部门经理角色id"'),t("span",{style:{color:"#E1E4E8"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    查询工资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(主体."),t("span",{style:{color:"#6F42C1"}},"hasRole"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"总经理角色id"'),t("span",{style:{color:"#24292E"}},") "),t("span",{style:{color:"#D73A49"}},"||"),t("span",{style:{color:"#24292E"}},"  主体."),t("span",{style:{color:"#6F42C1"}},"hasRole"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"部门经理角色id"'),t("span",{style:{color:"#24292E"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    查询工资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Gu=t("p",null,"根据上边的例子发现，当需要修改角色的权限时就需要修改授权的相关代码，系统可扩展性差。",-1),Ku=t("p",null,"基于资源的访问控制（Resource-Based Access",-1),Vu=t("p",null,"Control）是按资源（或权限）进行授权，比如：用户必须具有查询工资权限才可以查询员工工资信息等，访问控制流程如下：",-1),Hu=t("figure",null,[t("img",{alt:"image-20230705225645727",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225645727.png"})],-1),Zu=t("p",null,"根据上图中的判断，授权代码可以表示为：",-1),Qu=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(主体."),t("span",{style:{color:"#B392F0"}},"hasPermission"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"查询工资权限标识"'),t("span",{style:{color:"#E1E4E8"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    查询工资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(主体."),t("span",{style:{color:"#6F42C1"}},"hasPermission"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"查询工资权限标识"'),t("span",{style:{color:"#24292E"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    查询工资")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Yu=t("p",null,"优点：系统设计时定义好查询工资的权限标识，即使查询工资所需要的角色变化为总经理和部门经理也不需要修改授权代码，系统可扩展性强。",-1),$u={id:"_5-2-资源服务授权流程",tabindex:"-1"},sF=t("strong",null,"5.2 资源服务授权流程",-1),lF=t("p",null,"本项目在资源服务内部进行授权，基于资源的授权模式，因为接口在资源服务，通过在接口处添加授权注解实现授权。",-1),oF=t("p",null,"1、首先配置nginx代理",-1),nF=t("div",{style:{"max-height":"300px"},class:"language-apl"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"apl"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   http {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    server_names_hash_bucket_size "),t("span",{style:{color:"#79B8FF"}},"64"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"...")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"前端开发服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  upstream uidevserver{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    server "),t("span",{style:{color:"#79B8FF"}},"127.0.0.1"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#79B8FF"}},"8601"),t("span",{style:{color:"#E1E4E8"}}," weight"),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#79B8FF"}},"10"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  } ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   server {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        listen       "),t("span",{style:{color:"#79B8FF"}},"80"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        server_name  teacher"),t("span",{style:{color:"#79B8FF"}},".51xuecheng"),t("span",{style:{color:"#F97583"}},"."),t("span",{style:{color:"#E1E4E8"}},"cn"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"charset koi8"),t("span",{style:{color:"#F97583"}},"-"),t("span",{style:{color:"#E1E4E8"}},"r"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ssi on"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ssi_silent_errors on"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"access_log  logs"),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}},"host"),t("span",{style:{color:"#F97583"}},"."),t("span",{style:{color:"#E1E4E8"}},"access"),t("span",{style:{color:"#F97583"}},"."),t("span",{style:{color:"#E1E4E8"}},"log  main"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"location "),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"         "),t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"   alias   D:"),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}},"itcast2022"),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}},"xc_edu3"),t("span",{style:{color:"#79B8FF"}},".0"),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}},"code_1"),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}},"dist"),t("span",{style:{color:"#F97583"}},"/;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"         "),t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"   index  index"),t("span",{style:{color:"#F97583"}},"."),t("span",{style:{color:"#E1E4E8"}},"html index"),t("span",{style:{color:"#F97583"}},"."),t("span",{style:{color:"#E1E4E8"}},"htm"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#79B8FF"}},"#"),t("span",{style:{color:"#E1E4E8"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        location "),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            proxy_pass   http:"),t("span",{style:{color:"#F97583"}},"//"),t("span",{style:{color:"#E1E4E8"}},"uidevserver"),t("span",{style:{color:"#F97583"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        location "),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}},"api"),t("span",{style:{color:"#F97583"}},"/"),t("span",{style:{color:"#E1E4E8"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"                proxy_pass http:"),t("span",{style:{color:"#F97583"}},"//"),t("span",{style:{color:"#E1E4E8"}},"gatewayserver"),t("span",{style:{color:"#F97583"}},"/;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        } ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   http {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    server_names_hash_bucket_size "),t("span",{style:{color:"#005CC5"}},"64"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"...")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"前端开发服务")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  upstream uidevserver{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    server "),t("span",{style:{color:"#005CC5"}},"127.0.0.1"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#005CC5"}},"8601"),t("span",{style:{color:"#24292E"}}," weight"),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#005CC5"}},"10"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  } ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   server {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        listen       "),t("span",{style:{color:"#005CC5"}},"80"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        server_name  teacher"),t("span",{style:{color:"#005CC5"}},".51xuecheng"),t("span",{style:{color:"#D73A49"}},"."),t("span",{style:{color:"#24292E"}},"cn"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"charset koi8"),t("span",{style:{color:"#D73A49"}},"-"),t("span",{style:{color:"#24292E"}},"r"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ssi on"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ssi_silent_errors on"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"access_log  logs"),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}},"host"),t("span",{style:{color:"#D73A49"}},"."),t("span",{style:{color:"#24292E"}},"access"),t("span",{style:{color:"#D73A49"}},"."),t("span",{style:{color:"#24292E"}},"log  main"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"location "),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"         "),t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"   alias   D:"),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}},"itcast2022"),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}},"xc_edu3"),t("span",{style:{color:"#005CC5"}},".0"),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}},"code_1"),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}},"dist"),t("span",{style:{color:"#D73A49"}},"/;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"         "),t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"   index  index"),t("span",{style:{color:"#D73A49"}},"."),t("span",{style:{color:"#24292E"}},"html index"),t("span",{style:{color:"#D73A49"}},"."),t("span",{style:{color:"#24292E"}},"htm"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#005CC5"}},"#"),t("span",{style:{color:"#24292E"}},"}")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        location "),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            proxy_pass   http:"),t("span",{style:{color:"#D73A49"}},"//"),t("span",{style:{color:"#24292E"}},"uidevserver"),t("span",{style:{color:"#D73A49"}},";")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        }")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        location "),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}},"api"),t("span",{style:{color:"#D73A49"}},"/"),t("span",{style:{color:"#24292E"}}," {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"                proxy_pass http:"),t("span",{style:{color:"#D73A49"}},"//"),t("span",{style:{color:"#24292E"}},"gatewayserver"),t("span",{style:{color:"#D73A49"}},"/;")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        } ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        ")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   }")])])]),t("button",{class:"collapse"})],-1),eF=t("p",null,"加载nginx 配置。",-1),aF=t("p",null,"2、在资源服务集成Spring Security",-1),cF=t("p",null,[p("在需要授权的接口处使用"),t("code",null,"@PreAuthorize(\"hasAuthority('权限标识符')\")"),p("进行控制")],-1),tF=t("p",null,[p("下边代码指定"),t("code",null,"/course/list"),p("接口需要拥有"),t("code",null,"xc_teachmanager_course_list"),p(" 权限。")],-1),pF=t("figure",null,[t("img",{alt:"image-20230705225657359",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225657359.png"})],-1),rF=t("p",null,[p("设置了"),t("code",null,"@PreAuthorize"),p("表示执行此方法需要授权，如果当前用户请求接口没有权限则抛出异常")],-1),EF=t("p",null,[t("code",null,"org.springframework.security.access.AccessDeniedException"),p(": 不允许访问")],-1),yF=t("p",null,"3、在统一异常处理处解析此异常信息",-1),iF=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ResponseBody")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ExceptionHandler"),t("span",{style:{color:"#E1E4E8"}},"(Exception.class)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ResponseStatus"),t("span",{style:{color:"#E1E4E8"}},"(HttpStatus.INTERNAL_SERVER_ERROR)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," RestErrorResponse "),t("span",{style:{color:"#B392F0"}},"exception"),t("span",{style:{color:"#E1E4E8"}},"(Exception e) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   log."),t("span",{style:{color:"#B392F0"}},"error"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"【系统异常】{}"'),t("span",{style:{color:"#E1E4E8"}},",e."),t("span",{style:{color:"#B392F0"}},"getMessage"),t("span",{style:{color:"#E1E4E8"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   e."),t("span",{style:{color:"#B392F0"}},"printStackTrace"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(e."),t("span",{style:{color:"#B392F0"}},"getMessage"),t("span",{style:{color:"#E1E4E8"}},"()."),t("span",{style:{color:"#B392F0"}},"equals"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"不允许访问"'),t("span",{style:{color:"#E1E4E8"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"      "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RestErrorResponse"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"没有操作此功能的权限"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"RestErrorResponse"),t("span",{style:{color:"#E1E4E8"}},"(CommonError.UNKOWN_ERROR."),t("span",{style:{color:"#B392F0"}},"getErrMessage"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ResponseBody")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ExceptionHandler"),t("span",{style:{color:"#24292E"}},"(Exception.class)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ResponseStatus"),t("span",{style:{color:"#24292E"}},"(HttpStatus.INTERNAL_SERVER_ERROR)")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," RestErrorResponse "),t("span",{style:{color:"#6F42C1"}},"exception"),t("span",{style:{color:"#24292E"}},"(Exception e) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   log."),t("span",{style:{color:"#6F42C1"}},"error"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"【系统异常】{}"'),t("span",{style:{color:"#24292E"}},",e."),t("span",{style:{color:"#6F42C1"}},"getMessage"),t("span",{style:{color:"#24292E"}},"(),e);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   e."),t("span",{style:{color:"#6F42C1"}},"printStackTrace"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(e."),t("span",{style:{color:"#6F42C1"}},"getMessage"),t("span",{style:{color:"#24292E"}},"()."),t("span",{style:{color:"#6F42C1"}},"equals"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"不允许访问"'),t("span",{style:{color:"#24292E"}},")){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"      "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RestErrorResponse"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"没有操作此功能的权限"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"RestErrorResponse"),t("span",{style:{color:"#24292E"}},"(CommonError.UNKOWN_ERROR."),t("span",{style:{color:"#6F42C1"}},"getErrMessage"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),uF=t("p",null,"4、重启资源服务进行测试",-1),FF=t("p",null,"使用教学机构用户登录系统",-1),dF=t("p",null,"这里使用t1用户登录，账号:t1、密码：111111",-1),gF=t("p",null,"登录成功，点击“教学机构”",-1),hF=t("figure",null,[t("img",{alt:"image-20230705225706766",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225706766.png"})],-1),AF=t("p",null,"当用户没有权限时页面提示：没有操作此功能的权限。",-1),DF=t("figure",null,[t("img",{alt:"image-20230705225713175",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225713175.png"})],-1),CF={id:"_5-3-授权相关的数据模型",tabindex:"-1"},mF=t("strong",null,"5.3 授权相关的数据模型",-1),bF=t("p",null,"如何给用户分配权限呢？",-1),BF=t("p",null,"首先要学习数据模型，本项目授权相关的数据表如下：",-1),kF=t("figure",null,[t("img",{alt:"image-20230705225720492",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225720492.png"})],-1),SF=t("p",null,"说明如下：",-1),vF=t("p",null,[t("code",null,"xc_user"),p("：用户表，存储了系统用户信息，用户类型包括：学生、老师、管理员等")],-1),xF=t("p",null,[t("code",null,"xc_role"),p("：角色表，存储了系统的角色信息，学生、老师、教学管理员、系统管理员等。")],-1),fF=t("p",null,[t("code",null,"xc_user_role"),p("：用户角色表，一个用户可拥有多个角色，一个角色可被多个用户所拥有")],-1),_F=t("p",null,[t("code",null,"xc_menu"),p("：模块表，记录了菜单及菜单下的权限")],-1),wF=t("p",null,[t("code",null,"xc_permission"),p("：角色权限表，一个角色可拥有多个权限，一个权限可被多个角色所拥有")],-1),UF=t("p",null,"本项目教学阶段不再实现权限定义及用户权限分配的功能，权限分配的界面原型如下图所示：",-1),IF=t("figure",null,[t("img",{alt:"image-20230705225732787",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225732787.png"})],-1),jF=t("p",null,"本项目要求掌握基于权限数据模型（5张数据表），要求在数据库中操作完成给用户分配权限、查询用户权限等需求。",-1),PF=t("p",null,"1、查询用户所拥有的权限",-1),MF=t("p",null,"步骤：",-1),TF=t("p",null,"查询用户的id",-1),OF=t("p",null,"查询用户所拥有的角色",-1),zF=t("p",null,"查询用户所拥有的权限",-1),RF=t("p",null,"例子：",-1),LF=t("div",{style:{"max-height":"300px"},class:"language-sql"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"sql"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"SELECT"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"*"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"FROM"),t("span",{style:{color:"#E1E4E8"}}," xc_menu "),t("span",{style:{color:"#F97583"}},"WHERE"),t("span",{style:{color:"#E1E4E8"}}," id "),t("span",{style:{color:"#F97583"}},"IN"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  "),t("span",{style:{color:"#F97583"}},"SELECT"),t("span",{style:{color:"#E1E4E8"}}," menu_id "),t("span",{style:{color:"#F97583"}},"FROM"),t("span",{style:{color:"#E1E4E8"}}," xc_permission "),t("span",{style:{color:"#F97583"}},"WHERE"),t("span",{style:{color:"#E1E4E8"}}," role_id "),t("span",{style:{color:"#F97583"}},"IN"),t("span",{style:{color:"#E1E4E8"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"SELECT"),t("span",{style:{color:"#E1E4E8"}}," role_id "),t("span",{style:{color:"#F97583"}},"FROM"),t("span",{style:{color:"#E1E4E8"}}," xc_user_role "),t("span",{style:{color:"#F97583"}},"WHERE"),t("span",{style:{color:"#E1E4E8"}}," user_id "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#9ECBFF"}},"'49'")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"  )")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},")")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"SELECT"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"*"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"FROM"),t("span",{style:{color:"#24292E"}}," xc_menu "),t("span",{style:{color:"#D73A49"}},"WHERE"),t("span",{style:{color:"#24292E"}}," id "),t("span",{style:{color:"#D73A49"}},"IN"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  "),t("span",{style:{color:"#D73A49"}},"SELECT"),t("span",{style:{color:"#24292E"}}," menu_id "),t("span",{style:{color:"#D73A49"}},"FROM"),t("span",{style:{color:"#24292E"}}," xc_permission "),t("span",{style:{color:"#D73A49"}},"WHERE"),t("span",{style:{color:"#24292E"}}," role_id "),t("span",{style:{color:"#D73A49"}},"IN"),t("span",{style:{color:"#24292E"}},"(")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"SELECT"),t("span",{style:{color:"#24292E"}}," role_id "),t("span",{style:{color:"#D73A49"}},"FROM"),t("span",{style:{color:"#24292E"}}," xc_user_role "),t("span",{style:{color:"#D73A49"}},"WHERE"),t("span",{style:{color:"#24292E"}}," user_id "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#032F62"}},"'49'")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"  )")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},")")])])]),t("button",{class:"collapse"})],-1),WF=t("p",null,"2、给用户分配权限",-1),NF=t("p",null,"1）添加权限",-1),JF=t("p",null,"查询用户的id",-1),XF=t("p",null,"查询权限的id",-1),qF=t("p",null,"查询用户的角色，如果没有角色需要先给用户指定角色",-1),GF=t("p",null,"向角色权限表添加记录",-1),KF=t("p",null,"2）删除用户权限",-1),VF=t("p",null,"本项目是基于角色分配权限，如果要删除用户的权限可以给用户换角色，那么新角色下的权限就是用户的权限；如果不换用户的角色可以删除角色下的权限即删除角色权限关系表相应记录，这样操作是将角色下的权限删除，属于该角色的用户都将删除此权限。",-1),HF={id:"_5-4-查询用户权限",tabindex:"-1"},ZF=t("strong",null,"5.4 查询用户权限",-1),QF=t("p",null,"使用Spring Security进行授权，首先在生成jwt前会查询用户的权限，如下图：",-1),YF=t("figure",null,[t("img",{alt:"image-20230705225743413",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225743413.png"})],-1),$F=t("p",null,"接下来需要修改UserServiceImpl和PasswordAuthServiceImpl从数据库查询用户的权限。",-1),sd=t("p",null,"1、定义mapper接口",-1),ld=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"interface"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"XcMenuMapper"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"extends"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"BaseMapper"),t("span",{style:{color:"#E1E4E8"}},"<"),t("span",{style:{color:"#F97583"}},"XcMenu"),t("span",{style:{color:"#E1E4E8"}},"> {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    @"),t("span",{style:{color:"#F97583"}},"Select"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"SELECT    * FROM xc_menu WHERE id IN (SELECT menu_id FROM xc_permission WHERE role_id IN ( SELECT role_id FROM xc_user_role WHERE user_id = #{userId} ))"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    List<"),t("span",{style:{color:"#F97583"}},"XcMenu"),t("span",{style:{color:"#E1E4E8"}},"> "),t("span",{style:{color:"#B392F0"}},"selectPermissionByUserId"),t("span",{style:{color:"#E1E4E8"}},"(@"),t("span",{style:{color:"#F97583"}},"Param"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"userId"'),t("span",{style:{color:"#E1E4E8"}},") String "),t("span",{style:{color:"#FFAB70"}},"userId"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"interface"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"XcMenuMapper"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"extends"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"BaseMapper"),t("span",{style:{color:"#24292E"}},"<"),t("span",{style:{color:"#D73A49"}},"XcMenu"),t("span",{style:{color:"#24292E"}},"> {")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    @"),t("span",{style:{color:"#D73A49"}},"Select"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"SELECT    * FROM xc_menu WHERE id IN (SELECT menu_id FROM xc_permission WHERE role_id IN ( SELECT role_id FROM xc_user_role WHERE user_id = #{userId} ))"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    List<"),t("span",{style:{color:"#D73A49"}},"XcMenu"),t("span",{style:{color:"#24292E"}},"> "),t("span",{style:{color:"#6F42C1"}},"selectPermissionByUserId"),t("span",{style:{color:"#24292E"}},"(@"),t("span",{style:{color:"#D73A49"}},"Param"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"userId"'),t("span",{style:{color:"#24292E"}},") String "),t("span",{style:{color:"#E36209"}},"userId"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),od=t("p",null,"2、修改PasswordAuthServiceImpl",-1),nd=t("p",null,"修改UserServiceImpl类的getUserPrincipal方法，查询权限信息",-1),ed=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//查询用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," UserDetails "),t("span",{style:{color:"#B392F0"}},"getUserPrincipal"),t("span",{style:{color:"#E1E4E8"}},"(XcUserExt user){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String password "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," user."),t("span",{style:{color:"#B392F0"}},"getPassword"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//查询用户权限")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    List<"),t("span",{style:{color:"#F97583"}},"XcMenu"),t("span",{style:{color:"#E1E4E8"}},"> xcMenus "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," menuMapper."),t("span",{style:{color:"#B392F0"}},"selectPermissionByUserId"),t("span",{style:{color:"#E1E4E8"}},"(user."),t("span",{style:{color:"#B392F0"}},"getId"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    List<"),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"> permissions "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," ArrayList<>();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"if"),t("span",{style:{color:"#E1E4E8"}},"(xcMenus."),t("span",{style:{color:"#B392F0"}},"size"),t("span",{style:{color:"#E1E4E8"}},"()"),t("span",{style:{color:"#F97583"}},"<="),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加则报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        permissions."),t("span",{style:{color:"#B392F0"}},"add"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"p1"'),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }"),t("span",{style:{color:"#F97583"}},"else"),t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        xcMenus."),t("span",{style:{color:"#B392F0"}},"forEach"),t("span",{style:{color:"#E1E4E8"}},"(menu"),t("span",{style:{color:"#F97583"}},"->"),t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"            permissions."),t("span",{style:{color:"#B392F0"}},"add"),t("span",{style:{color:"#E1E4E8"}},"(menu."),t("span",{style:{color:"#B392F0"}},"getCode"),t("span",{style:{color:"#E1E4E8"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"        });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将用户权限放在XcUserExt中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    user."),t("span",{style:{color:"#B392F0"}},"setPermissions"),t("span",{style:{color:"#E1E4E8"}},"(permissions);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//为了安全在令牌中不放密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    user."),t("span",{style:{color:"#B392F0"}},"setPassword"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#79B8FF"}},"null"),t("span",{style:{color:"#E1E4E8"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String userString "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," JSON."),t("span",{style:{color:"#B392F0"}},"toJSONString"),t("span",{style:{color:"#E1E4E8"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"[] authorities "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," permissions."),t("span",{style:{color:"#B392F0"}},"toArray"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"String"),t("span",{style:{color:"#E1E4E8"}},"["),t("span",{style:{color:"#79B8FF"}},"0"),t("span",{style:{color:"#E1E4E8"}},"]);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    UserDetails userDetails "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," User."),t("span",{style:{color:"#B392F0"}},"withUsername"),t("span",{style:{color:"#E1E4E8"}},"(userString)."),t("span",{style:{color:"#B392F0"}},"password"),t("span",{style:{color:"#E1E4E8"}},"(password)."),t("span",{style:{color:"#B392F0"}},"authorities"),t("span",{style:{color:"#E1E4E8"}},"(authorities)."),t("span",{style:{color:"#B392F0"}},"build"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," userDetails;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#6A737D"}},"//查询用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," UserDetails "),t("span",{style:{color:"#6F42C1"}},"getUserPrincipal"),t("span",{style:{color:"#24292E"}},"(XcUserExt user){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String password "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," user."),t("span",{style:{color:"#6F42C1"}},"getPassword"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//查询用户权限")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    List<"),t("span",{style:{color:"#D73A49"}},"XcMenu"),t("span",{style:{color:"#24292E"}},"> xcMenus "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," menuMapper."),t("span",{style:{color:"#6F42C1"}},"selectPermissionByUserId"),t("span",{style:{color:"#24292E"}},"(user."),t("span",{style:{color:"#6F42C1"}},"getId"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    List<"),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"> permissions "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," ArrayList<>();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"if"),t("span",{style:{color:"#24292E"}},"(xcMenus."),t("span",{style:{color:"#6F42C1"}},"size"),t("span",{style:{color:"#24292E"}},"()"),t("span",{style:{color:"#D73A49"}},"<="),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},"){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        "),t("span",{style:{color:"#6A737D"}},"//用户权限,如果不加则报Cannot pass a null GrantedAuthority collection")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        permissions."),t("span",{style:{color:"#6F42C1"}},"add"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"p1"'),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }"),t("span",{style:{color:"#D73A49"}},"else"),t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        xcMenus."),t("span",{style:{color:"#6F42C1"}},"forEach"),t("span",{style:{color:"#24292E"}},"(menu"),t("span",{style:{color:"#D73A49"}},"->"),t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"            permissions."),t("span",{style:{color:"#6F42C1"}},"add"),t("span",{style:{color:"#24292E"}},"(menu."),t("span",{style:{color:"#6F42C1"}},"getCode"),t("span",{style:{color:"#24292E"}},"());")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"        });")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    }")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将用户权限放在XcUserExt中")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    user."),t("span",{style:{color:"#6F42C1"}},"setPermissions"),t("span",{style:{color:"#24292E"}},"(permissions);")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//为了安全在令牌中不放密码")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    user."),t("span",{style:{color:"#6F42C1"}},"setPassword"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#005CC5"}},"null"),t("span",{style:{color:"#24292E"}},");")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//将user对象转json")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String userString "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," JSON."),t("span",{style:{color:"#6F42C1"}},"toJSONString"),t("span",{style:{color:"#24292E"}},"(user);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"[] authorities "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," permissions."),t("span",{style:{color:"#6F42C1"}},"toArray"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"String"),t("span",{style:{color:"#24292E"}},"["),t("span",{style:{color:"#005CC5"}},"0"),t("span",{style:{color:"#24292E"}},"]);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    UserDetails userDetails "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," User."),t("span",{style:{color:"#6F42C1"}},"withUsername"),t("span",{style:{color:"#24292E"}},"(userString)."),t("span",{style:{color:"#6F42C1"}},"password"),t("span",{style:{color:"#24292E"}},"(password)."),t("span",{style:{color:"#6F42C1"}},"authorities"),t("span",{style:{color:"#24292E"}},"(authorities)."),t("span",{style:{color:"#6F42C1"}},"build"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," userDetails;")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),ad={id:"_5-5-授权测试",tabindex:"-1"},cd=t("strong",null,"5.5 授权测试",-1),td=t("p",null,"以上实现了认证时从数据库查询用户的权限，下边进行用户授权测试。",-1),pd=t("p",null,"重启认证服务，使用内容管理课程列表查询为例，代码如下：",-1),rd=t("figure",null,[t("img",{alt:"image-20230705225751417",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225751417.png"})],-1),Ed=t("p",null,[p("用户拥有"),t("code",null,"xc_teachmanager_course_list"),p("权限方可访问课程查询接口。")],-1),yd=t("p",null,"以用户stu1为例，当它没有此权限时页面报“没有此操作的权限”错误",-1),id=t("figure",null,[t("img",{alt:"image-20230705225757328",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225757328.png"})],-1),ud=t("p",null,[p("将"),t("code",null,"xc_teachmanager_course_list"),p("权限分配给用户。")],-1),Fd=t("p",null,"1）首先找到当前用户的角色",-1),dd=t("p",null,[p("2）找到"),t("code",null,"xc_teachmanager_course_list"),p("权限的主键")],-1),gd=t("p",null,"3）在角色权限关系表中添加记录",-1),hd=t("p",null,"分配完权限需要重新登录",-1),Ad=t("p",null,[p("由于用户分配了"),t("code",null,"xc_teachmanager_course_list"),p("权限，用户具有访问课程查询接口的权限。")],-1),Dd={id:"_5-6-细粒度授权",tabindex:"-1"},Cd=t("strong",null,"5.6 细粒度授权",-1),md={id:"_5-6-1-什么是细粒度授权",tabindex:"-1"},bd=t("strong",null,"5.6.1 什么是细粒度授权",-1),Bd=t("p",null,"什么是细粒度授权？",-1),kd=t("p",null,"细粒度授权也叫数据范围授权，即不同的用户所拥有的操作权限相同，但是能够操作的数据范围是不一样的。一个例子：用户A和用户B都是教学机构，他们都拥有“我的课程”权限，但是两个用户所查询到的数据是不一样的。",-1),Sd=t("p",null,"本项目有哪些细粒度授权？",-1),vd=t("p",null,"比如：",-1),xd=t("p",null,"我的课程，教学机构只允许查询本教学机构下的课程信息。",-1),fd=t("p",null,"我的选课，学生只允许查询自己所选课。",-1),_d=t("p",null,"如何实现细粒度授权？",-1),wd=t("p",null,"细粒度授权涉及到不同的业务逻辑，通常在service层实现，根据不同的用户进行校验，根据不同的参数查询不同的数据或操作不同的数据。",-1),Ud={id:"_5-6-2-教学机构细粒度授权",tabindex:"-1"},Id=t("strong",null,"5.6.2 教学机构细粒度授权",-1),jd=t("p",null,"教学机构在维护课程时只允许维护本机构的课程，教学机构细粒度授权过程如下：",-1),Pd=t("ul",null,[t("li",null,"1）获取当前登录的用户身份"),t("li",null,"2）得到用户所属教育机构的Id"),t("li",null,"3）查询该教学机构下的课程信息")],-1),Md=t("p",null,"最终实现了用户只允许查询自己机构的课程信息。",-1),Td=t("p",null,"根据公司Id查询课程，流程如下：",-1),Od=t("ul",null,[t("li",null,"1）教学机构用户登录系统，从用户身份中取出所属机构的id"),t("li",null,[p("在用户表中设计了"),t("code",null,"company_id"),p("字段存储该用户所属的机构id.")]),t("li",null,"2）接口层取出当前登录用户的身份，取出机构id"),t("li",null,"3）将机构id传入service方法。"),t("li",null,"4）service方法将机构id传入Dao方法，最终查询出本机构的课程信息。")],-1),zd=t("p",null,"代码实现如下：",-1),Rd=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"ApiOperation"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"课程查询接口"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PreAuthorize"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},"\"hasAuthority('xc_teachmanager_course_list')\""),t("span",{style:{color:"#E1E4E8"}},")"),t("span",{style:{color:"#6A737D"}},"//拥有课程列表查询的权限方可访问")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"PostMapping"),t("span",{style:{color:"#E1E4E8"}},"("),t("span",{style:{color:"#9ECBFF"}},'"/course/list"'),t("span",{style:{color:"#E1E4E8"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," PageResult"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"CourseBase"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"list"),t("span",{style:{color:"#E1E4E8"}},"(PageParams pageParams, @"),t("span",{style:{color:"#F97583"}},"RequestBody"),t("span",{style:{color:"#E1E4E8"}}," QueryCourseParamsDto queryCourseParams){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    XcUser user "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," SecurityUtil."),t("span",{style:{color:"#B392F0"}},"getUser"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    String companyId "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," user."),t("span",{style:{color:"#B392F0"}},"getCompanyId"),t("span",{style:{color:"#E1E4E8"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"    "),t("span",{style:{color:"#F97583"}},"return"),t("span",{style:{color:"#E1E4E8"}}," courseBaseInfoService."),t("span",{style:{color:"#B392F0"}},"queryCourseBaseList"),t("span",{style:{color:"#E1E4E8"}},"(Long."),t("span",{style:{color:"#B392F0"}},"parseLong"),t("span",{style:{color:"#E1E4E8"}},"(companyId),pageParams,queryCourseParams);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"ApiOperation"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"课程查询接口"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PreAuthorize"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},"\"hasAuthority('xc_teachmanager_course_list')\""),t("span",{style:{color:"#24292E"}},")"),t("span",{style:{color:"#6A737D"}},"//拥有课程列表查询的权限方可访问")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"PostMapping"),t("span",{style:{color:"#24292E"}},"("),t("span",{style:{color:"#032F62"}},'"/course/list"'),t("span",{style:{color:"#24292E"}},")")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," PageResult"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"CourseBase"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"list"),t("span",{style:{color:"#24292E"}},"(PageParams pageParams, @"),t("span",{style:{color:"#D73A49"}},"RequestBody"),t("span",{style:{color:"#24292E"}}," QueryCourseParamsDto queryCourseParams){")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//取出用户身份")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    XcUser user "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," SecurityUtil."),t("span",{style:{color:"#6F42C1"}},"getUser"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    String companyId "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," user."),t("span",{style:{color:"#6F42C1"}},"getCompanyId"),t("span",{style:{color:"#24292E"}},"();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"    "),t("span",{style:{color:"#D73A49"}},"return"),t("span",{style:{color:"#24292E"}}," courseBaseInfoService."),t("span",{style:{color:"#6F42C1"}},"queryCourseBaseList"),t("span",{style:{color:"#24292E"}},"(Long."),t("span",{style:{color:"#6F42C1"}},"parseLong"),t("span",{style:{color:"#24292E"}},"(companyId),pageParams,queryCourseParams);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),Ld=t("p",null,"Service方法如下：",-1),Wd=t("div",{style:{"max-height":"300px"},class:"language-java"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"java"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"@"),t("span",{style:{color:"#F97583"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#F97583"}},"public"),t("span",{style:{color:"#E1E4E8"}}," PageResult"),t("span",{style:{color:"#F97583"}},"<"),t("span",{style:{color:"#E1E4E8"}},"CourseBase"),t("span",{style:{color:"#F97583"}},">"),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#B392F0"}},"queryCourseBaseList"),t("span",{style:{color:"#E1E4E8"}},"(Long companyId,PageParams pageParams, QueryCourseParamsDto queryCourseParamsDto) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#6A737D"}},"//构建查询条件对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#F97583"}},"CourseBase"),t("span",{style:{color:"#E1E4E8"}},"> queryWrapper "),t("span",{style:{color:"#F97583"}},"="),t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#F97583"}},"new"),t("span",{style:{color:"#E1E4E8"}}," LambdaQueryWrapper<>();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," queryWrapper."),t("span",{style:{color:"#B392F0"}},"eq"),t("span",{style:{color:"#E1E4E8"}},"(CourseBase"),t("span",{style:{color:"#F97583"}},"::"),t("span",{style:{color:"#E1E4E8"}},"getCompanyId,companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," ....")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"@"),t("span",{style:{color:"#D73A49"}},"Override")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#D73A49"}},"public"),t("span",{style:{color:"#24292E"}}," PageResult"),t("span",{style:{color:"#D73A49"}},"<"),t("span",{style:{color:"#24292E"}},"CourseBase"),t("span",{style:{color:"#D73A49"}},">"),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6F42C1"}},"queryCourseBaseList"),t("span",{style:{color:"#24292E"}},"(Long companyId,PageParams pageParams, QueryCourseParamsDto queryCourseParamsDto) {")]),p("\n"),t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6A737D"}},"//构建查询条件对象")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<"),t("span",{style:{color:"#D73A49"}},"CourseBase"),t("span",{style:{color:"#24292E"}},"> queryWrapper "),t("span",{style:{color:"#D73A49"}},"="),t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#D73A49"}},"new"),t("span",{style:{color:"#24292E"}}," LambdaQueryWrapper<>();")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," "),t("span",{style:{color:"#6A737D"}},"//机构id")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," queryWrapper."),t("span",{style:{color:"#6F42C1"}},"eq"),t("span",{style:{color:"#24292E"}},"(CourseBase"),t("span",{style:{color:"#D73A49"}},"::"),t("span",{style:{color:"#24292E"}},"getCompanyId,companyId);")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," ....")])])]),t("button",{class:"collapse"})],-1),Nd={id:"_5-6-3-教学机构细粒度授权测试",tabindex:"-1"},Jd=t("strong",null,"5.6.3 教学机构细粒度授权测试",-1),Xd=t("p",null,"使用一个教学机构的用户登录项目，并且此用户具有查询课程的权限。",-1),qd=t("p",null,"手机修改数据库指定用户归属到一个机构中，涉及以下数据表：",-1),Gd=t("p",null,[t("code",null,"xc_company"),p("为机构表")],-1),Kd=t("p",null,[t("code",null,"xc_company_user"),p("为机构用户关系表")],-1),Vd=t("p",null,[t("code",null,"xc_user"),p("表中有"),t("code",null,"company_id"),p("字段。")],-1),Hd=t("p",null,"我们准备了t1 用户作为此次测试的用户，使用此用户登录系统：",-1),Zd=t("p",null,"提前在查询课程列表接口处打上断点。",-1),Qd=t("p",null,"经过测试可以正常取出用户所属的机构id",-1),Yd=t("figure",null,[t("img",{alt:"image-20230705225810633",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225810633.png"})],-1),$d=t("p",null,"跟踪持久层日志发现已将机构id传入dao方法，拼装sql语句，查询本机构的课程信息",-1),sg=t("figure",null,[t("img",{alt:"image-20230705225815714",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225815714.png"})],-1),lg={id:"_6-实战",tabindex:"-1"},og=t("strong",null,"6 实战",-1),ng={id:"_6-1-找回密码-实战",tabindex:"-1"},eg=t("strong",null,"6.1 找回密码(实战)",-1),ag=t("p",null,"需求：忘记密码需要找回，可以通过手机号找回密码，通过邮箱找回密码以及人工通道。",-1),cg=t("figure",null,[t("img",{alt:"image-20230705225823457",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225823457.png"})],-1),tg=t("p",null,"接口：",-1),pg=t("p",null,[p("手机验证码："),t("code",null,"/api/checkcode/phone?param1=手机号")],-1),rg=t("p",null,"邮箱验证码：/api/checkcode/phone?param1=电子邮箱地址",-1),Eg=t("p",null,[p("找回密码："),t("code",null,"/api/auth/findpassword")],-1),yg=t("p",null,"请求：",-1),ig=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"     "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"cellphone"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"     "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"email"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"     "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"checkcodekey"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"     "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"checkcode"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"     "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"confirmpwd"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"     "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"password"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}}," }")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"     "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"cellphone"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"     "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"email"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"     "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"checkcodekey"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"     "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"checkcode"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"     "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"confirmpwd"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"     "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"password"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}}," }")])])]),t("button",{class:"collapse"})],-1),ug=t("p",null,"响应：",-1),Fg=t("p",null,"200: 找回成功",-1),dg=t("p",null,"其它：找回失败，失败原因使用统一异常处理返回的信息格式",-1),gg=t("p",null,"执行流程 1、校验验证码，不一致则抛出异常",-1),hg=t("p",null,"2、判断两次密码是否一致，不一致则抛出异常",-1),Ag=t("p",null,"3、根据手机号和邮箱查询用户",-1),Dg=t("p",null,"4、如果找到用户更新为新密码",-1),Cg={id:"_6-2-注册-实战",tabindex:"-1"},mg=t("strong",null,"6.2 注册(实战)",-1),bg=t("p",null,"需求：为学生提供注册入口，通过此入口注册的用户为学生用户。",-1),Bg=t("figure",null,[t("img",{alt:"image-20230705225845103",class:"lazy","data-src":"https://jsd.onmicrosoft.cn/gh/imLKlauS/blog-picture@main/blogs/image-20230705225845103.png"})],-1),kg=t("p",null,"接口：",-1),Sg=t("p",null,[p("手机验证码："),t("code",null,"/api/checkcode/phone?param1=手机号")],-1),vg=t("p",null,[p("注册："),t("code",null,"/api/auth/register")],-1),xg=t("p",null,"请求：",-1),fg=t("div",{style:{"max-height":"300px"},class:"language-json"},[t("button",{title:"Copy Code",class:"copy"}),t("span",{class:"lang"},"json"),t("pre",{class:"shiki github-dark vp-code-dark"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"cellphone"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"username"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"email"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"nickname"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"password"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"confirmpwd"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"checkcodekey"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''"),t("span",{style:{color:"#E1E4E8"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"   "),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"checkcode"),t("span",{style:{color:"#E1E4E8"}},":"),t("span",{style:{color:"#FDAEB7","font-style":"italic"}},"''")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#E1E4E8"}},"}")])])]),t("pre",{class:"shiki github-light vp-code-light"},[t("code",null,[t("span",{class:"line"}),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"{")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"cellphone"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"username"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"email"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"nickname"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"password"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"confirmpwd"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"checkcodekey"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''"),t("span",{style:{color:"#24292E"}},",")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"   "),t("span",{style:{color:"#B31D28","font-style":"italic"}},"checkcode"),t("span",{style:{color:"#24292E"}},":"),t("span",{style:{color:"#B31D28","font-style":"italic"}},"''")]),p("\n"),t("span",{class:"line"},[t("span",{style:{color:"#24292E"}},"}")])])]),t("button",{class:"collapse"})],-1),_g=t("p",null,"响应：",-1),wg=t("p",null,"200: 注册成功",-1),Ug=t("p",null,"其它：注册失败，失败原因使用统一异常处理返回的信息格式",-1),Ig=t("p",null,"执行流程：",-1),jg=t("p",null,"1、校验验证码，如果不一致则抛出异常",-1),Pg=t("p",null,"2、校验两次密码是否一致，如果不一致则抛出异常",-1),Mg=t("p",null,"3、校验用户是否存在，如果存在则抛出异常",-1),Tg=t("p",null,"4、向用户表、用户角色关系表添加数据。角色为学生角色。",-1);const Og=s(F,[["render",function(s,l,o,i,u,F){const Og=y,zg=a;return c(),n(zg,{frontmatter:u.frontmatter,data:u.data},{"main-content-md":e((()=>[t("h1",d,[p("认证授权 "),r(Og,{class:"header-anchor",href:"#认证授权","aria-label":'Permalink to "认证授权"'},{default:e((()=>[p("​")])),_:1})]),t("h2",g,[h,p(),r(Og,{class:"header-anchor",href:"#_1-模块需求分析","aria-label":'Permalink to "**1 模块需求分析**"'},{default:e((()=>[p("​")])),_:1})]),t("h3",A,[D,p(),r(Og,{class:"header-anchor",href:"#_1-1-什么是认证授权","aria-label":'Permalink to "**1.1 什么是认证授权**"'},{default:e((()=>[p("​")])),_:1})]),C,m,b,B,k,S,v,x,f,t("h3",_,[w,p(),r(Og,{class:"header-anchor",href:"#_1-2-业务流程","aria-label":'Permalink to "**1.2 业务流程**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",U,[I,p(),r(Og,{class:"header-anchor",href:"#_1-2-1-统一认证","aria-label":'Permalink to "**1.2.1 统一认证**"'},{default:e((()=>[p("​")])),_:1})]),j,P,M,T,O,z,t("h4",R,[L,p(),r(Og,{class:"header-anchor",href:"#_1-2-2-单点登录","aria-label":'Permalink to "**1.2.2 单点登录**"'},{default:e((()=>[p("​")])),_:1})]),W,N,J,X,t("h4",q,[G,p(),r(Og,{class:"header-anchor",href:"#_1-2-3-第三方认证","aria-label":'Permalink to "**1.2.3 第三方认证**"'},{default:e((()=>[p("​")])),_:1})]),K,V,H,t("h2",Z,[Q,p(),r(Og,{class:"header-anchor",href:"#_2-spring-security-认证研究","aria-label":'Permalink to "**2 Spring Security 认证研究**"'},{default:e((()=>[p("​")])),_:1})]),t("h3",Y,[$,p(),r(Og,{class:"header-anchor",href:"#_2-1-spring-security介绍","aria-label":'Permalink to "**2.1 Spring Security介绍**"'},{default:e((()=>[p("​")])),_:1})]),ss,ls,t("p",null,[p("项目主页："),r(Og,{href:"https://spring.io/projects/spring-security",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://spring.io/projects/spring-security")])),_:1})]),t("p",null,[p("Spring cloud Security： "),r(Og,{href:"https://spring.io/projects/spring-cloud-security",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://spring.io/projects/spring-cloud-security")])),_:1})]),t("h3",os,[ns,p(),r(Og,{class:"header-anchor",href:"#_2-2-认证授权入门","aria-label":'Permalink to "**2.2 认证授权入门**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",es,[as,p(),r(Og,{class:"header-anchor",href:"#_2-2-1-创建认证服务工程","aria-label":'Permalink to "**2.2.1 创建认证服务工程**"'},{default:e((()=>[p("​")])),_:1})]),cs,ts,ps,rs,Es,ys,is,us,Fs,ds,gs,hs,As,t("p",null,[p("启动工程，尝试访问"),r(Og,{href:"http://localhost:63070/auth/r/r1",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/r/r1")])),_:1}),p(" :")]),Ds,t("p",null,[p("访问用户信息："),r(Og,{href:"http://localhost:63070/auth/user/52",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/user/52")])),_:1})]),Cs,ms,t("h4",bs,[Bs,p(),r(Og,{class:"header-anchor",href:"#_2-2-2-认证测试","aria-label":'Permalink to "**2.2.2 认证测试**"'},{default:e((()=>[p("​")])),_:1})]),ks,Ss,t("p",null,[p("重启工程，访问"),r(Og,{href:"http://localhost:63070/auth/r/r1",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/r/r1")])),_:1})]),vs,xs,fs,_s,ws,Us,Is,js,Ps,Ms,Ts,Os,zs,Rs,Ls,Ws,t("p",null,[p("1、访问"),r(Og,{href:"http://localhost:63070/auth/user/52",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/user/52")])),_:1}),p(" 可以正常访问")]),t("p",null,[p("2、访问"),r(Og,{href:"http://localhost:63070/auth/r/r1",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/r/r1")])),_:1}),p(" 显示登录页面")]),Ns,t("p",null,[p("为什么"),r(Og,{href:"http://localhost:63070/auth/user/52",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/user/52")])),_:1}),p(" 可以正常访问，访问"),r(Og,{href:"http://localhost:63070/auth/r/r1",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/r/r1")])),_:1}),p(" 显示登录页面？")]),Js,t("h4",Xs,[qs,p(),r(Og,{class:"header-anchor",href:"#_2-2-3-授权测试","aria-label":'Permalink to "**2.2.3 授权测试**"'},{default:e((()=>[p("​")])),_:1})]),Gs,Ks,Vs,Hs,Zs,Qs,Ys,$s,sl,ll,ol,nl,el,al,cl,tl,pl,rl,El,yl,t("h4",il,[ul,p(),r(Og,{class:"header-anchor",href:"#_2-2-4-工作原理","aria-label":'Permalink to "**2.2.4 工作原理**"'},{default:e((()=>[p("​")])),_:1})]),Fl,dl,gl,hl,Al,Dl,Cl,ml,bl,Bl,kl,Sl,vl,xl,fl,t("h3",_l,[wl,p(),r(Og,{class:"header-anchor",href:"#_2-3-什么是oauth2","aria-label":'Permalink to "**2.3 什么是OAuth2**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",Ul,[Il,p(),r(Og,{class:"header-anchor",href:"#_2-3-1-oauth2认证流程","aria-label":'Permalink to "**2.3.1 OAuth2认证流程**"'},{default:e((()=>[p("​")])),_:1})]),jl,Pl,Ml,t("p",null,[p("参考："),r(Og,{href:"https://baike.baidu.com/item/oAuth/7153134?fr=aladdin",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://baike.baidu.com/item/oAuth/7153134?fr=aladdin")])),_:1})]),t("p",null,[p("Oauth协议："),r(Og,{href:"https://tools.ietf.org/html/rfc6749",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://tools.ietf.org/html/rfc6749")])),_:1})]),Tl,Ol,zl,Rl,Ll,Wl,Nl,Jl,Xl,ql,Gl,Kl,Vl,Hl,Zl,Ql,Yl,$l,so,lo,oo,no,eo,ao,co,to,po,ro,t("p",null,[p("引自Oauth2.0协议rfc6749 "),r(Og,{href:"https://tools.ietf.org/html/rfc6749",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://tools.ietf.org/html/rfc6749")])),_:1})]),Eo,yo,io,uo,Fo,go,ho,Ao,Do,Co,mo,bo,Bo,ko,So,vo,xo,t("h4",fo,[_o,p(),r(Og,{class:"header-anchor",href:"#_2-3-2-oauth2在本项目的应用","aria-label":'Permalink to "**2.3.2 OAuth2在本项目的应用**"'},{default:e((()=>[p("​")])),_:1})]),wo,Uo,Io,jo,Po,Mo,To,t("h4",Oo,[zo,p(),r(Og,{class:"header-anchor",href:"#_2-3-3-oauth2的授权模式","aria-label":'Permalink to "**2.3.3 OAuth2的授权模式**"'},{default:e((()=>[p("​")])),_:1})]),Ro,t("h5",Lo,[Wo,p(),r(Og,{class:"header-anchor",href:"#_2-3-3-1-授权码模式","aria-label":'Permalink to "**2.3.3.1 授权码模式**"'},{default:e((()=>[p("​")])),_:1})]),No,Jo,Xo,qo,Go,Ko,Vo,Ho,Zo,Qo,Yo,$o,sn,ln,on,t("h5",nn,[en,p(),r(Og,{class:"header-anchor",href:"#_2-3-3-2授权码模式测试","aria-label":'Permalink to "**2.3.3.2授权码模式测试**"'},{default:e((()=>[p("​")])),_:1})]),an,cn,tn,pn,rn,En,yn,un,Fn,dn,gn,hn,An,Dn,Cn,mn,bn,t("p",null,[p("地址: "),r(Og,{href:"http://localhost:63070/auth/oauth/authorize?client_id=XcWebApp&response_type=code&scope=all&redirect_uri=http://www.51xuecheng.cn",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://localhost:63070/auth/oauth/authorize?client_id=XcWebApp&response_type=code&scope=all&redirect_uri=http://www.51xuecheng.cn")])),_:1})]),Bn,kn,Sn,vn,xn,fn,_n,wn,Un,In,t("p",null,[p("2、请求成功，重定向至"),r(Og,{href:"http://www.51xuecheng.cn/?code=%E6%8E%88%E6%9D%83%E7%A0%81%EF%BC%8C%E6%AF%94%E5%A6%82%EF%BC%9Ahttp://www.51xuecheng.cn/?code=Wqjb5H",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/?code=授权码，比如：http://www.51xuecheng.cn/?code=Wqjb5H")])),_:1})]),jn,Pn,Mn,Tn,On,zn,Rn,Ln,Wn,Nn,Jn,Xn,qn,Gn,Kn,Vn,Hn,Zn,t("h5",Qn,[Yn,p(),r(Og,{class:"header-anchor",href:"#_2-3-3-3-密码模式","aria-label":'Permalink to "**2.3.3.3 密码模式**"'},{default:e((()=>[p("​")])),_:1})]),$n,se,le,oe,ne,ee,ae,ce,te,pe,re,Ee,ye,ie,ue,Fe,t("h5",de,[ge,p(),r(Og,{class:"header-anchor",href:"#_2-3-3-4-本项目的应用方式","aria-label":'Permalink to "**2.3.3.4 本项目的应用方式**"'},{default:e((()=>[p("​")])),_:1})]),he,t("h3",Ae,[De,p(),r(Og,{class:"header-anchor",href:"#_2-4-jwt","aria-label":'Permalink to "**2.4 JWT**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",Ce,[me,p(),r(Og,{class:"header-anchor",href:"#_2-4-1-普通令牌的问题","aria-label":'Permalink to "**2.4.1 普通令牌的问题**"'},{default:e((()=>[p("​")])),_:1})]),be,Be,ke,Se,ve,xe,fe,_e,we,Ue,Ie,je,Pe,Me,t("h4",Te,[Oe,p(),r(Og,{class:"header-anchor",href:"#_2-4-2-什么是jwt","aria-label":'Permalink to "**2.4.2 什么是JWT**"'},{default:e((()=>[p("​")])),_:1})]),ze,t("p",null,[p("JSON Web Token（JWT）是一种使用JSON格式传递数据的网络令牌技术，它是一个开放的行业标准（RFC 7519），它定义了一种简洁的、自包含的协议格式，用于在通信双方传递json对象，传递的信息经过数字签名可以被验证和信任，它可以使用HMAC算法或使用RSA的公钥/私钥对来签名，防止内容篡改。官网："),r(Og,{href:"https://jwt.io/",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://jwt.io/")])),_:1})]),Re,Le,We,Ne,Je,Xe,qe,Ge,Ke,Ve,He,Ze,Qe,Ye,$e,sa,la,oa,na,ea,aa,ca,ta,pa,ra,Ea,ya,ia,ua,Fa,da,ga,ha,Aa,Da,Ca,ma,ba,Ba,ka,Sa,t("h4",va,[xa,p(),r(Og,{class:"header-anchor",href:"#_2-4-3-测试生成jwt令牌","aria-label":'Permalink to "**2.4.3 测试生成JWT令牌**"'},{default:e((()=>[p("​")])),_:1})]),fa,_a,wa,Ua,Ia,ja,Pa,Ma,Ta,Oa,za,Ra,La,Wa,Na,Ja,Xa,t("h4",qa,[Ga,p(),r(Og,{class:"header-anchor",href:"#_2-4-4-测试资源服务校验令牌","aria-label":'Permalink to "**2.4.4 测试资源服务校验令牌**"'},{default:e((()=>[p("​")])),_:1})]),Ka,Va,Ha,Za,Qa,Ya,$a,sc,lc,oc,nc,ec,ac,cc,tc,pc,rc,Ec,yc,ic,uc,Fc,dc,gc,t("h4",hc,[Ac,p(),r(Og,{class:"header-anchor",href:"#_2-4-5-测试获取用户身份","aria-label":'Permalink to "**2.4.5 测试获取用户身份**"'},{default:e((()=>[p("​")])),_:1})]),Dc,Cc,mc,bc,Bc,kc,Sc,vc,xc,fc,t("h3",_c,[wc,p(),r(Og,{class:"header-anchor",href:"#_2-5-网关认证","aria-label":'Permalink to "**2.5 网关认证**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",Uc,[Ic,p(),r(Og,{class:"header-anchor",href:"#_2-5-1-技术方案","aria-label":'Permalink to "**2.5.1 技术方案**"'},{default:e((()=>[p("​")])),_:1})]),jc,Pc,Mc,Tc,Oc,zc,Rc,Lc,Wc,Nc,Jc,Xc,t("h4",qc,[Gc,p(),r(Og,{class:"header-anchor",href:"#_2-5-2-实现网关认证","aria-label":'Permalink to "**2.5.2 实现网关认证**"'},{default:e((()=>[p("​")])),_:1})]),Kc,Vc,Hc,Zc,Qc,Yc,$c,st,lt,ot,nt,et,at,ct,tt,pt,rt,Et,yt,it,t("h2",ut,[Ft,p(),r(Og,{class:"header-anchor",href:"#_3-用户认证","aria-label":'Permalink to "**3 用户认证**"'},{default:e((()=>[p("​")])),_:1})]),t("h3",dt,[gt,p(),r(Og,{class:"header-anchor",href:"#_3-1-需求分析","aria-label":'Permalink to "**3.1 需求分析**"'},{default:e((()=>[p("​")])),_:1})]),ht,At,Dt,t("h3",Ct,[mt,p(),r(Og,{class:"header-anchor",href:"#_3-2-连接用户中心数据库","aria-label":'Permalink to "**3.2 连接用户中心数据库**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",bt,[Bt,p(),r(Og,{class:"header-anchor",href:"#_3-2-1-连接数据库认证","aria-label":'Permalink to "**3.2.1 连接数据库认证**"'},{default:e((()=>[p("​")])),_:1})]),kt,St,vt,xt,ft,_t,wt,Ut,It,jt,Pt,Mt,Tt,Ot,zt,Rt,Lt,Wt,Nt,Jt,Xt,qt,Gt,Kt,Vt,Ht,Zt,Qt,Yt,$t,sp,lp,op,np,ep,ap,cp,tp,t("h4",pp,[rp,p(),r(Og,{class:"header-anchor",href:"#_3-2-2-扩展用户身份信息","aria-label":'Permalink to "**3.2.2 扩展用户身份信息**"'},{default:e((()=>[p("​")])),_:1})]),Ep,yp,ip,up,Fp,dp,gp,hp,Ap,Dp,Cp,mp,bp,t("h4",Bp,[kp,p(),r(Og,{class:"header-anchor",href:"#_3-2-3-资源服务获取用户身份","aria-label":'Permalink to "**3.2.3 资源服务获取用户身份**"'},{default:e((()=>[p("​")])),_:1})]),Sp,vp,xp,fp,_p,wp,Up,Ip,jp,Pp,t("h3",Mp,[Tp,p(),r(Og,{class:"header-anchor",href:"#_3-3-支持认证方式多样","aria-label":'Permalink to "**3.3 支持认证方式多样**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",Op,[zp,p(),r(Og,{class:"header-anchor",href:"#_3-3-1-统一认证入口","aria-label":'Permalink to "**3.3.1 统一认证入口**"'},{default:e((()=>[p("​")])),_:1})]),Rp,Lp,Wp,Np,Jp,Xp,qp,Gp,Kp,Vp,Hp,Zp,Qp,Yp,$p,sr,lr,or,nr,er,ar,cr,tr,pr,rr,Er,yr,ir,ur,Fr,dr,t("h4",gr,[hr,p(),r(Og,{class:"header-anchor",href:"#_3-3-2-实现账号密码认证","aria-label":'Permalink to "**3.3.2 实现账号密码认证**"'},{default:e((()=>[p("​")])),_:1})]),Ar,Dr,Cr,mr,br,Br,kr,Sr,t("h3",vr,[xr,p(),r(Og,{class:"header-anchor",href:"#_3-4-验证码服务","aria-label":'Permalink to "**3.4 验证码服务**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",fr,[_r,p(),r(Og,{class:"header-anchor",href:"#_3-4-1-创建验证码服务工程","aria-label":'Permalink to "**3.4.1 创建验证码服务工程**"'},{default:e((()=>[p("​")])),_:1})]),wr,Ur,Ir,jr,Pr,Mr,Tr,Or,zr,Rr,Lr,Wr,Nr,Jr,Xr,t("h4",qr,[Gr,p(),r(Og,{class:"header-anchor",href:"#_3-4-2-验证码接口测试","aria-label":'Permalink to "**3.4.2 验证码接口测试**"'},{default:e((()=>[p("​")])),_:1})]),Kr,Vr,Hr,Zr,Qr,Yr,$r,sE,lE,oE,nE,eE,aE,cE,tE,pE,rE,EE,yE,iE,uE,t("h3",FE,[dE,p(),r(Og,{class:"header-anchor",href:"#_3-5-账号密码认证","aria-label":'Permalink to "**3.5 账号密码认证**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",gE,[hE,p(),r(Og,{class:"header-anchor",href:"#_3-5-1-需求分析","aria-label":'Permalink to "**3.5.1 需求分析**"'},{default:e((()=>[p("​")])),_:1})]),AE,DE,CE,mE,t("h4",bE,[BE,p(),r(Og,{class:"header-anchor",href:"#_3-5-2-账号密码认证开发","aria-label":'Permalink to "**3.5.2 账号密码认证开发**"'},{default:e((()=>[p("​")])),_:1})]),kE,SE,vE,xE,fE,_E,wE,UE,IE,jE,PE,t("h4",ME,[TE,p(),r(Og,{class:"header-anchor",href:"#_3-5-3-账号密码认证测试","aria-label":'Permalink to "**3.5.3 账号密码认证测试**"'},{default:e((()=>[p("​")])),_:1})]),t("p",null,[p("1、使用浏览器访问 "),r(Og,{href:"http://www.51xuecheng.cn/sign.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/sign.html")])),_:1})]),OE,zE,RE,LE,WE,NE,t("h2",JE,[XE,p(),r(Og,{class:"header-anchor",href:"#_4-微信扫码登录","aria-label":'Permalink to "**4 微信扫码登录**"'},{default:e((()=>[p("​")])),_:1})]),t("h3",qE,[GE,p(),r(Og,{class:"header-anchor",href:"#_4-1-接入规范","aria-label":'Permalink to "**4.1 接入规范**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",KE,[VE,p(),r(Og,{class:"header-anchor",href:"#_4-1-1-接入流程","aria-label":'Permalink to "**4.1.1 接入流程**"'},{default:e((()=>[p("​")])),_:1})]),HE,ZE,t("p",null,[r(Og,{href:"https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html")])),_:1})]),QE,YE,$E,t("h4",sy,[ly,p(),r(Og,{class:"header-anchor",href:"#_4-1-2-请求获取授权码","aria-label":'Permalink to "**4.1.2 请求获取授权码**"'},{default:e((()=>[p("​")])),_:1})]),t("p",null,[p("第三方使用网站应用授权登录前请注意已获取相应网页授权作用域（"),oy,p("），则可以通过在 PC 端打开以下链接： "),r(Og,{href:"https://open.weixin.qq.com/connect/qrconnect?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://open.weixin.qq.com/connect/qrconnect?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect")])),_:1}),p(" 若提示“该链接无法访问”，请检查参数是否填写错误，如"),ny,p("的域名与审核时填写的授权域名不一致或 scope 不为"),ey,p("。")]),ay,cy,ty,py,ry,Ey,t("p",null,[p("登录一号店网站应用 "),r(Og,{href:"https://test.yhd.com/wechat/login.do",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://test.yhd.com/wechat/login.do")])),_:1}),p(" 打开后，一号店会生成 state 参数，跳转到 "),r(Og,{href:"https://open.weixin.qq.com/connect/qrconnect?appid=wxbdc5610cc59c1631&redirect_uri=https%3A%2F%2Fpassport.yhd.com%2Fwechat%2Fcallback.do&response_type=code&scope=snsapi_login&state=3d6be0a4035d839573b04816624a415e#wechat_redirect",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://open.weixin.qq.com/connect/qrconnect?appid=wxbdc5610cc59c1631&redirect_uri=https%3A%2F%2Fpassport.yhd.com%2Fwechat%2Fcallback.do&response_type=code&scope=snsapi_login&state=3d6be0a4035d839573b04816624a415e#wechat_redirect")])),_:1}),p(" 微信用户使用微信扫描二维码并且确认登录后，PC端会跳转到 "),r(Og,{href:"https://test.yhd.com/wechat/callback.do?code=CODE&state=3d6be0a40sssssxxxxx6624a415e",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://test.yhd.com/wechat/callback.do?code=CODE&state=3d6be0a40sssssxxxxx6624a415e")])),_:1}),p(" 为了满足网站更定制化的需求，我们还提供了第二种获取 code 的方式，支持网站将微信登录二维码内嵌到自己页面中，用户使用微信扫码授权后通过 JS 将code返回给网站。 JS微信登录主要用途：网站希望用户在网站内就能完成登录，无需跳转到微信域下登录后再返回，提升微信登录的流畅性与成功率。 网站内嵌二维码微信登录 JS 实现办法：")]),yy,iy,uy,Fy,dy,t("h4",gy,[hy,p(),r(Og,{class:"header-anchor",href:"#_4-1-3-通过-code-获取access-token","aria-label":'Permalink to "**4.1.3 通过 code 获取access_token**"'},{default:e((()=>[p("​")])),_:1})]),Ay,Dy,Cy,my,by,By,ky,Sy,vy,xy,t("h4",fy,[_y,p(),r(Og,{class:"header-anchor",href:"#_4-1-4-通过access-token调用接口","aria-label":'Permalink to "**4.1.4 通过access_token调用接口**"'},{default:e((()=>[p("​")])),_:1})]),wy,Uy,Iy,jy,t("p",null,[p("其中"),Py,p("属于基础接口，若应用已拥有其它 scope 权限，则默认拥有"),My,p("的权限。使用"),Ty,p("可以让移动端网页授权绕过跳转授权登录页请求用户授权的动作，直接跳转第三方网页带上授权临时票据（code），但会使得用户已授权作用域（scope）仅为"),Oy,p("，从而导致无法获取到需要用户授权才允许获得的数据和基础功能。 接口调用方法可查阅"),r(Og,{href:"https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Authorized_Interface_Calling_UnionID.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("《微信授权关系接口调用指南》")])),_:1})]),t("p",null,[p("获取用户信息接口文档："),r(Og,{href:"https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Authorized_Interface_Calling_UnionID.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Authorized_Interface_Calling_UnionID.html")])),_:1})]),zy,Ry,Ly,Wy,Ny,Jy,Xy,qy,t("h3",Gy,[Ky,p(),r(Og,{class:"header-anchor",href:"#_4-2-准备开发环境","aria-label":'Permalink to "**4.2 准备开发环境**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",Vy,[Hy,p(),r(Og,{class:"header-anchor",href:"#_4-2-1-添加应用","aria-label":'Permalink to "**4.2.1 添加应用**"'},{default:e((()=>[p("​")])),_:1})]),Zy,t("p",null,[r(Og,{href:"https://open.weixin.qq.com/",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("https://open.weixin.qq.com/")])),_:1})]),Qy,Yy,$y,si,li,oi,t("h4",ni,[ei,p(),r(Og,{class:"header-anchor",href:"#_4-2-2-内网穿透","aria-label":'Permalink to "**4.2.2 内网穿透**"'},{default:e((()=>[p("​")])),_:1})]),ai,ci,ti,pi,ri,Ei,yi,ii,ui,Fi,t("h4",di,[p("4.2.3 无需使用内网穿透（固定端口） "),r(Og,{class:"header-anchor",href:"#_4-2-3-无需使用内网穿透-固定端口","aria-label":'Permalink to "4.2.3 无需使用内网穿透（固定端口）"'},{default:e((()=>[p("​")])),_:1})]),gi,hi,Ai,Di,Ci,mi,t("h3",bi,[Bi,p(),r(Og,{class:"header-anchor",href:"#_4-3-接入微信登录","aria-label":'Permalink to "**4.3 接入微信登录**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",ki,[Si,p(),r(Og,{class:"header-anchor",href:"#_4-3-1-接入分析","aria-label":'Permalink to "**4.3.1 接入分析**"'},{default:e((()=>[p("​")])),_:1})]),vi,xi,fi,_i,wi,Ui,Ii,ji,t("h4",Pi,[Mi,p(),r(Og,{class:"header-anchor",href:"#_4-3-2-定义接口","aria-label":'Permalink to "**4.3.2 定义接口**"'},{default:e((()=>[p("​")])),_:1})]),Ti,Oi,zi,Ri,Li,t("h4",Wi,[Ni,p(),r(Og,{class:"header-anchor",href:"#_4-3-3-接口环境测试","aria-label":'Permalink to "**4.3.3 接口环境测试**"'},{default:e((()=>[p("​")])),_:1})]),Ji,Xi,qi,Gi,Ki,Vi,Hi,Zi,t("p",null,[p("此时正常进入 "),Qi,p(" 方法，最后跳转到"),r(Og,{href:"http://www.51xuecheng.cn/sign.html?username=t1&authType=wx%E3%80%82",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/sign.html?username=t1&authType=wx。")])),_:1})]),t("h4",Yi,[$i,p(),r(Og,{class:"header-anchor",href:"#_4-3-4-申请令牌","aria-label":'Permalink to "**4.3.4 申请令牌**"'},{default:e((()=>[p("​")])),_:1})]),su,lu,ou,nu,eu,au,cu,tu,pu,ru,Eu,yu,t("p",null,[p("2、进入"),r(Og,{href:"http://www.51xuecheng.cn/wxsign.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/wxsign.html")])),_:1})]),iu,t("h4",uu,[Fu,p(),r(Og,{class:"header-anchor",href:"#_4-3-5-获取用户信息","aria-label":'Permalink to "**4.3.5 获取用户信息**"'},{default:e((()=>[p("​")])),_:1})]),du,gu,hu,Au,Du,Cu,t("p",null,[p("2、进入"),r(Og,{href:"http://www.51xuecheng.cn/wxsign.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/wxsign.html")])),_:1})]),mu,t("h4",bu,[Bu,p(),r(Og,{class:"header-anchor",href:"#_4-3-6-保存用户信息","aria-label":'Permalink to "**4.3.6 保存用户信息**"'},{default:e((()=>[p("​")])),_:1})]),ku,Su,vu,xu,fu,_u,t("p",null,[p("2、进入"),r(Og,{href:"http://www.51xuecheng.cn/wxsign.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/wxsign.html")])),_:1})]),wu,Uu,t("h2",Iu,[ju,p(),r(Og,{class:"header-anchor",href:"#_5-用户授权","aria-label":'Permalink to "**5 用户授权**"'},{default:e((()=>[p("​")])),_:1})]),t("h3",Pu,[Mu,p(),r(Og,{class:"header-anchor",href:"#_5-1-rbac","aria-label":'Permalink to "**5.1 RBAC**"'},{default:e((()=>[p("​")])),_:1})]),Tu,Ou,zu,Ru,Lu,Wu,Nu,Ju,Xu,qu,Gu,Ku,Vu,Hu,Zu,Qu,Yu,t("h3",$u,[sF,p(),r(Og,{class:"header-anchor",href:"#_5-2-资源服务授权流程","aria-label":'Permalink to "**5.2 资源服务授权流程**"'},{default:e((()=>[p("​")])),_:1})]),lF,oF,nF,eF,aF,cF,tF,pF,rF,EF,yF,iF,uF,FF,dF,gF,hF,AF,DF,t("h3",CF,[mF,p(),r(Og,{class:"header-anchor",href:"#_5-3-授权相关的数据模型","aria-label":'Permalink to "**5.3 授权相关的数据模型**"'},{default:e((()=>[p("​")])),_:1})]),bF,BF,kF,SF,vF,xF,fF,_F,wF,UF,IF,jF,PF,MF,TF,OF,zF,RF,LF,WF,NF,JF,XF,qF,GF,KF,VF,t("h3",HF,[ZF,p(),r(Og,{class:"header-anchor",href:"#_5-4-查询用户权限","aria-label":'Permalink to "**5.4 查询用户权限**"'},{default:e((()=>[p("​")])),_:1})]),QF,YF,$F,sd,ld,od,nd,ed,t("h3",ad,[cd,p(),r(Og,{class:"header-anchor",href:"#_5-5-授权测试","aria-label":'Permalink to "**5.5 授权测试**"'},{default:e((()=>[p("​")])),_:1})]),td,pd,rd,Ed,yd,id,ud,Fd,dd,gd,hd,Ad,t("h3",Dd,[Cd,p(),r(Og,{class:"header-anchor",href:"#_5-6-细粒度授权","aria-label":'Permalink to "**5.6 细粒度授权**"'},{default:e((()=>[p("​")])),_:1})]),t("h4",md,[bd,p(),r(Og,{class:"header-anchor",href:"#_5-6-1-什么是细粒度授权","aria-label":'Permalink to "**5.6.1 什么是细粒度授权**"'},{default:e((()=>[p("​")])),_:1})]),Bd,kd,Sd,vd,xd,fd,_d,wd,t("h4",Ud,[Id,p(),r(Og,{class:"header-anchor",href:"#_5-6-2-教学机构细粒度授权","aria-label":'Permalink to "**5.6.2 教学机构细粒度授权**"'},{default:e((()=>[p("​")])),_:1})]),jd,Pd,Md,Td,Od,zd,Rd,Ld,Wd,t("h4",Nd,[Jd,p(),r(Og,{class:"header-anchor",href:"#_5-6-3-教学机构细粒度授权测试","aria-label":'Permalink to "**5.6.3 教学机构细粒度授权测试**"'},{default:e((()=>[p("​")])),_:1})]),Xd,qd,Gd,Kd,Vd,Hd,Zd,Qd,Yd,$d,sg,t("h2",lg,[og,p(),r(Og,{class:"header-anchor",href:"#_6-实战","aria-label":'Permalink to "**6 实战**"'},{default:e((()=>[p("​")])),_:1})]),t("h3",ng,[eg,p(),r(Og,{class:"header-anchor",href:"#_6-1-找回密码-实战","aria-label":'Permalink to "**6.1 找回密码(实战)**"'},{default:e((()=>[p("​")])),_:1})]),ag,t("p",null,[p("界面访问地址："),r(Og,{href:"http://www.51xuecheng.cn/findpassword.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/findpassword.html")])),_:1})]),cg,tg,pg,rg,Eg,yg,ig,ug,Fg,dg,gg,hg,Ag,Dg,t("h3",Cg,[mg,p(),r(Og,{class:"header-anchor",href:"#_6-2-注册-实战","aria-label":'Permalink to "**6.2 注册(实战)**"'},{default:e((()=>[p("​")])),_:1})]),bg,t("p",null,[p("界面访问地址："),r(Og,{href:"http://www.51xuecheng.cn/register.html",target:"_blank",rel:"noreferrer"},{default:e((()=>[p("http://www.51xuecheng.cn/register.html")])),_:1})]),Bg,kg,Sg,vg,xg,fg,_g,wg,Ug,Ig,jg,Pg,Mg,Tg])),"main-header":e((()=>[E(s.$slots,"main-header")])),"main-header-after":e((()=>[E(s.$slots,"main-header-after")])),"main-nav":e((()=>[E(s.$slots,"main-nav")])),"main-content":e((()=>[E(s.$slots,"main-content")])),"main-content-after":e((()=>[E(s.$slots,"main-content-after")])),"main-nav-before":e((()=>[E(s.$slots,"main-nav-before")])),"main-nav-after":e((()=>[E(s.$slots,"main-nav-after")])),comment:e((()=>[E(s.$slots,"comment")])),footer:e((()=>[E(s.$slots,"footer")])),aside:e((()=>[E(s.$slots,"aside")])),"aside-custom":e((()=>[E(s.$slots,"aside-custom")])),default:e((()=>[E(s.$slots,"default")])),_:3},8,["frontmatter","data"])}]]);export{i as __pageData,Og as default};
