import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang-a2062fb2.js";import{_ as y,c as D,w as o,o as F,a as l,b as s,d as e,f as A,r as a,e as C,p as d}from"./app-85f8ae31.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-7d383f51.js";import"./YunCard.vue_vue_type_style_index_0_lang-b90e638b.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-9ca27c39.js";const fs=JSON.parse('{"title":"旋转吧！徽章！","description":"","frontmatter":{"title":"旋转吧！徽章！","date":"2021-09-05T21:46:11.000Z","updated":"2021-09-19T21:46:11.000Z","tags":["蚂蚁森林","徽章","动画"],"categories":["云游的小笔记"],"katex":true},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"简介","slug":"简介","link":"#简介","children":[]},{"level":2,"title":"长啥样","slug":"长啥样","link":"#长啥样","children":[]},{"level":2,"title":"我的实现方案","slug":"我的实现方案","link":"#我的实现方案","children":[{"level":3,"title":"如何拖动徽章？","slug":"如何拖动徽章？","link":"#如何拖动徽章？","children":[]},{"level":3,"title":"分析动画","slug":"分析动画","link":"#分析动画","children":[]}]},{"level":2,"title":"详细步骤","slug":"详细步骤","link":"#详细步骤","children":[{"level":3,"title":"初速度","slug":"初速度","link":"#初速度","children":[]},{"level":3,"title":"徽章旋转衰减","slug":"徽章旋转衰减","link":"#徽章旋转衰减","children":[]},{"level":3,"title":"平面重力","slug":"平面重力","link":"#平面重力","children":[]},{"level":3,"title":"如何停止","slug":"如何停止","link":"#如何停止","children":[]},{"level":3,"title":"抽象函数","slug":"抽象函数","link":"#抽象函数","children":[]},{"level":3,"title":"可复用","slug":"可复用","link":"#可复用","children":[]},{"level":3,"title":"最后一公里","slug":"最后一公里","link":"#最后一公里","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"relativePath":"pages/posts/how-to-realize-badge-rotation.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-blog\\\\imLKlauS.github.io-valaxy\\\\pages\\\\posts\\\\how-to-realize-badge-rotation.md","lastUpdated":null}'),c=JSON.parse('{"title":"旋转吧！徽章！","description":"","frontmatter":{"title":"旋转吧！徽章！","date":"2021-09-05T21:46:11.000Z","updated":"2021-09-19T21:46:11.000Z","tags":["蚂蚁森林","徽章","动画"],"categories":["云游的小笔记"],"katex":true},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"简介","slug":"简介","link":"#简介","children":[]},{"level":2,"title":"长啥样","slug":"长啥样","link":"#长啥样","children":[]},{"level":2,"title":"我的实现方案","slug":"我的实现方案","link":"#我的实现方案","children":[{"level":3,"title":"如何拖动徽章？","slug":"如何拖动徽章？","link":"#如何拖动徽章？","children":[]},{"level":3,"title":"分析动画","slug":"分析动画","link":"#分析动画","children":[]}]},{"level":2,"title":"详细步骤","slug":"详细步骤","link":"#详细步骤","children":[{"level":3,"title":"初速度","slug":"初速度","link":"#初速度","children":[]},{"level":3,"title":"徽章旋转衰减","slug":"徽章旋转衰减","link":"#徽章旋转衰减","children":[]},{"level":3,"title":"平面重力","slug":"平面重力","link":"#平面重力","children":[]},{"level":3,"title":"如何停止","slug":"如何停止","link":"#如何停止","children":[]},{"level":3,"title":"抽象函数","slug":"抽象函数","link":"#抽象函数","children":[]},{"level":3,"title":"可复用","slug":"可复用","link":"#可复用","children":[]},{"level":3,"title":"最后一公里","slug":"最后一公里","link":"#最后一公里","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"relativePath":"pages/posts/how-to-realize-badge-rotation.md","path":"D:\\\\Learning\\\\myblog\\\\valaxy-blog\\\\imLKlauS.github.io-valaxy\\\\pages\\\\posts\\\\how-to-realize-badge-rotation.md","lastUpdated":null}'),u={name:"pages/posts/how-to-realize-badge-rotation.md",data(){return{data:c,frontmatter:c.frontmatter}},setup(){d("pageData",c)}},h=l("p",null,"如何实现一个徽章惯性旋转动画？",-1),_={id:"前言",tabindex:"-1"},m=l("p",null,"距离上一次写技术文章过去了多久呢？大概已经屈指不可数了。 与此前相比，无论心境还是境遇也都变化了许多，而我本打算记录的实习生涯还未动笔，便已接近尾声。但愿还有机会一叙。",-1),f=l("p",null,"在家中慵懒地躺了数日，自觉不应继续如此，方翻了个身，决定将此文修整完，以略表奋发之意。 总之，也由衷地希望大家能从中学习到什么或是给我一些更好的改进建议。",-1),g=l("p",null,"那么，……，先旋转起来吧？",-1),b={id:"简介",tabindex:"-1"},v=l("p",null,[s("本篇文章原本来自于写「🐜 蚂蚁 🌲 森林 🐒 神奇动物」徽章动画时总结的技术分享，考虑到各种因素，已去除了敏感资源。 并编写了更为抽象（"),l("s",null,"高内聚、低耦合"),s("）的代码作为示例。")],-1),E=l("ul",null,[l("li",null,"一份大致技术流程的分享 Slide")],-1),k=l("p",null,[l("s",null,"这也是我离开腾讯后，前去蚂蚁实习做的第一个项目。")],-1),x={id:"长啥样",tabindex:"-1"},w=l("p",null,"那么首先，我们来看看这个动画的效果。",-1),B=l("div",{class:"success"},[l("blockquote",null,[l("p",null,"进入 「蚂蚁森林」 左上角 - 点击发现神奇物种（继续点左上角）")])],-1),S=l("p",null,[l("video",{src:"https://r2.yunyoujun.cn/videos/demo/ant-forest-animal-badge-rotation.mp4",alt:"徽章旋转",controls:""})],-1),q=l("blockquote",null,[l("p",null,"那么我实现了什么？")],-1),R=l("ul",null,[l("li",null,"拖动 3D 徽章"),l("li",null,"根据拖动速度展现的惯性动画"),l("li",null,"停止时总是停留在正/反面"),l("li",null,"进入时的晃动动画"),l("li",null,"轻拍晃动效果 👏"),l("li",null,"陀螺仪效果（晃动手机） 📱")],-1),T=l("p",null,"尽管这是一个简单的效果，但也同样有着一些细节和需要注意的问题。 接下来将主要就我选取的实现方案和遇到的问题进行分享。",-1),I=l("p",null,"顺便放一个简单的示例（可以直接拖动哦～）：",-1),P=l("iframe",{style:{height:"85vh"},src:"https://explosions.yunyoujun.cn/badge-rotation"},null,-1),$={id:"我的实现方案",tabindex:"-1"},j=l("p",null,"我们的首要任务是实现拖动徽章，松开手后的惯性动画。",-1),X=l("blockquote",null,[l("p",null,"你问我为什么不用 Three.js？懂得都懂。 当然 Three.js 较大，且业务可能存在很多定制需求，这也是一部分原因。")],-1),O={id:"如何拖动徽章？",tabindex:"-1"},Y=l("p",null,"首先，我们至少要保证徽章是可拖动的。 那么我们只需要计算屏幕触摸点横向移动的差值（delta X），按比例赋值给徽章饶 Y 轴旋转的角度（欧拉角 y）。",-1),z=l("blockquote",null,[l("p",null,"So easy? 此时还基本无需考虑动画的问题。因为手指移动是连续的，旋转就是连续的。")],-1),V=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," deltaX "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," curPos"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"x "),l("span",{style:{color:"#89DDFF"}},"-"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"this."),l("span",{style:{color:"#A6ACCD"}},"lastPos"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"x"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"model"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"eulerAngles"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"y "),l("span",{style:{color:"#89DDFF"}},"+="),l("span",{style:{color:"#A6ACCD"}}," deltaX"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"})])])],-1),L=l("blockquote",null,[l("p",null,"setInterval VS setTimeout VS requestAnimationFrame")],-1),M=l("p",null,"当我们的滑动停止后，徽章仍继续转动，这意味着这应当是一个动画。 在实现动画之前，我们先来考虑一下动画的机制。",-1),N=l("blockquote",null,[l("p",null,"屏幕的渲染帧率通常是：60fps")],-1),J=l("div",{class:"warning"},[l("blockquote",null,[l("p",null,[s("但实际上这里还有个坑，iOS 省电模式下会降低帧率，导致不同情况下表现不一致。反而不如使用 "),l("code",null,"setInterval"),s(" 替代 "),l("code",null,"requestAnimationFrame"),s("。 不过如果你业余写的小玩具用户量并没有达到蚂蚁森林的千万级别，也许还并不需要花心思考虑这些。更简洁才更优雅。")])])],-1),W=l("div",{class:"info"},[l("blockquote",null,[l("p",null,"你准备更新动画时你应该调用此方法。这将使浏览器在下一次重绘之前调用你传入给该方法的动画函数(即你的回调函数)。 回调函数执行次数通常是每秒 60 次，与浏览器屏幕刷新次数相匹配。")])],-1),Z={id:"分析动画",tabindex:"-1"},U=l("p",null,"接下来，我们对动画的状态进行一下分解。",-1),G=l("ul",null,[l("li",null,"拖动徽章（此时无需考虑动画、但要避免拖动与惯性动画冲突）"),l("li",null,"手离开屏幕，徽章旋转速度逐渐衰减（需要得知初速度）"),l("li",null,"最终总是停留在正面或是反面（在平面上的不同区间赋予对应方向的加速度）")],-1),K=l("p",null,"🤔，可能简短的文字难以描述清楚，我们来看一下具体的实现步骤。",-1),Q={id:"详细步骤",tabindex:"-1"},H=l("p",null,"事实上，我们将其抽象理解为物理世界中的速度，最后再根据不同阶段计算得出的速度，去算出对应旋转的角度，在每帧渲染时赋值给徽章即可。",-1),ll={id:"初速度",tabindex:"-1"},sl=l("p",null,"惯性动画，意味着徽章本身结束动应当有一个初速度。",-1),ol=l("div",{class:"info"},[l("blockquote",null,[l("p",null,"牛顿三大定律-第一定律：假若施加于某物体的外力为零，则该物体的运动速度不变（惯性定律）")])],-1),nl=l("p",null,[s("好吧，其实和惯性定律关系不大。（"),l("s",null,"我只是想放个定律在这里显得高大上一点。"),s("） 简而言之，我们可以在拖动结束时，即监听 "),l("code",null,"touchEnd"),s(" 时间时赋予徽章一个初速度。")],-1),el=l("p",null,"而该初速度可通过手指在屏幕上横向滑动的距离与滑动时间的比值计算而得。",-1),tl=l("p",null,[l("span",{class:"katex-display"},[l("span",{class:"katex"},[l("span",{class:"katex-mathml"},[l("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[l("semantics",null,[l("mrow",null,[l("mi",null,"v"),l("mo",null,"="),l("mfrac",null,[l("mrow",null,[l("mi",{mathvariant:"normal"},"Δ"),l("mi",null,"x")]),l("mrow",null,[l("mi",{mathvariant:"normal"},"Δ"),l("mi",null,"t")])])]),l("annotation",{encoding:"application/x-tex"},"v = \\frac{\\Delta x}{\\Delta t} ")])])]),l("span",{class:"katex-html","aria-hidden":"true"},[l("span",{class:"base"},[l("span",{class:"strut",style:{height:"0.4306em"}}),l("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"v"),l("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),l("span",{class:"mrel"},"="),l("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),l("span",{class:"base"},[l("span",{class:"strut",style:{height:"2.0463em","vertical-align":"-0.686em"}}),l("span",{class:"mord"},[l("span",{class:"mopen nulldelimiter"}),l("span",{class:"mfrac"},[l("span",{class:"vlist-t vlist-t2"},[l("span",{class:"vlist-r"},[l("span",{class:"vlist",style:{height:"1.3603em"}},[l("span",{style:{top:"-2.314em"}},[l("span",{class:"pstrut",style:{height:"3em"}}),l("span",{class:"mord"},[l("span",{class:"mord"},"Δ"),l("span",{class:"mord mathnormal"},"t")])]),l("span",{style:{top:"-3.23em"}},[l("span",{class:"pstrut",style:{height:"3em"}}),l("span",{class:"frac-line",style:{"border-bottom-width":"0.04em"}})]),l("span",{style:{top:"-3.677em"}},[l("span",{class:"pstrut",style:{height:"3em"}}),l("span",{class:"mord"},[l("span",{class:"mord"},"Δ"),l("span",{class:"mord mathnormal"},"x")])])]),l("span",{class:"vlist-s"},"​")]),l("span",{class:"vlist-r"},[l("span",{class:"vlist",style:{height:"0.686em"}},[l("span")])])])]),l("span",{class:"mclose nulldelimiter"})])])])])])],-1),al=l("blockquote",null,[l("p",null,"Talk is cheap, show me your code.")],-1),cl=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"// 创建动画实例，具体实现见后文")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," inertiaAnimation "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"createInertiaAnimation"),l("span",{style:{color:"#A6ACCD"}},"("),l("span",{style:{color:"#89DDFF"}},"{...}"),l("span",{style:{color:"#A6ACCD"}},")")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"// 滑动距离")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," deltaX "),l("span",{style:{color:"#89DDFF"}},"=")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  e"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"changedTouches["),l("span",{style:{color:"#F78C6C"}},"0"),l("span",{style:{color:"#A6ACCD"}},"]"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"clientX "),l("span",{style:{color:"#89DDFF"}},"-"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"this."),l("span",{style:{color:"#A6ACCD"}},"prePos"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"x"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," touchEndTime "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"new"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"Date"),l("span",{style:{color:"#A6ACCD"}},"()"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"valueOf"),l("span",{style:{color:"#A6ACCD"}},"()"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"// 滑动时间")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," deltaTime "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," touchEndTime "),l("span",{style:{color:"#89DDFF"}},"-"),l("span",{style:{color:"#A6ACCD"}}," touchStartTime"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," * 初始速度，每 ms 旋转速度（设顺时针为正数）")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," * deltaX <= 0 为顺时针")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"let"),l("span",{style:{color:"#A6ACCD"}}," speed "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"-"),l("span",{style:{color:"#A6ACCD"}}," deltaX "),l("span",{style:{color:"#89DDFF"}},"/"),l("span",{style:{color:"#A6ACCD"}}," deltaTime"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"// 将速度赋予动画实例，播放动画")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"inertiaAnimation"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"playAnimation "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FF9CAC"}},"true"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"inertiaAnimation"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"speed "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," speed"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"inertiaAnimation"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"run"),l("span",{style:{color:"#A6ACCD"}},"()"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"})])])],-1),rl={id:"徽章旋转衰减",tabindex:"-1"},pl=l("p",null,"根据有限的中学物理知识，我们可以有两种方案来模拟衰减。",-1),il=l("ul",null,[l("li",null,"方案 1: 模拟物理重力，使用加速度来计算速度"),l("li",null,"方案 2: 模拟摩擦力，采用摩擦系数一样的衰减系数")],-1),yl=l("p",null,[s("我决定采用 "),l("code",null,"方案 2"),s("，其更简便、更符合逻辑。 譬如，当速度变为相反方向（徽章反着转）这时无需考虑数值的正反，只需乘以衰减系数即可。 此外，加速度模式在之后模拟水平方向上的重力会用到，可以避免两边的逻辑混杂在一起，难以编写。")],-1),Dl=l("p",null,"在经过尝试后，我决定将每帧的衰减系数设定为 0.95。",-1),Fl=l("blockquote",null,[l("p",null,[l("code",null,"u: 0.95")])],-1),Al=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," * 每一步动画")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," * "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"@"),l("span",{style:{color:"#C792EA","font-style":"italic"}},"param"),l("span",{style:{color:"#676E95","font-style":"italic"}}," "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"{"),l("span",{style:{color:"#FFCB6B","font-style":"italic"}},"number"),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"}"),l("span",{style:{color:"#676E95","font-style":"italic"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"timestamp")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"function"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"step"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"timestamp"),l("span",{style:{color:"#89DDFF"}},")"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#A6ACCD"}},"speed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"*="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"u"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"})])])],-1),Cl={id:"平面重力",tabindex:"-1"},dl=l("p",null,"速度衰减，意味着徽章最后可能停止在任意角度。但这并不是我们想要的，我们希望它能总是保持正/反面。",-1),ul=l("p",null,[l("img",{src:"https://r2.yunyoujun.cn/images/badge-rotate-to-middle.jpg",alt:"旋转到一半停了"})],-1),hl=l("p",null,"同样我们可以从物理角度进行思考，在水平面施加一个「重力」，使其总是保持正/反面。 这个重力（加速度）在徽章的左右区间正负是不一样的。",-1),_l=l("blockquote",null,[l("p",null,"假设从徽章顶部看，顺时针方向为正 ，同时我们可以划分为四个区间。")],-1),ml=l("p",null,"随后从屏幕看向徽章：（徽章的左半部分，且处于靠近屏幕外的位置时，简称为 左半外。）",-1),fl=l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"重力范围"),l("th",null,"加速度方向"),l("th",null,"数值")])]),l("tbody",null,[l("tr",null,[l("td",null,"左半外"),l("td",null,"加速度向屏幕内"),l("td",null,"+")]),l("tr",null,[l("td",null,"左半内"),l("td",null,"加速度向屏幕外"),l("td",null,"-")]),l("tr",null,[l("td",null,"右半外"),l("td",null,"加速度向屏幕内"),l("td",null,"-")]),l("tr",null,[l("td",null,"右半内"),l("td",null,"加速度向屏幕外"),l("td",null,"+")])])],-1),gl=l("p",null,"同时我们需要做一些细节的处理，比如旋转角度大于 180 的时候，负数的时候。 最后给不同旋转区间的角度时的徽章速度赋予不同的加速度。",-1),bl=l("blockquote",null,[l("p",null,[s("经过尝试后，我决定将水平重力影响系数设置为 0.008。"),l("code",null,"gravity: 0.008")])],-1),vl=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"// 一些乱七八糟的取余处理（因为会大于 180 嘛）")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," remainder "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"getRotation"),l("span",{style:{color:"#A6ACCD"}},"() "),l("span",{style:{color:"#89DDFF"}},"%"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"180"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," positiveRemainder "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," remainder "),l("span",{style:{color:"#89DDFF"}},"<"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"0"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"?"),l("span",{style:{color:"#A6ACCD"}}," remainder "),l("span",{style:{color:"#89DDFF"}},"+"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"180"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," remainder"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),l("span",{style:{color:"#A6ACCD"}}," (positiveRemainder "),l("span",{style:{color:"#89DDFF"}},">="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"90"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"&&"),l("span",{style:{color:"#A6ACCD"}}," positiveRemainder "),l("span",{style:{color:"#89DDFF"}},"<"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"180"),l("span",{style:{color:"#A6ACCD"}},") "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#A6ACCD"}},"speed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"-="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"gravity"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),l("span",{style:{color:"#A6ACCD"}}," (positiveRemainder "),l("span",{style:{color:"#89DDFF"}},">"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"0"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"&&"),l("span",{style:{color:"#A6ACCD"}}," positiveRemainder "),l("span",{style:{color:"#89DDFF"}},"<"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"90"),l("span",{style:{color:"#A6ACCD"}},") "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#A6ACCD"}},"speed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"+="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"gravity"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"})])])],-1),El={id:"如何停止",tabindex:"-1"},kl=l("p",null,"速度配合水平面的重力加速度，并根据衰减系数逐渐衰减，数字尽管越来越小，但其仍旧是浮点数。",-1),xl=l("blockquote",null,[l("p",null,"正所谓，「日取其半，万世不竭」。——《庄子》")],-1),wl=l("p",null,"因此我们需要明确徽章趋近于静止时的一个界限（可以被忽略的参数大小）。",-1),Bl=l("ul",null,[l("li",null,[l("code",null,"toleratedSpeed"),s(": 0.001 可以被忽略的速度")]),l("li",null,[l("code",null,"toleratedAngle"),s(": 5 可以被忽略的角度")])],-1),Sl=l("p",null,"此外，拖拽时会与加速度动画、以及后续的陀螺仪动画产生冲突，我们需要通过状态来使得他们互相独立。",-1),ql=l("p",null,[l("code",null,"_this.playAnimation"),s(" 是否允许播放动画（外部可修改，来决定是否允许播放动画） "),l("code",null,"_this.isPlaying"),s(" 记录状态，是否正在播放动画（仅用来记录内部是否正在播放的状态）")],-1),Rl=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"function"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"step"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"timestamp"),l("span",{style:{color:"#89DDFF"}},")"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"// 继续播放动画的条件（需要避免和后续的陀螺仪/拖动等冲突）")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),l("span",{style:{color:"#F07178"}}," (")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#A6ACCD"}},"_this"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"playAnimation"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"&&")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    ("),l("span",{style:{color:"#A6ACCD"}},"Math"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"abs"),l("span",{style:{color:"#F07178"}},"("),l("span",{style:{color:"#A6ACCD"}},"speed"),l("span",{style:{color:"#F07178"}},") "),l("span",{style:{color:"#89DDFF"}},">"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"toleratedSpeed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"||")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"      ("),l("span",{style:{color:"#A6ACCD"}},"positiveRemainder"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},">"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"toleratedAngel")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"      "),l("span",{style:{color:"#89DDFF"}},"&&"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"positiveRemainder"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"<"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#F78C6C"}},"180"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"-"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"toleratedAngel"),l("span",{style:{color:"#F07178"}},"))")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  ) "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"    "),l("span",{style:{color:"#676E95","font-style":"italic"}},"// 记录是否正在播放动画")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#A6ACCD"}},"_this"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"isPlaying"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#FF9CAC"}},"true"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"    "),l("span",{style:{color:"#676E95","font-style":"italic"}},"// 根据时间和速度，计算每一帧徽章应该旋转的角度")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"deltaRotation"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"speed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"*"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"elapsed"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#82AAFF"}},"setRotation"),l("span",{style:{color:"#F07178"}},"("),l("span",{style:{color:"#A6ACCD"}},"deltaRotation"),l("span",{style:{color:"#F07178"}},")"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"    "),l("span",{style:{color:"#676E95","font-style":"italic"}},"// 继续播放动画")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#A6ACCD"}},"window"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"requestAnimationFrame"),l("span",{style:{color:"#F07178"}},"("),l("span",{style:{color:"#A6ACCD"}},"step"),l("span",{style:{color:"#F07178"}},")"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"}"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#A6ACCD"}},"_this"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"isPlaying"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#FF9CAC"}},"false"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"})])])],-1),Tl={id:"抽象函数",tabindex:"-1"},Il=l("p",null,"到这里，功能便实现的差不多了，但我们仍旧可以对代码进一步进行优化。",-1),Pl=l("ul",null,[l("li",null,"使用 TypeScript 编写（增强类型提示）"),l("li",null,"抽象出可配置的参数"),l("li",null,"函数内部默认提供默认参数")],-1),$l=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"export"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"interface"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"InertiaAnimationOptions"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   * 初速度")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"speed"),l("span",{style:{color:"#89DDFF"}},"?:"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"number"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   * 水平重力影响系数")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"gravity"),l("span",{style:{color:"#89DDFF"}},"?:"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"number"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   * 衰减系数")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"u"),l("span",{style:{color:"#89DDFF"}},"?:"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"number"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   * 最后可忽略的速度")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"toleratedSpeed"),l("span",{style:{color:"#89DDFF"}},"?:"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"0.0005"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   * 最后可忽略的角度")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"toleratedAngel"),l("span",{style:{color:"#89DDFF"}},"?:"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"3"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   * 获取旋转角度")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"getRotation"),l("span",{style:{color:"#89DDFF"}},"?:"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"()"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"=>"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"number"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   * 设置旋转角度")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"   */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"setRotation"),l("span",{style:{color:"#89DDFF"}},"?:"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"deltaRotation"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"number"),l("span",{style:{color:"#89DDFF"}},")"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"=>"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"void"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"})])])],-1),jl=l("ul",null,[l("li",null,[s("函数式而非 Class（有一定争议，但 react 后来的 hooks 和 vue 的 createXXX 很明显都更加青睐函数） "),l("ul",null,[l("li",null,[l("code",null,"createInertiaAnimation")])])])],-1),Xl=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"/**")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," * 创建旋转惯性动画")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," *")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," * "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"@"),l("span",{style:{color:"#C792EA","font-style":"italic"}},"param"),l("span",{style:{color:"#676E95","font-style":"italic"}}," "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"{"),l("span",{style:{color:"#FFCB6B","font-style":"italic"}},"*"),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"}"),l("span",{style:{color:"#676E95","font-style":"italic"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"options")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," * "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"@"),l("span",{style:{color:"#C792EA","font-style":"italic"}},"param"),l("span",{style:{color:"#676E95","font-style":"italic"}}," "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"{"),l("span",{style:{color:"#FFCB6B","font-style":"italic"}},"Function"),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"}"),l("span",{style:{color:"#676E95","font-style":"italic"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"callback"),l("span",{style:{color:"#676E95","font-style":"italic"}}," 回调函数 设置状态")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}}," */")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"export"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"function"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"createInertiaAnimation"),l("span",{style:{color:"#89DDFF"}},"(")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"options"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FFCB6B"}},"InertiaAnimationOptions")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},")"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"})])])],-1),Ol={id:"可复用",tabindex:"-1"},Yl=l("p",null,"还有什么可以优化的点？ 此处动画的应用场景是 3D 模型，但倘若是换为图片、DOM？",-1),zl=l("code",null,"touchcancel",-1),Vl=l("p",null,"我们还可以进一步解耦，允许用户（开发者）可以任意自定义旋转方式。 暴露两个可以控制 rotation 的方法。",-1),Ll=l("ul",null,[l("li",null,[l("code",null,"setRotation"),s(": 设置旋转角度 "),l("code",null,"transform: rotateY(${val}deg)")]),l("li",null,[l("code",null,"getRotation"),s(": 获取旋转角度 "),l("code",null,"getComputedStyle")])],-1),Ml=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"// 创建动画实例")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," inertiaAnimation "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"createInertiaAnimation"),l("span",{style:{color:"#A6ACCD"}},"("),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"speed"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"0.2"),l("span",{style:{color:"#89DDFF"}},",")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"getRotation"),l("span",{style:{color:"#89DDFF"}},"()"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"rotateY"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"value"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"},")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#F07178"}},"setRotation"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"deltaRotation"),l("span",{style:{color:"#89DDFF"}},")"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"    "),l("span",{style:{color:"#A6ACCD"}},"rotateY"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"value"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"-="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"deltaRotation"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"},")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}"),l("span",{style:{color:"#A6ACCD"}},")"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"})])])],-1),Nl={id:"最后一公里",tabindex:"-1"},Jl=l("p",null,"事实上，交给我的徽章动画工作的确到这里就结束了。 但是真的结束了吗？我们还可以自己尝试继续加一点点优化，细节决定成败。",-1),Wl={id:"初始晃动效果",tabindex:"-1"},Zl=l("blockquote",null,[l("p",null,"用户打开徽章时，进行缓动，让用户知道它是可拖动的。此外这可以和此后的惯性动画共用一个实例，仅需赋予一个开始的初速度，即可快速实现。（也体现了此前优化封装的好处）")],-1),Ul=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," inertiaAnimation "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"createInertiaAnimation"),l("span",{style:{color:"#A6ACCD"}},"()"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"game"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"run"),l("span",{style:{color:"#A6ACCD"}},"(options"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"()"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"=>"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#A6ACCD"}},"inertiaAnimation"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"playAnimation"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#FF9CAC"}},"true"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"// 赋予一个微小的初速度，并播放动画")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#A6ACCD"}},"inertiaAnimation"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"speed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#F78C6C"}},"0.2"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#A6ACCD"}},"inertiaAnimation"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"run"),l("span",{style:{color:"#F07178"}},"()"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}"),l("span",{style:{color:"#A6ACCD"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),Gl={id:"轻拍晃动",tabindex:"-1"},Kl=l("blockquote",null,[l("p",null,"原本的初速度是根据移动距离和时间计算的，那么用户仅仅想拍一下徽章呢？ 这时没有反馈是不大好的，且较小数值的移动距离和时间，容易出现边界计算的问题。 当移动距离和时间小于一定数值时触发，并判断为左侧还是右侧。（同样公用一个动画实例，仅需赋予一个初速度，即可快速实现。）")],-1),Ql=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"// 轻拍")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," tapSpeed "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"0.3"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),l("span",{style:{color:"#A6ACCD"}}," (Math"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"abs"),l("span",{style:{color:"#A6ACCD"}},"(deltaX) "),l("span",{style:{color:"#89DDFF"}},"<"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"5"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"&&"),l("span",{style:{color:"#A6ACCD"}}," deltaTime "),l("span",{style:{color:"#89DDFF"}},"<"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#F78C6C"}},"200"),l("span",{style:{color:"#A6ACCD"}},") "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"pageWidth"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"document"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"documentElement"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"clientWidth"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#A6ACCD"}},"speed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"this."),l("span",{style:{color:"#A6ACCD"}},"prePos"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"x"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},">"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"pageWidth"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"/"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#F78C6C"}},"2"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"?"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"-"),l("span",{style:{color:"#A6ACCD"}},"tapSpeed"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"tapSpeed"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),l("span",{class:"line"})])])],-1),Hl={id:"陀螺仪",tabindex:"-1"},ls=l("blockquote",null,[l("p",null,"用户微微晃动手机，徽章总是面向用户，也是增强体验不错的方式。 但也存在一些小问题... 🐛")],-1),ss=l("ul",null,[l("li",null,[s("与惯性动画冲突造成抖动 "),l("ul",null,[l("li",null,"通过各类状态判断，当用户在拖动、仍在播放惯性动画时，陀螺仪效果不生效（与拖动和惯性动画之间的冲突处理逻辑类似）")])]),l("li",null,"陀螺仪因为用户初始拿的位置便具有数值（应当使用相对数值）"),l("li",null,[s("超过 90 度会突变为负数 "),l("code",null,"90 -> -89")]),l("li",null,[s("数值频率变化敏感 "),l("ul",null,[l("li",null,"通过相对计算，并进行缓动，过大变化时舍去")])]),l("li",null,[s("网页 API "),l("code",null,"deviceorientation"),s(" iOS 兼容问题")])],-1),os=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"window"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"addEventListener"),l("span",{style:{color:"#A6ACCD"}},"("),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#C3E88D"}},"deviceorientation"),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"event"),l("span",{style:{color:"#89DDFF"}},")"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"=>"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"// gamma: 从左到右")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#C792EA"}},"let"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"deltaGamma"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"event"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"gamma"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"-"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"this."),l("span",{style:{color:"#A6ACCD"}},"lastGamma"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#F07178"}},"  "),l("span",{style:{color:"#89DDFF"}},"...")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF"}},"},"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#FF9CAC"}},"true"),l("span",{style:{color:"#A6ACCD"}},")"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"})])])],-1),ns={id:"总结",tabindex:"-1"},es=l("code",null,"@explosions/badge-rotation",-1),ts=l("div",{class:"language-bash"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#FFCB6B"}},"npm"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C3E88D"}},"install"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C3E88D"}},"@explosions/badge-rotation")]),s(`
`),l("span",{class:"line"})])])],-1),as=l("div",{class:"language-typescript"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"{"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#A6ACCD"}},"createInertiaAnimation"),l("span",{style:{color:"#F07178"}}," "),l("span",{style:{color:"#89DDFF"}},"}"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#C3E88D"}},"@explosions/badge-rotation"),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"const"),l("span",{style:{color:"#A6ACCD"}}," inertiaAnimation "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"createInertiaAnimation"),l("span",{style:{color:"#A6ACCD"}},"()"),l("span",{style:{color:"#89DDFF"}},";")]),s(`
`),l("span",{class:"line"})])])],-1),cs=l("p",null,"以上便是我在实现过程中的一些方案、问题与思考，从零开始去尝试如何实现是一件很有趣的事情，但想必也一定存在更优雅的方案和优化，所以有任何建议也欢迎给我留言。谢谢！",-1),rs=l("p",null,"下次再有什么有趣的事情时候见！",-1),ps=l("hr",null,null,-1),is=l("p",null,"Q.E.D.",-1);function ys(t,Ds,Fs,As,r,Cs){const n=C,p=i;return F(),D(p,{frontmatter:r.frontmatter,data:r.data},{"main-content-md":o(()=>[h,l("blockquote",null,[l("p",null,[s("标题我只能说：懂得都懂。"),e(n,{href:"https://www.zhihu.com/question/393670234",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("如何评价「懂的都懂」这句话？｜知乎")]),_:1})])]),l("h2",_,[s("前言 "),e(n,{class:"header-anchor",href:"#前言","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),m,f,g,A(" more "),l("h2",b,[s("简介 "),e(n,{class:"header-anchor",href:"#简介","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),v,l("ul",null,[l("li",null,[s("示例（去除敏感资源）："),e(n,{href:"https://explosions.yunyoujun.cn/badge-rotation/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("https://explosions.yunyoujun.cn/badge-rotation/")]),_:1})]),l("li",null,[s("PPT (slidev): "),e(n,{href:"https://badge-rotation.explosions.yunyoujun.cn/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("https://badge-rotation.explosions.yunyoujun.cn/")]),_:1}),E]),l("li",null,[s("简化后可以参考的代码："),e(n,{href:"https://github.com/YunYouJun/explosions/blob/main/src/pages/badge-rotation/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("https://github.com/YunYouJun/explosions/blob/main/src/pages/badge-rotation/")]),_:1})])]),k,l("h2",x,[s("长啥样 "),e(n,{class:"header-anchor",href:"#长啥样","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),w,B,S,q,R,T,I,P,l("h2",$,[s("我的实现方案 "),e(n,{class:"header-anchor",href:"#我的实现方案","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),j,l("p",null,[s("而神奇动物中的徽章使用 tiny3d（蚂蚁开源的一个 3D 渲染库 "),e(n,{href:"http://tinyjs.net/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("tiny")]),_:1}),s(" + tiny-plugin-three） 在 canvas 上渲染的 3D 模型。我们只需要按照帧率改变徽章的旋转角度使其形成动画即可。")]),X,l("h3",O,[s("如何拖动徽章？ "),e(n,{class:"header-anchor",href:"#如何拖动徽章？","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),Y,z,V,L,M,N,J,l("p",null,[s("定时函数 setTimeout(callback, 16) （设置为每 16 ms 执行一次），便可以达到类似的效果。 但是我们还有更为优雅的方式，"),e(n,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("requestAnimationFrame")]),_:1}),s("。")]),W,l("h3",Z,[s("分析动画 "),e(n,{class:"header-anchor",href:"#分析动画","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),U,G,K,l("h2",Q,[s("详细步骤 "),e(n,{class:"header-anchor",href:"#详细步骤","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),H,l("h3",ll,[s("初速度 "),e(n,{class:"header-anchor",href:"#初速度","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),sl,ol,nl,el,tl,al,cl,l("h3",rl,[s("徽章旋转衰减 "),e(n,{class:"header-anchor",href:"#徽章旋转衰减","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),pl,il,yl,Dl,Fl,Al,l("h3",Cl,[s("平面重力 "),e(n,{class:"header-anchor",href:"#平面重力","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),dl,ul,hl,_l,ml,fl,gl,bl,vl,l("h3",El,[s("如何停止 "),e(n,{class:"header-anchor",href:"#如何停止","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),kl,xl,wl,Bl,Sl,ql,Rl,l("h3",Tl,[s("抽象函数 "),e(n,{class:"header-anchor",href:"#抽象函数","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),Il,Pl,$l,jl,Xl,l("h3",Ol,[s("可复用 "),e(n,{class:"header-anchor",href:"#可复用","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),Yl,l("blockquote",null,[l("p",null,[s("譬如 CSS 编写而成的立体徽章，CSS 原教旨主义 示例："),e(n,{href:"https://explosions.yunyoujun.cn/badge-rotation/",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("https://explosions.yunyoujun.cn/badge-rotation/")]),_:1}),s(" 使用 TypeScript + VueUse + CSS + createInertiaAnimation 搭建，顺便给 Vususe 中 swipe 缺失的 "),zl,s(" 事件提了个 PR。")])]),Vl,Ll,Ml,l("h3",Nl,[s("最后一公里 "),e(n,{class:"header-anchor",href:"#最后一公里","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),Jl,l("h4",Wl,[s("初始晃动效果 "),e(n,{class:"header-anchor",href:"#初始晃动效果","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),Zl,Ul,l("h4",Gl,[s("轻拍晃动 "),e(n,{class:"header-anchor",href:"#轻拍晃动","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),Kl,Ql,l("h4",Hl,[s("陀螺仪 "),e(n,{class:"header-anchor",href:"#陀螺仪","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),ls,ss,os,l("blockquote",null,[l("p",null,[s("查询 "),e(n,{href:"https://caniuse.com/mdn-api_deviceorientationevent",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("DeviceOrientationEvent API | Can I use")]),_:1}),s(" 其实可以发现 iOS 网页的这个事件有兼容问题。 平时只能自求多福了。（支付宝的话则可以调用其自身的原生 API）")])]),l("h2",ns,[s("总结 "),e(n,{class:"header-anchor",href:"#总结","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("p",null,[s("至此，一个完整的徽章旋转动画，便算告一段落了。 后续，我们甚至还可以进一步将其封装为一个 npm 包 "),e(n,{href:"https://www.npmjs.com/package/@explosions/badge-rotation",target:"_blank",rel:"noreferrer"},{default:o(()=>[es]),_:1}),s("，通过导入的方式来快速使用它。")]),l("blockquote",null,[l("p",null,[s("我在 npm 上建立了一个 "),e(n,{href:"https://www.npmjs.com/settings/explosions/packages",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("explosions")]),_:1}),s(" 的 org，打算在这个 scope 下发些有趣的动效。 如果你也有些想法和兴趣，可以到"),e(n,{href:"https://github.com/YunYouJun/explosions",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("这里")]),_:1}),s("来点 PR 或 Issue。")])]),ts,as,cs,rs,ps,is]),"main-header":o(()=>[a(t.$slots,"main-header")]),"main-header-after":o(()=>[a(t.$slots,"main-header-after")]),"main-nav":o(()=>[a(t.$slots,"main-nav")]),"main-content":o(()=>[a(t.$slots,"main-content")]),"main-content-after":o(()=>[a(t.$slots,"main-content-after")]),"main-nav-before":o(()=>[a(t.$slots,"main-nav-before")]),"main-nav-after":o(()=>[a(t.$slots,"main-nav-after")]),comment:o(()=>[a(t.$slots,"comment")]),footer:o(()=>[a(t.$slots,"footer")]),aside:o(()=>[a(t.$slots,"aside")]),"aside-custom":o(()=>[a(t.$slots,"aside-custom")]),default:o(()=>[a(t.$slots,"default")]),_:3},8,["frontmatter","data"])}const gs=y(u,[["render",ys]]);export{fs as __pageData,gs as default};
