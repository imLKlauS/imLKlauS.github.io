import{_ as s}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BOb0xH-1.js";import"./chunks/@vueuse/motion.BrTBiDBP.js";import{d as i,a as l,u as a}from"./chunks/vue-router.iuc03XPI.js";import{a1 as n,a3 as t,a4 as h,a5 as e,a6 as k,a7 as p,F as r,a2 as o,Z as g}from"./framework.CSpzLJwA.js";import"./app.DxsXqPDj.js";import"./chunks/dayjs.Dto65haK.js";import"./chunks/vue-i18n.C5QQbedb.js";import"./chunks/pinia.CKttsWmm.js";import"./chunks/nprogress.BEPa78Un.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.IawhXP3l.js";import"./index.TQnGKZgq.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.DIveis5r.js";import"./post.BWOv1eSm.js";const d=i("/posts/MySQL_Log",async s=>JSON.parse('{"title":"MySQL - 日志","description":"","frontmatter":{"title":"MySQL - 日志","author":"imklaus","tags":["SQL"],"categories":["MySQL","日志篇"],"date":"2025-3-19 01:00:07","outline":"deep","excerpt_type":"html","end":true},"headers":[],"relativePath":"pages/posts/MySQL_Log.md","lastUpdated":null}'),{lazy:(s,i)=>s.name===i.name}),c={__name:"MySQL_Log",setup(i,{expose:c}){const{data:u}=d(),y=a(),E=l(),b=Object.assign(E.meta.frontmatter||{},u.value?.frontmatter||{});y.currentRoute.value.data=u.value,g("valaxy:frontmatter",b),globalThis.$frontmatter=b;return c({frontmatter:{title:"MySQL - 日志",author:"imklaus",tags:["SQL"],categories:["MySQL","日志篇"],date:"2025-3-19 01:00:07",outline:"deep",excerpt_type:"html",end:!0}}),(i,l)=>{const a=s;return o(),n(a,{frontmatter:r(b)},{"main-content-md":t(()=>[l[0]||(l[0]=e("h3",{id:"日志分类",tabindex:"-1"},[p("日志分类 "),e("a",{class:"header-anchor",href:"#日志分类","aria-label":'Permalink to "日志分类"'},"​")],-1)),l[1]||(l[1]=e("p",null,"在任何一种数据库中，都会有各种各样的日志，记录着数据库工作的过程，可以帮助数据库管理员追踪数据库曾经发生过的各种事件",-1)),l[2]||(l[2]=e("p",null,"MySQL日志主要包括六种：",-1)),l[3]||(l[3]=e("ol",null,[e("li",null,"重做日志（redo log）"),e("li",null,"回滚日志（undo log）"),e("li",null,"归档日志（binlog）（二进制日志）"),e("li",null,"错误日志（errorlog）"),e("li",null,"慢查询日志（slow query log）"),e("li",null,"一般查询日志（general log）"),e("li",null,"中继日志（relay log）")],-1)),k(" more "),l[4]||(l[4]=e("hr",null,null,-1)),l[5]||(l[5]=e("h3",{id:"错误日志",tabindex:"-1"},[p("错误日志 "),e("a",{class:"header-anchor",href:"#错误日志","aria-label":'Permalink to "错误日志"'},"​")],-1)),l[6]||(l[6]=e("p",null,"错误日志是 MySQL 中最重要的日志之一，记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。当数据库出现任何故障导致无法正常使用时，可以首先查看此日志",-1)),l[7]||(l[7]=e("p",null,[p("该日志是默认开启的，默认位置是："),e("code",null,"/var/log/mysql/error.log")],-1)),l[8]||(l[8]=e("p",null,"查看指令：",-1)),l[9]||(l[9]=e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"SHOW VARIABLES "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"LIKE"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'log_error%'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),l[10]||(l[10]=e("p",null,"查看日志内容：",-1)),l[11]||(l[11]=e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tail"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -f"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /var/log/mysql/error.log")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),l[12]||(l[12]=e("hr",null,null,-1)),l[13]||(l[13]=e("h3",{id:"归档日志",tabindex:"-1"},[p("归档日志 "),e("a",{class:"header-anchor",href:"#归档日志","aria-label":'Permalink to "归档日志"'},"​")],-1)),l[14]||(l[14]=e("h4",{id:"基本介绍",tabindex:"-1"},[p("基本介绍 "),e("a",{class:"header-anchor",href:"#基本介绍","aria-label":'Permalink to "基本介绍"'},"​")],-1)),l[15]||(l[15]=e("p",null,[p("归档日志（BINLOG）也叫二进制日志，是因为采用二进制进行存储，记录了所有的 DDL（数据定义语言）语句和 DML（数据操作语言）语句，但"),e("strong",null,"不包括数据查询语句，在事务提交前的最后阶段写入")],-1)),l[16]||(l[16]=e("p",null,[p("作用："),e("strong",null,"灾难时的数据恢复和 MySQL 的主从复制")],-1)),l[17]||(l[17]=e("p",null,"归档日志默认情况下是没有开启的，需要在 MySQL 配置文件中开启，并配置 MySQL 日志的格式：",-1)),l[18]||(l[18]=e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/mysql")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"vim"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," my.cnf")]),p("\n"),e("span",{class:"line"}),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 配置开启binlog日志， 日志的文件前缀为 mysqlbin -----\x3e 生成的文件名如: mysqlbin.000001")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"log_bin"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"mysqlbin")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 配置二进制日志的格式")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"binlog_format"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"STATEMENT")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),l[19]||(l[19]=e("p",null,"日志存放位置：配置时给定了文件名但是没有指定路径，日志默认写入MySQL 的数据目录",-1)),l[20]||(l[20]=e("p",null,"日志格式：",-1)),l[21]||(l[21]=e("ul",null,[e("li",null,[e("p",null,[p("STATEMENT：该日志格式在日志文件中记录的都是 "),e("strong",null,"SQL 语句"),p("，每一条对数据进行修改的 SQL 都会记录在日志文件中，通过 mysqlbinlog 工具，可以查看到每条语句的文本。主从复制时，从库会将日志解析为原语句，并在从库重新执行一遍")]),e("p",null,"缺点：可能会导致主备不一致，因为记录的 SQL 在不同的环境中可能选择的索引不同，导致结果不同")]),e("li",null,[e("p",null,[p("ROW：该日志格式在日志文件中记录的是每一行的"),e("strong",null,"数据变更"),p("，而不是记录 SQL 语句。比如执行 SQL 语句 "),e("code",null,"update tb_book set status='1'"),p("，如果是 STATEMENT，在日志中会记录一行 SQL 语句； 如果是 ROW，由于是对全表进行更新，就是每一行记录都会发生变更，ROW 格式的日志中会记录每一行的数据变更")]),e("p",null,"缺点：记录的数据比较多，占用很多的存储空间")]),e("li",null,[e("p",null,"MIXED：这是 MySQL 默认的日志格式，混合了STATEMENT 和 ROW 两种格式，MIXED 格式能尽量利用两种模式的优点，而避开它们的缺点")])],-1)),l[22]||(l[22]=e("hr",null,null,-1)),l[23]||(l[23]=e("h4",{id:"日志刷盘",tabindex:"-1"},[p("日志刷盘 "),e("a",{class:"header-anchor",href:"#日志刷盘","aria-label":'Permalink to "日志刷盘"'},"​")],-1)),l[24]||(l[24]=e("p",null,"事务执行过程中，先将日志写（write）到 binlog cache，事务提交时再把 binlog cache 写（fsync）到 binlog 文件中，一个事务的 binlog 是不能被拆开的，所以不论这个事务多大也要确保一次性写入",-1)),l[25]||(l[25]=e("p",null,"事务提交时执行器把 binlog cache 里的完整事务写入到 binlog 中，并清空 binlog cache",-1)),l[26]||(l[26]=e("p",null,"write 和 fsync 的时机由参数 sync_binlog 控制的：",-1)),l[27]||(l[27]=e("ul",null,[e("li",null,"sync_binlog=0：表示每次提交事务都只 write，不 fsync"),e("li",null,"sync_binlog=1：表示每次提交事务都会执行 fsync"),e("li",null,"sync_binlog=N(N>1)：表示每次提交事务都 write，但累积 N 个事务后才 fsync，但是如果主机发生异常重启，会丢失最近 N 个事务的 binlog 日志")],-1)),l[28]||(l[28]=e("hr",null,null,-1)),l[29]||(l[29]=e("h4",{id:"日志读取",tabindex:"-1"},[p("日志读取 "),e("a",{class:"header-anchor",href:"#日志读取","aria-label":'Permalink to "日志读取"'},"​")],-1)),l[30]||(l[30]=e("p",null,"日志文件存储位置：/var/lib/mysql",-1)),l[31]||(l[31]=e("p",null,"由于日志以二进制方式存储，不能直接读取，需要用 mysqlbinlog 工具来查看，语法如下：",-1)),l[32]||(l[32]=e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mysqlbinlog"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," log-file"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),l[33]||(l[33]=e("p",null,"查看 STATEMENT 格式日志：",-1)),l[34]||(l[34]=e("ul",null,[e("li",null,[e("p",null,"执行插入语句："),e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"INSERT INTO"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tb_book "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"VALUES"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"NULL"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'Lucene'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'2088-05-01'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'0'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),e("button",{class:"code-block-unfold-btn"})])]),e("li",null,[e("p",null,[e("code",null,"cd /var/lib/mysql"),p("：")]),e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"-rw-r-----"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  1"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysql"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysql"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      177"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 5月"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  23"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 21:08"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysqlbin.000001")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"-rw-r-----"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  1"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysql"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysql"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"       18"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 5月"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  23"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 21:04"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysqlbin.index")])])]),e("button",{class:"code-block-unfold-btn"})]),e("p",null,"mysqlbin.index：该文件是日志索引文件 ， 记录日志的文件名；"),e("p",null,"mysqlbing.000001：日志文件")]),e("li",null,[e("p",null,"查看日志内容："),e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mysqlbinlog"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mysqlbing.000001"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),e("button",{class:"code-block-unfold-btn"})]),e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/image-20250320013217813.png",alt:"image-20250320013217813",loading:"lazy",decoding:"async",class:"lazy"})]),e("p",null,"日志结尾有 COMMIT")])],-1)),l[35]||(l[35]=e("p",null,"查看 ROW 格式日志：",-1)),l[36]||(l[36]=e("ul",null,[e("li",null,[e("p",null,"修改配置："),e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 配置二进制日志的格式")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"binlog_format"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ROW")])])]),e("button",{class:"code-block-unfold-btn"})])]),e("li",null,[e("p",null,"插入数据："),e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"INSERT INTO"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tb_book "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"VALUES"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"NULL"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'SpringCloud实战'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'2088-05-05'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'0'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),e("button",{class:"code-block-unfold-btn"})])]),e("li",null,[e("p",null,"查看日志内容：日志格式 ROW，直接查看数据是乱码，可以在 mysqlbinlog 后面加上参数 -vv"),e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mysqlbinlog "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"vv "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"mysqlbin"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"000002")])])]),e("button",{class:"code-block-unfold-btn"})]),e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/image-20250320013258023.png",alt:"image-20250320013258023",loading:"lazy",decoding:"async",class:"lazy"})])])],-1)),l[37]||(l[37]=e("hr",null,null,-1)),l[38]||(l[38]=e("h4",{id:"日志删除",tabindex:"-1"},[p("日志删除 "),e("a",{class:"header-anchor",href:"#日志删除","aria-label":'Permalink to "日志删除"'},"​")],-1)),l[39]||(l[39]=e("p",null,"对于比较繁忙的系统，生成日志量大，这些日志如果长时间不清除，将会占用大量的磁盘空间，需要删除日志",-1)),l[40]||(l[40]=e("ul",null,[e("li",null,[e("p",null,"Reset Master 指令删除全部 binlog 日志，删除之后，日志编号将从 xxxx.000001重新开始"),e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Reset"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," Master"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\t-- MySQL指令")])])]),e("button",{class:"code-block-unfold-btn"})])]),e("li",null,[e("p",null,[p("执行指令 "),e("code",null,"PURGE MASTER LOGS TO 'mysqlbin.***"),p("，该命令将删除 "),e("code",null," ***"),p(" 编号之前的所有日志")])]),e("li",null,[e("p",null,[p("执行指令 "),e("code",null,"PURGE MASTER LOGS BEFORE 'yyyy-mm-dd hh:mm:ss'"),p(" ，该命令将删除日志为 "),e("code",null,"yyyy-mm-dd hh:mm:ss"),p(" 之前产生的日志")])]),e("li",null,[e("p",null,[p("设置参数 "),e("code",null,"--expire_logs_days=#"),p("，此参数的含义是设置日志的过期天数，过了指定的天数后日志将会被自动删除，这样做有利于减少管理日志的工作量，配置 my.cnf 文件：")]),e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"log_bin"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"mysqlbin")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"binlog_format"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ROW")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"--expire_logs_days"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"3")])])]),e("button",{class:"code-block-unfold-btn"})])])],-1)),l[41]||(l[41]=e("hr",null,null,-1)),l[42]||(l[42]=e("h4",{id:"数据恢复",tabindex:"-1"},[p("数据恢复 "),e("a",{class:"header-anchor",href:"#数据恢复","aria-label":'Permalink to "数据恢复"'},"​")],-1)),l[43]||(l[43]=e("p",null,"误删库或者表时，需要根据 binlog 进行数据恢复",-1)),l[44]||(l[44]=e("p",null,"一般情况下数据库有定时的全量备份，假如每天 0 点定时备份，12 点误删了库，恢复流程：",-1)),l[45]||(l[45]=e("ul",null,[e("li",null,"取最近一次全量备份，用备份恢复出一个临时库"),e("li",null,"从日志文件中取出凌晨 0 点之后的日志"),e("li",null,"把除了误删除数据的语句外日志，全部应用到临时库")],-1)),l[46]||(l[46]=e("p",null,"跳过误删除语句日志的方法：",-1)),l[47]||(l[47]=e("ul",null,[e("li",null,"如果原实例没有使用 GTID 模式，只能在应用到包含 12 点的 binlog 文件的时候，先用 –stop-position 参数执行到误操作之前的日志，然后再用 –start-position 从误操作之后的日志继续执行"),e("li",null,"如果实例使用了 GTID 模式，假设误操作命令的 GTID 是 gtid1，那么只需要提交一个空事务先将这个 GTID 加到临时实例的 GTID 集合，之后按顺序执行 binlog 的时就会自动跳过误操作的语句")],-1)),l[48]||(l[48]=e("hr",null,null,-1)),l[49]||(l[49]=e("h3",{id:"查询日志",tabindex:"-1"},[p("查询日志 "),e("a",{class:"header-anchor",href:"#查询日志","aria-label":'Permalink to "查询日志"'},"​")],-1)),l[50]||(l[50]=e("p",null,"查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的 SQL 语句",-1)),l[51]||(l[51]=e("p",null,"默认情况下，查询日志是未开启的。如果需要开启查询日志，配置 my.cnf：",-1)),l[52]||(l[52]=e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 该选项用来开启查询日志，可选值0或者1，0代表关闭，1代表开启 ")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"general_log"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 设置日志的文件名，如果没有指定，默认的文件名为host_name.log，存放在/var/lib/mysql")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"general_log_file"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"mysql_query.log")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),l[53]||(l[53]=e("p",null,"配置完毕之后，在数据库执行以下操作：",-1)),l[54]||(l[54]=e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tb_book;")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tb_book "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WHERE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"UPDATE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tb_book "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SET"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," name"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'lucene入门指南'"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," WHERE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," tb_book "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WHERE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 8")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),l[55]||(l[55]=e("p",null,"执行完毕之后， 再次来查询日志文件：",-1)),l[56]||(l[56]=e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/image-20250320013318003.png",alt:"image-20250320013318003",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[57]||(l[57]=e("hr",null,null,-1)),l[58]||(l[58]=e("h3",{id:"慢日志",tabindex:"-1"},[p("慢日志 "),e("a",{class:"header-anchor",href:"#慢日志","aria-label":'Permalink to "慢日志"'},"​")],-1)),l[59]||(l[59]=e("p",null,"慢查询日志记录所有执行时间超过 long_query_time 并且扫描记录数不小于 min_examined_row_limit 的所有的 SQL 语句的日志long_query_time 默认为 10 秒，最小为 0， 精度到微秒",-1)),l[60]||(l[60]=e("p",null,[p("慢查询日志默认是关闭的，可以通过两个参数来控制慢查询日志，配置文件 "),e("code",null,"/etc/mysql/my.cnf"),p("：")],-1)),l[61]||(l[61]=e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 该参数用来控制慢查询日志是否开启，可选值0或者1，0代表关闭，1代表开启 ")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"slow_query_log"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),p("\n"),e("span",{class:"line"}),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 该参数用来指定慢查询日志的文件名，存放在 /var/lib/mysql")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"slow_query_log_file"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"slow_query.log")]),p("\n"),e("span",{class:"line"}),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 该选项用来配置查询的时间限制，超过这个时间将认为值慢查询，将需要进行日志记录，默认10s")]),p("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"long_query_time"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"10")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),l[62]||(l[62]=e("p",null,"日志读取：",-1)),l[63]||(l[63]=e("ul",null,[e("li",null,[e("p",null,"直接通过 cat 指令查询该日志文件："),e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"cat"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," slow_query.log")])])]),e("button",{class:"code-block-unfold-btn"})]),e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/image-20250320013338559.png",alt:"image-20250320013338559",loading:"lazy",decoding:"async",class:"lazy"})])]),e("li",null,[e("p",null,"如果慢查询日志内容很多，直接查看文件比较繁琐，可以借助 mysql 自带的 mysqldumpslow 工具对慢查询日志进行分类汇总："),e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mysqldumpslow"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," slow_query.log")])])]),e("button",{class:"code-block-unfold-btn"})]),e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/image-20250320013349361.png",alt:"image-20250320013349361",loading:"lazy",decoding:"async",class:"lazy"})])])],-1))]),"main-header":t(()=>[h(i.$slots,"main-header")]),"main-header-after":t(()=>[h(i.$slots,"main-header-after")]),"main-nav":t(()=>[h(i.$slots,"main-nav")]),"main-content-before":t(()=>[h(i.$slots,"main-content-before")]),"main-content":t(()=>[h(i.$slots,"main-content")]),"main-content-after":t(()=>[h(i.$slots,"main-content-after")]),"main-nav-before":t(()=>[h(i.$slots,"main-nav-before")]),"main-nav-after":t(()=>[h(i.$slots,"main-nav-after")]),comment:t(()=>[h(i.$slots,"comment")]),footer:t(()=>[h(i.$slots,"footer")]),aside:t(()=>[h(i.$slots,"aside")]),"aside-custom":t(()=>[h(i.$slots,"aside-custom")]),default:t(()=>[h(i.$slots,"default")]),_:3},8,["frontmatter"])}}};export{c as default,d as usePageData};
