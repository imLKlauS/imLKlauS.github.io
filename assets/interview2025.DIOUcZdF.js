import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BxOTQp-8.js";import{_ as s}from"./ValaxyMermaid.vue_vue_type_script_setup_true_lang.RpPG1OOg.js";import"./chunks/@vueuse/motion.D4J2SB46.js";import{d as l,a,u as n}from"./chunks/vue-router.RvvYB2Hz.js";import{a1 as h,a3 as t,a4 as k,a5 as e,W as E,a6 as r,ac as p,F as g,a2 as d,Z as y}from"./framework.GzYmdVjK.js";import"./app.CcfNILCs.js";import"./chunks/dayjs.Dto65haK.js";import"./chunks/vue-i18n.BvWwj3SI.js";import"./chunks/pinia.BcfqlbOB.js";import"./chunks/nprogress.W5IEJXTh.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.DiDThyEF.js";import"./index.TQnGKZgq.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.KHJRstPN.js";import"./post.CFaem5QF.js";const u=l("/posts/interview2025",async i=>JSON.parse('{"title":"面试笔录","description":"","frontmatter":{"title":"面试笔录","cover":"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/wallhaven-3z32j3_1920x1080.png","top":100,"author":"imklaus","tags":["JVM"],"categories":["Java","面试"],"date":"2025/12/3 2:31:00","outline":"deep","postTitleClass":"text-#ffa500","excerpt_type":"html","end":false},"headers":[],"relativePath":"pages/posts/interview2025.md","lastUpdated":null}'),{lazy:(i,s)=>i.name===s.name}),o={__name:"interview2025",setup(l,{expose:o}){const{data:c}=u(),F=n(),A=a(),C=Object.assign(A.meta.frontmatter||{},c.value?.frontmatter||{});F.currentRoute.value.data=c.value,y("valaxy:frontmatter",C),globalThis.$frontmatter=C;return o({frontmatter:{title:"面试笔录",cover:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/wallhaven-3z32j3_1920x1080.png",top:100,author:"imklaus",tags:["JVM"],categories:["Java","面试"],date:"2025/12/3 2:31:00",outline:"deep",postTitleClass:"text-#ffa500",excerpt_type:"html",end:!1}}),(l,a)=>{const n=s,y=i;return d(),h(y,{frontmatter:g(C)},{"main-content-md":t(()=>[a[0]||(a[0]=e("h2",{id:"自我介绍",tabindex:"-1"},[r("自我介绍 "),e("a",{class:"header-anchor",href:"#自我介绍","aria-label":'Permalink to "自我介绍"'},"​")],-1)),a[1]||(a[1]=e("hr",null,null,-1)),a[2]||(a[2]=e("h3",{id:"核心原则",tabindex:"-1"},[r("核心原则 "),e("a",{class:"header-anchor",href:"#核心原则","aria-label":'Permalink to "核心原则"'},"​")],-1)),a[3]||(a[3]=e("ol",null,[e("li",null,[e("strong",null,"结构化清晰"),r("：遵循“总 - 分 - 总”的逻辑，让面试官轻松跟上你的思路。")]),e("li",null,[e("strong",null,"价值导向"),r("：不说“我做了XX”，而是说“我通过XX技术，解决了XX问题，带来了XX价值”。")]),e("li",null,[e("strong",null,"与岗位匹配"),r("：提前研究JD，将你的技能和经验与公司的技术要求、业务方向对齐。")]),e("li",null,[e("strong",null,"自信沉稳"),r("：语速平稳，眼神交流，展现专业与诚意。")])],-1)),a[4]||(a[4]=e("hr",null,null,-1)),a[5]||(a[5]=e("h3",{id:"自我介绍框架-黄金1-5-2分钟",tabindex:"-1"},[r("自我介绍框架（黄金1.5-2分钟） "),e("a",{class:"header-anchor",href:"#自我介绍框架-黄金1-5-2分钟","aria-label":'Permalink to "自我介绍框架（黄金1.5-2分钟）"'},"​")],-1)),a[6]||(a[6]=e("h4",{id:"第一部分-开场白-基本信息-15秒",tabindex:"-1"},[r("第一部分：开场白 & 基本信息 (15秒) "),e("a",{class:"header-anchor",href:"#第一部分-开场白-基本信息-15秒","aria-label":'Permalink to "第一部分：开场白 & 基本信息 (15秒)"'},"​")],-1)),a[7]||(a[7]=e("p",null,[e("strong",null,"目的"),r("：礼貌开场，清晰说明你的身份和工作经验。 "),e("strong",null,"话术"),r("：")],-1)),a[8]||(a[8]=e("blockquote",null,[e("p",null,"“各位面试官，下午好。我叫[你的名字]，非常感谢给我这次面试机会。我拥有3年的Java后端开发经验，上一家公司是在[上一家公司名称]，主要负责[你负责的核心领域，如：电商平台的交易系统/金融风控核心服务]。”")],-1)),a[9]||(a[9]=e("p",null,[e("strong",null,"要点"),r("：直接、简洁，点名年限和核心领域。")],-1)),a[10]||(a[10]=e("h4",{id:"第二部分-技术栈与核心技能-45秒",tabindex:"-1"},[r("第二部分：技术栈与核心技能 (45秒) "),e("a",{class:"header-anchor",href:"#第二部分-技术栈与核心技能-45秒","aria-label":'Permalink to "第二部分：技术栈与核心技能 (45秒)"'},"​")],-1)),a[11]||(a[11]=e("p",null,[e("strong",null,"目的"),r("：展示你的技术广度和深度，证明你具备扎实的技术根基。 "),e("strong",null,"话术"),r("（请选择最擅长的点来说，不必全部罗列）：")],-1)),a[12]||(a[12]=e("blockquote",null,[e("p",null,"“在技术方面，我的技能栈主要集中在Java生态。”"),e("p",null,[e("strong",null,"【基础与框架】")]),e("ul",null,[e("li",null,[r("“我对 "),e("strong",null,"Java基础"),r(" 有比较扎实的理解，熟悉JVM内存模型、垃圾回收机制以及多线程并发编程。”")]),e("li",null,[r("“熟练掌握主流开源框架，如 "),e("strong",null,"Spring全家桶"),r("（Spring, Spring MVC, Spring Boot），并理解其核心原理，比如Spring的IOC、AOP，以及Spring Boot的自动装配机制。”")])]),e("p",null,[e("strong",null,"【数据与存储】")]),e("ul",null,[e("li",null,[r("“在数据持久化方面，我精通 "),e("strong",null,"MyBatis"),r("，并对 "),e("strong",null,"MySQL"),r(" 有丰富的使用和优化经验，包括索引优化、慢查询分析等。”")]),e("li",null,[r("“对分布式缓存 "),e("strong",null,"Redis"),r(" 也很熟悉，用它来做过热点数据缓存、分布式锁等场景。”")])]),e("p",null,[e("strong",null,"【分布式与中间件】")]),e("ul",null,[e("li",null,[r("“在3年的项目中，我也接触并应用了一些分布式技术和中间件。比如使用 "),e("strong",null,"消息队列"),r("，来解决系统解耦和削峰填谷的问题。”")]),e("li",null,[r("“对微服务架构有实践经验，了解 "),e("strong",null,"Spring Cloud"),r(" 的相关组件。”")])])],-1)),a[13]||(a[13]=e("p",null,[e("strong",null,"要点"),r("：将技术分类，用“精通”、“熟练掌握”、“了解”等词语准确描述你的掌握程度。提到“原理”和“场景”能瞬间提升专业度。")],-1)),a[14]||(a[14]=e("h4",{id:"第三部分-项目经验与价值贡献-45秒",tabindex:"-1"},[r("第三部分：项目经验与价值贡献 (45秒) "),e("a",{class:"header-anchor",href:"#第三部分-项目经验与价值贡献-45秒","aria-label":'Permalink to "第三部分：项目经验与价值贡献 (45秒)"'},"​")],-1)),a[15]||(a[15]=e("p",null,[e("strong",null,"目的"),r("：这是重中之重！通过1-2个最具代表性的项目，证明你能用技术解决实际问题。 "),e("strong",null,"话术"),r("（使用STAR法则简化版：情景、任务、行动、结果）：")],-1)),a[16]||(a[16]=e("blockquote",null,[e("p",null,"“在之前的工作中，我深度参与了一个[项目名称或类型]项目。我主要负责[你的核心职责]。”"),e("p",null,[e("strong",null,"【举例】"),r("： “比如，在去年的‘XX电商促销系统’中，我负责优化下单接口的性能。当时面临的主要问题是，在高并发下接口响应慢且超时率高。”")]),e("p",null,[e("strong",null,"【行动与价值】"),r("：")]),e("ul",null,[e("li",null,[r("“我通过 "),e("strong",null,"线程池参数调优"),r(" 和 "),e("strong",null,"数据库连接池优化"),r("，减少了线程上下文切换和等待时间。”")]),e("li",null,[r("“同时，我引入了 "),e("strong",null,"Redis缓存"),r("，将商品库存和用户信息等热点数据预热到缓存中，减少了对数据库的直接访问。”")]),e("li",null,[r("“通过这些优化，最终将"),e("strong",null,"下单接口的平均响应时间从500ms降低到了150ms，在峰值期间的系统稳定性也得到了大幅提升"),r("，顺利支撑了公司的大促活动。”")])])],-1)),a[17]||(a[17]=e("p",null,[e("strong",null,"要点"),r("："),e("strong",null,"一定要量化结果！"),r(" 用“降低了XX%”、“提升了XX”、“支撑了XX QPS”这样的数据来展示你的贡献。")],-1)),a[18]||(a[18]=e("h4",{id:"第四部分-职业动机与结尾-15秒",tabindex:"-1"},[r("第四部分：职业动机与结尾 (15秒) "),e("a",{class:"header-anchor",href:"#第四部分-职业动机与结尾-15秒","aria-label":'Permalink to "第四部分：职业动机与结尾 (15秒)"'},"​")],-1)),a[19]||(a[19]=e("p",null,[e("strong",null,"目的"),r("：表达你对新机会的渴望和与公司的契合度，并礼貌结尾。 "),e("strong",null,"话术"),r("：")],-1)),a[20]||(a[20]=e("blockquote",null,[e("p",null,"“我目前正处于职业发展的上升期，非常渴望能加入一个像贵公司这样技术驱动、有挑战性的平台，与团队一起深入技术，创造更大的价值。”"),e("p",null,"“以上就是我的简单介绍，谢谢各位面试官。我带来的简历中有更详细的项目描述，非常期待后续的交流。”")],-1)),a[21]||(a[21]=e("p",null,[e("strong",null,"要点"),r("：表达积极性和对公司的认可，将话题自然过渡到下一环节。")],-1)),a[22]||(a[22]=e("hr",null,null,-1)),a[23]||(a[23]=e("h3",{id:"进阶技巧-注意事项",tabindex:"-1"},[r("进阶技巧 & 注意事项 "),e("a",{class:"header-anchor",href:"#进阶技巧-注意事项","aria-label":'Permalink to "进阶技巧 & 注意事项"'},"​")],-1)),a[24]||(a[24]=e("ol",null,[e("li",null,[e("strong",null,"引导面试官"),r("：在介绍中“埋点”，引导到你准备充分的知识点。比如，你提到“用了Redis做分布式锁”，面试官很可能就会深入问你怎么实现的，有什么坑。")]),e("li",null,[e("strong",null,"扬长避短"),r("：对于不熟悉的技术，不要夸大。可以说“有所了解，并在项目中简单应用过”，或者坦诚地说“这部分我还没有深入实践，但我对其原理很感兴趣”。")]),e("li",null,[e("strong",null,"展现软实力"),r("：可以在项目部分不经意地提到“与产品、测试同事沟通”、“跨团队协作”等，体现你的团队协作能力。")]),e("li",null,[e("strong",null,"差异化"),r("：如果你有亮点，一定要突出！比如： "),e("ul",null,[e("li",null,[e("strong",null,"性能优化狂人"),r("：“我曾将系统某个核心接口的TPS从100提升到2000。”")]),e("li",null,[e("strong",null,"问题解决者"),r("：“我独立排查并解决过一个线上JVM Full GC频繁导致服务卡顿的疑难杂症。”")]),e("li",null,[e("strong",null,"技术爱好者"),r("：“我有在技术博客上分享的习惯，GitHub上有X个Star。”")])])])],-1)),a[25]||(a[25]=e("h3",{id:"模板总结-直接套用版",tabindex:"-1"},[r("模板总结（直接套用版） "),e("a",{class:"header-anchor",href:"#模板总结-直接套用版","aria-label":'Permalink to "模板总结（直接套用版）"'},"​")],-1)),a[26]||(a[26]=e("blockquote",null,[e("p",null,"面试官好，我叫[姓名]，有3年Java后端开发经验。过去主要在[上一家公司]负责[核心业务领域]相关的研发工作。"),e("p",null,"技术上，我基础比较扎实，熟悉JVM、多线程，精通Spring Boot、MyBatis等主流框架。对MySQL调优、Redis应用以及消息队列等中间件都有实践经验。"),e("p",null,"在项目中，我不仅完成日常开发，更注重解决技术难题。例如在[某项目]中，我通过[某项技术方案]，成功将[某个指标]提升了[具体数据]，保证了系统的稳定和高性能。"),e("p",null,"我关注到贵公司在[某个业务或技术点]方面做得很好，这非常吸引我。我希望能在这里深入发展，贡献我的力量。我的介绍就到这，谢谢。")],-1)),a[27]||(a[27]=e("hr",null,null,-1)),a[28]||(a[28]=e("h2",{id:"项目介绍",tabindex:"-1"},[r("项目介绍 "),e("a",{class:"header-anchor",href:"#项目介绍","aria-label":'Permalink to "项目介绍"'},"​")],-1)),a[29]||(a[29]=e("h3",{id:"采购公共服务系统-中台型系统",tabindex:"-1"},[r("采购公共服务系统（中台型系统） "),e("a",{class:"header-anchor",href:"#采购公共服务系统-中台型系统","aria-label":'Permalink to "采购公共服务系统（中台型系统）"'},"​")],-1)),a[30]||(a[30]=e("h4",{id:"参与的核心模块",tabindex:"-1"},[r("参与的核心模块 "),e("a",{class:"header-anchor",href:"#参与的核心模块","aria-label":'Permalink to "参与的核心模块"'},"​")],-1)),a[31]||(a[31]=e("ol",null,[e("li",null,[e("strong",null,"供应商评估分类模块")]),e("li",null,[e("strong",null,"统一权限管理模块")]),e("li",null,[e("strong",null,"系统性能优化（贯穿各模块）")])],-1)),a[32]||(a[32]=e("h4",{id:"如何体现业务能力",tabindex:"-1"},[r("如何体现业务能力 "),e("a",{class:"header-anchor",href:"#如何体现业务能力","aria-label":'Permalink to "如何体现业务能力"'},"​")],-1)),a[33]||(a[33]=e("p",null,[e("strong",null,"不要说："),r(' "我写了供应商评估的CRUD接口。"')],-1)),a[34]||(a[34]=e("p",null,[e("strong",null,"要这样说：")],-1)),a[35]||(a[35]=e("blockquote",null,[e("p",null,[r('"我负责的'),e("strong",null,"供应商评估分类模块"),r("，是整个采购体系的"),e("strong",null,"决策中枢"),r("。它的业务价值在于，将原本依赖人工经验、标准不一的供应商评估，转变为一个"),e("strong",null,"自动化、标准化、可追溯"),r("的智能决策流程。")]),e("p",null,[e("strong",null,"我解决的核心业务问题是"),r("：")]),e("ul",null,[e("li",null,[e("strong",null,"评估标准不统一"),r("：不同采购员对供应商的打分标准不一。我通过设计"),e("strong",null,"可配置的打分模板"),r("，将评估指标和权重固化到系统中，保证了公平性。")]),e("li",null,[e("strong",null,"数据孤岛"),r("：评估需要质量、财务、交付等多个部门的数据。我通过"),e("strong",null,"消息队列异步集成"),r("多个上游系统的数据，打破了部门墙，形成了对供应商的360度立体评估。")]),e("li",null,[e("strong",null,"决策效率低下"),r("：手动评估一个供应商需要几天。系统实现后，"),e("strong",null,"评估周期缩短了70%"),r("，采购团队能更快地筛选出优质供应商。")])]),e("p",null,[e("strong",null,"这个模块直接带来的业务价值是"),r("：提升了供应商队伍的整体质量，降低了采购风险，并且为采购决策提供了"),e("strong",null,"数据支撑"),r('，而不再是‘拍脑袋’决定。"')])],-1)),a[36]||(a[36]=e("hr",null,null,-1)),a[37]||(a[37]=e("h4",{id:"业务细节深度剖析",tabindex:"-1"},[r("业务细节深度剖析 "),e("a",{class:"header-anchor",href:"#业务细节深度剖析","aria-label":'Permalink to "业务细节深度剖析"'},"​")],-1)),a[38]||(a[38]=e("p",null,[e("strong",null,"1. 业务背景与痛点（展现你理解业务为什么存在）")],-1)),a[39]||(a[39]=e("blockquote",null,[e("p",null,'"在我们集团原有的采购体系中，供应商评估存在三个核心痛点：'),e("p",null,[e("strong",null,"第一，标准不透明。"),r(" 不同的采购事业部、甚至不同的采购员，对‘好供应商’的定义完全不同。A采购员看重价格，B采购员看重交期，导致评估结果无法横向对比，集团无法建立统一的供应商战略。")]),e("p",null,[e("strong",null,"第二，数据孤岛。"),r(" 评估需要的核心数据散落在多个系统中：")]),e("ul",null,[e("li",null,[e("strong",null,"质量数据"),r(" 在QMS（质量管理系统）中，包括来料合格率、生产过程中的PPM值。")]),e("li",null,[e("strong",null,"财务数据"),r(" 在SRM和财务系统中，包括开票准确性、付款周期。")]),e("li",null,[e("strong",null,"交付数据"),r(" 在WMS和TMS中，包括准时交付率、订单满足率。 采购员需要手动登录多个系统，复制粘贴数据到Excel里拼凑出一份评估报告，效率极低且容易出错。")])]),e("p",null,[e("strong",null,"第三，决策缺乏依据。"),r(' 最终的供应商等级（比如A/B/C级）划分，很大程度上依赖采购经理的个人经验，缺乏数据支撑，存在主观性和潜在的合规风险。"')])],-1)),a[40]||(a[40]=e("p",null,[e("strong",null,"2. 我的技术实现如何解决业务痛点（展现你如何用技术赋能业务）")],-1)),a[41]||(a[41]=e("blockquote",null,[e("p",null,[r('"我负责将这个混乱的流程系统化、自动化。我的核心工作不是简单的CRUD，而是'),e("strong",null,"将一个复杂的、依赖人脑判断的决策过程，抽象成一个可配置、可执行、可追溯的系统模型"),r("。")]),e("p",null,[e("strong",null,"具体实现上，我设计了三个核心实体和它们之间的关系：")]),e("ol",null,[e("li",null,[e("p",null,[e("strong",null,"【评估模板】"),r("：这是业务的灵魂。我设计的数据库表结构，允许业务人员像搭积木一样配置模板。")]),e("ul",null,[e("li",null,[e("code",null,"template_id"),r(", "),e("code",null,"template_name"),r(" （模板基本信息）")]),e("li",null,[e("code",null,"category_id"),r(" （适用于什么品类的供应商，如电子类、结构件类）")]),e("li",null,[r("最关键的是"),e("code",null,"scoring_rules"),r("字段，它是一个JSON结构，定义了评分规则：")])]),e("div",{class:"language-json max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"json"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'  "indicators"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": [")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "name"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"价格竞争力"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "weight"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0.3"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "dataSource"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"QUOTATION_SYSTEM"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "calculationRule"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"AVG_PRICE_RANKING"'),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // 规则：平均报价在所有供应商中的排名分")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    },")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "name"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"质量合格率"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "weight"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0.4"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "dataSource"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"QMS_SYSTEM"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "calculationRule"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"DIRECT_VALUE"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 规则：直接取值")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "thresholds"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": [")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"condition"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"value >= 99.5%"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"condition"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"value >= 99%"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"condition"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"value >= 98%"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"condition"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"value < 98%"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      ]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    },")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "name"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"技术创新能力"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "weight"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0.3"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "dataSource"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"MANUAL_INPUT"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 规则：需要专家手动打分")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'      "scorers"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ROLE_PURCHASING_MANAGER"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  ]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})]),e("p",null,[r("这个设计让"),e("strong",null,"业务规则实现了数据驱动"),r("，业务调整评估标准不再需要发版上线。")])]),e("li",null,[e("p",null,[e("strong",null,"【数据集成流程】"),r("：为了解决数据孤岛问题，我设计了异步数据集成流。")]),e("ul",null,[e("li",null,[e("strong",null,"实时数据"),r("：如订单状态变更，通过 "),e("strong",null,"RabbitMQ"),r(" 发送领域事件，我们的系统消费后更新本地数据仓库。")]),e("li",null,[e("strong",null,"批量数据"),r("：如月度质量报告，通过 "),e("strong",null,"FDI文件接口"),r("，由定时任务在凌晨同步。")]),e("li",null,[e("strong",null,"关键实现"),r("：我使用了 "),e("code",null,"CompletableFuture"),r(" 并行调用多个系统的"),e("code",null,"/api/supplier/{id}/quality-stats"),r("等接口，将原本串行需要10秒的数据获取过程，压缩到了2秒内。")])])]),e("li",null,[e("p",null,[e("strong",null,"【评估引擎】"),r("：这是系统的大脑。当触发评估时，引擎会：")]),e("ul",null,[e("li",null,"根据模板ID加载评分规则。"),e("li",null,[r("根据规则里的"),e("code",null,"dataSource"),r("，从我们的数据仓库或实时接口获取数据。")]),e("li",null,[r("执行"),e("code",null,"calculationRule"),r("，为每个指标计算出原始分数。")]),e("li",null,"应用权重，计算出加权总分。"),e("li",null,"根据预设的等级阈值（如A级>90分，B级>75分），自动划定供应商等级。"),e("li",null,[e("strong",null,[r("整个计算过程在一个"),e("code",null,"@Transactional"),r("事务中完成，并记录下每一次评估的‘评估快照’，确保所有决策可审计、可追溯。")]),r('"')])])])])],-1)),a[42]||(a[42]=e("p",null,[e("strong",null,"3. 业务价值的具体量化（展现你的工作带来了什么）")],-1)),a[43]||(a[43]=e("blockquote",null,[e("p",null,'"这个模块上线后，带来的改变是实实在在的：'),e("ul",null,[e("li",null,[e("strong",null,"效率提升"),r("：单个供应商的评估时间从"),e("strong",null,"平均3个工作日"),r("缩短到"),e("strong",null,"系统自动触发，分钟级出结果"),r("。")]),e("li",null,[e("strong",null,"成本节约"),r("：采购团队每年因此节约的工时，折算人力成本约"),e("strong",null,"50万元/年"),r("。")]),e("li",null,[e("strong",null,"决策质量"),r("：新供应商引入后的‘暴雷率’（即出现严重质量或交付问题）"),e("strong",null,"降低了25%"),r("，因为我们的评估模型提前识别了风险。")]),e("li",null,[e("strong",null,"战略价值"),r('：集团终于可以拿出一张统一的‘供应商地图’，清晰地看到各个品类下的核心、战略、淘汰供应商，为集中采购和议价提供了数据武器。"')])])],-1)),a[44]||(a[44]=e("hr",null,null,-1)),a[45]||(a[45]=e("h4",{id:"宏观到微观",tabindex:"-1"},[r("宏观到微观 "),e("a",{class:"header-anchor",href:"#宏观到微观","aria-label":'Permalink to "宏观到微观"'},"​")],-1)),a[46]||(a[46]=e("h5",{id:"第一层-项目背景-30秒-商业价值视角",tabindex:"-1"},[r("第一层：项目背景（30秒 - 商业价值视角） "),e("a",{class:"header-anchor",href:"#第一层-项目背景-30秒-商业价值视角","aria-label":'Permalink to "第一层：项目背景（30秒 - 商业价值视角）"'},"​")],-1)),a[47]||(a[47]=e("p",null,[e("strong",null,"目标"),r("：用业务语言说清系统的定位和价值。")],-1)),a[48]||(a[48]=e("blockquote",null,[e("p",null,[e("strong",null,'"我们先从项目背景说起。')]),e("p",null,"在大型制造集团中，采购不是一个单一动作，而是涉及供应商管理、价格谈判、质量评估、合同审批等数十个环节的复杂体系。过去，每个业务部门都有自己的采购流程和供应商池，导致："),e("ul",null,[e("li",null,[e("strong",null,"同一家供应商"),r("，在A部门是A级，在B部门却是C级")]),e("li",null,[e("strong",null,"采购数据分散"),r("，集团无法集中议价，错失成本优化机会")]),e("li",null,[e("strong",null,"风险不可控"),r("，出现过合作的供应商在其他子公司有不良记录")])]),e("p",null,[e("strong",null,"采购公共服务系统"),r('就是要解决这个问题，它将全集团所有采购相关的公共能力和基础数据统一管理，构建一个’采购中台’。"')])],-1)),a[49]||(a[49]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[50]||(a[50]=e("ul",null,[e("li",null,"从集团管控痛点切入"),e("li",null,"说明分散管理的弊端"),e("li",null,'明确"中台"定位')],-1)),a[51]||(a[51]=e("hr",null,null,-1)),a[52]||(a[52]=e("h5",{id:"第二层-项目描述-1分钟-系统架构视角",tabindex:"-1"},[r("第二层：项目描述（1分钟 - 系统架构视角） "),e("a",{class:"header-anchor",href:"#第二层-项目描述-1分钟-系统架构视角","aria-label":'Permalink to "第二层：项目描述（1分钟 - 系统架构视角）"'},"​")],-1)),a[53]||(a[53]=e("p",null,[e("strong",null,"目标"),r("：描述系统技术架构和核心服务。")],-1)),a[54]||(a[54]=e("blockquote",null,[e("p",null,[e("strong",null,'"从项目描述来看，这是一个典型的'),r("微服务中台架构**。")]),e("p",null,[r("系统采用 "),e("strong",null,"Spring Cloud Alibaba"),r(" 体系，"),e("strong",null,"Nacos"),r(" 作为服务注册发现和配置中心，"),e("strong",null,"Sentinel"),r(" 负责流量控制。数据库使用 "),e("strong",null,"MySQL"),r("，缓存层是 "),e("strong",null,"Redis"),r("，异步通信通过 "),e("strong",null,"RabbitMQ"),r(" 实现。")]),e("p",null,"系统核心模块包括："),e("ul",null,[e("li",null,[e("strong",null,"供应商主数据服务"),r("：全集团统一的供应商档案")]),e("li",null,[e("strong",null,"权限管理服务"),r("：为所有采购相关系统提供统一的权限控制")]),e("li",null,[e("strong",null,"模板引擎服务"),r("：可配置的评估模板、打分模板")]),e("li",null,[e("strong",null,"业务群组服务"),r("：支持按事业部、项目灵活划分数据权限")]),e("li",null,[e("strong",null,"白名单服务"),r('：集团级的供应商准入控制"')])])],-1)),a[55]||(a[55]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[56]||(a[56]=e("ul",null,[e("li",null,"明确技术栈选型"),e("li",null,"列举核心微服务及其职责"),e("li",null,'体现"公共服务"特性')],-1)),a[57]||(a[57]=e("hr",null,null,-1)),a[58]||(a[58]=e("h5",{id:"第三层-个人业务开发-1-5分钟-实现细节视角",tabindex:"-1"},[r("第三层：个人业务开发（1.5分钟 - 实现细节视角） "),e("a",{class:"header-anchor",href:"#第三层-个人业务开发-1-5分钟-实现细节视角","aria-label":'Permalink to "第三层：个人业务开发（1.5分钟 - 实现细节视角）"'},"​")],-1)),a[59]||(a[59]=e("p",null,[e("strong",null,"目标"),r("：具体说明负责的模块和技术实现。")],-1)),a[60]||(a[60]=e("blockquote",null,[e("p",null,[e("strong",null,'"我主要负责供应商评估分类模块和系统性能优化。')]),e("p",null,[e("strong",null,"供应商评估分类模块"),r("的业务目标是：将原本依赖个人经验的供应商评估，变成"),e("strong",null,"标准化、数据驱动"),r("的智能决策。")]),e("p",null,[e("strong",null,"我的技术实现核心是一个可配置的规则引擎"),r("：")]),e("ul",null,[e("li",null,"数据库设计中，我用JSON字段存储评分规则，支持灵活配置指标、权重、数据源和计算规则"),e("li",null,[r("通过"),e("strong",null,"策略模式"),r("实现不同的评分算法，如排名法、阈值法、专家打分法")]),e("li",null,[r("评估执行时，使用"),e("code",null,"CompletableFuture"),r("并行获取质量、交付、财务等多维度数据")]),e("li",null,[r("整个评估过程在"),e("code",null,"@Transactional"),r("事务中完成，并记录完整的评估快照用于审计")])]),e("p",null,[e("strong",null,"在系统性能优化方面"),r("，我建立了一套完整的优化方法论：")]),e("ul",null,[e("li",null,[r("通过"),e("strong",null,"Redis缓存"),r("热点数据，将供应商信息的查询从50ms优化到2ms")]),e("li",null,[r("对"),e("strong",null,"SQL执行计划"),r("进行分析，解决隐式转换、索引失效问题")]),e("li",null,[r("对大表实施"),e("strong",null,"分库分表"),r("，对复杂查询实施"),e("strong",null,"读写分离")]),e("li",null,[r("最终将核心接口的响应时间"),e("strong",null,"稳定控制在250ms以内"),r('"')])])],-1)),a[61]||(a[61]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[62]||(a[62]=e("ul",null,[e("li",null,"具体的技术选型和设计模式"),e("li",null,"数据结构和算法思考"),e("li",null,"性能优化的系统性方法")],-1)),a[63]||(a[63]=e("hr",null,null,-1)),a[64]||(a[64]=e("h5",{id:"第四层-解决的技术难题-2分钟-实战深度视角",tabindex:"-1"},[r("第四层：解决的技术难题（2分钟 - 实战深度视角） "),e("a",{class:"header-anchor",href:"#第四层-解决的技术难题-2分钟-实战深度视角","aria-label":'Permalink to "第四层：解决的技术难题（2分钟 - 实战深度视角）"'},"​")],-1)),a[65]||(a[65]=e("p",null,[e("strong",null,"目标"),r("：深入技术难点和解决方案。")],-1)),a[66]||(a[66]=e("blockquote",null,[e("p",null,[e("strong",null,'"我解决了几个关键的技术难题：')]),e("p",null,[e("strong",null,"第一个是’复杂业务规则的抽象与执行’问题。")]),e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：不同品类的供应商评估标准完全不同，电子件看技术创新，结构件看成本控制，如何设计一个既灵活又高性能的规则引擎？")]),e("li",null,[e("strong",null,"我的解决方案"),r("： "),e("ol",null,[e("li",null,[e("strong",null,"元数据驱动"),r("：将评估指标、权重、数据源、计算规则定义为元数据，存储在JSON配置中")]),e("li",null,[e("strong",null,"策略模式+工厂模式"),r("：为不同类型的计算规则（直接取值、排名计算、阈值打分）实现不同的策略")]),e("li",null,[e("strong",null,"并行数据获取"),r("：使用"),e("code",null,"CompletableFuture"),r("并行从质量系统、财务系统等获取数据")]),e("li",null,[e("strong",null,"结果"),r("：支持业务人员在"),e("strong",null,"不发版"),r("的情况下调整评估标准，评估计算性能在500ms内完成")])])])]),e("p",null,[e("strong",null,"第二个是’大规模代码重构与质量提升’问题。")]),e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：历史代码中存在40多个分散的定时任务，以及300多个深度嵌套的if-else")]),e("li",null,[e("strong",null,"我的解决方案"),r("： "),e("ol",null,[e("li",null,[e("strong",null,"策略模式统一定时任务"),r("：将所有定时任务抽象为"),e("code",null,"ScheduledTask"),r("接口，统一管理和监控")]),e("li",null,[e("strong",null,"函数式编程重构条件逻辑"),r("：使用"),e("code",null,"Predicate"),r("和"),e("code",null,"Function"),r("接口替换深层嵌套")]),e("li",null,[e("strong",null,"模板方法模式抽取公共逻辑"),r("：将重复的校验、审批流程抽象为模板")]),e("li",null,[e("strong",null,"结果"),r("：代码量减少40%，可维护性大幅提升，新功能开发效率提高60%")])])])]),e("p",null,[e("strong",null,"第三个是’分布式环境下的数据权限’问题。")]),e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：A事业部的用户不能看到B事业部的供应商数据，但这种过滤不能在每个查询接口重复实现")]),e("li",null,[e("strong",null,"我的解决方案"),r("： "),e("ol",null,[e("li",null,[e("strong",null,"Spring AOP + 自定义注解"),r("：在DAO层通过切面自动注入数据权限过滤条件")]),e("li",null,[e("strong",null,"ThreadLocal传递用户上下文"),r("：在网关层解析用户权限，通过ThreadLocal传递到业务层")]),e("li",null,[e("strong",null,"Redis缓存权限规则"),r("：将用户-数据权限关系缓存到Redis，避免每次查询都访问数据库")]),e("li",null,[e("strong",null,"结果"),r("：实现"),e("strong",null,"对业务代码透明"),r('的数据权限控制，性能影响<5%"')])])])])],-1)),a[67]||(a[67]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[68]||(a[68]=e("ul",null,[e("li",null,"每个问题都有具体的技术难点描述"),e("li",null,"解决方案体现设计模式和架构思想"),e("li",null,"有量化的性能和改进指标")],-1)),a[69]||(a[69]=e("hr",null,null,-1)),a[70]||(a[70]=e("h5",{id:"第五层-系统级难点与思考-1分钟-架构演进视角",tabindex:"-1"},[r("第五层：系统级难点与思考（1分钟 - 架构演进视角） "),e("a",{class:"header-anchor",href:"#第五层-系统级难点与思考-1分钟-架构演进视角","aria-label":'Permalink to "第五层：系统级难点与思考（1分钟 - 架构演进视角）"'},"​")],-1)),a[71]||(a[71]=e("p",null,[e("strong",null,"目标"),r("：讨论系统层面的架构挑战和思考。")],-1)),a[72]||(a[72]=e("blockquote",null,[e("p",null,[e("strong",null,'"在系统架构层面，我们面临几个持续的挑战：')]),e("p",null,[e("strong",null,"第一个是’数据一致性与性能的权衡’。")]),e("ul",null,[e("li",null,"作为基础服务，我们对数据的准确性要求极高，但分布式事务的性能代价又难以接受"),e("li",null,[r("我们采用"),e("strong",null,"最终一致性"),r("为主，但在供应商状态变更等关键场景，仍需要"),e("strong",null,"短暂的数据同步窗口"),r("，这是个持续优化的平衡点")])]),e("p",null,[e("strong",null,"第二个是’API兼容性与技术债管理’。")]),e("ul",null,[e("li",null,[r("作为被几十个系统依赖的中台，我们的API一旦发布就"),e("strong",null,"几乎不能下线")]),e("li",null,[r("即使推出了v2接口，v1接口也不敢废弃，导致系统"),e("strong",null,"技术债持续累积"),r("。如何在推动下游升级和保持系统纯洁性之间找到平衡，是个管理难题")])]),e("p",null,[e("strong",null,"第三个是’缓存策略的极致优化’。")]),e("ul",null,[e("li",null,[r("权限数据、配置数据等要求"),e("strong",null,"极高的实时性"),r("，但又是"),e("strong",null,"最高频的查询")]),e("li",null,[r("我们通过"),e("strong",null,"多级缓存"),r("（本地缓存+Redis）来优化，但在集群环境下，本地缓存的"),e("strong",null,"一致性"),r("又成为新的问题。这是一个典型的"),e("strong",null,"复杂度转移"),r("案例")])]),e("p",null,[e("strong",null,"第四个是’监控与故障定位’。")]),e("ul",null,[e("li",null,[r("当一个问题涉及权限服务、供应商服务、模板服务等多个微服务时，"),e("strong",null,"故障定位变得异常困难")]),e("li",null,'我们虽然建立了链路追踪，但在高并发下，全量采集的性能开销又成为新的瓶颈"')])],-1)),a[73]||(a[73]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[74]||(a[74]=e("ul",null,[e("li",null,"体现对分布式系统本质问题的理解"),e("li",null,"展现架构权衡的思考"),e("li",null,"承认技术没有完美解决方案")],-1)),a[75]||(a[75]=e("hr",null,null,-1)),a[76]||(a[76]=e("h4",{id:"模板",tabindex:"-1"},[r("模板 "),e("a",{class:"header-anchor",href:"#模板","aria-label":'Permalink to "模板"'},"​")],-1)),a[77]||(a[77]=e("h5",{id:"_1-项目背景-商业价值",tabindex:"-1"},[r("1. 项目背景（商业价值） "),e("a",{class:"header-anchor",href:"#_1-项目背景-商业价值","aria-label":'Permalink to "1. 项目背景（商业价值）"'},"​")],-1)),a[78]||(a[78]=e("p",null,[r('"这是集团级的'),e("strong",null,"采购中台系统"),r('。过去各业务部门采购流程分散，导致同一供应商评价标准不一、数据孤岛、风险不可控。我们构建这个’采购中台’，就是要实现全集团采购能力的统一管理和数据共享。"')],-1)),a[79]||(a[79]=e("h5",{id:"_2-项目描述-技术架构",tabindex:"-1"},[r("2. 项目描述（技术架构） "),e("a",{class:"header-anchor",href:"#_2-项目描述-技术架构","aria-label":'Permalink to "2. 项目描述（技术架构）"'},"​")],-1)),a[80]||(a[80]=e("p",null,[r('"系统采用'),e("strong",null,"Spring Cloud Alibaba微服务架构"),r('，核心服务包括供应商主数据、统一权限管理、模板引擎、业务群组、白名单管理等。作为基础公共服务，被公司数十个业务系统依赖。"')],-1)),a[81]||(a[81]=e("h5",{id:"_3-个人职责与业务开发",tabindex:"-1"},[r("3. 个人职责与业务开发 "),e("a",{class:"header-anchor",href:"#_3-个人职责与业务开发","aria-label":'Permalink to "3. 个人职责与业务开发"'},"​")],-1)),a[82]||(a[82]=e("p",null,[r('"我主要负责'),e("strong",null,"供应商评估分类模块"),r("和"),e("strong",null,"系统性能优化"),r("：")],-1)),a[83]||(a[83]=e("p",null,[e("strong",null,"评估模块"),r("：我设计了一个"),e("strong",null,"可配置的规则引擎"),r("，用JSON存储评分规则，支持指标、权重、数据源的灵活配置，通过策略模式实现不同的评分算法。")],-1)),a[84]||(a[84]=e("p",null,[e("strong",null,"性能优化"),r("：建立完整的优化体系，包括Redis缓存热点数据、SQL执行计划分析、分库分表、读写分离，将核心接口响应时间"),e("strong",null,"稳定控制在250ms内"),r('。"')],-1)),a[85]||(a[85]=e("h5",{id:"_4-解决的技术难题",tabindex:"-1"},[r("4. 解决的技术难题 "),e("a",{class:"header-anchor",href:"#_4-解决的技术难题","aria-label":'Permalink to "4. 解决的技术难题"'},"​")],-1)),a[86]||(a[86]=e("p",null,[r('"'),e("strong",null,"复杂业务规则的抽象与执行"),r("：")],-1)),a[87]||(a[87]=e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：不同品类供应商评估标准完全不同")]),e("li",null,[e("strong",null,"方案"),r("：元数据驱动 + 策略模式 + 并行数据获取")]),e("li",null,[e("strong",null,"结果"),r("：支持不发版调整评估标准，计算性能在500ms内")])],-1)),a[88]||(a[88]=e("p",null,[e("strong",null,"大规模代码重构与质量提升"),r("：")],-1)),a[89]||(a[89]=e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：40多个分散定时任务，300多个深层if-else")]),e("li",null,[e("strong",null,"方案"),r("：策略模式统一定时任务 + 函数式编程重构条件逻辑")]),e("li",null,[e("strong",null,"结果"),r('：代码量减少40%，开发效率提升60%"')])],-1)),a[90]||(a[90]=e("h5",{id:"_5-系统级难点与思考",tabindex:"-1"},[r("5. 系统级难点与思考 "),e("a",{class:"header-anchor",href:"#_5-系统级难点与思考","aria-label":'Permalink to "5. 系统级难点与思考"'},"​")],-1)),a[91]||(a[91]=e("p",null,[r('"'),e("strong",null,"API兼容性与技术债管理"),r("：作为被几十个系统依赖的中台，API一旦发布几乎不能下线，如何在推动升级和保持系统纯洁性间平衡是持续挑战。")],-1)),a[92]||(a[92]=e("p",null,[e("strong",null,"缓存策略的极致优化"),r('：权限数据要求极高实时性又是最高频查询，多级缓存在集群环境下的一致性保障需要持续优化。"')],-1)),a[93]||(a[93]=e("hr",null,null,-1)),a[94]||(a[94]=e("h4",{id:"深度技术面试详解",tabindex:"-1"},[r("深度技术面试详解 "),e("a",{class:"header-anchor",href:"#深度技术面试详解","aria-label":'Permalink to "深度技术面试详解"'},"​")],-1)),a[95]||(a[95]=e("h5",{id:"一、项目背景与商业价值-深入版",tabindex:"-1"},[r("一、项目背景与商业价值（深入版） "),e("a",{class:"header-anchor",href:"#一、项目背景与商业价值-深入版","aria-label":'Permalink to "一、项目背景与商业价值（深入版）"'},"​")],-1)),a[96]||(a[96]=e("blockquote",null,[e("p",null,"采购公共服务系统是公司ERP系统的核心中台模块，旨在解决集团内部采购流程分散、数据孤岛、供应商管理不统一的问题。过去，各个事业部有自己的供应商池和评估标准，导致同一家供应商在不同部门的评级不同，集团无法集中议价，采购风险难以控制。该系统将全集团的供应商管理、权限控制、评估模板等公共能力下沉，为所有采购相关业务提供统一服务。")],-1)),a[97]||(a[97]=e("h6",{id:"_1-1-业务痛点深度分析",tabindex:"-1"},[r("1.1 业务痛点深度分析 "),e("a",{class:"header-anchor",href:"#_1-1-业务痛点深度分析","aria-label":'Permalink to "1.1 业务痛点深度分析"'},"​")],-1)),a[98]||(a[98]=e("p",null,[r('"在深入介绍前，我想先阐述这个系统解决的'),e("strong",null,"根本性业务问题"),r("：")],-1)),a[99]||(a[99]=e("p",null,[e("strong",null,"数据孤岛与标准不一")],-1)),a[100]||(a[100]=e("ul",null,[e("li",null,"各事业部独立维护供应商数据，同一供应商在不同系统中有不同ID和评级"),e("li",null,"缺乏统一的供应商准入标准，质量风险难以控制"),e("li",null,"采购数据分散，集团无法利用规模优势进行集中议价")],-1)),a[101]||(a[101]=e("p",null,[e("strong",null,"流程效率低下")],-1)),a[102]||(a[102]=e("ul",null,[e("li",null,"新供应商准入需要跨部门人工审批，周期长达2-3周"),e("li",null,"供应商评估依赖个人经验，缺乏客观量化标准"),e("li",null,"权限管理分散，每个系统都需要重复开发权限模块")],-1)),a[103]||(a[103]=e("p",null,[e("strong",null,"合规与审计风险")],-1)),a[104]||(a[104]=e("ul",null,[e("li",null,"采购决策缺乏完整的数据追溯链"),e("li",null,"敏感操作缺少统一的审计日志"),e("li",null,'难以满足上市公司的合规性要求"')],-1)),a[105]||(a[105]=e("h6",{id:"_1-2-中台战略定位",tabindex:"-1"},[r("1.2 中台战略定位 "),e("a",{class:"header-anchor",href:"#_1-2-中台战略定位","aria-label":'Permalink to "1.2 中台战略定位"'},"​")],-1)),a[106]||(a[106]=e("p",null,[r('"我们的系统定位是'),e("strong",null,"采购能力中台"),r("，将通用的采购能力抽象为可复用的服务：")],-1)),a[107]||(a[107]=e("ul",null,[e("li",null,[e("strong",null,"供应商主数据服务"),r("：全集团唯一的供应商信息源")]),e("li",null,[e("strong",null,"统一权限服务"),r("：所有采购系统的单点权限控制")]),e("li",null,[e("strong",null,"模板引擎服务"),r("：可配置的业务规则执行引擎")]),e("li",null,[e("strong",null,"审计追踪服务"),r('：完整的操作日志和合规保障"')])],-1)),a[108]||(a[108]=e("hr",null,null,-1)),a[109]||(a[109]=e("h5",{id:"二、系统架构深度解析",tabindex:"-1"},[r("二、系统架构深度解析 "),e("a",{class:"header-anchor",href:"#二、系统架构深度解析","aria-label":'Permalink to "二、系统架构深度解析"'},"​")],-1)),a[110]||(a[110]=e("h6",{id:"_2-1-微服务架构设计",tabindex:"-1"},[r("2.1 微服务架构设计 "),e("a",{class:"header-anchor",href:"#_2-1-微服务架构设计","aria-label":'Permalink to "2.1 微服务架构设计"'},"​")],-1)),a[111]||(a[111]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 系统核心服务划分")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SpringBootApplication")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ProcurementPlatform"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 1. 供应商主数据服务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SupplierService "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplierService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SupplierService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 供应商生命周期管理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 2. 权限控制服务  ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," AuthorizationService "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"authService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AuthorizationService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 统一的RBAC权限模型")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 3. 模板引擎服务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," TemplateEngineService "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"templateService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," TemplateEngineService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 可配置的业务规则")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 4. 业务群组服务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," BusinessGroupService "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"groupService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," BusinessGroupService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 多租户数据隔离")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[112]||(a[112]=e("h6",{id:"_2-2-技术栈选型考量",tabindex:"-1"},[r("2.2 技术栈选型考量 "),e("a",{class:"header-anchor",href:"#_2-2-技术栈选型考量","aria-label":'Permalink to "2.2 技术栈选型考量"'},"​")],-1)),a[113]||(a[113]=e("p",null,[r('"我们在技术选型时重点考虑了'),e("strong",null,"中台系统"),r("的特殊要求：")],-1)),a[114]||(a[114]=e("p",null,[e("strong",null,"Spring Cloud Alibaba体系")],-1)),a[115]||(a[115]=e("ul",null,[e("li",null,[e("strong",null,"Nacos"),r("：服务注册发现 + 配置中心，支持配置热更新")]),e("li",null,[e("strong",null,"Sentinel"),r("：流量控制、熔断降级，保障服务稳定性")]),e("li",null,[e("strong",null,"Seata"),r("：分布式事务，解决数据一致性问题（在关键业务中使用）")])],-1)),a[116]||(a[116]=e("p",null,[e("strong",null,"数据存储策略")],-1)),a[117]||(a[117]=e("ul",null,[e("li",null,[e("strong",null,"MySQL"),r("：核心业务数据，采用分库分表")]),e("li",null,[e("strong",null,"Redis"),r("：缓存热点数据 + 分布式会话 + 分布式锁")]),e("li",null,[e("strong",null,"Elasticsearch"),r("：供应商搜索和复杂查询")])],-1)),a[118]||(a[118]=e("p",null,[e("strong",null,"消息中间件")],-1)),a[119]||(a[119]=e("ul",null,[e("li",null,[e("strong",null,"RabbitMQ"),r("：业务解耦 + 最终一致性保障")]),e("li",null,[r("采用"),e("strong",null,"确认机制"),r('确保消息不丢失"')])],-1)),a[120]||(a[120]=e("hr",null,null,-1)),a[121]||(a[121]=e("h5",{id:"三、核心模块技术实现",tabindex:"-1"},[r("三、核心模块技术实现 "),e("a",{class:"header-anchor",href:"#三、核心模块技术实现","aria-label":'Permalink to "三、核心模块技术实现"'},"​")],-1)),a[122]||(a[122]=e("h6",{id:"_3-1-供应商评估分类模块-重点",tabindex:"-1"},[r("3.1 供应商评估分类模块（重点） "),e("a",{class:"header-anchor",href:"#_3-1-供应商评估分类模块-重点","aria-label":'Permalink to "3.1 供应商评估分类模块（重点）"'},"​")],-1)),a[123]||(a[123]=e("p",null,[e("strong",null,"3.1.1 规则引擎设计")],-1)),a[124]||(a[124]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 可配置的评估规则引擎核心实现")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SupplierEvaluationEngine"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RedisTemplate<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> redisTemplate;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DataSourceRouter dataSourceRouter;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 执行供应商评估")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," EvaluationResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"evaluateSupplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"templateCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," startTime "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," System."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentTimeMillis"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 1. 加载评估模板")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            EvaluationTemplate template "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," loadEvaluationTemplate"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(templateCode);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 2. 并行获取评估数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Map<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> evaluationData "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," fetchEvaluationDataParallel"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId, template);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 3. 执行评分计算")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ScoreResult scoreResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," calculateScores"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(template, evaluationData);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 4. 确定供应商等级")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            SupplierLevel level "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," determineSupplierLevel"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(scoreResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTotalScore"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 5. 保存评估结果和快照")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," saveEvaluationResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId, template, scoreResult, level, evaluationData);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"供应商评估完成，supplierId: {}, 耗时: {}ms"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    supplierId, System."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentTimeMillis"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," startTime);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 并行获取多维度评估数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Map<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"fetchEvaluationDataParallel"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                                           EvaluationTemplate "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"template"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 使用CompletableFuture并行调用多个数据源")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"DataFetchResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> futures "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," template."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getDataSources"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dataSource "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                fetchSingleDataSource"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId, dataSource), dataFetchExecutor))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"collect"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collectors."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 等待所有数据获取完成（设置超时）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"allOf"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," CompletableFuture"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.SECONDS);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (TimeoutException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"warn"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"数据获取超时，将使用已获取的数据继续评估"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 不抛出异常，使用已获取的数据继续评估")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EvaluationException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"数据获取失败"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 聚合结果")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Map<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> result "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HashMap<>();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"DataFetchResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> future "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," futures) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (future."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isDone"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," !"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"future."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isCompletedExceptionally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    DataFetchResult dataResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," future."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    result."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dataResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getDataSource"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), dataResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"warn"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"单个数据源获取失败"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[125]||(a[125]=e("p",null,[e("strong",null,"3.1.2 模板配置数据结构")],-1)),a[126]||(a[126]=e("div",{class:"language-json max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"json"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 评估模板的JSON配置结构")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'  "templateCode"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ELECTRONIC_SUPPLIER_V1"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'  "templateName"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"电子类供应商评估模板"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'  "applicableCategories"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ELECTRONIC"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"PCBA"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"],")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'  "scoringRules"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'    "indicators"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": [")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "code"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"QUALITY_PERFORMANCE"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "name"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"质量表现"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "weight"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0.35"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "dataSource"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"QMS_SYSTEM"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "calculationType"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"THRESHOLD_SCORING"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "parameters"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'          "dataField"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"quality_qualified_rate"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'          "thresholds"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": [")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"min"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"99.5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"EXCELLENT"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"min"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"99.0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"max"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"99.5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"GOOD"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"min"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"98.0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"max"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"99.0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"6"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"AVERAGE"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"max"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"98.0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"score"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"POOR"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          ]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      },")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "code"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"TECHNICAL_CAPABILITY"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "name"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"技术能力"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "weight"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0.25"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "dataSource"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"MANUAL_SCORING"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "calculationType"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"EXPERT_EVALUATION"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'        "parameters"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'          "requiredRoles"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"TECHNICAL_MANAGER"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"RD_DIRECTOR"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"],")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'          "scoringRange"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"min"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"max"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  },")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'  "levelSettings"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'    "levels"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": [")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"A"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"minScore"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"90"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"privileges"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"PRIORITY_BIDDING"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"LONG_TERM_CONTRACT"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"B"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"minScore"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"75"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"maxScore"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"90"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"privileges"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"NORMAL_BIDDING"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"C"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"minScore"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"60"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"maxScore"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"75"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"privileges"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"RESTRICTED_BIDDING"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]},")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      {"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"D"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"maxScore"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"60"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"privileges"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": [], "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},'"actions"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ["),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"AUTO_REJECT"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]}")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[127]||(a[127]=e("h6",{id:"_3-2-系统性能优化-深度实践",tabindex:"-1"},[r("3.2 系统性能优化（深度实践） "),e("a",{class:"header-anchor",href:"#_3-2-系统性能优化-深度实践","aria-label":'Permalink to "3.2 系统性能优化（深度实践）"'},"​")],-1)),a[128]||(a[128]=e("p",null,[e("strong",null,"3.2.1 多级缓存架构")],-1)),a[129]||(a[129]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MultiLevelCacheService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RedisTemplate<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> redisTemplate;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 本地缓存（Caffeine）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Cache<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> localCache "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Caffeine."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"newBuilder"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"maximumSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"expireAfterWrite"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.MINUTES)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 多级缓存查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," <"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"T"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> T "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getWithMultiLevelCache"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"key"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Class<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"T"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                      Supplier<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"T"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"loader"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Duration "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"expiry"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1. 查询本地缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        T value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (T) localCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getIfPresent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            metricService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordCacheHit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"local"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 2. 查询Redis分布式缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String redisKey "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "procurement:"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (T) redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(redisKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 回填本地缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            localCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            metricService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordCacheHit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"redis"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 3. 缓存未命中，从数据源加载")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," loader."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 异步写入缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 写入Redis，设置过期时间")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(redisKey, value, expiry);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 写入本地缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                localCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }, cacheExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        metricService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordCacheMiss"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 缓存一致性保障 - 发布缓存失效事件")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"EventListener")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," handleDataChangeEvent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(DataChangedEvent "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String cacheKey "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," buildCacheKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getEntityType"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getEntityId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1. 删除本地缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        localCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"invalidate"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cacheKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 2. 发布Redis消息，通知其他实例失效本地缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"convertAndSend"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"cache.invalidation"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", cacheKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 3. 删除Redis缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"delete"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"procurement:"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cacheKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[130]||(a[130]=e("p",null,[e("strong",null,"3.2.2 SQL优化实战")],-1)),a[131]||(a[131]=e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 优化前的慢查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_evaluation ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WHERE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"IN"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WHERE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," category "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'ELECTRONIC'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"AND"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," evaluation_date "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BETWEEN"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '2023-01-01'"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," AND"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '2023-12-31'")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ORDER BY"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," total_score "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"DESC"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 优化后的查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 1. 创建复合索引")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"CREATE"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," INDEX"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," idx_supplier_evaluation_composite"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ON"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_evaluation(supplier_id, evaluation_date, total_score);")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 2. 使用JOIN替代子查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," se."),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_evaluation se")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"INNER JOIN"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier s "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ON"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," se"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"supplier_id"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," s"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"supplier_id")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WHERE"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," s"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"category"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'ELECTRONIC'")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"AND"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," se"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"evaluation_date"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," BETWEEN"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '2023-01-01'"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," AND"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '2023-12-31'")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ORDER BY"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," se"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"total_score"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," DESC"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 3. 分页优化 - 使用游标分页替代LIMIT OFFSET")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_evaluation ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"WHERE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ? "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"AND"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," evaluation_date "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BETWEEN"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ? "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"AND"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ?")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ORDER BY"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"LIMIT"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[132]||(a[132]=e("hr",null,null,-1)),a[133]||(a[133]=e("h5",{id:"四、解决的核心技术难题",tabindex:"-1"},[r("四、解决的核心技术难题 "),e("a",{class:"header-anchor",href:"#四、解决的核心技术难题","aria-label":'Permalink to "四、解决的核心技术难题"'},"​")],-1)),a[134]||(a[134]=e("h6",{id:"_4-1-分布式数据权限控制",tabindex:"-1"},[r("4.1 分布式数据权限控制 "),e("a",{class:"header-anchor",href:"#_4-1-分布式数据权限控制","aria-label":'Permalink to "4.1 分布式数据权限控制"'},"​")],-1)),a[135]||(a[135]=e("p",null,[e("strong",null,"4.1.1 架构设计")],-1)),a[136]||(a[136]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 基于Spring AOP的数据权限切面")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Aspect")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DataPermissionAspect"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Around"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"@annotation(dataPermission)"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"applyDataPermission"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ProceedingJoinPoint "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"joinPoint"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                    DataPermission "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"dataPermission"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Throwable {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1. 获取当前用户权限上下文")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        UserContext userContext "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SecurityContextHolder."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getUserContext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 2. 解析数据权限规则")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        DataPermissionRule rule "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," parsePermissionRule"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dataPermission, userContext);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 3. 修改SQL查询条件")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        modifyQueryForDataPermission"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(joinPoint, rule);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 4. 执行原方法")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," joinPoint."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"proceed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," modifyQueryForDataPermission"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ProceedingJoinPoint "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"joinPoint"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                            DataPermissionRule "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"rule"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] args "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," joinPoint."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getArgs"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," args.length; i"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (args[i] "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DataQuery) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                DataQuery query "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (DataQuery) args[i];")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 动态添加数据权限过滤条件")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                query."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addFilter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"buildDataPermissionFilter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(rule));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 数据权限规则配置")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Entity")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Table"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"name"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "data_permission_rule"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DataPermissionRule"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Id")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Long id;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 规则类型：用户级、部门级、业务群组级")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Enumerated"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(EnumType.STRING)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RuleType ruleType;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 目标数据类型：供应商、报价单、合同等")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String dataType;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 权限条件（SQL WHERE片段）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String permissionCondition;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // JSON配置，支持复杂规则")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Column"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"columnDefinition"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "json"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String ruleConfig;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[137]||(a[137]=e("p",null,[e("strong",null,"4.1.2 性能优化策略")],-1)),a[138]||(a[138]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DataPermissionOptimizer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 权限规则缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," LoadingCache<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"DataPermissionRule"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> permissionCache "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Caffeine."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"newBuilder"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"maximumSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"refreshAfterWrite"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.MINUTES)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"loadPermissionRules);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 预编译数据权限过滤器，避免每次查询都解析规则")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DataFilter "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compileDataFilter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(UserContext "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"userContext"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"dataType"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String cacheKey "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," buildCacheKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(userContext, dataType);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," permissionCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cacheKey)."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"convertRuleToFilter)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reduce"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(DataFilter"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"and)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"orElse"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(DataFilter.EMPTY);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[139]||(a[139]=e("h6",{id:"_4-2-大规模代码重构与质量提升",tabindex:"-1"},[r("4.2 大规模代码重构与质量提升 "),e("a",{class:"header-anchor",href:"#_4-2-大规模代码重构与质量提升","aria-label":'Permalink to "4.2 大规模代码重构与质量提升"'},"​")],-1)),a[140]||(a[140]=e("p",null,[e("strong",null,"4.2.1 定时任务统一管理")],-1)),a[141]||(a[141]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 定时任务统一接口")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," interface"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ScheduledTask"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTaskName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getCronExpression"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," execute"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    default"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," isEnabled"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() { "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 定时任务执行器")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," UnifiedScheduler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ScheduledTask"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> scheduledTasks;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostConstruct")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," scheduleAllTasks"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        scheduledTasks."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"filter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ScheduledTask"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"isEnabled)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"forEach"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"scheduleTask);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," scheduleTask"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ScheduledTask "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"task"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 使用ScheduledExecutorService统一调度")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 添加监控和异常处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        scheduledExecutor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"scheduleWithFixedDelay"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                metricService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordTaskStart"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(task."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTaskName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                task."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"execute"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                metricService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordTaskSuccess"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(task."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTaskName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                metricService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordTaskFailure"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(task."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTaskName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"定时任务执行失败: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", task."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTaskName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getDelaySeconds"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(task."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getCronExpression"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()), TimeUnit.SECONDS);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[142]||(a[142]=e("p",null,[e("strong",null,"4.2.2 复杂条件逻辑重构")],-1)),a[143]||(a[143]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 重构前 - 深层嵌套的if-else")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," OldEvaluationService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ScoreResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"evaluate"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Supplier "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", EvaluationContext "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"context"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (supplier."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getCategory"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ELECTRONIC"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (context."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isQualityCheckRequired"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (supplier."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getQualityScore"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 8.0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (supplier."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getDeliveryPerformance"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 95.0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // ... 更多嵌套")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (supplier."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getCategory"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"MECHANICAL"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 另一个复杂的条件分支")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // ... 总共300多行深层嵌套")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 重构后 - 使用函数式编程和策略模式")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," RefactoredEvaluationService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Map<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"EvaluationStrategy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> strategies;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ScoreResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"evaluate"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Supplier "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", EvaluationContext "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"context"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," strategies."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplier."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getCategory"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"evaluate"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplier, context);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 策略接口")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," interface"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EvaluationStrategy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ScoreResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"evaluate"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Supplier "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", EvaluationContext "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"context"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 具体策略实现")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ElectronicSupplierStrategy"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EvaluationStrategy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," List<EvaluationRule<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> rules "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Arrays."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"asList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"checkQualityRequirement,")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"checkDeliveryPerformance,")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"checkTechnicalCapability")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    );")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ScoreResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"evaluate"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Supplier "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", EvaluationContext "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"context"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rules."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(rule "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rule."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"apply"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplier, context))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reduce"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ScoreResult"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"combine)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"orElse"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ScoreResult.EMPTY);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ScoreResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"checkQualityRequirement"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Supplier "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", EvaluationContext "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"context"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," context."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isQualityCheckRequired"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getQualityScore"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 8.0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ?")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ScoreResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"passing"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"质量达标"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ScoreResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"failing"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"质量不达标"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[144]||(a[144]=e("hr",null,null,-1)),a[145]||(a[145]=e("h5",{id:"五、系统级架构挑战与解决方案",tabindex:"-1"},[r("五、系统级架构挑战与解决方案 "),e("a",{class:"header-anchor",href:"#五、系统级架构挑战与解决方案","aria-label":'Permalink to "五、系统级架构挑战与解决方案"'},"​")],-1)),a[146]||(a[146]=e("h6",{id:"_5-1-数据一致性保障",tabindex:"-1"},[r("5.1 数据一致性保障 "),e("a",{class:"header-anchor",href:"#_5-1-数据一致性保障","aria-label":'Permalink to "5.1 数据一致性保障"'},"​")],-1)),a[147]||(a[147]=e("p",null,[e("strong",null,"5.1.1 最终一致性模式")],-1)),a[148]||(a[148]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 基于消息队列的最终一致性实现")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EventuallyConsistentService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RabbitTemplate rabbitTemplate;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 创建供应商（核心事务+事件发布）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Supplier "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"createSupplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(CreateSupplierRequest "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"request"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1. 核心数据写入（强一致性）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Supplier supplier "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplierRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"save"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"convertToEntity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 2. 发布领域事件")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        SupplierCreatedEvent event "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SupplierCreatedEvent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplier."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        rabbitTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"convertAndSend"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"supplier.exchange"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"supplier.created"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", event);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 3. 记录本地事件表（防消息丢失）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        eventRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"save"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DomainEvent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(event));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 事件处理 - 更新相关系统的数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RabbitListener"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"queues"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "supplier.created.queue"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," handleSupplierCreated"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(SupplierCreatedEvent "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 更新搜索索引")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            searchService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"indexSupplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSupplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 通知风控系统")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            riskControlService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"onNewSupplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSupplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 标记事件已处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            eventRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"markAsProcessed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getEventId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 记录失败，进入重试机制")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"处理供应商创建事件失败"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AmqpRejectAndDontRequeueException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[149]||(a[149]=e("h6",{id:"_5-2-高可用与容灾设计",tabindex:"-1"},[r("5.2 高可用与容灾设计 "),e("a",{class:"header-anchor",href:"#_5-2-高可用与容灾设计","aria-label":'Permalink to "5.2 高可用与容灾设计"'},"​")],-1)),a[150]||(a[150]=e("p",null,[e("strong",null,"5.2.1 服务降级与熔断")],-1)),a[151]||(a[151]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 基于Sentinel的服务保护")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ProtectedSupplierService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SentinelResource"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        value"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "supplierQuery"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        fallback"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "getSupplierFallback"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        blockHandler"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "handleFlowControl"')]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    )")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Supplier "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSupplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 正常业务逻辑")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplierRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"findById"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"orElseThrow"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SupplierNotFoundException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 降级逻辑")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Supplier "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSupplierFallback"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Throwable "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"ex"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"warn"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"供应商查询降级，supplierId: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", supplierId, ex);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 返回降级数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Supplier fallback "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        fallback."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        fallback."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"供应商信息暂不可用"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        fallback."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setStatus"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(SupplierStatus.UNKNOWN);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," fallback;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 流控处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Supplier "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"handleFlowControl"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", BlockException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"ex"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ServiceBusyException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"系统繁忙，请稍后重试"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[152]||(a[152]=e("hr",null,null,-1)),a[153]||(a[153]=e("h5",{id:"六、量化成果与业务影响",tabindex:"-1"},[r("六、量化成果与业务影响 "),e("a",{class:"header-anchor",href:"#六、量化成果与业务影响","aria-label":'Permalink to "六、量化成果与业务影响"'},"​")],-1)),a[154]||(a[154]=e("h6",{id:"_6-1-性能指标提升",tabindex:"-1"},[r("6.1 性能指标提升 "),e("a",{class:"header-anchor",href:"#_6-1-性能指标提升","aria-label":'Permalink to "6.1 性能指标提升"'},"​")],-1)),a[155]||(a[155]=e("ul",null,[e("li",null,[e("strong",null,"接口响应时间"),r("：核心接口从平均800ms优化到250ms以内")]),e("li",null,[e("strong",null,"系统吞吐量"),r("：从500 TPS提升到2000 TPS")]),e("li",null,[e("strong",null,"缓存命中率"),r("：达到98.5%，数据库压力降低70%")]),e("li",null,[e("strong",null,"任务执行效率"),r("：批量评估任务从小时级优化到分钟级")])],-1)),a[156]||(a[156]=e("h6",{id:"_6-2-业务价值体现",tabindex:"-1"},[r("6.2 业务价值体现 "),e("a",{class:"header-anchor",href:"#_6-2-业务价值体现","aria-label":'Permalink to "6.2 业务价值体现"'},"​")],-1)),a[157]||(a[157]=e("ul",null,[e("li",null,[e("strong",null,"采购效率"),r("：供应商准入周期从3周缩短到3天")]),e("li",null,[e("strong",null,"决策质量"),r('：基于数据的客观评估，供应商"暴雷率"降低25%')]),e("li",null,[e("strong",null,"成本节约"),r("：集中议价每年为集团节约采购成本约8%")]),e("li",null,[e("strong",null,"合规性"),r("：实现100%操作可审计，满足上市合规要求")])],-1)),a[158]||(a[158]=e("h6",{id:"_6-3-技术债务清理",tabindex:"-1"},[r("6.3 技术债务清理 "),e("a",{class:"header-anchor",href:"#_6-3-技术债务清理","aria-label":'Permalink to "6.3 技术债务清理"'},"​")],-1)),a[159]||(a[159]=e("ul",null,[e("li",null,[e("strong",null,"代码质量"),r("：代码重复率从35%降低到8%")]),e("li",null,[e("strong",null,"可维护性"),r("：新功能开发效率提升60%")]),e("li",null,[e("strong",null,"系统稳定性"),r("：线上故障率降低80%")])],-1)),a[160]||(a[160]=e("hr",null,null,-1)),a[161]||(a[161]=e("p",null,"这个深度技术详解展现了你在架构设计、性能优化、复杂问题解决方面的全面能力，让面试官看到你不仅是一个编码实现者，更是一个系统架构师和问题解决专家。",-1)),a[162]||(a[162]=e("hr",null,null,-1)),a[163]||(a[163]=e("h4",{id:"高并发处理能力与优化",tabindex:"-1"},[r("高并发处理能力与优化 "),e("a",{class:"header-anchor",href:"#高并发处理能力与优化","aria-label":'Permalink to "高并发处理能力与优化"'},"​")],-1)),a[164]||(a[164]=e("h5",{id:"_1-高并发场景分析",tabindex:"-1"},[r("1. 高并发场景分析 "),e("a",{class:"header-anchor",href:"#_1-高并发场景分析","aria-label":'Permalink to "1. 高并发场景分析"'},"​")],-1)),a[165]||(a[165]=e("p",null,[e("strong",null,"读多写少"),r("是其典型特征：")],-1)),a[166]||(a[166]=e("ul",null,[e("li",null,[e("strong",null,"高频读操作"),r("（占比>90%）：权限验证、供应商信息查询、配置数据读取")]),e("li",null,[e("strong",null,"低频写操作"),r("：供应商信息变更、评估结果提交、权限配置更新")]),e("li",null,[e("strong",null,"特点"),r("：请求量大、响应要求高、数据一致性要求强")])],-1)),a[167]||(a[167]=e("h5",{id:"_2-四层性能优化体系",tabindex:"-1"},[r("2. 四层性能优化体系 "),e("a",{class:"header-anchor",href:"#_2-四层性能优化体系","aria-label":'Permalink to "2. 四层性能优化体系"'},"​")],-1)),a[168]||(a[168]=e("h6",{id:"第一层-缓存优化体系-解决读压力",tabindex:"-1"},[e("strong",null,"第一层：缓存优化体系（解决读压力）"),r(),e("a",{class:"header-anchor",href:"#第一层-缓存优化体系-解决读压力","aria-label":'Permalink to "**第一层：缓存优化体系（解决读压力）**"'},"​")],-1)),a[169]||(a[169]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 多级缓存架构实现")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ProcurementCacheService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 一级缓存：本地缓存（Caffeine），5分钟过期")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Cache<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> localCache "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Caffeine."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"newBuilder"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"maximumSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10_000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"expireAfterWrite"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.MINUTES)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordStats"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 记录缓存命中率")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 二级缓存：Redis集群")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RedisTemplate<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> redisTemplate;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 带降级的多级缓存查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," <"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"T"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> T "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getWithGracefulDegradation"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"key"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Supplier<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"T"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"loader"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                          Class<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"T"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Duration "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"expiry"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第1步：本地缓存（最快，<1ms）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        T value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (T) localCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getIfPresent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            metrics."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordCacheHit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"local"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第2步：分布式锁防止缓存击穿")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String lockKey "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "lock:cache:"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," key;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        RLock lock "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," redissonClient."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getLock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(lockKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 尝试获取锁，等待100ms，锁持有300ms")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tryLock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"300"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.MILLISECONDS)) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 第3步：Redis缓存（<5ms）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (T) redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"buildRedisKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 回填本地缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    localCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    metrics."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordCacheHit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"redis"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 第4步：数据库查询（最慢，20-100ms）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," loader."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (value "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 异步双写缓存（不阻塞主流程）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                                buildRedisKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key), ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                value, ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                expiry")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            );")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            localCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }, cacheWriteExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 第5步：降级方案 - 返回过期的缓存数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    T staleValue "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getStaleDataFromBackup"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    metrics."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordCacheDegradation"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," staleValue;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 获取锁失败，直接返回降级数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getStaleDataFromBackup"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (InterruptedException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            Thread."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentThread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"interrupt"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getStaleDataFromBackup"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isHeldByCurrentThread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"unlock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 缓存预热机制（应对早高峰）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Scheduled"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cron"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "0 30 6 * * ?"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 每天6:30执行")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," preheatCache"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 预热高频查询数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> hotKeys "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," identifyHotKeys"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        hotKeys."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"parallelStream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"forEach"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 异步预热")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Object data "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," loadDataFromDB"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (data "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"buildRedisKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key), data, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.HOURS);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }, preheatExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        });")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[170]||(a[170]=e("h6",{id:"第二层-数据库优化",tabindex:"-1"},[e("strong",null,"第二层：数据库优化"),r(),e("a",{class:"header-anchor",href:"#第二层-数据库优化","aria-label":'Permalink to "**第二层：数据库优化**"'},"​")],-1)),a[171]||(a[171]=e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 1. 读写分离配置")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 主库（写）：1主 | 从库（读）：3从")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 使用ShardingSphere进行自动路由")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 2. 分库分表策略（供应商表，数据量：5000万+）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"CREATE"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," TABLE"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," supplier_00"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    supplier_id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BIGINT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," PRIMARY KEY"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    supplier_code "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"VARCHAR"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"50"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    -- ... 其他字段")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    shard_key "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"INT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," AS"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (supplier_id % "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 虚拟列用于分片")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PARTITION"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," BY"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," KEY"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(shard_key) PARTITIONS "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"16"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 3. 索引优化（覆盖索引）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"CREATE"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," INDEX"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," idx_supplier_query"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ON"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplier_00 ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplier_status, category_id, create_time) ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"INCLUDE"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (supplier_name, credit_level); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 包含查询所需的所有列")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 4. 垂直拆分（大字段分离）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- supplier_basic：基础信息，高频查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- supplier_detail：详细信息（公司介绍、资质文件等），低频查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- supplier_statistics：统计信息，用于报表")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[172]||(a[172]=e("h5",{id:"第三层-应用层优化",tabindex:"-1"},[e("strong",null,"第三层：应用层优化"),r(),e("a",{class:"header-anchor",href:"#第三层-应用层优化","aria-label":'Permalink to "**第三层：应用层优化**"'},"​")],-1)),a[173]||(a[173]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 连接池优化（HikariCP配置）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DataSource "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dataSource"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    HikariConfig config "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," HikariConfig"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setJdbcUrl"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(jdbcUrl);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setUsername"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(username);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setPassword"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(password);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMaximumPoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"50"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");          "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 根据CPU核心数调整")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMinimumIdle"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setConnectionTimeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");     "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 30秒超时")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setIdleTimeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"600000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");          "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 10分钟")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMaxLifetime"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1800000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");         "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 30分钟")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setConnectionTestQuery"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"SELECT 1"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setPoolName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ProcurementPool"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 监控连接池状态")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addDataSourceProperty"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"metrics"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"true"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    config."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addDataSourceProperty"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"metricRegistry"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", metricRegistry);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," HikariDataSource"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(config);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 2. 线程池隔离（不同业务使用不同线程池）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Configuration")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ThreadPoolConfiguration"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 核心业务线程池（快速响应）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"coreBusinessExecutor"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolTaskExecutor "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"coreBusinessExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ThreadPoolTaskExecutor executor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ThreadPoolTaskExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCorePoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMaxPoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"50"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setQueueCapacity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setThreadNamePrefix"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"core-business-"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setRejectedExecutionHandler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolExecutor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"CallerRunsPolicy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," executor;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 批量处理线程池（允许堆积）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"batchProcessingExecutor"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolTaskExecutor "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"batchProcessingExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ThreadPoolTaskExecutor executor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ThreadPoolTaskExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCorePoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMaxPoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setQueueCapacity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");  "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 大队列，允许任务堆积")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setThreadNamePrefix"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"batch-process-"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setRejectedExecutionHandler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolExecutor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"AbortPolicy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," executor;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 3. 异步化处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AsyncAssessmentService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolTaskExecutor batchProcessingExecutor;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 异步批量评估（应对评估高峰期）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Async"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"batchProcessingExecutor"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BatchResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"asyncBatchAssessment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierIds"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 使用分治策略：每100个供应商一批")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> batches "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Lists."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"partition"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierIds, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"AssessmentResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> futures "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batches."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(batch "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                processBatchAssessment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(batch), batchProcessingExecutor))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"collect"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collectors."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 等待所有批次完成，但设置超时")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"allOf"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," CompletableFuture"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"orTimeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.MINUTES)  "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 5分钟超时")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"thenApply"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," aggregateResults"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[174]||(a[174]=e("h5",{id:"第四层-应急与降级",tabindex:"-1"},[e("strong",null,"第四层：应急与降级"),r(),e("a",{class:"header-anchor",href:"#第四层-应急与降级","aria-label":'Permalink to "**第四层：应急与降级**"'},"​")],-1)),a[175]||(a[175]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 熔断降级（Sentinel配置）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SupplierServiceWithCircuitBreaker"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SentinelResource"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        value"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "supplierQueryResource"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        fallback"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "querySupplierFallback"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        blockHandler"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "handleFlowControl"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        exceptionsToIgnore"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {IllegalArgumentException.class}")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    )")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Supplier "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSupplierWithProtection"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 正常业务逻辑")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," supplierRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"findById"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"orElseThrow"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SupplierNotFoundException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 降级方法：返回简化数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Supplier "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"querySupplierFallback"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", Throwable "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"ex"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"warn"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"供应商查询降级，返回简化数据，supplierId: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", supplierId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Supplier simplified "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        simplified."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplierId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        simplified."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"供应商信息加载中..."'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        simplified."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setStatus"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(SupplierStatus.UNKNOWN);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 记录降级事件，用于后续补偿")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        degradeEventRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"save"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DegradeEvent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"supplier_query"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", supplierId));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," simplified;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 流控处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Supplier "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"handleFlowControl"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"supplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", BlockException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"ex"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ServiceDegradeException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"系统繁忙，请稍后重试"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 2. 限流策略")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," RateLimitConfiguration"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RateLimiter "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplierQueryRateLimiter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 令牌桶算法：每秒100个令牌，桶容量200")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RateLimiter."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"create"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100.0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"200"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.MILLISECONDS);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Before"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"execution(* com..SupplierService.*(..))"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," checkRateLimit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(JoinPoint "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"joinPoint"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"supplierQueryRateLimiter."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tryAcquire"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," RateLimitExceededException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"请求过于频繁，请稍后重试"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[176]||(a[176]=e("hr",null,null,-1)),a[177]||(a[177]=e("h3",{id:"零部件询报价寻源系统-交易型系统",tabindex:"-1"},[r("零部件询报价寻源系统（交易型系统） "),e("a",{class:"header-anchor",href:"#零部件询报价寻源系统-交易型系统","aria-label":'Permalink to "零部件询报价寻源系统（交易型系统）"'},"​")],-1)),a[178]||(a[178]=e("h4",{id:"参与的核心模块-1",tabindex:"-1"},[r("参与的核心模块 "),e("a",{class:"header-anchor",href:"#参与的核心模块-1","aria-label":'Permalink to "参与的核心模块"'},"​")],-1)),a[179]||(a[179]=e("ol",null,[e("li",null,[e("strong",null,"零部件数据导入/导出引擎")]),e("li",null,[e("strong",null,"供应商报价超时自动处理模块")]),e("li",null,[e("strong",null,"询价流程核心逻辑")])],-1)),a[180]||(a[180]=e("h4",{id:"如何体现业务能力-1",tabindex:"-1"},[r("如何体现业务能力 "),e("a",{class:"header-anchor",href:"#如何体现业务能力-1","aria-label":'Permalink to "如何体现业务能力"'},"​")],-1)),a[181]||(a[181]=e("p",null,[e("strong",null,"不要说："),r(' "我做了Excel导入导出功能。"')],-1)),a[182]||(a[182]=e("p",null,[e("strong",null,"要这样说：")],-1)),a[183]||(a[183]=e("blockquote",null,[e("p",null,[r('"我主导的'),e("strong",null,"零部件数据导入引擎"),r("，优化的是整个新车研发和采购流程的"),e("strong",null,"源头效率"),r("。在汽车行业，一个新车项目涉及上万个零部件，传统的Excel邮件来回传递，不仅容易出错，而且效率极低，是项目进度的"),e("strong",null,"核心瓶颈"),r("。")]),e("p",null,[e("strong",null,"我解决的核心业务问题是"),r("：")]),e("ul",null,[e("li",null,[e("strong",null,"流程卡点"),r("：之前采购员需要花几天时间手工处理Excel，现在"),e("strong",null,"从5分钟优化到10秒内"),r("，释放了人力，让他们能专注于更重要的供应商谈判工作。")]),e("li",null,[e("strong",null,"数据准确性"),r("：通过系统级的校验规则，杜绝了人为错误，保证了"),e("strong",null,"BOM（物料清单）数据的准确性"),r("，从源头上避免了因数据错误导致的采购错误和成本浪费。")]),e("li",null,[e("strong",null,"流程自动化"),r("：我设计的"),e("strong",null,"报价超时自动关闭机制"),r("，将采购员从繁琐的流程跟踪中解放出来，系统自动推进流程，确保了每个询价单都不会被遗忘，"),e("strong",null,"加快了新车型的上市周期"),r("。")])]),e("p",null,[e("strong",null,"这个模块带来的业务价值非常直接"),r('：它让东风日产的供应链响应速度更快，在面对市场竞争时能更敏捷，直接支撑了‘东风日产’、‘启辰’、‘英菲尼迪’等多个品牌车型的快速迭代。"')])],-1)),a[184]||(a[184]=e("hr",null,null,-1)),a[185]||(a[185]=e("h4",{id:"业务细节深度剖析-1",tabindex:"-1"},[r("业务细节深度剖析 "),e("a",{class:"header-anchor",href:"#业务细节深度剖析-1","aria-label":'Permalink to "业务细节深度剖析"'},"​")],-1)),a[186]||(a[186]=e("p",null,[e("strong",null,"1. 业务背景与痛点（展现你理解业务为什么存在）")],-1)),a[187]||(a[187]=e("blockquote",null,[e("p",null,[r('"在汽车行业，一个新车型项目的启动，涉及到'),e("strong",null,"上万种零部件"),r("的寻源和定价。在系统上线前，这个过程是这样的：")]),e("ol",null,[e("li",null,[r("工程师发布一个包含上万行零件的Excel "),e("code",null,"BOM（Bill of Material）清单"),r("。")]),e("li",null,[e("strong",null,"采购员需要手动将这张大表，按照‘采购品类’拆分成几十个小表"),r("，分别发给对应的供应商。")]),e("li",null,[r("供应商填报价，采购员再手动将几十个Excel里的报价"),e("strong",null,"合并回一张大表"),r("，进行比价。")])]),e("p",null,[e("strong",null,"这个过程的痛点在于：")]),e("ul",null,[e("li",null,[e("strong",null,"极易出错"),r("：手动复制粘贴，零件号和价格对不上是家常便饭。")]),e("li",null,[e("strong",null,"效率极低"),r("：一个车型的询价周期长达"),e("strong",null,"2-3周"),r("，严重拖慢新车上市速度。")]),e("li",null,[e("strong",null,"版本混乱"),r("：工程师发来BOM的v1.1，采购员可能还在用v1.0，导致采购了错误的零件。")]),e("li",null,[e("strong",null,"无法追溯"),r('：为什么最终选了这个供应商？当时的比价过程是怎样的？没有记录。"')])])],-1)),a[188]||(a[188]=e("p",null,[e("strong",null,"2. 我的技术实现如何解决业务痛点（展现你如何用技术赋能业务）")],-1)),a[189]||(a[189]=e("blockquote",null,[e("p",null,[r('"我负责打造的'),e("strong",null,"数据导入引擎"),r("，就是要将这个‘石器时代’的流程自动化。这不仅仅是‘上传一个Excel’，而是"),e("strong",null,"重新定义了一条数字化的供应链数据流水线"),r("。")]),e("p",null,[e("strong",null,"我的实现分为三个层次，对应三种不同量级的数据：")]),e("ol",null,[e("li",null,[e("p",null,[e("strong",null,"【万级以下：基于MyBatis的批量执行器缓存】")]),e("ul",null,[e("li",null,[e("strong",null,"技术细节"),r("：我配置了MyBatis的 "),e("code",null,"ExecutorType.BATCH"),r("，并在代码中控制 "),e("code",null,"flush"),r(" 的时机。")])]),e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 在Spring中获取批量SqlSession")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"SqlSession sqlSession "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sqlSessionTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSqlSessionFactory"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"openSession"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ExecutorType.BATCH);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"PartMapper mapper "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sqlSession."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMapper"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(PartMapper.class);")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batchSize "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); i"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    mapper."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"insert"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(parts."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(i));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 每1000条，刷到数据库一次，并清空缓存，防止OOM")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"%"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batchSize "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        sqlSession."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"flushStatements"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 最后提交事务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"sqlSession."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"commit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),e("button",{class:"code-block-unfold-btn"})]),e("ul",null,[e("li",null,[e("strong",null,"业务对应"),r("：这适用于日常的‘零星采购’或‘设计变更’，数据量小，要求快速响应。")])])]),e("li",null,[e("p",null,[e("strong",null,"【数万级：JDBC Batch + 手动事务管理】")]),e("ul",null,[e("li",null,[e("strong",null,"技术细节"),r("：我绕过了MyBatis，直接使用JDBC的原生批量处理能力，并手动控制事务。")])]),e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," DataSource dataSource;")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," bulkInsert"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(List"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Part"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String sql "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "INSERT INTO parts (part_code, part_name, ...) VALUES (?, ?, ...)"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Connection connection "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dataSource."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getConnection"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"         PreparedStatement ps "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," connection."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"prepareStatement"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(sql)) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        connection."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setAutoCommit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 关闭自动提交")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Part part "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," parts) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ps."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setString"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", part."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getPartCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ps."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setString"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", part."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // ... 设置其他参数")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ps."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addBatch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 加入批次")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 分段提交，避免批处理过大")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (batchCount"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," %"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5000"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ps."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"executeBatch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                connection."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"commit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 执行剩余批次")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ps."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"executeBatch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        connection."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"commit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (SQLException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 异常处理，记录失败的具体行和原因")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})]),e("ul",null,[e("li",null,[e("strong",null,"业务对应"),r("：这适用于一个‘子系统’或‘小总成’的零件导入，比如全车的‘线束’或‘内饰件’。")])])]),e("li",null,[e("p",null,[e("strong",null,"【数十万级：分段处理 + JDBC Batch + 并行计算】")]),e("ul",null,[e("li",null,[e("strong",null,"技术细节"),r("：这是最复杂的场景，我动用了 "),e("code",null,"CompletableFuture"),r(" 和分治思想。")])]),e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ImportResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"importFullVehicleBOM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(List"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Part"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," allParts) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 1. 数据预处理：清洗、去重、校验格式")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Part"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> validParts "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," preprocessData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(allParts);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 2. 按业务规则分片（例如：按零件大类分片）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Map<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Part"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> partsByCategory "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," validParts."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"collect"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collectors."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"groupingBy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Part"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"getCategoryCode));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 3. 为每个分片创建异步任务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    List<CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BatchResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> futures "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," partsByCategory."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"values"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(categoryParts "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 每个分类在一个独立的线程和事务中处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processSingleCategory"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(categoryParts);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }, importExecutor)) "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 使用专用的、队列很深的线程池")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"collect"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collectors."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 4. 等待所有任务完成，聚合结果")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"allOf"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," CompletableFuture"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"thenApply"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," futures."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(CompletableFuture"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"join)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"reduce"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ImportResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mergeResults))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"join"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})]),e("ul",null,[e("li",null,[e("strong",null,"业务对应"),r("：这就是支撑"),e("strong",null,"全新车型项目"),r("启动的‘核武器’。一个全新平台的BOM可能有"),e("strong",null,"15-20万行"),r("，我的引擎能在"),e("strong",null,"10秒内"),r('完成所有数据的清洗、校验、入库和初始化询价单，将项目周期缩短了数周。"')])])])])],-1)),a[190]||(a[190]=e("p",null,[e("strong",null,"3. 业务价值的具体量化（展现你的工作带来了什么）")],-1)),a[191]||(a[191]=e("blockquote",null,[e("p",null,'"这个引擎带来的价值，直接体现在公司的核心指标上：'),e("ul",null,[e("li",null,[e("strong",null,"时间就是金钱"),r("：将新车项目的"),e("strong",null,"询价启动周期从2周压缩到1天以内"),r("，为车型提前上市抢占了市场窗口。这在竞争白热化的汽车行业是"),e("strong",null,"战略级"),r("的优势。")]),e("li",null,[e("strong",null,"质量与成本"),r("：数据错误率从"),e("strong",null,"人工操作的~5%降低到系统级的<0.1%"),r("，避免了因采购错误零件导致的巨额模具修改费和项目延期损失。")]),e("li",null,[e("strong",null,"流程再造"),r("：实现了‘一个数据源’的理念。从此，工程师发布的BOM，就是采购员操作的BOM，就是最终财务结算的BOM，"),e("strong",null,"彻底消除了信息不一致的根源"),r("。")]),e("li",null,[e("strong",null,"能力沉淀"),r('：这套系统将个人经验（比如怎么拆分BOM）固化成了公司的数字资产，即使新人也能快速上手处理最复杂的车型项目。"')])])],-1)),a[192]||(a[192]=e("hr",null,null,-1)),a[193]||(a[193]=e("h4",{id:"宏观到微观-1",tabindex:"-1"},[r("宏观到微观 "),e("a",{class:"header-anchor",href:"#宏观到微观-1","aria-label":'Permalink to "宏观到微观"'},"​")],-1)),a[194]||(a[194]=e("h5",{id:"第一层-项目背景-30秒-让外行也能听懂",tabindex:"-1"},[r("第一层：项目背景（30秒 - 让外行也能听懂） "),e("a",{class:"header-anchor",href:"#第一层-项目背景-30秒-让外行也能听懂","aria-label":'Permalink to "第一层：项目背景（30秒 - 让外行也能听懂）"'},"​")],-1)),a[195]||(a[195]=e("p",null,[e("strong",null,"目标"),r("：用最简洁的语言说清楚这是个什么系统，解决了什么商业问题。")],-1)),a[196]||(a[196]=e("blockquote",null,[e("p",null,[e("strong",null,'"我们首先来看项目背景。')]),e("p",null,"在汽车制造行业，一辆车由上万个零部件组成。在项目初期，采购部门需要向成百上千家供应商询价、比价、谈判，最终确定由谁供货。这个流程传统上依赖Excel和邮件，效率极低且容易出错。"),e("p",null,[r("我参与的 "),e("strong",null,"'零部件询报价寻源系统'"),r(' ，就是要将这个耗时数周的线下流程，变成一个高效、透明、在线的数字化系统。它直接支撑了东风日产所有新车型的零部件采购工作。"')])],-1)),a[197]||(a[197]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[198]||(a[198]=e("ul",null,[e("li",null,"从行业常识切入，易于理解"),e("li",null,"一句话点明系统的商业价值"),e("li",null,"提到具体公司名称增加可信度")],-1)),a[199]||(a[199]=e("hr",null,null,-1)),a[200]||(a[200]=e("h5",{id:"第二层-项目描述-1分钟-展现技术视野",tabindex:"-1"},[r("第二层：项目描述（1分钟 - 展现技术视野） "),e("a",{class:"header-anchor",href:"#第二层-项目描述-1分钟-展现技术视野","aria-label":'Permalink to "第二层：项目描述（1分钟 - 展现技术视野）"'},"​")],-1)),a[201]||(a[201]=e("p",null,[e("strong",null,"目标"),r("：描述系统的技术架构和核心功能，展现你的技术视野。")],-1)),a[202]||(a[202]=e("blockquote",null,[e("p",null,[e("strong",null,'"接下来是项目描述。')]),e("p",null,[r("这是一个典型的"),e("strong",null,"分布式微服务架构"),r("的ToB系统。技术栈以 "),e("strong",null,"Spring Cloud"),r(" 为核心，使用 "),e("strong",null,"Nacos"),r(" 作为注册中心，"),e("strong",null,"MySQL"),r(" 作为主要存储，"),e("strong",null,"Redis"),r(" 处理缓存，"),e("strong",null,"RabbitMQ"),r(" 用于系统解耦。")]),e("p",null,[r("系统核心流程包括："),e("strong",null,"零件导入 → 创建询价单 → 供应商报价 → 比价决策 → 确定供应商"),r("。它需要与公司内部的 "),e("strong",null,"PDT车型管理系统"),r("、"),e("strong",null,"物流系统"),r(" 等多个上下游系统对接，是整个供应链的"),e("strong",null,"核心枢纽"),r('。"')])],-1)),a[203]||(a[203]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[204]||(a[204]=e("ul",null,[e("li",null,"明确技术架构定位（微服务、分布式）"),e("li",null,"列举核心技术和中间件"),e("li",null,"描述核心业务流程"),e("li",null,"说明系统在IT生态中的位置")],-1)),a[205]||(a[205]=e("hr",null,null,-1)),a[206]||(a[206]=e("h5",{id:"第三层-个人业务开发-1-5分钟-体现你的贡献",tabindex:"-1"},[r("第三层：个人业务开发（1.5分钟 - 体现你的贡献） "),e("a",{class:"header-anchor",href:"#第三层-个人业务开发-1-5分钟-体现你的贡献","aria-label":'Permalink to "第三层：个人业务开发（1.5分钟 - 体现你的贡献）"'},"​")],-1)),a[207]||(a[207]=e("p",null,[e("strong",null,"目标"),r("：具体说明你负责的模块，展现你的业务理解和技术实现能力。")],-1)),a[208]||(a[208]=e("blockquote",null,[e("p",null,[e("strong",null,'"在这个系统中，我主要负责两个核心模块的开发。')]),e("p",null,[e("strong",null,"第一个是’数据导入引擎’"),r("。这个模块要解决的核心业务问题是：如何将工程师提供的包含数万行零件数据的Excel表格，快速、准确地转化为系统中的结构化数据。")]),e("p",null,[e("strong",null,"我的实现方案是分级处理"),r("：")]),e("ul",null,[e("li",null,[r("对于万级以下数据，使用 "),e("strong",null,"MyBatis批量操作")]),e("li",null,[r("对于数万级数据，采用 "),e("strong",null,"JDBC Batch + 手动事务")]),e("li",null,[r("对于数十万级的全车BOM数据，使用 "),e("strong",null,"CompletableFuture并行处理 + 分片策略")])]),e("p",null,[e("strong",null,"第二个是’供应商报价超时自动处理’"),r("。业务背景是：给供应商的报价窗口期通常是48小时，超时后需要自动关闭报价通道。")]),e("p",null,[e("strong",null,"我的技术方案是"),r("：利用 "),e("strong",null,"RabbitMQ的延时队列和死信队列"),r('，在创建询价单时发送一个48小时后过期的消息，消息过期后自动进入死信队列，由消费者执行关闭逻辑。这取代了之前低效的数据库轮询方案。"')])],-1)),a[209]||(a[209]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[210]||(a[210]=e("ul",null,[e("li",null,'明确 ownership（"我负责"）'),e("li",null,"讲清业务问题，而不只是技术功能"),e("li",null,"技术方案与业务场景一一对应"),e("li",null,"体现技术选型的思考过程")],-1)),a[211]||(a[211]=e("hr",null,null,-1)),a[212]||(a[212]=e("h5",{id:"第四层-解决的技术难题-2分钟-展现实战深度",tabindex:"-1"},[r("第四层：解决的技术难题（2分钟 - 展现实战深度） "),e("a",{class:"header-anchor",href:"#第四层-解决的技术难题-2分钟-展现实战深度","aria-label":'Permalink to "第四层：解决的技术难题（2分钟 - 展现实战深度）"'},"​")],-1)),a[213]||(a[213]=e("p",null,[e("strong",null,"目标"),r("：深入技术细节，展现你解决复杂问题的能力。")],-1)),a[214]||(a[214]=e("blockquote",null,[e("p",null,[e("strong",null,'"在开发过程中，我攻克了几个关键的技术难题。')]),e("p",null,[e("strong",null,"第一个是’大数据量导入的稳定性’问题。")]),e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：在并行处理数十万行数据时，很容易出现"),e("strong",null,"OOM（内存溢出）"),r(" 和"),e("strong",null,"数据库连接池耗尽"),r("。")]),e("li",null,[e("strong",null,"我的解决方案"),r("： "),e("ol",null,[e("li",null,[e("strong",null,"流式读取"),r("：使用EasyExcel的流式读取API，不一次性加载整个Excel到内存。")]),e("li",null,[e("strong",null,"分片策略"),r("：按零件类别将数据分组，不同组在不同的线程中处理，避免单一事务过大。")]),e("li",null,[e("strong",null,"资源控制"),r("：为导入任务配置独立的线程池，设置合理的队列大小，使用"),e("code",null,"CallerRunsPolicy"),r("拒绝策略保证不丢失任务。")]),e("li",null,[e("strong",null,"结果"),r("：将导入时间从"),e("strong",null,"5分钟优化到10秒内"),r("，且在大数据量下保持稳定。")])])])]),e("p",null,[e("strong",null,"第二个是’分布式环境下的缓存一致性’问题。")]),e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：零件基础信息被缓存后，当工程师在源头系统修改了数据，如何让所有服务的缓存及时失效。")]),e("li",null,[e("strong",null,"我的解决方案"),r("： "),e("ol",null,[e("li",null,[e("strong",null,"设计缓存键规范"),r("：如"),e("code",null,"part:info:{partId}"),r("，便于管理和批量操作。")]),e("li",null,[e("strong",null,"建立更新广播机制"),r("：当基础数据变更时，通过RabbitMQ发布"),e("code",null,"PartInfoUpdatedEvent"),r("事件，所有消费此事件的服务都会失效本地缓存。")]),e("li",null,[e("strong",null,"降级策略"),r("：为缓存设置合理的TTL，作为最终保障。")]),e("li",null,[e("strong",null,"结果"),r('：核心数据的缓存一致性达到99.9%以上。"')])])])])],-1)),a[215]||(a[215]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[216]||(a[216]=e("ul",null,[e("li",null,'使用"问题-解决方案-结果"的黄金结构'),e("li",null,"提到具体的技术问题和风险（OOM、连接池耗尽、缓存不一致）"),e("li",null,"解决方案要具体到API和技术细节"),e("li",null,"用数据量化成果")],-1)),a[217]||(a[217]=e("hr",null,null,-1)),a[218]||(a[218]=e("h5",{id:"第五层-系统级难点与思考-1分钟-展现架构思维",tabindex:"-1"},[r("第五层：系统级难点与思考（1分钟 - 展现架构思维） "),e("a",{class:"header-anchor",href:"#第五层-系统级难点与思考-1分钟-展现架构思维","aria-label":'Permalink to "第五层：系统级难点与思考（1分钟 - 展现架构思维）"'},"​")],-1)),a[219]||(a[219]=e("p",null,[e("strong",null,"目标"),r("：讨论系统层面尚未完美解决的挑战，展现你的技术前瞻性和深度思考。")],-1)),a[220]||(a[220]=e("blockquote",null,[e("p",null,[e("strong",null,'"尽管我们解决了很多问题，但系统中仍存在一些架构层面的挑战。')]),e("p",null,[e("strong",null,"第一个是’跨系统数据一致性的终极保障’"),r("。")]),e("ul",null,[e("li",null,"我们虽然通过消息队列实现了最终一致性，但在极端网络分区场景下，仍可能出现微小概率的数据不一致。"),e("li",null,[r("我们曾考虑引入Seata这类分布式事务框架，但其性能代价在高速业务场景下难以接受。这是"),e("strong",null,"性能与一致性"),r("的经典权衡。")])]),e("p",null,[e("strong",null,"第二个是’复杂查询的性能与灵活性矛盾’"),r("。")]),e("ul",null,[e("li",null,"采购人员需要按零件类型、供应商地区、价格区间等十多个维度任意组合筛选询价单。"),e("li",null,[r("这种"),e("strong",null,"多维度、低基数的查询"),r("，无论是数据库索引还是缓存，都难以高效支持。")]),e("li",null,[r("我们目前的方案是通过"),e("strong",null,"Elasticsearch建立二级索引"),r("，但这又带来了数据同步延迟和维护复杂性的新问题。")])]),e("p",null,[e("strong",null,"第三个是’API的平滑演进与历史包袱’"),r("。")]),e("ul",null,[e("li",null,"作为公共服务，我们的API被几十个下游系统调用。即使推出了v2版本，也不敢轻易下线v1，因为无法确认是否还有陈旧的系统在依赖它。"),e("li",null,[r("这导致系统背负的"),e("strong",null,"技术债会随时间线性增长"),r('，需要在’推动下游改造’和’维护成本’之间不断权衡。"')])])],-1)),a[221]||(a[221]=e("p",null,[e("strong",null,"要点"),r("：")],-1)),a[222]||(a[222]=e("ul",null,[e("li",null,"展现你能够跳出具体代码，思考系统级问题"),e("li",null,"讨论技术选型的权衡（Trade-offs）"),e("li",null,"体现对技术债务、长期维护成本的认知"),e("li",null,"承认技术没有银弹，展现务实的态度")],-1)),a[223]||(a[223]=e("hr",null,null,-1)),a[224]||(a[224]=e("h4",{id:"模板-1",tabindex:"-1"},[r("模板 "),e("a",{class:"header-anchor",href:"#模板-1","aria-label":'Permalink to "模板"'},"​")],-1)),a[225]||(a[225]=e("h5",{id:"_1-项目背景-商业价值-1",tabindex:"-1"},[r("1. 项目背景（商业价值） "),e("a",{class:"header-anchor",href:"#_1-项目背景-商业价值-1","aria-label":'Permalink to "1. 项目背景（商业价值）"'},"​")],-1)),a[226]||(a[226]=e("p",null,[r('"这是一个支撑'),e("strong",null,"东风日产全系车型"),r('零部件采购的数字化系统。在汽车行业，一辆车有上万个零部件，传统依赖Excel和邮件的采购方式效率极低且容易出错。我们的系统就是要将耗时数周的线下流程，变成高效透明的在线数字化系统。"')],-1)),a[227]||(a[227]=e("h5",{id:"_2-项目描述-技术架构-1",tabindex:"-1"},[r("2. 项目描述（技术架构） "),e("a",{class:"header-anchor",href:"#_2-项目描述-技术架构-1","aria-label":'Permalink to "2. 项目描述（技术架构）"'},"​")],-1)),a[228]||(a[228]=e("p",null,[r('"系统采用'),e("strong",null,"Spring Cloud微服务架构"),r('，技术栈包括SpringBoot、MyBatis、MySQL、Nacos、Redis、RabbitMQ。核心流程涵盖零件导入、询价单创建、供应商报价、比价决策到确定供应商的全链路，需要与PDT车型管理系统、物流系统等多个上下游系统对接。"')],-1)),a[229]||(a[229]=e("h5",{id:"_3-个人职责与业务开发-1",tabindex:"-1"},[r("3. 个人职责与业务开发 "),e("a",{class:"header-anchor",href:"#_3-个人职责与业务开发-1","aria-label":'Permalink to "3. 个人职责与业务开发"'},"​")],-1)),a[230]||(a[230]=e("p",null,'"我主要负责两个核心模块：',-1)),a[231]||(a[231]=e("p",null,[e("strong",null,"第一是数据导入引擎"),r("：解决数万行Excel零件数据的快速准确转化问题。我采用"),e("strong",null,"分级处理策略"),r("：")],-1)),a[232]||(a[232]=e("ul",null,[e("li",null,"万级以下：MyBatis批量操作"),e("li",null,"数万级：JDBC Batch + 手动事务"),e("li",null,"数十万级：CompletableFuture并行处理 + 分片策略")],-1)),a[233]||(a[233]=e("p",null,[e("strong",null,"第二是供应商报价超时处理"),r("：通过"),e("strong",null,"RabbitMQ延时队列+死信队列"),r('实现48小时报价窗口期的自动关闭，取代低效的数据库轮询。"')],-1)),a[234]||(a[234]=e("h5",{id:"_4-解决的技术难题-1",tabindex:"-1"},[r("4. 解决的技术难题 "),e("a",{class:"header-anchor",href:"#_4-解决的技术难题-1","aria-label":'Permalink to "4. 解决的技术难题"'},"​")],-1)),a[235]||(a[235]=e("p",null,[r('"'),e("strong",null,"大数据量导入的稳定性问题"),r("：")],-1)),a[236]||(a[236]=e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：并行处理数十万数据时的OOM和连接池耗尽")]),e("li",null,[e("strong",null,"方案"),r("：流式读取 + 分片策略 + 资源隔离 + 合理的拒绝策略")]),e("li",null,[e("strong",null,"结果"),r("：导入时间从"),e("strong",null,"5分钟优化到10秒内"),r("，且保持稳定")])],-1)),a[237]||(a[237]=e("p",null,[e("strong",null,"分布式缓存一致性问题"),r("：")],-1)),a[238]||(a[238]=e("ul",null,[e("li",null,[e("strong",null,"难点"),r("：零件数据在源头修改后，多服务实例缓存更新不及时")]),e("li",null,[e("strong",null,"方案"),r("：设计缓存键规范 + MQ事件广播 + TTL兜底")]),e("li",null,[e("strong",null,"结果"),r('：缓存一致性达到99.9%以上"')])],-1)),a[239]||(a[239]=e("h5",{id:"_5-系统级难点与思考-1",tabindex:"-1"},[r("5. 系统级难点与思考 "),e("a",{class:"header-anchor",href:"#_5-系统级难点与思考-1","aria-label":'Permalink to "5. 系统级难点与思考"'},"​")],-1)),a[240]||(a[240]=e("p",null,[r('"'),e("strong",null,"跨系统数据一致性的终极保障"),r("：虽然通过MQ实现最终一致性，但极端网络分区下仍有微小概率不一致。我们在"),e("strong",null,"性能与一致性"),r("间持续权衡。")],-1)),a[241]||(a[241]=e("p",null,[e("strong",null,"复杂查询的性能与灵活性矛盾"),r('：多维度、低基数的组合查询难以优化，目前通过ES二级索引解决，但带来了数据同步延迟的新问题。"')],-1)),a[242]||(a[242]=e("hr",null,null,-1)),a[243]||(a[243]=e("h4",{id:"高并发处理能力与优化-1",tabindex:"-1"},[r("高并发处理能力与优化 "),e("a",{class:"header-anchor",href:"#高并发处理能力与优化-1","aria-label":'Permalink to "高并发处理能力与优化"'},"​")],-1)),a[244]||(a[244]=e("h5",{id:"_1-高并发场景分析-1",tabindex:"-1"},[r("1. 高并发场景分析 "),e("a",{class:"header-anchor",href:"#_1-高并发场景分析-1","aria-label":'Permalink to "1. 高并发场景分析"'},"​")],-1)),a[245]||(a[245]=e("p",null,[e("strong",null,"特点"),r("：有明显的"),e("strong",null,"峰值现象"),r("和"),e("strong",null,"批量处理需求")],-1)),a[246]||(a[246]=e("ul",null,[e("li",null,[e("strong",null,"高峰时段"),r("：新车项目启动时（批量导入数万零件）")]),e("li",null,[e("strong",null,"关键操作"),r("：供应商集中报价（截止时间前）")]),e("li",null,[e("strong",null,"数据特点"),r("：单次数据量大，计算复杂，时效性要求高")])],-1)),a[247]||(a[247]=e("h5",{id:"_2-四层性能优化体系-1",tabindex:"-1"},[r("2. 四层性能优化体系 "),e("a",{class:"header-anchor",href:"#_2-四层性能优化体系-1","aria-label":'Permalink to "2. 四层性能优化体系"'},"​")],-1)),a[248]||(a[248]=e("h6",{id:"第一层-数据分片与路由",tabindex:"-1"},[e("strong",null,"第一层：数据分片与路由"),r(),e("a",{class:"header-anchor",href:"#第一层-数据分片与路由","aria-label":'Permalink to "**第一层：数据分片与路由**"'},"​")],-1)),a[249]||(a[249]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 分库分表策略（按业务维度）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," QuotationShardingAlgorithm"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," PreciseShardingAlgorithm"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"doSharding"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collection<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"availableTargetNames"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                           PreciseShardingValue<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"shardingValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Long quotationId "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," shardingValue."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 策略1：大客户单独分库（数据隔离）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Long customerId "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," extractCustomerId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(quotationId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isKeyAccount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(customerId)) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "ds_key_account"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 大客户专属库")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 策略2：按时间分片（2023年、2024年不同库）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        LocalDateTime createTime "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getCreateTime"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(quotationId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," year "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," createTime."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getYear"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (year "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2024"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "ds_"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (year "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"%"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 2024年到ds_0")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (year "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2023"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "ds_"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (year "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"%"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 2023年到ds_1")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 策略3：按车型项目分片")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String projectCode "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getProjectCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(quotationId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Math."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"abs"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(projectCode."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"hashCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"%"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 4"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "ds_project_"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," hash;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 获取大客户分片")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," isKeyAccount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"customerId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 从缓存中获取大客户列表")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String cacheKey "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "key_accounts"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Set<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> keyAccounts "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Set"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Long"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cacheKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," keyAccounts "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," keyAccounts."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"contains"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(customerId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[250]||(a[250]=e("h6",{id:"第二层-批量处理优化",tabindex:"-1"},[e("strong",null,"第二层：批量处理优化"),r(),e("a",{class:"header-anchor",href:"#第二层-批量处理优化","aria-label":'Permalink to "**第二层：批量处理优化**"'},"​")],-1)),a[251]||(a[251]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 大数据量导入的分级处理策略")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," BulkImportService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 监控指标")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MeterRegistry meterRegistry;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 三级导入策略")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ImportResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"intelligentImport"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"allData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," totalSize "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," allData."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 根据数据量选择不同策略")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (totalSize "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 10_000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"counter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"import.strategy"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"L1"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"increment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," level1Import"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(allData);          "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 策略1：单事务批量插入")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (totalSize "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 100_000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"counter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"import.strategy"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"L2"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"increment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," level2Import"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(allData);          "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 策略2：分批事务处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"counter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"import.strategy"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"level"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"L3"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"increment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," level3Import"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(allData);          "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 策略3：并行分片处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 策略3：大规模数据并行导入（10万+）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ImportResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"level3Import"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"allData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," startTime "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," System."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentTimeMillis"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第1步：数据预处理（清洗、去重、分类）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Map<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> categorizedData "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," preprocessAndCategorize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(allData);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第2步：按类别并行处理（不同类别可完全并行）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"CategoryResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> futures "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," categorizedData."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"entrySet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(entry "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                processSingleCategory"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(entry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), entry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()), ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                importExecutor))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"collect"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collectors."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第3步：收集结果（带超时控制）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"allOf"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," CompletableFuture"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.MINUTES); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 5分钟超时")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ImportResult result "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," aggregateResults"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," duration "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," System."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentTimeMillis"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," startTime;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"大规模导入完成，数据量：{}，耗时：{}ms，TPS：{}/s"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                     allData."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), duration, allData."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1000L"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," duration);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 记录性能指标")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"timer"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"import.duration"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"strategy"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"L3"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"record"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(duration, TimeUnit.MILLISECONDS);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (TimeoutException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 超时处理：返回部分成功结果")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," handleTimeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures, allData."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 单类别处理（包含防OOM机制）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CategoryResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"processSingleCategory"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"category"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"data"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 限制单次处理内存使用")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        MemoryLimitHelper."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"enforceMemoryLimit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"500"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1024"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1024"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 500MB限制")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> batches "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Lists."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"partition"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        CategoryResult categoryResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CategoryResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> batch "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batches) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 使用JDBC批量插入，手动控制事务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                CategoryResult batchResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processBatchWithJdbc"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(category, batch);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                categoryResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"merge"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(batchResult);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 定期释放资源")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (batchResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getProcessedCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"%"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5000"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    System."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"gc"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 建议GC，防止内存碎片")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    clearTemporaryResources"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MemoryError "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 内存溢出保护：记录已处理数据，优雅退出")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"内存溢出，中止处理类别：{}，已处理：{}条"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                         category, categoryResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getProcessedCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," categoryResult;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," categoryResult;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[252]||(a[252]=e("h6",{id:"第三层-计算与查询分离",tabindex:"-1"},[e("strong",null,"第三层：计算与查询分离"),r(),e("a",{class:"header-anchor",href:"#第三层-计算与查询分离","aria-label":'Permalink to "**第三层：计算与查询分离**"'},"​")],-1)),a[253]||(a[253]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 报价计算的异步化与结果缓存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," QuotationCalculationService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RedisTemplate<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"CalculationResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> redisTemplate;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 带缓存的复杂报价计算")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"CalculationResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"calculateQuotationAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(QuotationRequest "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"request"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 生成缓存键（基于请求参数的哈希）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String cacheKey "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," buildCacheKey"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 第1步：尝试从缓存获取")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CalculationResult cached "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cacheKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (cached "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," !"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"cached."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isExpired"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"counter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"calculation.cache.hit"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"increment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cached;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 第2步：缓存未命中，执行计算")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CalculationResult result "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," performComplexCalculation"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 第3步：异步写入缓存（TTL: 1小时）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                redisTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"opsForValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(cacheKey, result, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.HOURS);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }, cacheWriteExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"counter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"calculation.cache.miss"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"increment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }, calculationExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 复杂计算分解为可并行子任务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CalculationResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"performComplexCalculation"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(QuotationRequest "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"request"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 将计算分解为4个可并行部分")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"MaterialCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> materialFuture "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," calculateMaterialCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request), calculationExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"LaborCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> laborFuture "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," calculateLaborCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request), calculationExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"TransportCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> transportFuture "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," calculateTransportCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request), calculationExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RiskCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> riskFuture "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," calculateRiskCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request), calculationExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 并行执行，等待所有结果")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"allOf"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(materialFuture, laborFuture, transportFuture, riskFuture)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"thenApply"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(v "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    MaterialCost material "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," materialFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    LaborCost labor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," laborFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    TransportCost transport "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," transportFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    RiskCost risk "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," riskFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 合并计算结果")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CalculationResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"builder"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"materialCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(material)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"laborCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(labor)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"transportCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(transport)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"riskCost"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(risk)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"total"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"calculateTotal"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(material, labor, transport, risk))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CalculationException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价计算失败"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            })")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"join"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[254]||(a[254]=e("h6",{id:"第四层-流量削峰与队列缓冲",tabindex:"-1"},[e("strong",null,"第四层：流量削峰与队列缓冲"),r(),e("a",{class:"header-anchor",href:"#第四层-流量削峰与队列缓冲","aria-label":'Permalink to "**第四层：流量削峰与队列缓冲**"'},"​")],-1)),a[255]||(a[255]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 报价提交的异步队列处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," QuotationSubmissionService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," RabbitTemplate rabbitTemplate;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 报价提交 - 同步快速响应，异步处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SubmissionResponse "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"submitQuotation"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(QuotationSubmission "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"submission"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第1步：基础验证（同步，快速失败）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        validateSubmission"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(submission);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第2步：生成唯一ID，快速响应")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String submissionId "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," generateSubmissionId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第3步：消息入队，异步处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        QuotationMessage message "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," convertToMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(submission, submissionId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 使用确认回调确保消息不丢失")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        rabbitTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setConfirmCallback"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"((correlationData, ack, cause) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (ack) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价消息已确认，ID: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", submissionId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价消息发送失败，ID: {}, 原因: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", submissionId, cause);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 记录到重试表")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                retryService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordFailedMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(message);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        });")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        rabbitTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"convertAndSend"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"quotation.exchange"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'                                     "quotation.submit"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                     message,")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                     new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CorrelationData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(submissionId));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 第4步：立即返回（响应时间<100ms）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," SubmissionResponse."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"builder"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"submissionId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(submissionId)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"status"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(SubmissionStatus.PROCESSING)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"message"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价已接收，正在处理"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"estimatedCompletionTime"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(LocalDateTime."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"now"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"plusMinutes"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 消息消费者（处理实际业务）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RabbitListener"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"queues"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "quotation.process.queue"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"                   concurrency"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "10-20"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 动态并发消费者")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processQuotationMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(QuotationMessage "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"message"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," startTime "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," System."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentTimeMillis"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 第1步：去重检查（幂等性）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (processedMessageCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getIfPresent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(message."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessageId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"warn"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"重复消息，跳过处理: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", message."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessageId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 第2步：业务处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            QuotationResult result "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," quotationProcessor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"process"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(message);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 第3步：更新状态")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            quotationStatusService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"updateStatus"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(message."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSubmissionId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                               SubmissionStatus.COMPLETED, ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                               result);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 第4步：记录已处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            processedMessageCache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(message."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessageId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            long"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," duration "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," System."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentTimeMillis"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," startTime;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价处理完成，ID: {}，耗时: {}ms"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                     message."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSubmissionId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), duration);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                     ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价处理失败，ID: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", message."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSubmissionId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 进入死信队列，人工处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AmqpRejectAndDontRequeueException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[256]||(a[256]=e("hr",null,null,-1)),a[257]||(a[257]=e("h3",{id:"监控与调优体系-两个系统通用",tabindex:"-1"},[r("监控与调优体系（两个系统通用） "),e("a",{class:"header-anchor",href:"#监控与调优体系-两个系统通用","aria-label":'Permalink to "监控与调优体系（两个系统通用）"'},"​")],-1)),a[258]||(a[258]=e("h4",{id:"_1-多维度监控",tabindex:"-1"},[r("1. 多维度监控 "),e("a",{class:"header-anchor",href:"#_1-多维度监控","aria-label":'Permalink to "1. 多维度监控"'},"​")],-1)),a[259]||(a[259]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 应用性能监控")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," PerformanceMonitor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MeterRegistry meterRegistry;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 关键指标监控")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"EventListener")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," monitorRequest"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(RequestHandledEvent "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 记录响应时间分布")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Timer.Sample sample "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Timer."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"start"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 业务处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            handleRequest"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(event);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            sample."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stop"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Timer."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"builder"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"http.request.duration"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tags"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"uri"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getUri"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'                      "method"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMethod"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'                      "status"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStatus"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"register"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(meterRegistry));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 记录QPS")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"counter"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"http.request.count"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'            "uri"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getUri"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'            "status"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", event."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStatus"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"increment"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // JVM监控")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Scheduled"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fixedDelay"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 60000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," monitorJVM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 内存使用")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        MemoryUsage heapUsage "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ManagementFactory."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMemoryMXBean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getHeapMemoryUsage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"gauge"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"jvm.memory.heap.used"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", heapUsage."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getUsed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"gauge"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"jvm.memory.heap.max"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", heapUsage."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMax"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // GC情况")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"GarbageCollectorMXBean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> gcBeans "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ManagementFactory."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getGarbageCollectorMXBeans"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        gcBeans."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"forEach"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(gc "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"gauge"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"jvm.gc.count"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", gc."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getCollectionCount"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            meterRegistry."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"gauge"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"jvm.gc.time"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", gc."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getCollectionTime"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        });")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[260]||(a[260]=e("h4",{id:"_2-容量规划与弹性伸缩",tabindex:"-1"},[r("2. 容量规划与弹性伸缩 "),e("a",{class:"header-anchor",href:"#_2-容量规划与弹性伸缩","aria-label":'Permalink to "2. 容量规划与弹性伸缩"'},"​")],-1)),a[261]||(a[261]=e("div",{class:"language-yaml max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"yaml"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Kubernetes弹性伸缩配置")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"apiVersion"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"autoscaling/v2")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"kind"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"HorizontalPodAutoscaler")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"metadata"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  name"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"procurement-service-hpa")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"spec"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  scaleTargetRef"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    apiVersion"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"apps/v1")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    kind"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"Deployment")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    name"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"procurement-service")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  minReplicas"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  maxReplicas"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  metrics"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"Resource")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    resource"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      name"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"cpu")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      target"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"Utilization")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        averageUtilization"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"70")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  - "),e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"Pods")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    pods"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      metric"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        name"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"http_requests_per_second")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      target"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"AverageValue")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        averageValue"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  # 当单Pod QPS > 1000时扩容")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  behavior"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    scaleDown"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      stabilizationWindowSeconds"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"300"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  # 缩容稳定窗口5分钟")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      policies"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"Percent")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        value"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        periodSeconds"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"60")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    scaleUp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      stabilizationWindowSeconds"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"60"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"   # 扩容稳定窗口1分钟")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      policies"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"type"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"Percent")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        value"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        periodSeconds"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[262]||(a[262]=e("hr",null,null,-1)),a[263]||(a[263]=e("h3",{id:"成果对比与总结",tabindex:"-1"},[r("成果对比与总结 "),e("a",{class:"header-anchor",href:"#成果对比与总结","aria-label":'Permalink to "成果对比与总结"'},"​")],-1)),a[264]||(a[264]=e("h4",{id:"_1-性能优化成果",tabindex:"-1"},[r("1. 性能优化成果 "),e("a",{class:"header-anchor",href:"#_1-性能优化成果","aria-label":'Permalink to "1. 性能优化成果"'},"​")],-1)),a[265]||(a[265]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"指标"),e("th",{style:{"text-align":"left"}},"采购系统（优化后）"),e("th",{style:{"text-align":"left"}},"询报价系统（优化后）"),e("th",{style:{"text-align":"left"}},"优化前")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},"平均响应时间"),e("td",{style:{"text-align":"left"}},"<250ms"),e("td",{style:{"text-align":"left"}},"<200ms"),e("td",{style:{"text-align":"left"}},"800-1500ms")]),e("tr",null,[e("td",{style:{"text-align":"left"}},"P99响应时间"),e("td",{style:{"text-align":"left"}},"<500ms"),e("td",{style:{"text-align":"left"}},"<400ms"),e("td",{style:{"text-align":"left"}},"3000-5000ms")]),e("tr",null,[e("td",{style:{"text-align":"left"}},"系统吞吐量"),e("td",{style:{"text-align":"left"}},"2000 TPS"),e("td",{style:{"text-align":"left"}},"5000 TPS"),e("td",{style:{"text-align":"left"}},"200-500 TPS")]),e("tr",null,[e("td",{style:{"text-align":"left"}},"数据库负载"),e("td",{style:{"text-align":"left"}},"降低70%"),e("td",{style:{"text-align":"left"}},"降低80%"),e("td",{style:{"text-align":"left"}},"持续高负载")]),e("tr",null,[e("td",{style:{"text-align":"left"}},"缓存命中率"),e("td",{style:{"text-align":"left"}},"98.5%"),e("td",{style:{"text-align":"left"}},"96%"),e("td",{style:{"text-align":"left"}},"60-70%")]),e("tr",null,[e("td",{style:{"text-align":"left"}},"批量处理时间"),e("td",{style:{"text-align":"left"}},"分钟级"),e("td",{style:{"text-align":"left"}},"10秒级"),e("td",{style:{"text-align":"left"}},"小时级")])])],-1)),a[266]||(a[266]=e("h4",{id:"_2-架构设计思想总结",tabindex:"-1"},[r("2. 架构设计思想总结 "),e("a",{class:"header-anchor",href:"#_2-架构设计思想总结","aria-label":'Permalink to "2. 架构设计思想总结"'},"​")],-1)),a[267]||(a[267]=e("blockquote",null,[e("p",null,'"在两个系统的性能优化实践中，我总结了以下几点核心思想：'),e("p",null,[e("strong",null,"1. 分层缓存的智慧"),r(" 从本地缓存到分布式缓存的多级架构，不仅是性能优化，更是系统弹性的保障。我们为每级缓存设计了不同的过期策略和降级方案，确保即使缓存层部分失效，系统仍能提供服务。")]),e("p",null,[e("strong",null,"2. 数据分片的艺术"),r(" 不是简单的哈希取模，而是"),e("strong",null,"按业务特征分片"),r("。采购系统按供应商重要性分片，询报价系统按时间+项目分片，让热点数据自然分散，避免单点瓶颈。")]),e("p",null,[e("strong",null,"3. 异步化的边界把握"),r(" 不是所有操作都适合异步。我们坚持："),e("strong",null,"用户交互路径同步化，后台处理异步化"),r("。报价提交立即返回收据，后台队列处理，这种模式平衡了用户体验和系统吞吐量。")]),e("p",null,[e("strong",null,"4. 容量设计的预见性"),r(" 通过监控数据预测容量需求，在业务高峰前"),e("strong",null,"主动扩容和预热"),r("。询报价系统在新车项目启动前预扩容30%资源，避免了被动应对。")]),e("p",null,[e("strong",null,"5. 降级不是失败，而是策略"),r(" 我们设计了"),e("strong",null,"阶梯式降级方案"),r("：缓存降级 → 简化计算 → 静态数据返回 → 友好提示。这比简单的’系统繁忙’更能保持用户信任。")]),e("p",null,[r("这些经验让我深刻理解，高并发优化不是单纯的技术堆砌，而是"),e("strong",null,"在业务约束、技术成本、用户体验之间找到最佳平衡点"),r('的系统工程。"')])],-1)),a[268]||(a[268]=e("hr",null,null,-1)),a[269]||(a[269]=e("h3",{id:"总结",tabindex:"-1"},[r("总结 "),e("a",{class:"header-anchor",href:"#总结","aria-label":'Permalink to "总结"'},"​")],-1)),a[270]||(a[270]=e("h4",{id:"升华-如何总结你的业务能力",tabindex:"-1"},[r("升华：如何总结你的业务能力 "),e("a",{class:"header-anchor",href:"#升华-如何总结你的业务能力","aria-label":'Permalink to "升华：如何总结你的业务能力"'},"​")],-1)),a[271]||(a[271]=e("p",null,"在分别介绍完两个项目后，你需要一个总结来升华，将你的技术贡献与业务能力明确挂钩。",-1)),a[272]||(a[272]=e("blockquote",null,[e("p",null,"“通过这两个项目，我认为我的业务能力主要体现在三个方面："),e("ol",null,[e("li",null,[e("strong",null,"业务抽象与建模能力"),r("：我能够深入理解像‘供应商评估’、‘询报价’这样的复杂业务流程，并将其抽象为"),e("strong",null,"可配置、可扩展的系统模型"),r("（如打分模板、规则引擎），而不仅仅是实现单一功能。")]),e("li",null,[e("strong",null,"通过技术驱动业务效率"),r("：我始终关注我的代码如何为业务创造价值。无论是将导入时间从5分钟优化到10秒，还是通过自动化处理解放人力，我的目标都是"),e("strong",null,"通过技术手段解决业务的真实痛点，提升关键指标"),r("。")]),e("li",null,[e("strong",null,"端到端的业务流程理解"),r("：我从不是只守着自己的一亩三分地。我会去了解我的模块在上游是谁在用，产生的数据下游流向哪里。比如，我知道我优化的询价数据，最终会流向PDT系统和物流系统，这让我在设计接口和数据结构时，能"),e("strong",null,"站在全局视角考虑，避免形成新的数据孤岛"),r("。")])]),e("p",null,[r("简单来说，我不仅是一个实现需求的开发者，更是一个"),e("strong",null,"愿意并且能够用技术为业务赋能"),r("的合作者。”")])],-1)),a[273]||(a[273]=e("h4",{id:"技术成长与价值总结-1分钟",tabindex:"-1"},[r("技术成长与价值总结（1分钟） "),e("a",{class:"header-anchor",href:"#技术成长与价值总结-1分钟","aria-label":'Permalink to "技术成长与价值总结（1分钟）"'},"​")],-1)),a[274]||(a[274]=e("p",null,'"通过这两个项目，我完成了从功能开发者到系统思考者的转变：',-1)),a[275]||(a[275]=e("p",null,[e("strong",null,"在技术深度上"),r("，我从CRUD深入到JVM调优、分布式事务、系统架构层面，建立了完整的性能优化方法论。")],-1)),a[276]||(a[276]=e("p",null,[e("strong",null,"在业务理解上"),r("，我学会了将复杂业务抽象为可配置的系统模型，通过技术手段驱动业务效率提升。")],-1)),a[277]||(a[277]=e("p",null,[e("strong",null,"在架构思维上"),r("，我深刻体会到架构设计本质上是各种约束下的权衡艺术，需要在性能、一致性、可维护性间找到最佳平衡点。")],-1)),a[278]||(a[278]=e("p",null,[r("我带来的不仅是代码实现能力，更是"),e("strong",null,"用技术解决业务难题、创造实际价值"),r('的系统化思维。"')],-1)),a[279]||(a[279]=e("hr",null,null,-1)),a[280]||(a[280]=e("h4",{id:"结尾表达意愿-30秒",tabindex:"-1"},[r("结尾表达意愿（30秒） "),e("a",{class:"header-anchor",href:"#结尾表达意愿-30秒","aria-label":'Permalink to "结尾表达意愿（30秒）"'},"​")],-1)),a[281]||(a[281]=e("p",null,'"我非常欣赏贵公司在[提及公司的某个技术或业务特点]方面的实践，这与我过去的技术积累和职业规划高度契合。我期待能将在分布式系统和高并发场景下的经验带到贵团队，共同应对更有挑战的业务场景。',-1)),a[282]||(a[282]=e("p",null,'我的介绍就到这里，谢谢您的时间。"',-1)),a[283]||(a[283]=e("hr",null,null,-1)),a[284]||(a[284]=e("h2",{id:"面试场景题",tabindex:"-1"},[r("面试场景题 "),e("a",{class:"header-anchor",href:"#面试场景题","aria-label":'Permalink to "面试场景题"'},"​")],-1)),a[285]||(a[285]=e("h3",{id:"典型场景题分类和示例",tabindex:"-1"},[r("典型场景题分类和示例 "),e("a",{class:"header-anchor",href:"#典型场景题分类和示例","aria-label":'Permalink to "典型场景题分类和示例"'},"​")],-1)),a[286]||(a[286]=e("h4",{id:"一、-系统设计与架构场景题-重中之重",tabindex:"-1"},[r("一、 系统设计与架构场景题 (重中之重) "),e("a",{class:"header-anchor",href:"#一、-系统设计与架构场景题-重中之重","aria-label":'Permalink to "一、 系统设计与架构场景题 (重中之重)"'},"​")],-1)),a[287]||(a[287]=e("p",null,"这类问题旨在考察你如何从零开始或改造一个系统，评估你的技术选型、权衡和宏观思考能力。",-1)),a[288]||(a[288]=e("ol",null,[e("li",null,[e("strong",null,"经典系统设计"),e("ul",null,[e("li",null,[e("strong",null,"设计一个秒杀系统"),r("：这是最经典的场景。面试官会期待你谈到： "),e("ul",null,[e("li",null,[e("strong",null,"流量削峰"),r("：如何用消息队列（如RabbitMQ, Kafka）缓冲瞬时巨额流量。")]),e("li",null,[e("strong",null,"缓存预热"),r("：如何提前将商品库存等信息加载到Redis等缓存中。")]),e("li",null,[e("strong",null,"库存扣减"),r("：如何在分布式环境下保证“超卖”问题（Redis Lua脚本、数据库乐观锁）。")]),e("li",null,[e("strong",null,"限流与熔断"),r("：如何在前端（页面静态化）、网关、服务层进行限流（如Sentinel, Hystrix）。")]),e("li",null,[e("strong",null,"无状态服务"),r("：如何保证服务可以水平扩展。")])])]),e("li",null,[e("strong",null,"设计一个短链接系统"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"短码生成算法"),r("（自增ID、哈希、随机数）及其优缺点。")]),e("li",null,[e("strong",null,"存储设计"),r("（用什么数据库？如何分库分表？）。")]),e("li",null,[e("strong",null,"高并发读"),r("（缓存策略）。")]),e("li",null,[e("strong",null,"过期和清理策略"),r("。")])])]),e("li",null,[e("strong",null,"设计一个微博/微信朋友圈Feed流系统"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"推模式 vs 拉模式"),r(" 的权衡，以及"),e("strong",null,"混合模式"),r("的应用。")]),e("li",null,"如何存储海量数据（分库分表策略）。"),e("li",null,"如何保证好友发布新状态后，我能及时看到（推模式下的异步任务、扇出）。")])]),e("li",null,[e("strong",null,"设计一个分布式ID生成器"),r("： "),e("ul",null,[e("li",null,"UUID、数据库自增、Snowflake算法、Leaf-segment、Leaf-snowflake等方案的原理和选型考量。")])])])]),e("li",null,[e("strong",null,"现有系统优化与重构"),e("ul",null,[e("li",null,[r("“我们有一个系统，随着业务发展，数据库CPU经常100%，你有什么排查思路和优化方案？” "),e("ul",null,[e("li",null,"考察点：SQL优化、索引优化、读写分离、引入缓存、分库分表、归档历史数据。")])]),e("li",null,[r("“一个RPC接口调用超时，如何从后端的角度进行排查？” "),e("ul",null,[e("li",null,"考察点：全链路监控、日志分析、数据库慢查询、网络问题、GC问题、下游服务瓶颈。")])]),e("li",null,[r("“如何将一个庞大的单体应用拆分为微服务？你会考虑哪些因素？” "),e("ul",null,[e("li",null,"考察点：领域驱动设计（DDD）、服务边界划分（高内聚、低耦合）、数据一致性（Saga、TCC）、分布式事务、API网关。")])])])])],-1)),a[289]||(a[289]=e("hr",null,null,-1)),a[290]||(a[290]=e("h4",{id:"二、-高并发与性能优化场景题",tabindex:"-1"},[r("二、 高并发与性能优化场景题 "),e("a",{class:"header-anchor",href:"#二、-高并发与性能优化场景题","aria-label":'Permalink to "二、 高并发与性能优化场景题"'},"​")],-1)),a[291]||(a[291]=e("p",null,"这类问题考察你在压力下保证系统稳定性和高性能的能力。",-1)),a[292]||(a[292]=e("ol",null,[e("li",null,[e("strong",null,"缓存相关"),e("ul",null,[e("li",null,[r("“如何保证缓存与数据库的双写一致性？”（经典难题） "),e("ul",null,[e("li",null,"考察点：Cache-Aside模式、延时双删、串行化、最终一致性理解。")])]),e("li",null,[r("“缓存穿透、缓存击穿、缓存雪崩分别是什么？你的解决方案是什么？” "),e("ul",null,[e("li",null,"穿透：布隆过滤器、缓存空对象。"),e("li",null,"击穿：互斥锁、永不过期。"),e("li",null,"雪崩：随机过期时间、集群高可用、多级缓存。")])]),e("li",null,"“为什么选择Redis而不是Memcached？Redis的持久化机制（RDB/AOF）如何选择？”")])]),e("li",null,[e("strong",null,"数据库与锁"),e("ul",null,[e("li",null,[r("“在秒杀场景中，有100个商品库存，10万人来抢，如何保证不超卖？” "),e("ul",null,[e("li",null,[r("考察点：乐观锁（"),e("code",null,"version"),r("字段）、悲观锁（"),e("code",null,"select ... for update"),r("）、Redis递减（Lua脚本保证原子性）。")])])]),e("li",null,[r("“什么是死锁？如何在Java中定位和避免死锁？” "),e("ul",null,[e("li",null,[r("考察点："),e("code",null,"jstack"),r("命令分析线程堆栈、避免顺序不一致、使用尝试锁。")])])]),e("li",null,[r("“你们项目里分库分表是怎么做的？如何选择分片键？遇到跨分片查询/排序怎么办？” "),e("ul",null,[e("li",null,"考察点：对ShardingSphere、MyCAT等中间件的理解，或自己设计的思路。")])])])])],-1)),a[293]||(a[293]=e("hr",null,null,-1)),a[294]||(a[294]=e("h4",{id:"三、-分布式与微服务场景题",tabindex:"-1"},[r("三、 分布式与微服务场景题 "),e("a",{class:"header-anchor",href:"#三、-分布式与微服务场景题","aria-label":'Permalink to "三、 分布式与微服务场景题"'},"​")],-1)),a[295]||(a[295]=e("p",null,"考察你对分布式系统复杂性的理解和处理能力。",-1)),a[296]||(a[296]=e("ol",null,[e("li",null,[e("strong",null,"事务与一致性"),e("ul",null,[e("li",null,[r("“在微服务架构下，如何实现分布式事务？” "),e("ul",null,[e("li",null,"考察点：本地消息表、最大努力通知、TCC、Saga模式、Seata框架。")])]),e("li",null,"“CAP理论是什么？你的系统如何取舍？BASE理论呢？”")])]),e("li",null,[e("strong",null,"服务治理与稳定性"),e("ul",null,[e("li",null,"“服务注册与发现的原理是什么？（Eureka, Nacos）”"),e("li",null,"“如何实现服务的熔断和降级？原理是什么？（Hystrix, Sentinel）”"),e("li",null,[r("“如果服务A调用服务B，B又调用C，C挂了导致整个链路卡住，怎么处理？” "),e("ul",null,[e("li",null,"考察点：超时设置、熔断器、线程池隔离。")])])])])],-1)),a[297]||(a[297]=e("hr",null,null,-1)),a[298]||(a[298]=e("h4",{id:"四、-项目经验与线上问题排查场景题-行为面试",tabindex:"-1"},[r("四、 项目经验与线上问题排查场景题 (行为面试) "),e("a",{class:"header-anchor",href:"#四、-项目经验与线上问题排查场景题-行为面试","aria-label":'Permalink to "四、 项目经验与线上问题排查场景题 (行为面试)"'},"​")],-1)),a[299]||(a[299]=e("p",null,"这类问题通过你过去的实际经历来评估你的能力。",-1)),a[300]||(a[300]=e("ol",null,[e("li",null,[e("strong",null,"项目深度"),e("ul",null,[e("li",null,[r("“介绍一个你做过的最有挑战的项目/模块。” "),e("ul",null,[e("li",null,[e("strong",null,"STAR法则"),r("：情境、任务、行动、结果。重点讲清楚你"),e("strong",null,"个人"),r("的贡献和技术决策。")])])]),e("li",null,"“在这个项目中，你遇到的最大技术难点是什么？你是怎么解决的？”"),e("li",null,"“如果让你重做这个项目，你会在架构上做什么改进？”")])]),e("li",null,[e("strong",null,"线上故障处理"),e("ul",null,[e("li",null,[r("“讲一次你处理过的线上故障，从发现到解决的全过程。” "),e("ul",null,[e("li",null,"考察点：监控告警、日志排查、定位问题、紧急回滚/修复、复盘总结。")])]),e("li",null,[r("“如何排查Java应用的CPU占用率过高或内存泄漏问题？” "),e("ul",null,[e("li",null,[r("考察点："),e("code",null,"top"),r(" -> "),e("code",null,"jstack"),r(" 查线程、"),e("code",null,"jmap"),r("/"),e("code",null,"jstat"),r(" 分析GC、MAT分析堆转储。")])])])])])],-1)),a[301]||(a[301]=e("hr",null,null,-1)),a[302]||(a[302]=e("h4",{id:"五、-技术深度与原理性场景题",tabindex:"-1"},[r("五、 技术深度与原理性场景题 "),e("a",{class:"header-anchor",href:"#五、-技术深度与原理性场景题","aria-label":'Permalink to "五、 技术深度与原理性场景题"'},"​")],-1)),a[303]||(a[303]=e("p",null,"5年经验要求你对常用技术的理解不能停留在“会用”，而要深入原理。",-1)),a[304]||(a[304]=e("ol",null,[e("li",null,[e("strong",null,"JVM"),e("ul",null,[e("li",null,"“线上Full GC频繁，如何排查和优化？”"),e("li",null,"“JVM调优你做过吗？常用的参数有哪些？（如堆大小、垃圾收集器选择）”")])]),e("li",null,[e("strong",null,"框架 (Spring)"),e("ul",null,[e("li",null,"“Spring Bean的生命周期是怎样的？”"),e("li",null,"“Spring事务的实现原理是什么？什么情况下会失效？”")])]),e("li",null,[e("strong",null,"消息队列"),e("ul",null,[e("li",null,"“如何保证消息不被重复消费？（幂等性）”"),e("li",null,"“如何保证消息的可靠传输？（生产者确认、消息持久化、消费者确认）”"),e("li",null,"“Kafka为什么吞吐量高？（页缓存、顺序IO、零拷贝）”")])])],-1)),a[305]||(a[305]=e("hr",null,null,-1)),a[306]||(a[306]=e("h3",{id:"场景一-设计一个秒杀系统",tabindex:"-1"},[r("场景一：设计一个秒杀系统 "),e("a",{class:"header-anchor",href:"#场景一-设计一个秒杀系统","aria-label":'Permalink to "场景一：设计一个秒杀系统"'},"​")],-1)),a[307]||(a[307]=e("p",null,"这是面试的“标配”题，完美考察高并发、高性能、高可用的架构能力。",-1)),a[308]||(a[308]=e("p",null,[e("strong",null,"回答思路："),r(" 分层削峰、冗余缓存、极限优化、预案兜底。")],-1)),a[309]||(a[309]=e("p",null,[e("strong",null,"详细答法：")],-1)),a[310]||(a[310]=e("p",null,[r("“面试官好，设计一个秒杀系统，我会从"),e("strong",null,"架构分层"),r("的角度，从前到后，逐层进行设计和优化。”")],-1)),a[311]||(a[311]=e("ol",null,[e("li",null,[e("strong",null,"前端/接入层优化"),e("ul",null,[e("li",null,[e("strong",null,"目的"),r("：拦截80%以上的无效流量，尽量让请求不打到后端服务。")]),e("li",null,[e("strong",null,"措施"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"静态化"),r("：将商品详情页、活动页等提前生成静态HTML/CDN缓存，直接返回，不经过后端服务。")]),e("li",null,[e("strong",null,"按钮置灰与计数"),r("：前端在活动开始前将按钮置灰，通过JS进行倒计时，防止用户提前重复提交。同时，用户点击后立即置灰，防止连点。")]),e("li",null,[e("strong",null,"验证码"),r("：在提交秒杀请求时，弹出图形/滑动验证码，可以有效防止机器人刷单，并起到“削峰”作用。")])])])])]),e("li",null,[e("strong",null,"网关层优化"),e("ul",null,[e("li",null,[e("strong",null,"目的"),r("：全局流控，恶意请求拦截。")]),e("li",null,[e("strong",null,"措施"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"限流"),r("：使用网关（如Spring Cloud Gateway, Nginx）配置严格的限流规则，例如对同一个UID/IP在短时间内进行次数限制。可以使用"),e("strong",null,"令牌桶"),r("或"),e("strong",null,"漏桶算法"),r("。")]),e("li",null,[e("strong",null,"防刷"),r("：识别并拦截恶意IP、设备指纹等。")])])])])]),e("li",null,[e("strong",null,"服务层优化（核心业务逻辑）"),e("ul",null,[e("li",null,[e("strong",null,"目的"),r("：将同步业务异步化，保证核心流程的可靠与高性能。")]),e("li",null,[e("strong",null,"架构"),r("：采用"),e("strong",null,"微服务"),r("拆分，秒杀活动管理、商品查询、订单服务等各自独立，便于扩容和隔离。")]),e("li",null,[e("strong",null,"措施"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"缓存预热"),r("：在秒杀开始前，将参与秒杀的商品库存（例如100个）提前加载到"),e("strong",null,"Redis"),r("中。")]),e("li",null,[e("strong",null,"请求入队"),r("：用户秒杀请求到达后，不做复杂的库存扣减和订单创建，而是进行基础的校验（如用户资格、活动是否进行中）后，生成一个唯一的请求ID，立即放入"),e("strong",null,"消息队列（如Kafka/RocketMQ）"),r(" 中，并立即给前端返回“排队中”的状态。"),e("strong",null,"这一步是核心，将同步的秒杀请求变成了异步处理。")]),e("li",null,[e("strong",null,"令牌（Ticket）机制"),r("：放入队列的其实是一个“资格”，后端服务异步地从队列中消费，判断库存，如果成功，则为这个请求生成一个购买令牌（Token），用户凭此令牌在有效期内完成支付即可。")])])])])]),e("li",null,[e("strong",null,"数据层优化"),e("ul",null,[e("li",null,[e("strong",null,"目的"),r("：解决数据库的“写”瓶颈，防止超卖。")]),e("li",null,[e("strong",null,"库存扣减"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"方案一（首选）"),r("：在"),e("strong",null,"Redis"),r("中预扣库存。使用"),e("code",null,"decr"),r("命令或"),e("strong",null,"Lua脚本"),r("来保证原子性。因为Redis是单线程内存操作，性能极高。扣减成功后，再将订单信息异步落库。")]),e("li",null,[e("strong",null,"方案二（备用）"),r("：如果必须用数据库，使用"),e("strong",null,"乐观锁"),r("（"),e("code",null,"update stock set count = count - 1 where product_id = xx and count > 0"),r("），通过"),e("code",null,"count > 0"),r("和行级锁来防止超卖。")])])]),e("li",null,[e("strong",null,"订单创建"),r("：订单服务消费MQ消息，创建订单。这里数据库依然是瓶颈，可以考虑使用"),e("strong",null,"分库分表"),r("策略。")])])]),e("li",null,[e("strong",null,"容灾与降级"),e("ul",null,[e("li",null,[e("strong",null,"目的"),r("：凡事做最坏的打算。")]),e("li",null,[e("strong",null,"措施"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"服务熔断与降级"),r("：如果订单服务或数据库压力过大，通过Sentinel/Hystrix进行熔断，暂时屏蔽秒杀功能，保护系统不被打垮。")]),e("li",null,[e("strong",null,"预案"),r("：准备好开关配置，在系统出现问题时能一键关闭秒杀入口。")]),e("li",null,[e("strong",null,"监控与告警"),r("：全链路监控（APM）、大盘、关键指标（QPS、库存消耗速度、DB负载）的告警必不可少。")])])])])])],-1)),a[312]||(a[312]=e("p",null,[e("strong",null,"总结陈述："),r(" “总之，一个秒杀系统的核心思想是‘分层过滤，逐级削峰’。前端拦截大部分无效请求，网关进行全局控流，服务层通过‘请求入队’将瞬时高峰 flatten 成平稳的异步流，最后在数据层通过Redis等高性能中间件解决核心的库存并发问题，并辅以完善的监控和降级预案来保证系统的最终稳定。”")],-1)),a[313]||(a[313]=e("hr",null,null,-1)),a[314]||(a[314]=e("h3",{id:"场景二-如何保证缓存与数据库的双写一致性",tabindex:"-1"},[r("场景二：如何保证缓存与数据库的双写一致性？ "),e("a",{class:"header-anchor",href:"#场景二-如何保证缓存与数据库的双写一致性","aria-label":'Permalink to "场景二：如何保证缓存与数据库的双写一致性？"'},"​")],-1)),a[315]||(a[315]=e("p",null,"这是一个技术深度题，考察你对分布式数据一致性的理解。",-1)),a[316]||(a[316]=e("p",null,[e("strong",null,"回答思路："),r(" 没有银弹，根据不同业务场景（对一致性要求的强弱）选择最合适的方案。")],-1)),a[317]||(a[317]=e("p",null,[e("strong",null,"详细答法：")],-1)),a[318]||(a[318]=e("p",null,"“面试官好，缓存双写一致性问题没有一个完美的通用方案，需要根据业务场景进行权衡。主要有以下几种思路：”",-1)),a[319]||(a[319]=e("ol",null,[e("li",null,[e("strong",null,"Cache-Aside Pattern（旁路缓存模式） - 最常用"),e("ul",null,[e("li",null,[e("strong",null,"读"),r("：先读缓存，命中则返回；未命中则读数据库，然后写入缓存。")]),e("li",null,[e("strong",null,"写"),r("："),e("strong",null,"先更新数据库，再删除缓存。")]),e("li",null,[e("strong",null,"为什么是删除缓存，而不是更新缓存？"),e("ul",null,[e("li",null,"如果更新缓存，在并发写时，可能出现更新顺序问题，导致缓存中是旧数据。"),e("li",null,[r("删除缓存是一种"),e("strong",null,"懒惰加载"),r("的方式，下次读请求自然会从数据库加载最新数据。")])])]),e("li",null,[e("strong",null,"存在的问题"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"场景一"),r("：读请求A未命中缓存，读数据库（旧数据）。此时写请求B更新了数据库并删除了缓存。然后A把读到的旧数据写入了缓存。导致缓存一直是旧数据。 "),e("ul",null,[e("li",null,[e("strong",null,"概率"),r("：这个场景需要满足（1）读缓存miss （2）一个写请求在读请求读库和写缓存之间完成。因为写操作通常比读操作慢，所以概率较低。")])])]),e("li",null,[e("strong",null,"场景二"),r("：先删缓存，再更新数据库。在并发下，很容易导致另一个读请求在删缓存后、更新数据库前，把旧数据读出来并塞回缓存。"),e("strong",null,"这个概率很高，不推荐。")])])])])]),e("li",null,[e("strong",null,"采用延时双删策略 - 优化方案"),e("ul",null,[e("li",null,[e("strong",null,"步骤"),r("： "),e("ol",null,[e("li",null,"先删除缓存。"),e("li",null,"再更新数据库。"),e("li",null,[r("（"),e("strong",null,"关键"),r("）休眠一个短暂的时间（如几百毫秒，根据业务决定）。")]),e("li",null,"再次删除缓存。")])]),e("li",null,[e("strong",null,"目的"),r("：第二次删除是为了清理在“更新数据库”这个时间窗口内，可能被其他读请求写入的旧数据。")]),e("li",null,[e("strong",null,"缺点"),r("：引入了延时，降低了吞吐量。")])])]),e("li",null,[e("strong",null,"强一致性方案 - 复杂度高，特定场景使用"),e("ul",null,[e("li",null,[e("strong",null,"思路"),r("：通过"),e("strong",null,"订阅数据库的Binlog"),r("（使用Canal/Debezium等中间件）来异步更新/删除缓存。")]),e("li",null,[e("strong",null,"流程"),r("：业务代码只更新数据库。一个独立的中间件订阅Binlog，当解析到数据变更时，再去操作Redis。")]),e("li",null,[e("strong",null,"优点"),r("：业务代码简洁，将缓存与数据库的同步解耦。")]),e("li",null,[e("strong",null,"缺点"),r("：有短暂延迟，架构更复杂。为了保证顺序，可能需要单线程消费。")])])])],-1)),a[320]||(a[320]=e("p",null,[e("strong",null,"总结陈述："),r(" “所以，在实际项目中，我们最常用的是 "),e("strong",null,"‘先更新数据库，再删除缓存’"),r(" 的Cache-Aside模式，因为它简单有效，不一致的概率较低。如果对一致性要求极高，我们会结合‘延时双删’来进一步降低风险。而在一些允许秒级延迟、但追求架构解耦的场景，我们会考虑通过"),e("strong",null,"订阅Binlog"),r("的方案。没有最好的方案，只有最适合业务场景的方案。”")],-1)),a[321]||(a[321]=e("hr",null,null,-1)),a[322]||(a[322]=e("h3",{id:"场景三-讲一次你处理过的线上故障",tabindex:"-1"},[r("场景三：讲一次你处理过的线上故障 "),e("a",{class:"header-anchor",href:"#场景三-讲一次你处理过的线上故障","aria-label":'Permalink to "场景三：讲一次你处理过的线上故障"'},"​")],-1)),a[323]||(a[323]=e("p",null,"这是行为面试题，考察你的实际经验、排查问题的逻辑性和复盘能力。",-1)),a[324]||(a[324]=e("p",null,[e("strong",null,"回答思路："),r(" 使用"),e("strong",null,"STAR法则"),r("，并突出你的"),e("strong",null,"排查方法论"),r("。")],-1)),a[325]||(a[325]=e("p",null,[e("strong",null,"详细答法：")],-1)),a[326]||(a[326]=e("p",null,"“面试官好，我分享一次我们系统遇到的CPU 100%的线上故障。”",-1)),a[327]||(a[327]=e("ul",null,[e("li",null,[e("strong",null,"S（情境）"),r("： “当时是在一个工作日午后，监控平台突然告警，显示我们核心交易服务的几台服务器CPU使用率飙升到100%，导致大量API响应超时，影响了部分用户下单。”")]),e("li",null,[e("strong",null,"T（任务）"),r("： “我的任务是立即定位问题根因，并尽快恢复服务，将影响降到最低。”")]),e("li",null,[e("strong",null,"A（行动）"),r("： "),e("strong",null,"（这是重点，要体现你的排查链条）"),e("ol",null,[e("li",null,[e("strong",null,"确认现象与止损"),r("：我首先登录服务器，用"),e("code",null,"top"),r("命令确认了是某个Java进程占用了几乎全部CPU。同时，我立刻联系运维同学，"),e("strong",null,"先对其中一台机器做流量切出（摘流）"),r("，保留现场用于排查，让其他机器继续提供服务，避免全盘崩溃。")]),e("li",null,[e("strong",null,"定位问题线程"),r("：对摘流的机器，我用 "),e("code",null,"top -Hp [pid]"),r(" 看到有一个线程的CPU占用异常高。")]),e("li",null,[e("strong",null,"分析线程栈"),r("：我将这个高CPU线程的ID转换为16进制，然后用 "),e("code",null,"jstack [pid] | grep -A 20 [nid]"),r(" 命令打印出这个线程的堆栈信息。发现这个线程正处于 "),e("strong",null,"‘RUNNABLE’"),r(" 状态，并且堆栈信息显示它正在频繁地执行一个"),e("strong",null,"日志打印操作"),r("。")]),e("li",null,[e("strong",null,"深入代码"),r("：我立刻去检查了这段日志相关的代码，发现是一个循环体里，在"),e("code",null,"DEBUG"),r("级别下，使用了"),e("code",null,'logger.debug("Processing data: " + largeObject.toString())'),r(" 这种方式来拼接字符串。而"),e("code",null,"largeObject"),r("是一个非常大的JSON对象。")]),e("li",null,[e("strong",null,"根因分析"),r("： "),e("ul",null,[e("li",null,[r("即使在"),e("code",null,"INFO"),r("级别，由于字符串拼接发生在传入"),e("code",null,"debug"),r("方法之前，所以"),e("strong",null,"无论级别如何，这个耗时的字符串拼接操作都会执行"),r("。")]),e("li",null,[r("当时正好有同事为了排查另一个问题，在线上临时将日志级别改为了"),e("code",null,"DEBUG"),r("，触发了这个“性能炸弹”。")]),e("li",null,"大量的字符串创建和拼接，导致了疯狂的GC和CPU占用。")])])])]),e("li",null,[e("strong",null,"R（结果）"),r("： “找到原因后，我们立刻将日志级别改回"),e("code",null,"INFO"),r("，服务器CPU在十几秒内恢复正常。随后，我们"),e("strong",null,"修复了代码"),r("，将其改为使用"),e("code",null,'logger.debug("Processing data: {}", largeObject)'),r(" 这种占位符的方式，确保在日志级别不匹配时不会有无谓的消耗。最后，我们在团队内进行了"),e("strong",null,"复盘"),r("，并制定了代码规范，禁止在日志中直接进行字符串拼接，同时加强了上线前对日志代码的审查。”")])],-1)),a[328]||(a[328]=e("p",null,[e("strong",null,"这个回答展现了："),r(" 应急能力（先止损）、排查方法（从现象到线程到代码）、技术深度（理解JVM、日志框架原理）、闭环能力（修复和预防）。")],-1)),a[329]||(a[329]=e("hr",null,null,-1)),a[330]||(a[330]=e("h3",{id:"场景四-在微服务架构下-如何实现分布式事务",tabindex:"-1"},[r("场景四：在微服务架构下，如何实现分布式事务？ "),e("a",{class:"header-anchor",href:"#场景四-在微服务架构下-如何实现分布式事务","aria-label":'Permalink to "场景四：在微服务架构下，如何实现分布式事务？"'},"​")],-1)),a[331]||(a[331]=e("p",null,"考察你对分布式系统理论和技术落地的掌握。",-1)),a[332]||(a[332]=e("p",null,[e("strong",null,"回答思路："),r(" 从理论（CAP/BASE）到实践（具体方案），并说明选型考量。")],-1)),a[333]||(a[333]=e("p",null,[e("strong",null,"详细答法：")],-1)),a[334]||(a[334]=e("p",null,[r("“面试官好，在微服务架构下，我们放弃了传统的强一致性分布式事务（如XA/2PC），因为它性能差、同步阻塞，不符合微服务高可用的要求。我们转向追求"),e("strong",null,"最终一致性"),r("，基于BASE理论。常见的方案有几种：”")],-1)),a[335]||(a[335]=e("ol",null,[e("li",null,[e("strong",null,"可靠消息最终一致性（异步确保型）"),e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：适用于跨服务的异步任务，如订单成功后发短信、扣减库存。")]),e("li",null,[e("strong",null,"方案一（本地消息表）"),r("： "),e("ol",null,[e("li",null,"在业务数据库中，与业务数据同库同表，有一张“本地消息表”。"),e("li",null,[r("业务执行时，在一个"),e("strong",null,"本地数据库事务"),r("中，既要完成业务操作，也要向消息表插入一条记录。")]),e("li",null,"有一个定时任务，扫描消息表，将消息发送到MQ。"),e("li",null,"下游服务消费MQ，处理业务。处理成功后，通知上游或上游主动回调来更新消息状态。")])]),e("li",null,[e("strong",null,"方案二（使用RocketMQ事务消息）"),r("： "),e("ol",null,[e("li",null,"生产者发送一个“半消息”到MQ。"),e("li",null,"MQ持久化成功并回复生产者。"),e("li",null,"生产者执行本地事务。"),e("li",null,[r("根据本地事务执行结果，向MQ提交"),e("code",null,"Commit"),r("或"),e("code",null,"Rollback"),r("。")]),e("li",null,"MK如果收到Commit，则下游服务可见并消费；如果超时未收到，则回查生产者的本地事务状态。")])]),e("li",null,[e("strong",null,"核心"),r("：通过MQ的可靠性，保证只要上游事务成功，消息最终一定能被下游消费。")])])]),e("li",null,[e("strong",null,"TCC模式"),e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：适用于对一致性要求高、且业务逻辑可以明确分为两阶段的场景，如资金扣款、酒店预订。")]),e("li",null,[e("strong",null,"流程"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"Try"),r("：尝试执行。完成所有业务的检查，并"),e("strong",null,"预留"),r("必需资源（如冻结部分金额、锁定酒店库存）。")]),e("li",null,[e("strong",null,"Confirm"),r("：确认执行。真正执行业务，使用Try阶段预留的资源。"),e("strong",null,"要求幂等"),r("。")]),e("li",null,[e("strong",null,"Cancel"),r("：取消执行。释放Try阶段预留的资源。"),e("strong",null,"要求幂等"),r("。")])])]),e("li",null,[e("strong",null,"优点"),r("：性能较好，数据最终一致。")]),e("li",null,[e("strong",null,"缺点"),r("：业务侵入性强，需要为每个操作实现三个接口，开发复杂。")])])]),e("li",null,[e("strong",null,"Saga模式"),e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：适用于业务流程长、需要调用多个服务的场景。")]),e("li",null,[e("strong",null,"流程"),r("：将一个分布式事务拆分为多个本地事务，每个本地事务都有对应的补偿操作。")]),e("li",null,[e("strong",null,"执行方式"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"正向"),r("：T1 -> T2 -> T3 …")]),e("li",null,[e("strong",null,"补偿"),r("：如果T3失败，则执行 C3 -> C2 -> C1 …（反向补偿）。")])])]),e("li",null,[e("strong",null,"优点"),r("：一阶段就提交本地事务，无锁，高性能。")]),e("li",null,[e("strong",null,"缺点"),r("：不保证隔离性，可能出现“脏写”，需要业务上能处理或通过其他手段避免。")])])])],-1)),a[336]||(a[336]=e("p",null,[e("strong",null,"总结陈述："),r(" “在我们的项目中，"),e("strong",null,"绝大部分场景使用的是‘可靠消息最终一致性’"),r("，因为它对业务侵入较小，通过MQ和补偿机制能很好地满足需求。对于少数核心的资金类业务，我们会采用"),e("strong",null,"TCC"),r("模式。同时，我们也会使用"),e("strong",null,"Seata"),r("这样的分布式事务框架来降低这些模式的实现复杂度。选型的核心在于权衡业务对一致性的要求与系统的复杂度和性能。”")],-1)),a[337]||(a[337]=e("hr",null,null,-1)),a[338]||(a[338]=e("h2",{id:"面经一-博奥特-华安保险",tabindex:"-1"},[e("strong",null,"面经一"),r("：博奥特 - 华安保险 "),e("a",{class:"header-anchor",href:"#面经一-博奥特-华安保险","aria-label":'Permalink to "**面经一**：博奥特 - 华安保险"'},"​")],-1)),a[339]||(a[339]=e("hr",null,null,-1)),a[340]||(a[340]=e("h3",{id:"q-redis缓存与java本地缓存的区别",tabindex:"-1"},[r("Q：Redis缓存与Java本地缓存的区别 "),e("a",{class:"header-anchor",href:"#q-redis缓存与java本地缓存的区别","aria-label":'Permalink to "Q：Redis缓存与Java本地缓存的区别"'},"​")],-1)),a[341]||(a[341]=e("h4",{id:"核心定义",tabindex:"-1"},[r("核心定义 "),e("a",{class:"header-anchor",href:"#核心定义","aria-label":'Permalink to "核心定义"'},"​")],-1)),a[342]||(a[342]=e("ul",null,[e("li",null,[e("strong",null,"Java 本地缓存"),r("：指在 Java 应用程序的 JVM 堆内存（或堆外内存）中开辟一块空间，用于存储数据。它的生命周期与应用程序保持一致，访问速度极快，但无法被其他应用共享。常见的实现有："),e("code",null,"ConcurrentHashMap"),r("、"),e("code",null,"Guava Cache"),r("、"),e("code",null,"Caffeine"),r("、"),e("code",null,"Ehcache"),r("等。")]),e("li",null,[e("strong",null,"Redis 缓存"),r("：一个独立的、基于内存的键值数据库，通常以独立的服务器进程形式存在，通过网络协议（如 RESP）与应用程序进行通信。它支持数据持久化、主从复制、集群分片等高级功能，是一个集中式的缓存解决方案。")])],-1)),a[343]||(a[343]=e("hr",null,null,-1)),a[344]||(a[344]=e("h4",{id:"详细对比分析",tabindex:"-1"},[r("详细对比分析 "),e("a",{class:"header-anchor",href:"#详细对比分析","aria-label":'Permalink to "详细对比分析"'},"​")],-1)),a[345]||(a[345]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"特性维度"),e("th",{style:{"text-align":"left"}},"Java 本地缓存"),e("th",{style:{"text-align":"left"}},"Redis 缓存")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"架构与位置")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"进程内缓存"),r("，与应用同属一个 JVM 进程。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"进程外缓存"),r("，独立的服务，通过网络访问。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"性能")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"极高"),r("。直接读写 JVM 内存，无网络开销和序列化/反序列化开销。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"高"),r("。基于内存，但存在网络 I/O 和序列化/反序列化的开销。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"数据一致性")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"难保证"),r("。在集群环境下，每个应用实例的本地缓存是独立的，更新一个实例的缓存无法通知其他实例，导致"),e("strong",null,"数据不一致"),r("。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"易保证"),r("。作为集中式存储，所有应用实例都访问同一个数据源，数据是"),e("strong",null,"一致"),r("的。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"分布式支持")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"不支持"),r(" 或 "),e("strong",null,"需要额外手段"),r("。本身是单机的。要实现分布式效果，需要引入广播机制（如 Redis Pub/Sub）或一致性哈希等复杂方案。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"原生支持"),r("。通过 Redis Cluster 或客户端分片，可以轻松实现水平扩展。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"容量与扩展性")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"受 JVM 堆内存限制"),r("。容量有限，过大的缓存会影响 GC，可能引发 Full GC 甚至 OOM。扩展性差，只能垂直扩展（加大 JVM 堆）。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"容量独立，扩展性强"),r("。数据存储在独立的 Redis 服务器上，容量不受应用限制。可以水平扩展（增加 Redis 集群节点）。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"数据结构和功能")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"简单"),r("。通常是简单的 Key-Value 映射。高级功能（如过期、淘汰策略）需要自行实现或依赖第三方库（如 Caffeine）。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"极其丰富"),r("。支持字符串、列表、集合、有序集合、哈希、位图、流等多种数据结构。提供发布订阅、Lua 脚本、事务等强大功能。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"数据持久化")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"通常不持久化"),r("。应用重启后缓存数据丢失。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"支持持久化"),r("。可通过 RDB 快照和 AOF 日志将内存数据持久化到磁盘，保证数据不丢失。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"可靠性/高可用")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"低"),r("。缓存数据与应用共存亡，应用宕机则缓存丢失。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"高"),r("。通过 Redis Sentinel 或 Redis Cluster 提供主从复制和故障自动转移，实现高可用。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"使用复杂度")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"低"),r("。引入 jar 包即可使用，无需部署和维护额外中间件。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"中"),r("。需要单独部署、维护和监控 Redis 服务器，增加了运维成本。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"适用场景")]),e("td",{style:{"text-align":"left"}},"- 数据量不大、更新频率低 - 对性能要求极致，可接受短暂不一致 - 单机应用或无需在集群间同步缓存的场景 - 作为 Redis 缓存前的第一道屏障（多级缓存）"),e("td",{style:{"text-align":"left"}},"- 大规模分布式系统，需要缓存共享 - 数据一致性要求高 - 缓存数据量巨大 - 需要利用丰富的数据结构或功能（如排行榜、消息队列） - 需要高可用和数据持久化")])])],-1)),a[346]||(a[346]=e("hr",null,null,-1)),a[347]||(a[347]=e("h4",{id:"场景举例与选择策略",tabindex:"-1"},[r("场景举例与选择策略 "),e("a",{class:"header-anchor",href:"#场景举例与选择策略","aria-label":'Permalink to "场景举例与选择策略"'},"​")],-1)),a[348]||(a[348]=e("h4",{id:"_1-适合使用-java-本地缓存的场景",tabindex:"-1"},[r("1. 适合使用 Java 本地缓存的场景 "),e("a",{class:"header-anchor",href:"#_1-适合使用-java-本地缓存的场景","aria-label":'Permalink to "1. 适合使用 Java 本地缓存的场景"'},"​")],-1)),a[349]||(a[349]=e("ul",null,[e("li",null,[e("strong",null,"配置信息缓存"),r("：例如，系统启动时加载的、很少变化的配置项、字典数据。每个应用实例在本地缓存一份，访问速度最快。")]),e("li",null,[e("strong",null,"短时间高频访问的只读数据"),r("：比如，一分钟内不会变动的商品基本信息。即使各实例间有一分钟的差异，业务上也可接受。")]),e("li",null,[e("strong",null,"多级缓存架构的第一级"),r("：在请求到达 Redis 之前，先用本地缓存拦截一次，极大减轻 Redis 的压力和网络延迟。这是非常经典的架构模式。")])],-1)),a[350]||(a[350]=e("h4",{id:"_2-适合使用-redis-缓存的场景",tabindex:"-1"},[r("2. 适合使用 Redis 缓存的场景 "),e("a",{class:"header-anchor",href:"#_2-适合使用-redis-缓存的场景","aria-label":'Permalink to "2. 适合使用 Redis 缓存的场景"'},"​")],-1)),a[351]||(a[351]=e("ul",null,[e("li",null,[e("strong",null,"Session 共享"),r("：在集群部署中，用户的 Session 信息存储在 Redis 中，任何一台应用服务器都能访问，实现登录状态的保持。")]),e("li",null,[e("strong",null,"分布式锁"),r("：利用 Redis 的原子操作实现跨 JVM 的互斥锁。")]),e("li",null,[e("strong",null,"排行榜/计数器"),r("：利用 Redis 的 "),e("code",null,"ZSET"),r("（有序集合）可以轻松实现实时排行榜；利用 "),e("code",null,"INCR"),r(" 命令实现高性能的计数器。")]),e("li",null,[e("strong",null,"缓存热点数据"),r("：如商品详情页、文章详情等，所有应用实例都从同一个 Redis 获取，保证数据一致。")])],-1)),a[352]||(a[352]=e("hr",null,null,-1)),a[353]||(a[353]=e("h4",{id:"最佳实践与结合使用-多级缓存",tabindex:"-1"},[r("最佳实践与结合使用：多级缓存 "),e("a",{class:"header-anchor",href:"#最佳实践与结合使用-多级缓存","aria-label":'Permalink to "最佳实践与结合使用：多级缓存"'},"​")],-1)),a[354]||(a[354]=e("p",null,[r("在现代高并发系统中，通常不会二选一，而是将它们结合使用，形成"),e("strong",null,"多级缓存"),r("，以兼顾性能和一致性。")],-1)),a[355]||(a[355]=e("p",null,[e("strong",null,"经典的多级缓存架构（如 CPU 缓存架构）：")],-1)),a[356]||(a[356]=e("ol",null,[e("li",null,[e("strong",null,"L1 缓存：Java 本地缓存 (Caffeine)"),e("ul",null,[e("li",null,"作用：抵御最热点的数据访问，响应速度在纳秒级。"),e("li",null,"策略：设置较短的过期时间（如 1-2 分钟），容忍极短时间的数据不一致。")])]),e("li",null,[e("strong",null,"L2 缓存：Redis 分布式缓存"),e("ul",null,[e("li",null,"作用：作为共享缓存层，抵御大量的数据访问，保证集群数据一致性。"),e("li",null,"策略：设置较长的过期时间，并从数据库加载数据。")])]),e("li",null,[e("strong",null,"数据源：数据库 (MySQL等)"),e("ul",null,[e("li",null,"最终的数据持久化层。")])])],-1)),a[357]||(a[357]=e("p",null,[e("strong",null,"工作流程：")],-1)),a[358]||(a[358]=e("ol",null,[e("li",null,"请求到达应用。"),e("li",null,[r("首先查询 "),e("strong",null,"L1 本地缓存"),r("，如果命中则直接返回。")]),e("li",null,[r("如果 L1 未命中，则查询 "),e("strong",null,"L2 Redis 缓存"),r("。")]),e("li",null,"如果 Redis 命中，则将数据写入本地缓存（并设置短过期时间），然后返回。"),e("li",null,[r("如果 Redis 也未命中，则查询"),e("strong",null,"数据库"),r("，将结果写入 Redis 和本地缓存，然后返回。")])],-1)),a[359]||(a[359]=e("p",null,[e("strong",null,"缓存更新/失效策略："),r(" 为了保证数据最终一致性，当数据发生变更时：")],-1)),a[360]||(a[360]=e("ol",null,[e("li",null,"更新数据库。"),e("li",null,[r("删除 Redis 中对应的缓存（"),e("strong",null,"Cache-Aside 模式"),r("）。")]),e("li",null,"发布一个消息（通过 Redis Pub/Sub 或 MQ），通知所有应用实例删除其本地缓存中的该数据。")],-1)),a[361]||(a[361]=e("h4",{id:"总结-1",tabindex:"-1"},[r("总结 "),e("a",{class:"header-anchor",href:"#总结-1","aria-label":'Permalink to "总结"'},"​")],-1)),a[362]||(a[362]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"缓存类型"),e("th",{style:{"text-align":"left"}},"优势"),e("th",{style:{"text-align":"left"}},"劣势")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"Java 本地缓存")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"性能极致、零网络开销、实现简单")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"容量有限、数据不一致、可靠性低")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"Redis 缓存")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"功能丰富、数据一致、容量大、高可用")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"存在网络延迟、需要额外运维")])])])],-1)),a[363]||(a[363]=e("p",null,[e("strong",null,"最终选择建议：")],-1)),a[364]||(a[364]=e("ul",null,[e("li",null,[e("strong",null,"追求极致性能、可接受数据短时不一致"),r(" -> 优先考虑 "),e("strong",null,"Java 本地缓存"),r("。")]),e("li",null,[e("strong",null,"需要数据共享、保证一致性、缓存大量数据"),r(" -> 必须使用 "),e("strong",null,"Redis 缓存"),r("。")]),e("li",null,[e("strong",null,"构建高性能、高可用的超大规模系统"),r(" -> 采用 "),e("strong",null,"多级缓存架构"),r("，让两者协同工作，取长补短。")])],-1)),a[365]||(a[365]=e("hr",null,null,-1)),a[366]||(a[366]=e("h3",{id:"q-redis为什么这么快",tabindex:"-1"},[r("Q：Redis为什么这么快？ "),e("a",{class:"header-anchor",href:"#q-redis为什么这么快","aria-label":'Permalink to "Q：Redis为什么这么快？"'},"​")],-1)),a[367]||(a[367]=e("h4",{id:"_1-基于内存的存储与访问",tabindex:"-1"},[r("1. 基于内存的存储与访问 "),e("a",{class:"header-anchor",href:"#_1-基于内存的存储与访问","aria-label":'Permalink to "1. 基于内存的存储与访问"'},"​")],-1)),a[368]||(a[368]=e("p",null,"这是最根本、也是最容易理解的原因。",-1)),a[369]||(a[369]=e("ul",null,[e("li",null,[e("strong",null,"直接内存操作"),r("：Redis 将所有数据存储在内存（RAM）中。这意味着数据的读写操作完全不需要磁盘 I/O，而磁盘 I/O（尤其是机械硬盘）通常是传统数据库（如 MySQL）最主要的性能瓶颈。")]),e("li",null,[e("strong",null,"速度数量级差异"),r("：内存的读写速度比 SSD 快 10-100 倍，比机械硬盘快 10万 倍以上。这种硬件级别的速度优势是 Redis 高性能的基石。")])],-1)),a[370]||(a[370]=e("blockquote",null,[e("p",null,[e("strong",null,"类比"),r("：从内存中读取数据就像从办公桌的桌面上直接拿一份文件，而从磁盘读取数据则像是需要走到档案室去翻找。前者几乎是瞬时的。")])],-1)),a[371]||(a[371]=e("hr",null,null,-1)),a[372]||(a[372]=e("h4",{id:"_2-高效的数据结构",tabindex:"-1"},[r("2. 高效的数据结构 "),e("a",{class:"header-anchor",href:"#_2-高效的数据结构","aria-label":'Permalink to "2. 高效的数据结构"'},"​")],-1)),a[373]||(a[373]=e("p",null,"Redis 不仅仅是简单的 Key-Value 存储，它提供了丰富的数据结构，并且每种结构都针对特定场景进行了极致的优化。",-1)),a[374]||(a[374]=e("ul",null,[e("li",null,[e("strong",null,"动态字符串（SDS）"),r("：与 C 语言原生字符串相比，SDS 获取字符串长度的时间复杂度是 O(1)（原生是 O(n)），并且避免了缓冲区溢出，同时减少了内存重分配次数。")]),e("li",null,[e("strong",null,"字典（Hash Table）"),r("：Redis 的整个 Key 空间就是一个巨大的字典，其实现使用了高效的哈希表，并采用了一种称为 "),e("strong",null,"“渐进式 Rehash”"),r(" 的策略。在扩容时，它不会一次性将所有数据迁移到新哈希表，而是分多次、渐进式地完成，避免了单次操作导致的长时间停顿，保证了高性能。")]),e("li",null,[e("strong",null,"跳跃表（Skip List）"),r("：用于实现有序集合（Sorted Set）。它在链表的基础上增加了多级索引，使得查找效率可以达到平均 O(log n)，且实现比平衡树更简单，非常适合范围查询。")]),e("li",null,[e("strong",null,"压缩列表（ziplist）"),r(" 和 "),e("strong",null,"快速列表（quicklist）"),r("： "),e("ul",null,[e("li",null,[e("code",null,"ziplist"),r(" 是为小数据量列表、哈希、有序集合设计的一种紧凑的、连续内存存储结构，它通过牺牲部分读写速度来极大地节省内存，从而减少内存分配和碎片。")]),e("li",null,[e("code",null,"quicklist"),r(" 是列表（List）的默认实现，它是双向链表和 ziplist 的结合。它将多个 ziplist 节点用双向链表连接起来，在空间效率和操作效率之间取得了完美的平衡。")])])]),e("li",null,[e("strong",null,"紧凑存储"),r("：对于整数集合等，Redis 会使用最紧凑的编码方式来存储，以节省内存。")])],-1)),a[375]||(a[375]=e("p",null,"这些精心设计的数据结构，使得 Redis 在时间和空间效率上都达到了很高的水平。",-1)),a[376]||(a[376]=e("hr",null,null,-1)),a[377]||(a[377]=e("h4",{id:"_3-单线程模型与-i-o-多路复用",tabindex:"-1"},[r("3. 单线程模型与 I/O 多路复用 "),e("a",{class:"header-anchor",href:"#_3-单线程模型与-i-o-多路复用","aria-label":'Permalink to "3. 单线程模型与 I/O 多路复用"'},"​")],-1)),a[378]||(a[378]=e("p",null,[r("这是 Redis 设计中"),e("strong",null,"最精妙也最容易被误解"),r("的一点。")],-1)),a[379]||(a[379]=e("h5",{id:"核心是单线程",tabindex:"-1"},[r("核心是单线程 "),e("a",{class:"header-anchor",href:"#核心是单线程","aria-label":'Permalink to "核心是单线程"'},"​")],-1)),a[380]||(a[380]=e("p",null,[r("Redis 的"),e("strong",null,"核心网络事件处理器（命令执行器）是单线程的"),r("。这意味着在任何给定时刻，只有一个命令在被处理。")],-1)),a[381]||(a[381]=e("p",null,[e("strong",null,"为什么单线程反而快？")],-1)),a[382]||(a[382]=e("ol",null,[e("li",null,[e("strong",null,"避免了线程切换和竞态的开销"),r("：多线程编程需要复杂的锁机制来保证数据一致性，锁的竞争和线程上下文的切换会消耗大量的 CPU 资源。单线程模型完全避免了这些开销。")]),e("li",null,[e("strong",null,"不存在加锁/解锁操作"),r("：所有操作都是原子的，不会因为并发问题导致数据混乱，简化了实现。")]),e("li",null,[e("strong",null,"顺序执行，无需同步"),r("：命令按照到达顺序被逐一执行，逻辑清晰，性能可预测。")])],-1)),a[383]||(a[383]=e("h5",{id:"i-o-多路复用-单线程的-神助攻",tabindex:"-1"},[r("I/O 多路复用：单线程的“神助攻” "),e("a",{class:"header-anchor",href:"#i-o-多路复用-单线程的-神助攻","aria-label":'Permalink to "I/O 多路复用：单线程的“神助攻”"'},"​")],-1)),a[384]||(a[384]=e("p",null,[r("单线程如何处理海量的并发连接呢？答案是 "),e("strong",null,"I/O 多路复用技术"),r("。")],-1)),a[385]||(a[385]=e("ul",null,[e("li",null,[e("strong",null,"原理"),r("：Redis 使用 "),e("code",null,"epoll"),r("（Linux）、"),e("code",null,"kqueue"),r("（BSD/Mac） 或 "),e("code",null,"select"),r(" 等系统调用，在一个线程中同时监控成千上万个网络连接（Socket）。当任何一个 Socket 有数据到达（即有客户端请求）时，多路复用器会通知 Redis，然后 Redis 依次处理这些就绪的 Socket 上的命令。")]),e("li",null,[e("strong",null,"工作流程"),r("： "),e("ol",null,[e("li",null,"多个客户端与 Redis 建立连接。"),e("li",null,"Redis 的单线程通过 I/O 多路复用器监听所有 Socket。"),e("li",null,"当某个 Socket 可读（有请求）时，多路复用器将其放入一个队列。"),e("li",null,"Redis 的事件处理器按顺序从队列中取出请求，逐个执行命令。"),e("li",null,"执行完毕后，将结果写入对应的 Socket 输出缓冲区。")])])],-1)),a[386]||(a[386]=e("blockquote",null,[e("p",null,[e("strong",null,"类比"),r("：单线程的 Redis 就像一个"),e("strong",null,"高效的餐厅服务员"),r("。I/O 多路复用就像他有一个“万能对讲机”，可以同时监听所有餐桌（客户端）的点餐需求。他不需要在每张桌子前傻等，而是当有顾客（Socket）准备好点餐（请求可读）时，对讲机会通知他，他再走过去处理。这样，一个服务员就能高效地服务整个餐厅。")])],-1)),a[387]||(a[387]=e("p",null,[e("strong",null,"结论"),r("：单线程模型 + I/O 多路复用，使得 Redis 在极高的并发连接下，依然能保持极低的延迟和极高的吞吐量，尤其是在操作都是内存级别的轻量级操作时。")],-1)),a[388]||(a[388]=e("hr",null,null,-1)),a[389]||(a[389]=e("h4",{id:"_4-其他优化手段",tabindex:"-1"},[r("4. 其他优化手段 "),e("a",{class:"header-anchor",href:"#_4-其他优化手段","aria-label":'Permalink to "4. 其他优化手段"'},"​")],-1)),a[390]||(a[390]=e("p",null,"除了上述三大核心原因，Redis 还有一些其他的优化策略：",-1)),a[391]||(a[391]=e("ul",null,[e("li",null,[e("strong",null,"虚拟内存机制"),r("：虽然数据在内存中，但 Redis 仍会利用操作系统的虚拟内存和交换分区，不过现代 Redis 版本更倾向于使用持久化机制来保证数据安全。")]),e("li",null,[e("strong",null,"管道化（Pipeline）"),r("：客户端可以将多个命令一次性发送给 Redis，而无需等待每个命令的响应。这极大地减少了网络往返时间（RTT），在需要执行大量命令时效果显著。")]),e("li",null,[e("strong",null,"精细的底层优化"),r("：Redis 的代码非常简洁高效，由 C 语言编写，对常见操作进行了大量优化。")])],-1)),a[392]||(a[392]=e("hr",null,null,-1)),a[393]||(a[393]=e("h4",{id:"总结与权衡",tabindex:"-1"},[r("总结与权衡 "),e("a",{class:"header-anchor",href:"#总结与权衡","aria-label":'Permalink to "总结与权衡"'},"​")],-1)),a[394]||(a[394]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"特性"),e("th",{style:{"text-align":"left"}},"带来的速度优势"),e("th",{style:{"text-align":"left"}},"潜在的代价/限制")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"内存存储")]),e("td",{style:{"text-align":"left"}},"极快的读写速度"),e("td",{style:{"text-align":"left"}},"数据容量受内存大小限制，成本较高，数据易失（需配合持久化）")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"高效数据结构")]),e("td",{style:{"text-align":"left"}},"节省内存，操作快速"),e("td",{style:{"text-align":"left"}},"数据结构复杂度较高，需要根据场景选择合适的数据类型")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"单线程模型")]),e("td",{style:{"text-align":"left"}},"无锁，无上下文切换，原子操作"),e("td",{style:{"text-align":"left"}},[r("无法利用多核CPU；单个耗时命令（如"),e("code",null,"keys *"),r("）会阻塞所有后续命令")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"I/O 多路复用")]),e("td",{style:{"text-align":"left"}},"高并发连接下的高性能"),e("td",{style:{"text-align":"left"}},"对CPU密集型任务不友好")])])],-1)),a[395]||(a[395]=e("p",null,[e("strong",null,"关于多线程的补充"),r("： 从 Redis 4.0 开始，为了弥补单线程在特定任务上的短板，Redis 引入了"),e("strong",null,"多线程"),r("，但主要用于"),e("strong",null,"后台任务"),r("，如：")],-1)),a[396]||(a[396]=e("ul",null,[e("li",null,[r("大 Key 的异步删除（"),e("code",null,"UNLINK"),r(" 命令）。")]),e("li",null,"持久化时 AOF 文件的刷盘操作。")],-1)),a[397]||(a[397]=e("p",null,[r("在 Redis 6.0 及之后，进一步引入了"),e("strong",null,"多线程 I/O"),r("，用于处理网络数据的"),e("strong",null,"读取和解析"),r("（"),e("code",null,"read"),r("/"),e("code",null,"parse"),r("），但"),e("strong",null,[r("命令的执行（"),e("code",null,"exec"),r("）仍然是单线程的")]),r("。这进一步提升了在网络 I/O 成为瓶颈时的性能，而其核心的、无锁的命令执行模型依然得以保留。")],-1)),a[398]||(a[398]=e("p",null,[e("strong",null,"最终结论"),r("： Redis 的极速是 "),e("strong",null,"内存速度 + 精妙数据结构 + 单线程无锁架构 + I/O 多路复用"),r(" 这一组合拳的结果。它通过牺牲数据规模（受限于内存）和通用性（不适合复杂事务和CPU密集型任务），换取了在特定场景下无与伦比的性能。")],-1)),a[399]||(a[399]=e("hr",null,null,-1)),a[400]||(a[400]=e("h3",{id:"q-redis中rdb和aof的区别",tabindex:"-1"},[r("Q：Redis中RDB和AOF的区别 "),e("a",{class:"header-anchor",href:"#q-redis中rdb和aof的区别","aria-label":'Permalink to "Q：Redis中RDB和AOF的区别"'},"​")],-1)),a[401]||(a[401]=e("h4",{id:"核心概念速览",tabindex:"-1"},[r("核心概念速览 "),e("a",{class:"header-anchor",href:"#核心概念速览","aria-label":'Permalink to "核心概念速览"'},"​")],-1)),a[402]||(a[402]=e("ul",null,[e("li",null,[e("strong",null,"RDB"),r("：在指定的时间间隔内，生成内存中整个数据集的一个"),e("strong",null,"时间点快照"),r("。它就像是给数据库拍一张完整的照片。")]),e("li",null,[e("strong",null,"AOF"),r("：记录服务器接收到的"),e("strong",null,"每一个写操作命令"),r("，并在服务器启动时通过重新执行这些命令来重建原始数据集。它就像是记录数据库所有操作的日记。")])],-1)),a[403]||(a[403]=e("p",null,"下面我们从多个维度进行详细对比。",-1)),a[404]||(a[404]=e("hr",null,null,-1)),a[405]||(a[405]=e("h4",{id:"详细对比表格",tabindex:"-1"},[r("详细对比表格 "),e("a",{class:"header-anchor",href:"#详细对比表格","aria-label":'Permalink to "详细对比表格"'},"​")],-1)),a[406]||(a[406]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"特性维度"),e("th",{style:{"text-align":"left"}},"RDB"),e("th",{style:{"text-align":"left"}},"AOF")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"持久化原理")]),e("td",{style:{"text-align":"left"}},[r("定时生成内存数据的"),e("strong",null,"二进制快照文件"),r("。")]),e("td",{style:{"text-align":"left"}},[r("记录"),e("strong",null,"每一次写操作命令"),r("（文本协议格式），通过重放命令恢复。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"文件格式")]),e("td",{style:{"text-align":"left"}},[r("紧凑的、二进制的 "),e("code",null,"dump.rdb"),r(" 文件。")]),e("td",{style:{"text-align":"left"}},[r("文本文件，默认名为 "),e("code",null,"appendonly.aof"),r("，内容是可读的 Redis 命令。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"数据安全性")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"较低"),r("。可能丢失最后一次快照之后的所有数据。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"非常高"),r("。根据 "),e("code",null,"appendfsync"),r(" 策略配置，最多丢失一秒数据，甚至完全不丢。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"性能影响")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"写时复制"),r(" 机制，"),e("code",null,"fork()"),r(" 子进程时可能阻塞主线程，内存占用翻倍。"),e("strong",null,"恢复大数据集时速度快"),r("。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"主要在于文件同步开销"),r("。"),e("code",null,"appendfsync always"),r(" 性能差，"),e("code",null,"everysec"),r(" 性能很好，"),e("code",null,"no"),r(" 性能最好但可能丢失更多数据。"),e("strong",null,"恢复大数据集时速度慢"),r("。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"文件大小")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"小"),r("。二进制压缩格式，是某个时间点的数据全集。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"大"),r("。记录所有操作日志，长期运行会非常大。但支持重写以压缩文件。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"数据恢复速度")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"快"),r("。直接将 RDB 文件读入内存即可。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"慢"),r("。需要逐条执行 AOF 文件中的所有命令，过程漫长。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"容灾性")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"较差"),r("。损坏的 RDB 文件可能导致数据无法恢复。")]),e("td",{style:{"text-align":"left"}},[e("strong",null,"较好"),r("。即使文件尾部有损坏，"),e("code",null,"redis-check-aof"),r(" 工具可以修复（截掉损坏部分）。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"使用场景")]),e("td",{style:{"text-align":"left"}},[r("适合"),e("strong",null,"大规模数据恢复"),r("、"),e("strong",null,"冷备份"),r("、对数据丢失不敏感（如数据统计、缓存）的场景。")]),e("td",{style:{"text-align":"left"}},[r("适合"),e("strong",null,"对数据安全要求极高"),r("的场景，如业务核心数据、金融交易数据。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"配置复杂度")]),e("td",{style:{"text-align":"left"}},"简单，主要设置保存快照的时间策略。"),e("td",{style:{"text-align":"left"}},[r("相对复杂，需要配置 "),e("code",null,"appendfsync"),r(" 策略、AOF 重写策略等。")])])])],-1)),a[407]||(a[407]=e("hr",null,null,-1)),a[408]||(a[408]=e("h4",{id:"深入原理与细节分析",tabindex:"-1"},[r("深入原理与细节分析 "),e("a",{class:"header-anchor",href:"#深入原理与细节分析","aria-label":'Permalink to "深入原理与细节分析"'},"​")],-1)),a[409]||(a[409]=e("h5",{id:"_1-rdb-的工作机制与优缺点",tabindex:"-1"},[r("1. RDB 的工作机制与优缺点 "),e("a",{class:"header-anchor",href:"#_1-rdb-的工作机制与优缺点","aria-label":'Permalink to "1. RDB 的工作机制与优缺点"'},"​")],-1)),a[410]||(a[410]=e("p",null,[e("strong",null,"工作原理：")],-1)),a[411]||(a[411]=e("ol",null,[e("li",null,[e("strong",null,"手动触发"),r("：执行 "),e("code",null,"SAVE"),r("（阻塞）或 "),e("code",null,"BGSAVE"),r("（后台异步）命令。")]),e("li",null,[e("strong",null,"自动触发"),r("：在配置文件中设置 "),e("code",null,"save m n"),r(" 规则，例如 "),e("code",null,"save 900 1"),r(" 表示在 900 秒内至少有 1 个 key 发生变化，则触发 "),e("code",null,"BGSAVE"),r("。")]),e("li",null,[e("strong",null,[e("code",null,"BGSAVE"),r(" 过程")]),r("：Redis 主进程 "),e("code",null,"fork()"),r(" 一个子进程。子进程拥有主进程此刻的内存数据副本。子进程负责将数据写入临时 RDB 文件，写入完成后替换旧的 RDB 文件。父进程继续处理客户端请求。")])],-1)),a[412]||(a[412]=e("p",null,[e("strong",null,"优点：")],-1)),a[413]||(a[413]=e("ul",null,[e("li",null,[e("strong",null,"性能最大化"),r("："),e("code",null,"fork"),r(" 子进程进行持久化，主进程不会进行磁盘 I/O 操作，保证了 Redis 的高性能。")]),e("li",null,[e("strong",null,"灾难恢复友好"),r("：紧凑的二进制文件非常适合用于灾难恢复，可以快速地将一个 RDB 文件转移到远程数据中心或对象存储中。")]),e("li",null,[e("strong",null,"快速重启"),r("：相比 AOF，在数据集很大时，RDB 的恢复速度要快得多。")])],-1)),a[414]||(a[414]=e("p",null,[e("strong",null,"缺点：")],-1)),a[415]||(a[415]=e("ul",null,[e("li",null,[e("strong",null,"数据丢失风险"),r("：由于是定时快照，一旦在两次快照之间数据库发生故障，会丢失这段时间内的所有数据。")]),e("li",null,[e("strong",null,[e("code",null,"fork()"),r(" 可能阻塞")]),r("：当数据集非常大时（例如几十GB），"),e("code",null,"fork()"),r(" 操作本身可能会非常耗时，导致主进程短暂停止服务（毫秒级甚至秒级）。")])],-1)),a[416]||(a[416]=e("h5",{id:"_2-aof-的工作机制与优缺点",tabindex:"-1"},[r("2. AOF 的工作机制与优缺点 "),e("a",{class:"header-anchor",href:"#_2-aof-的工作机制与优缺点","aria-label":'Permalink to "2. AOF 的工作机制与优缺点"'},"​")],-1)),a[417]||(a[417]=e("p",null,[e("strong",null,"工作原理：")],-1)),a[418]||(a[418]=e("ol",null,[e("li",null,[e("strong",null,"命令追加"),r("：每一个写命令都会被追加到 AOF 缓冲区的末尾。")]),e("li",null,[e("strong",null,"文件同步"),r("：根据 "),e("code",null,"appendfsync"),r(" 配置，将缓冲区内容写入并同步到 AOF 磁盘文件。 "),e("ul",null,[e("li",null,[e("strong",null,[e("code",null,"always")]),r("：每个事件循环都将 AOF 缓冲区的内容"),e("strong",null,"写入并同步"),r("到 AOF 文件。最安全，性能最差。")]),e("li",null,[e("strong",null,[e("code",null,"everysec")]),r("：每个事件循环将 AOF 缓冲区内容"),e("strong",null,"写入"),r("到 AOF 文件，并且"),e("strong",null,"每秒同步一次"),r("。在安全性和性能之间取得了很好的平衡，是"),e("strong",null,"默认推荐"),r("的策略。")]),e("li",null,[e("strong",null,[e("code",null,"no")]),r("：每个事件循环将 AOF 缓冲区内容"),e("strong",null,"写入"),r("到 AOF 文件，但同步操作由操作系统决定。性能最好，但可能丢失一个事件循环的数据。")])])]),e("li",null,[e("strong",null,"文件重写"),r("：随着命令不断写入，AOF 文件会越来越大。Redis 提供了 "),e("code",null,"BGREWRITEAOF"),r(" 机制，"),e("code",null,"fork"),r(" 子进程根据当前数据库状态创建一个新的、更小的 AOF 文件，来替换旧文件。例如，对一个 key 进行了 100 次 "),e("code",null,"incr"),r("，重写后只需记录一条 "),e("code",null,"set key 100"),r(" 命令。")])],-1)),a[419]||(a[419]=e("p",null,[e("strong",null,"优点：")],-1)),a[420]||(a[420]=e("ul",null,[e("li",null,[e("strong",null,"极高的数据安全性"),r("：即使使用默认的 "),e("code",null,"everysec"),r(" 策略，也最多只丢失 1 秒钟的数据。")]),e("li",null,[e("strong",null,"可读性"),r("：AOF 文件是纯文本格式，易于理解和分析。如果误操作（如 "),e("code",null,"FLUSHALL"),r("），可以在文件末尾删除该命令后进行恢复。")])],-1)),a[421]||(a[421]=e("p",null,[e("strong",null,"缺点：")],-1)),a[422]||(a[422]=e("ul",null,[e("li",null,[e("strong",null,"文件体积大"),r("：即使经过重写，AOF 文件通常也比同数据集的 RDB 文件大。")]),e("li",null,[e("strong",null,"恢复速度慢"),r("：数据恢复时需要重新执行所有命令，比 RDB 慢很多。")]),e("li",null,[e("strong",null,"性能依赖同步策略"),r("：在写入吞吐量高的场景下，AOF 的性能可能仍低于 RDB。")])],-1)),a[423]||(a[423]=e("hr",null,null,-1)),a[424]||(a[424]=e("h4",{id:"如何选择-rdb-vs-aof",tabindex:"-1"},[r("如何选择：RDB vs AOF？ "),e("a",{class:"header-anchor",href:"#如何选择-rdb-vs-aof","aria-label":'Permalink to "如何选择：RDB vs AOF？"'},"​")],-1)),a[425]||(a[425]=e("p",null,"这是一个经典的权衡问题，取决于你的业务需求。",-1)),a[426]||(a[426]=e("ul",null,[e("li",null,[e("strong",null,"追求极致的数据安全，愿意牺牲一些性能和存储空间？"),e("ul",null,[e("li",null,[e("strong",null,"选择 AOF"),r("。这是最常见的选择。")])])]),e("li",null,[e("strong",null,"可以容忍分钟级别的数据丢失，追求更快的启动速度和更小的备份文件？"),e("ul",null,[e("li",null,[e("strong",null,"选择 RDB"),r("。适用于用作缓存或存储非关键数据的场景。")])])]),e("li",null,[e("strong",null,"“我全都要”！希望兼顾数据安全、性能和快速恢复？"),e("ul",null,[e("li",null,[e("strong",null,"选择 “RDB + AOF” 的混合模式"),r("（Redis 4.0+ 推荐）。")])])])],-1)),a[427]||(a[427]=e("h4",{id:"混合持久化-推荐",tabindex:"-1"},[r("混合持久化（推荐） "),e("a",{class:"header-anchor",href:"#混合持久化-推荐","aria-label":'Permalink to "混合持久化（推荐）"'},"​")],-1)),a[428]||(a[428]=e("p",null,[r("在 Redis 4.0 之后，引入了一个新的选项："),e("strong",null,[e("code",null,"aof-use-rdb-preamble")]),r("。")],-1)),a[429]||(a[429]=e("p",null,[e("strong",null,"工作原理："),r(" 当开启混合持久化后，在 AOF 重写时，子进程不再是单纯地将当前数据集转换为 AOF 命令，而是会"),e("strong",null,"先将当前数据集以 RDB 二进制格式写入到新的 AOF 文件的前半部分"),r("。然后，在重写期间接收到的写命令，会以 AOF 格式继续追加到文件的后半部分。")],-1)),a[430]||(a[430]=e("p",null,[r("这样一来，新的 AOF 文件就由一个 "),e("strong",null,"RDB 数据快照头"),r(" 和一个 "),e("strong",null,"AOF 命令增量尾"),r(" 组成。")],-1)),a[431]||(a[431]=e("p",null,[e("strong",null,"优势：")],-1)),a[432]||(a[432]=e("ul",null,[e("li",null,[e("strong",null,"快速恢复"),r("：重启时，先加载 RDB 部分，速度极快，然后再重放少量的增量 AOF 命令，大大提升了恢复速度。")]),e("li",null,[e("strong",null,"数据安全"),r("：结合了 RDB 的文件小、恢复快和 AOF 的数据不丢失的优点。")])],-1)),a[433]||(a[433]=e("p",null,[e("strong",null,"配置方法："),r(" 在 "),e("code",null,"redis.conf"),r(" 中设置：")],-1)),a[434]||(a[434]=e("div",{class:"language-sh max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sh"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"appendonly"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," yes")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"aof-use-rdb-preamble"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," yes")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[435]||(a[435]=e("h4",{id:"总结与比喻",tabindex:"-1"},[r("总结与比喻 "),e("a",{class:"header-anchor",href:"#总结与比喻","aria-label":'Permalink to "总结与比喻"'},"​")],-1)),a[436]||(a[436]=e("ul",null,[e("li",null,[e("strong",null,"RDB 像拍照片"),r("：定期定格，记录瞬间。"),e("strong",null,"恢复快、文件小，但可能错过镜头间的精彩（数据变化）"),r("。")]),e("li",null,[e("strong",null,"AOF 像写日记"),r("：事无巨细，逐条记录。"),e("strong",null,"数据全、最可靠，但日记本厚（文件大），复盘（恢复）起来慢"),r("。")]),e("li",null,[e("strong",null,"混合模式像“照片+日记补录”"),r("：先拍一张完整的照片，然后在照片后面记录之后发生的新事情。"),e("strong",null,"结合了两者的优点，是现代 Redis 部署的推荐方案"),r("。")])],-1)),a[437]||(a[437]=e("p",null,[r("在实际生产环境中，强烈建议根据业务容忍度进行测试，并优先考虑开启 "),e("strong",null,"AOF"),r(" 或 "),e("strong",null,"混合持久化"),r(" 来保证数据的安全性。")],-1)),a[438]||(a[438]=e("hr",null,null,-1)),a[439]||(a[439]=e("h3",{id:"q-注重项目的难点",tabindex:"-1"},[r("Q：注重项目的难点 "),e("a",{class:"header-anchor",href:"#q-注重项目的难点","aria-label":'Permalink to "Q：注重项目的难点"'},"​")],-1)),a[440]||(a[440]=e("ul",null,[e("li",null,[r("对项目二中系统对接上游系统与下游系统的数据传输方式，以及供应商是否存在外部系统导入数据进内部系统。 "),e("ul",null,[e("li",null,[r("对于"),e("strong",null,"零部件询报价寻源系统"),r("，其数据来源通常是"),e("strong",null,"多通道、分阶段"),r("的，而不是单一来源。下图清晰地展示了该系统核心的数据来源与流向：")])])])],-1)),E(n,p({code:"Zmxvd2NoYXJ0IFREDQogICAgQVvkuJzpo47ml6XkuqflhoXpg6jns7vnu59dIC0tPiBCW-mbtumDqOS7tuivouaKpeS7t-Wvu-a6kOezu-e7n10NCiAgICBDW-WGhemDqOeUqOaItzxicj7ph4fotK0v5bel56iL5biIXSAtLSDkuIrkvKBFeGNlbCAtLT4gQg0KICAgIERb5r2c5Zyo5L6b5bqU5ZWGXSAtLSDkuIrkvKBFeGNlbCAtLT4gQw0KICAgIEVb56Gu5a6a5L6b5bqU5ZWGXSAtLSDlnKjnur_miqXku7cgLS0-IEINCiAgICANCiAgICBzdWJncmFwaCBBIFvlhoXpg6jmlbDmja7mupBdDQogICAgICAgIEExW1BEVOi9puWei-euoeeQhuezu-e7n10NCiAgICAgICAgQTJbRVJQ5Li75pWw5o2u57O757ufXQ0KICAgICAgICBBM1vorr7orqEv5bel6Im657O757ufXQ0KICAgIGVuZA"},{}),null,16),a[441]||(a[441]=e("p",null,"下面我们来分步解析这套数据流机制：",-1)),a[442]||(a[442]=e("h4",{id:"核心数据来源分析",tabindex:"-1"},[e("strong",null,"核心数据来源分析"),r(),e("a",{class:"header-anchor",href:"#核心数据来源分析","aria-label":'Permalink to "**核心数据来源分析**"'},"​")],-1)),a[443]||(a[443]=e("ol",null,[e("li",null,[e("strong",null,"来自东风日产内部系统（主要来源）")])],-1)),a[444]||(a[444]=e("p",null,"这是系统最核心、最正式的数据来源，保证了数据的权威性和一致性。",-1)),a[445]||(a[445]=e("ul",null,[e("li",null,[e("strong",null,"数据内容"),r("：需要询价的"),e("strong",null,"零部件清单（BOM）、车型信息、技术图纸、需求数量、时间节点"),r("等。")]),e("li",null,[e("strong",null,"来源系统"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"PDT车型综合管理系统"),r("（项目描述中已提及）：这是最直接的源头，新车型项目启动时，会生成完整的零部件清单，并自动或手动触发询价流程。")]),e("li",null,[e("strong",null,"ERP主数据系统"),r("：获取已有的物料基础信息、历史价格等。")]),e("li",null,[e("strong",null,"设计/工艺系统"),r("：获取最新的技术规范和图纸。")])])]),e("li",null,[e("strong",null,"交互方式"),r("：通常通过"),e("strong",null,"系统接口对接"),r("实现。PDT系统会通过API调用或消息队列，将询价任务同步到寻源系统。")])],-1)),a[446]||(a[446]=e("ol",{start:"2"},[e("li",null,[e("strong",null,"来自内部用户（采购/工程师）的Excel导入")])],-1)),a[447]||(a[447]=e("p",null,[r("这是对系统对接方式的"),e("strong",null,"重要补充"),r("，用于处理非标、紧急或系统无法覆盖的场景。")],-1)),a[448]||(a[448]=e("ul",null,[e("li",null,[e("strong",null,"数据内容"),r("： "),e("ul",null,[e("li",null,[r("新供应商引入时的"),e("strong",null,"初步物料清单"),r("。")]),e("li",null,[r("临时、小批量的"),e("strong",null,"零星采购需求"),r("。")]),e("li",null,[r("对已有数据的"),e("strong",null,"批量更新"),r("。")])])]),e("li",null,[e("strong",null,"交互方式"),r("：这正是你职责中 "),e("strong",null,"“使用 CompletableFuture 并行导入零件数据”"),r(" 和 "),e("strong",null,"“优化Excel导入”"),r(" 所解决的问题。"),e("strong",null,"供应商不直接操作该系统，而是将Excel文件发给东风日产的采购人员，由内部员工统一导入"),r("，以保证数据的规范和安全。")])],-1)),a[449]||(a[449]=e("ol",{start:"3"},[e("li",null,[e("strong",null,"来自供应商的数据（核心是报价，而非零件数据）")])],-1)),a[450]||(a[450]=e("p",null,[r("这里是关键的区分点："),e("strong",null,"供应商提供的是“报价”数据，而非“零件”主数据。")],-1)),a[451]||(a[451]=e("ul",null,[e("li",null,[e("strong",null,"供应商不直接导入零件数据"),r("：零件的基础信息（如零件号、名称、技术规格、图纸）是由东风日产定义和拥有的，供应商无权创建或修改。")]),e("li",null,[e("strong",null,"供应商的核心操作"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"在线报价"),r("：在系统中针对发布的询价单，填写单价、付款条件、交货周期等。")]),e("li",null,[e("strong",null,"上传辅助文件"),r("：可能会上传报价明细、资质文件、技术建议等作为附件。")])])]),e("li",null,[e("strong",null,"潜在的特殊情况"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"“供应商白名单”申请"),r("：新供应商可能会提交申请和资料，但这属于"),e("strong",null,"基础数据管理"),r("模块，而非询价流程本身。")]),e("li",null,[e("strong",null,"替代方案建议"),r("：供应商可能在报价时，建议一个功能相似的替代零件，但这需要经过严格的审批流程才会被纳入系统。")])])])],-1)),a[452]||(a[452]=e("h4",{id:"面试专业回答话术",tabindex:"-1"},[r("面试专业回答话术 "),e("a",{class:"header-anchor",href:"#面试专业回答话术","aria-label":'Permalink to "面试专业回答话术"'},"​")],-1)),a[453]||(a[453]=e("p",null,"你可以这样清晰地向面试官阐述：",-1)),a[454]||(a[454]=e("blockquote",null,[e("p",null,"“在这个系统中，数据来源是双向的，但角色和数据类型是严格区分的。"),e("p",null,[e("strong",null,"首先，询价的‘零部件主数据’是由我们东风日产内部产生和定义的。"),r(" 主要来自两个通道：")]),e("ol",null,[e("li",null,[e("strong",null,"系统对接"),r("：例如从 "),e("strong",null,"PDT车型管理系统"),r(" 通过接口自动同步过来，这是最主流、最规范的方式。")]),e("li",null,[e("strong",null,"内部导入"),r("：由我们的采购或工程师，通过我优化过的 "),e("strong",null,"Excel导入功能"),r("，将整理好的零件清单批量录入系统。")])]),e("p",null,[e("strong",null,"然后，供应商在这个流程中，扮演的是‘报价响应方’的角色。"),r(" 他们登录系统后，看到的是我们发布的、已定义好的零部件询价单，他们的核心操作是"),e("strong",null,"填写报价信息"),r("，而不是导入零件数据本身。这样保证了数据源的权威性和业务流程的规范性。”")])],-1)),a[455]||(a[455]=e("h4",{id:"为什么要这样设计-展现你的架构思维",tabindex:"-1"},[r("为什么要这样设计？（展现你的架构思维） "),e("a",{class:"header-anchor",href:"#为什么要这样设计-展现你的架构思维","aria-label":'Permalink to "为什么要这样设计？（展现你的架构思维）"'},"​")],-1)),a[456]||(a[456]=e("ul",null,[e("li",null,[e("strong",null,"数据主权与安全性"),r("：零部件基础数据是企业的核心资产，必须掌握在自己手中，防止供应商篡改或看到敏感信息。")]),e("li",null,[e("strong",null,"流程标准化"),r("：统一的零件数据是进行**“苹果对苹果”比价**的前提。如果每个供应商都按自己的理解报不同的零件，比价就无法进行。")]),e("li",null,[e("strong",null,"系统解耦"),r("：将数据定义（内部）与数据响应（供应商）分离，使得系统架构更清晰，易于维护和扩展。")])],-1)),a[457]||(a[457]=e("p",null,[r("这样回答，表明你不仅知道技术实现，更能从"),e("strong",null,"业务、流程和架构"),r("的角度理解一个系统的设计精髓。")],-1)),a[458]||(a[458]=e("hr",null,null,-1)),a[459]||(a[459]=e("h3",{id:"q-引入mq对系统的增强",tabindex:"-1"},[r("Q：引入MQ对系统的增强 "),e("a",{class:"header-anchor",href:"#q-引入mq对系统的增强","aria-label":'Permalink to "Q：引入MQ对系统的增强"'},"​")],-1)),a[460]||(a[460]=e("h4",{id:"没有引入mq之前的系统交互方式",tabindex:"-1"},[r("没有引入MQ之前的系统交互方式 "),e("a",{class:"header-anchor",href:"#没有引入mq之前的系统交互方式","aria-label":'Permalink to "没有引入MQ之前的系统交互方式"'},"​")],-1)),a[461]||(a[461]=e("p",null,[r("在没有引入消息队列(MQ)之前，系统间的交互主要是"),e("strong",null,"同步调用"),r("和"),e("strong",null,"定时任务轮询"),r("的结合。")],-1)),a[462]||(a[462]=e("p",null,[e("strong",null,"核心交互模式：")],-1)),a[463]||(a[463]=e("ol",null,[e("li",null,[e("p",null,[e("strong",null,"同步HTTP/RPC调用 (占主导)")]),e("ul",null,[e("li",null,[e("p",null,[e("strong",null,"场景"),r("：当上游系统（如PDT车型管理系统）有新的零部件数据需要发起询价流程时，会"),e("strong",null,"直接、同步地调用"),r("我们寻源系统的API接口。")])]),e("li",null,[e("p",null,[e("strong",null,"代码逻辑"),r(" 大致如下：")]),e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 在上游系统中")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ResponseEntity<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> response "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," restTemplate."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"postForEntity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'    "http://xunyuan-system/api/startInquiry"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    inquiryRequest, ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String.class")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 必须等待寻源系统的响应")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (response."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStatusCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"is2xxSuccessful"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 继续执行后续逻辑")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 处理失败，可能要进行重试或记录错误")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})])])])]),e("li",null,[e("p",null,[e("strong",null,"数据库轮询 (作为补充)")]),e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：对于一些非实时性的数据集成，比如老数据迁移(FDI集成)，可能会采用一个定时任务，定期去扫描上游系统的数据库表或某个文件目录，发现有新数据后再进行拉取和处理。")])])])],-1)),a[464]||(a[464]=e("p",null,[e("strong",null,"这种方式带来的核心痛点：")],-1)),a[465]||(a[465]=e("ul",null,[e("li",null,[e("strong",null,"系统紧耦合"),r("：上游系统的可用性直接影响了我们系统的可用性。如果我们系统因部署、故障或性能问题宕机，上游系统的调用会立即失败，导致业务流程中断。")]),e("li",null,[e("strong",null,"性能瓶颈与延迟"),r("：上游系统必须"),e("strong",null,"等待"),r("我们系统的全部处理完成（如数据校验、入库、初始化流程等）后才能得到响应。如果我们的处理较慢，会直接拖慢上游系统的响应时间。")]),e("li",null,[e("strong",null,"缺乏弹性与削峰能力"),r("：如果上游系统在某一时刻产生大量询价请求（例如新车发布），我们的系统必须能实时处理这些洪峰流量，否则可能导致服务雪崩。我们没有“缓冲地带”。")]),e("li",null,[e("strong",null,"流程驱动困难"),r("：对于“"),e("strong",null,"供应商报价超时自动关闭"),r("”这类需要"),e("strong",null,"延迟触发"),r("的业务场景，实现起来非常笨重。通常只能通过一个定时任务，频繁地扫描数据库表，检查每个询价单的创建时间来判断是否超时。这对数据库压力大，且不精确。")])],-1)),a[466]||(a[466]=e("hr",null,null,-1)),a[467]||(a[467]=e("h4",{id:"引入rabbitmq之后如何体现其强大作用",tabindex:"-1"},[r("引入RabbitMQ之后如何体现其强大作用 "),e("a",{class:"header-anchor",href:"#引入rabbitmq之后如何体现其强大作用","aria-label":'Permalink to "引入RabbitMQ之后如何体现其强大作用"'},"​")],-1)),a[468]||(a[468]=e("p",null,[r("引入MQ后，系统架构从"),e("strong",null,"紧耦合的同步模型"),r("转变为"),e("strong",null,"松耦合的异步事件驱动模型"),r("，其强大作用体现在以下几个方面：")],-1)),a[469]||(a[469]=e("p",null,[e("strong",null,"1. 解耦 (Decoupling) - 最核心的价值")],-1)),a[470]||(a[470]=e("ul",null,[e("li",null,[e("strong",null,"之前"),r("：上游系统需要知道寻源系统的确切网络地址和接口，并与之直接通信。")]),e("li",null,[e("strong",null,"之后"),r("：上游系统不再关心谁来处理这个请求，它只需要将一条消息（如 "),e("code",null,"InquiryCreatedEvent"),r("）发送到RabbitMQ的特定交换机。我们寻源系统作为消费者，只需要监听这个交换机的消息即可。"),e("strong",null,"即使寻源系统正在重启或暂时不可用，消息也会安全地存储在RabbitMQ中，不会丢失。"),r(" 系统间的依赖从“服务-服务”变成了“服务-消息队列-服务”。")])],-1)),a[471]||(a[471]=e("p",null,[e("strong",null,"2. 异步与削峰填谷 (Asynchrony & Buffering)")],-1)),a[472]||(a[472]=e("ul",null,[e("li",null,[e("strong",null,"之前"),r("：一个耗时2秒的询价创建流程，会阻塞上游系统2秒。")]),e("li",null,[e("strong",null,"之后"),r("：上游系统发送消息到MQ后，几乎可以立即返回成功响应，将实际的耗时处理抛在脑后。我们寻源系统可以按照自己的处理能力，从MQ中拉取消息并进行消费。"),e("strong",null,"突然到来的流量洪峰会被MQ这个“缓冲区”平滑掉"),r("，避免了系统被瞬间冲垮。")])],-1)),a[473]||(a[473]=e("p",null,[e("strong",null,"3. 增强业务能力与可靠性 (Enhanced Capabilities & Reliability)"),r(" 这正是你项目中 "),e("strong",null,"“供应商报价超时自动关闭”"),r(" 功能的完美体现。")],-1)),a[474]||(a[474]=e("ul",null,[e("li",null,[e("strong",null,"之前"),r("：依赖低效的数据库轮询，难以实现。")]),e("li",null,[e("strong",null,"之后"),r("： "),e("ul",null,[e("li",null,"当创建一个询价单时，系统会同步发送一条消息到RabbitMQ。"),e("li",null,[r("这条消息"),e("strong",null,"不设置消费者"),r("，并配置一个"),e("strong",null,"TTL（生存时间）"),r("，比如48小时（报价窗口期）。")]),e("li",null,[r("48小时后，消息因过期变成"),e("strong",null,"死信"),r("，会自动被路由到另一个队列——"),e("strong",null,"死信队列"),r("。")]),e("li",null,[r("此时，我们有一个专门的消费者监听这个"),e("strong",null,"死信队列"),r("，一旦收到消息（即说明有询价单超时了），就自动执行关闭逻辑。")]),e("li",null,[e("strong",null,"这种方式精准、高效、对数据库无压力，是MQ在解决复杂业务场景上的典范应用。")])])])],-1)),a[475]||(a[475]=e("p",null,[e("strong",null,"4. 最终一致性 (Eventual Consistency)"),r(" 在与下游系统集成时，也可以通过MQ来保证最终一致性。例如，当设定“最优供应商”后，可以通过发布一个 "),e("code",null,"SupplierSelectedEvent"),r(" 事件，让物流管理系统、PDT系统等各自订阅并更新自己的状态，而不是通过脆弱的同步调用链。")],-1)),a[476]||(a[476]=e("p",null,[e("strong",null,"面试回答话术建议")],-1)),a[477]||(a[477]=e("p",null,"你可以这样组织语言：",-1)),a[478]||(a[478]=e("blockquote",null,[e("p",null,[r("“在引入RabbitMQ之前，系统间主要通过"),e("strong",null,"同步HTTP调用"),r("进行交互。这导致系统间"),e("strong",null,"耦合紧密"),r("，上游系统的稳定性直接制约着我们，并且缺乏对突发流量的"),e("strong",null,"削峰能力"),r("。")]),e("p",null,[r("引入MQ后，我们实现了"),e("strong",null,"架构上的解耦和异步化"),r("。最典型的例子就是我们用 "),e("strong",null,[e("code",null,"延时队列+死信队列")]),r(" 完美地实现了"),e("code",null,"供应商报价超时自动关闭"),r("功能。这个功能在之前需要通过"),e("strong",null,"低效的数据库轮询"),r("来实现，而现在由MQ内部机制自动触发，"),e("strong",null,"精准、高效且不增加数据库压力"),r("。")]),e("p",null,[r("总的来说，MQ的引入让我们的系统从脆弱的"),e("code",null,"请求-响应"),r("模型，进化成了更具"),e("strong",null,[r("弹性、可扩展性和可靠性的"),e("code",null,"事件驱动"),r("架构")]),r("。")])],-1)),a[479]||(a[479]=e("p",null,"这样回答，既清晰地对比了前后差异，又通过一个具体、有亮点的案例（延时队列）证明了你的技术深度和MQ的实际价值。",-1)),a[480]||(a[480]=e("hr",null,null,-1)),a[481]||(a[481]=e("h2",{id:"面经二-中软-招银云创",tabindex:"-1"},[e("strong",null,"面经二"),r("：中软 - 招银云创 "),e("a",{class:"header-anchor",href:"#面经二-中软-招银云创","aria-label":'Permalink to "**面经二**：中软 - 招银云创"'},"​")],-1)),a[482]||(a[482]=e("hr",null,null,-1)),a[483]||(a[483]=e("h3",{id:"q-分布式cap原理",tabindex:"-1"},[r("Q：分布式CAP原理 "),e("a",{class:"header-anchor",href:"#q-分布式cap原理","aria-label":'Permalink to "Q：分布式CAP原理"'},"​")],-1)),a[484]||(a[484]=e("h4",{id:"_1-cap原理是什么",tabindex:"-1"},[r("1. CAP原理是什么？ "),e("a",{class:"header-anchor",href:"#_1-cap原理是什么","aria-label":'Permalink to "1. CAP原理是什么？"'},"​")],-1)),a[485]||(a[485]=e("p",null,[r("CAP原理，也常被称为CAP定理，它指出对于一个"),e("strong",null,"分布式计算系统"),r("来说，不可能同时完全满足以下三个核心特性：")],-1)),a[486]||(a[486]=e("ul",null,[e("li",null,[e("strong",null,"C：一致性")]),e("li",null,[e("strong",null,"A：可用性")]),e("li",null,[e("strong",null,"P：分区容错性")])],-1)),a[487]||(a[487]=e("p",null,[r("该定理表明，在分布式系统中，"),e("strong",null,"当网络发生分区时，我们必须在一致性和可用性之间做出权衡，无法二者兼得。")],-1)),a[488]||(a[488]=e("p",null,[r("理解CAP的关键在于认识到它是一个“三选二”的"),e("strong",null,"权衡"),r("，而不是一个“三选二”的"),e("strong",null,"完美方案"),r("。由于分区是分布式系统中无法避免的现实，P 实际上是我们必须选择的。因此，真正的选择是在 C 和 A 之间。")],-1)),a[489]||(a[489]=e("hr",null,null,-1)),a[490]||(a[490]=e("h4",{id:"_2-深入理解三个核心概念",tabindex:"-1"},[r("2. 深入理解三个核心概念 "),e("a",{class:"header-anchor",href:"#_2-深入理解三个核心概念","aria-label":'Permalink to "2. 深入理解三个核心概念"'},"​")],-1)),a[491]||(a[491]=e("h5",{id:"c-一致性",tabindex:"-1"},[e("strong",null,"C：一致性"),r(),e("a",{class:"header-anchor",href:"#c-一致性","aria-label":'Permalink to "**C：一致性**"'},"​")],-1)),a[492]||(a[492]=e("p",null,[r("这里的“一致性”指的是 "),e("strong",null,"线性一致性"),r(" 或 "),e("strong",null,"强一致性"),r("。它意味着，在任何一次数据读取操作中，系统都应该返回"),e("strong",null,"最近一次成功写入的数据"),r("。")],-1)),a[493]||(a[493]=e("ul",null,[e("li",null,[e("strong",null,"通俗解释"),r("：对于所有连接到系统的客户端（无论连接到哪个节点），只要看到某个数据被更新了，那么之后的所有读操作，要么看到的是更新后的值，要么读取失败。系统表现得“好像”只有一个数据副本。")]),e("li",null,[e("strong",null,"例子"),r("：你在一台机器上更新了某个值为 "),e("code",null,"100"),r("，那么之后从任何其他机器上读取这个值，都必须是 "),e("code",null,"100"),r("。系统不会让你读到旧的 "),e("code",null,"50"),r("。")])],-1)),a[494]||(a[494]=e("h5",{id:"a-可用性",tabindex:"-1"},[e("strong",null,"A：可用性"),r(),e("a",{class:"header-anchor",href:"#a-可用性","aria-label":'Permalink to "**A：可用性**"'},"​")],-1)),a[495]||(a[495]=e("p",null,[r("可用性指的是，"),e("strong",null,"系统的每一个非故障节点，对于每一个请求（无论读写）都必须给出一个非错误的响应"),r("（但不能保证响应中包含的数据是最新的）。")],-1)),a[496]||(a[496]=e("ul",null,[e("li",null,[e("strong",null,"通俗解释"),r("：只要系统节点没宕机，它就"),e("strong",null,"必须"),r("响应客户端的请求，不能超时也不能报错。但响应的数据可能是旧的。")]),e("li",null,[e("strong",null,"例子"),r("：即使发生了网络分区，导致某个节点无法与其他节点同步数据，它仍然需要处理客户端的读请求。它可能会返回自己本地的旧数据，但绝不会不响应。")])],-1)),a[497]||(a[497]=e("h5",{id:"p-分区容错性",tabindex:"-1"},[e("strong",null,"P：分区容错性"),r(),e("a",{class:"header-anchor",href:"#p-分区容错性","aria-label":'Permalink to "**P：分区容错性**"'},"​")],-1)),a[498]||(a[498]=e("p",null,[r("分区容错性指的是，"),e("strong",null,"系统在遇到网络分区（即节点之间无法正常通信）的情况下，仍然能够继续对外提供服务"),r("。")],-1)),a[499]||(a[499]=e("ul",null,[e("li",null,[e("strong",null,"通俗解释"),r("：网络不是100%可靠的，节点之间的网络可能会中断（比如光缆被挖断、交换机故障）。分布式系统必须能够容忍这种情况，部分节点组成的子网络依然可以独立运行，而不是整个系统崩溃。")]),e("li",null,[e("strong",null,"例子"),r("：一个分布式系统由北京和上海的两个机房组成。如果它们之间的网络光缆断了，形成了两个无法通信的分区，系统设计上需要能处理这种情况。")])],-1)),a[500]||(a[500]=e("hr",null,null,-1)),a[501]||(a[501]=e("h4",{id:"_3-为什么不能同时满足-——-cap的三种场景",tabindex:"-1"},[r("3. 为什么不能同时满足？—— CAP的三种场景 "),e("a",{class:"header-anchor",href:"#_3-为什么不能同时满足-——-cap的三种场景","aria-label":'Permalink to "3. 为什么不能同时满足？—— CAP的三种场景"'},"​")],-1)),a[502]||(a[502]=e("p",null,"我们通过一个经典的例子来解释：一个由两个节点（Node A, Node B）组成的分布式数据库，它们之间通过网络同步数据。",-1)),a[503]||(a[503]=e("h5",{id:"场景一-满足-ca-放弃-p",tabindex:"-1"},[e("strong",null,"场景一：满足 CA（放弃 P）"),r(),e("a",{class:"header-anchor",href:"#场景一-满足-ca-放弃-p","aria-label":'Permalink to "**场景一：满足 CA（放弃 P）**"'},"​")],-1)),a[504]||(a[504]=e("ul",null,[e("li",null,[e("strong",null,"选择"),r("：保证一致性和可用性，放弃分区容错性。")]),e("li",null,[e("strong",null,"如何实现"),r("：系统设计成当节点间无法通信（即发生分区）时，整个系统停止服务（不可用）。")]),e("li",null,[e("strong",null,"结果"),r("：当网络正常时，系统是强一致且可用的。一旦网络发生分区，系统为了保持一致性（因为无法同步数据），只能选择不服务，从而牺牲了可用性。这实际上"),e("strong",null,"不是一个真正的分布式系统"),r("，因为它无法容忍网络故障。典型的单点数据库集群（如主从模式的MySQL，在主从断连时，主库可能被设置为只读或下线）在某些配置下接近这种模式，但严格来说，它们无法完全放弃P。")])],-1)),a[505]||(a[505]=e("h5",{id:"场景二-满足-cp-放弃-a",tabindex:"-1"},[e("strong",null,"场景二：满足 CP（放弃 A）"),r(),e("a",{class:"header-anchor",href:"#场景二-满足-cp-放弃-a","aria-label":'Permalink to "**场景二：满足 CP（放弃 A）**"'},"​")],-1)),a[506]||(a[506]=e("ul",null,[e("li",null,[e("strong",null,"选择"),r("：保证一致性和分区容错性，放弃可用性。")]),e("li",null,[e("strong",null,"如何实现"),r("：当网络分区发生时，系统会锁定受影响的分区，阻止对其的读写操作，以确保数据不会出现不一致。只有那些能与其他大多数节点通信的分区可以继续工作。")]),e("li",null,[e("strong",null,"结果"),r("：系统保证了数据的强一致性，但牺牲了部分节点的可用性。客户端连接到被锁定的分区时，会收到错误或超时。")]),e("li",null,[e("strong",null,"典型系统"),r("："),e("strong",null,"ZooKeeper"),r(", "),e("strong",null,"etcd"),r(", "),e("strong",null,"HBase"),r(", "),e("strong",null,"MongoDB"),r("（使用强一致性配置时）。在选举Leader或网络不稳定时，这些系统可能会短暂不可用。")])],-1)),a[507]||(a[507]=e("h5",{id:"场景三-满足-ap-放弃-c",tabindex:"-1"},[e("strong",null,"场景三：满足 AP（放弃 C）"),r(),e("a",{class:"header-anchor",href:"#场景三-满足-ap-放弃-c","aria-label":'Permalink to "**场景三：满足 AP（放弃 C）**"'},"​")],-1)),a[508]||(a[508]=e("ul",null,[e("li",null,[e("strong",null,"选择"),r("：保证可用性和分区容错性，放弃强一致性。")]),e("li",null,[e("strong",null,"如何实现"),r("：当网络分区发生时，所有节点仍然可以处理读写请求。但这可能导致数据在不同节点上出现不一致（即“最终一致性”）。")]),e("li",null,[e("strong",null,"结果"),r("：系统始终保持高可用，但读取的数据可能不是最新的。当网络分区恢复后，系统会通过一些机制（如冲突解决）来逐步达成一致性。")]),e("li",null,[e("strong",null,"典型系统"),r("："),e("strong",null,"Cassandra"),r(", "),e("strong",null,"DynamoDB"),r(", "),e("strong",null,"Riak"),r(", "),e("strong",null,"Eureka"),r("。这些系统在设计上优先保证可用性。")])],-1)),a[509]||(a[509]=e("hr",null,null,-1)),a[510]||(a[510]=e("h4",{id:"_4-对cap的常见误解与澄清",tabindex:"-1"},[r("4. 对CAP的常见误解与澄清 "),e("a",{class:"header-anchor",href:"#_4-对cap的常见误解与澄清","aria-label":'Permalink to "4. 对CAP的常见误解与澄清"'},"​")],-1)),a[511]||(a[511]=e("ol",null,[e("li",null,[e("strong",null,"误解一：CAP是“三选二”，可以任意选择。"),e("ul",null,[e("li",null,[e("strong",null,"澄清"),r("：P是分布式系统的固有属性，你无法选择“放弃P”，因为网络故障必然会发生。因此，"),e("strong",null,"真实的选择是在发生P时，是选择C还是选择A"),r("。在系统没有发生分区时，是可以同时实现CA的。")])])]),e("li",null,[e("strong",null,"误解二：一个系统在整个生命周期中只能是CP或AP。"),e("ul",null,[e("li",null,[e("strong",null,"澄清"),r("：CAP是针对"),e("strong",null,"同一个数据对象"),r("的权衡。一个复杂的系统可以为"),e("strong",null,"不同的数据模型"),r("或"),e("strong",null,"不同的操作"),r("选择不同的策略。例如，一个系统可以对其核心用户数据采用CP策略，而对用户的会话数据采用AP策略。")])])]),e("li",null,[e("strong",null,"误解三：放弃C意味着数据永远混乱。"),e("ul",null,[e("li",null,[e("strong",null,"澄清"),r("：放弃C通常是指放弃"),e("strong",null,"强一致性"),r("，转而采用"),e("strong",null,"最终一致性"),r("。系统会保证在未来的某个时间点（在没有新写入的情况下），所有副本的数据会变得一致。这期间会存在一个“不一致窗口”。")])])])],-1)),a[512]||(a[512]=e("hr",null,null,-1)),a[513]||(a[513]=e("h4",{id:"_5-cap在现代系统设计中的应用与延伸",tabindex:"-1"},[r("5. CAP在现代系统设计中的应用与延伸 "),e("a",{class:"header-anchor",href:"#_5-cap在现代系统设计中的应用与延伸","aria-label":'Permalink to "5. CAP在现代系统设计中的应用与延伸"'},"​")],-1)),a[514]||(a[514]=e("h5",{id:"base理论",tabindex:"-1"},[e("strong",null,"BASE理论"),r(),e("a",{class:"header-anchor",href:"#base理论","aria-label":'Permalink to "**BASE理论**"'},"​")],-1)),a[515]||(a[515]=e("p",null,"为了弥补CAP中放弃强一致性带来的问题，eBay的架构师提出了BASE理论，它是对AP系统的一种实践性描述：",-1)),a[516]||(a[516]=e("ul",null,[e("li",null,[e("strong",null,"Basically Available（基本可用）"),r("：系统在出现不可预知故障时，允许损失部分可用性（如响应时间变长、部分功能降级）。")]),e("li",null,[e("strong",null,"Soft state（软状态）"),r("：允许系统中的数据存在中间状态，并认为该状态不会影响系统的整体可用性（即各节点间的数据复制存在延迟）。")]),e("li",null,[e("strong",null,"Eventually consistent（最终一致性）"),r("：经过一段时间后，所有数据副本最终会达到一致的状态。")])],-1)),a[517]||(a[517]=e("p",null,"BASE理论是构建高可用、可扩展互联网系统的指导思想，它通过牺牲强一致性来换取系统的灵活性和性能。",-1)),a[518]||(a[518]=e("h5",{id:"现实世界中的权衡",tabindex:"-1"},[e("strong",null,"现实世界中的权衡"),r(),e("a",{class:"header-anchor",href:"#现实世界中的权衡","aria-label":'Permalink to "**现实世界中的权衡**"'},"​")],-1)),a[519]||(a[519]=e("p",null,"现代分布式数据库和中间件提供了灵活的配置，让开发者可以根据业务场景决定CAP的权衡。",-1)),a[520]||(a[520]=e("ul",null,[e("li",null,[e("strong",null,"银行账户、库存系统"),r("：对一致性要求极高，通常选择"),e("strong",null,"CP"),r("。")]),e("li",null,[e("strong",null,"社交媒体点赞、用户会话"),r("：对可用性要求更高，可以接受短暂不一致，通常选择"),e("strong",null,"AP"),r("。")]),e("li",null,[e("strong",null,"服务发现"),r("：在微服务架构中，服务发现组件（如Eureka选择AP，Consul选择CP）的不同选择直接影响了系统的行为。")])],-1)),a[521]||(a[521]=e("h4",{id:"总结-2",tabindex:"-1"},[r("总结 "),e("a",{class:"header-anchor",href:"#总结-2","aria-label":'Permalink to "总结"'},"​")],-1)),a[522]||(a[522]=e("p",null,"CAP原理是一个揭示分布式系统内在本质的简洁而深刻的模型。它告诉我们：",-1)),a[523]||(a[523]=e("ul",null,[e("li",null,[e("strong",null,"分区是必然发生的"),r("，设计系统时必须考虑。")]),e("li",null,[r("在分区发生时，"),e("strong",null,"你无法同时保证强一致性和高可用性"),r("，必须做出选择。")]),e("li",null,[r("这个选择没有对错，完全取决于你的"),e("strong",null,"业务需求"),r("。")]),e("li",null,[e("strong",null,"理解CAP，不是为了背诵理论，而是为了在系统设计时做出明智的权衡。"),r(" 当你设计一个功能时，问问自己：“如果现在网络断了，这个功能是应该报错（CP）还是继续用可能旧的数据提供服务（AP）？” 这个问题的答案，就是CAP原理在你系统中的具体体现。")])],-1)),a[524]||(a[524]=e("hr",null,null,-1)),a[525]||(a[525]=e("h3",{id:"q-项目如何体现分布式系统",tabindex:"-1"},[r("Q：项目如何体现分布式系统 "),e("a",{class:"header-anchor",href:"#q-项目如何体现分布式系统","aria-label":'Permalink to "Q：项目如何体现分布式系统"'},"​")],-1)),a[526]||(a[526]=e("h4",{id:"维度一-架构层面-微服务拆分与服务治理",tabindex:"-1"},[r("维度一：架构层面 - 微服务拆分与服务治理 "),e("a",{class:"header-anchor",href:"#维度一-架构层面-微服务拆分与服务治理","aria-label":'Permalink to "维度一：架构层面 - 微服务拆分与服务治理"'},"​")],-1)),a[527]||(a[527]=e("p",null,[e("strong",null,"采购公共服务系统（明确的微服务架构）")],-1)),a[528]||(a[528]=e("ul",null,[e("li",null,[e("strong",null,"服务拆分"),r("：将庞大的ERP系统按业务域拆分为"),e("strong",null,"供应商服务、权限服务、评估服务、白名单服务"),r("等独立的微服务。")]),e("li",null,[e("strong",null,"服务注册与发现"),r("：使用 "),e("strong",null,"Nacos"),r(" 作为注册中心，各个微服务启动时向Nacos注册自己的网络地址，消费者通过服务名而非具体的IP地址来调用服务。")]),e("li",null,[e("strong",null,"配置集中管理"),r("：使用 "),e("strong",null,"Nacos"),r(" 作为配置中心，所有微服务的配置（如数据库连接、缓存地址、开关配置）集中管理，实现"),e("strong",null,"配置与代码分离"),r("和"),e("strong",null,"动态刷新"),r("。")])],-1)),a[529]||(a[529]=e("p",null,[e("strong",null,"零部件询报价寻源系统（内聚的微服务或分布式模块）")],-1)),a[530]||(a[530]=e("ul",null,[e("li",null,[e("strong",null,"系统边界清晰"),r("：虽然项目描述未明确说微服务，但其作为独立系统，与 "),e("strong",null,"PDT系统、物流系统"),r(" 等形成"),e("strong",null,"系统间的分布式架构"),r("。")]),e("li",null,[e("strong",null,"API网关模式"),r("：对外提供统一的RESTful API，下游系统通过HTTP调用，体现了"),e("strong",null,"面向服务的架构"),r("思想。")])],-1)),a[531]||(a[531]=e("p",null,"似乎出了点问题",-1)),a[532]||(a[532]=e("hr",null,null,-1)),a[533]||(a[533]=e("h4",{id:"维度二-数据层面-数据分布与一致性",tabindex:"-1"},[r("维度二：数据层面 - 数据分布与一致性 "),e("a",{class:"header-anchor",href:"#维度二-数据层面-数据分布与一致性","aria-label":'Permalink to "维度二：数据层面 - 数据分布与一致性"'},"​")],-1)),a[534]||(a[534]=e("p",null,[e("strong",null,"分布式缓存（两个项目都用到了Redis）")],-1)),a[535]||(a[535]=e("ul",null,[e("li",null,[e("strong",null,"共享会话"),r("：用户登录后，会话信息存储在Redis中，这样无论用户的请求被负载均衡到哪台应用服务器，都能识别其身份。"),e("strong",null,"解决了HTTP无状态协议在分布式集群下的状态保持问题"),r("。")]),e("li",null,[e("strong",null,"共享数据"),r("：热点数据（如供应商信息、零件分类、配置信息）缓存在Redis中，所有服务实例共享同一份数据视图，"),e("strong",null,"避免每个实例都去查询数据库，保证数据的一致性"),r("和"),e("strong",null,"减轻数据库压力"),r("。")])],-1)),a[536]||(a[536]=e("p",null,[e("strong",null,"分布式数据源")],-1)),a[537]||(a[537]=e("ul",null,[e("li",null,[e("strong",null,"读写分离与分库分表"),r('：你提到的"数据量特别大的表采用分库分表，读写分离的设计"，这是'),e("strong",null,"数据层分布式的核心体现"),r("。数据被水平拆分到不同的数据库实例中，应用需要通过中间件或框架来路由数据访问。")])],-1)),a[538]||(a[538]=e("p",null,[e("strong",null,"最终一致性（通过消息队列实现）")],-1)),a[539]||(a[539]=e("ul",null,[e("li",null,[e("strong",null,"采购系统"),r("：供应商状态变更后，通过MQ发送事件消息，让其他关心此状态的服务（如评估服务、白名单服务）异步更新自己的数据，实现"),e("strong",null,"数据的最终一致性"),r("，而不是强一致的分布式事务。")])],-1)),a[540]||(a[540]=e("hr",null,null,-1)),a[541]||(a[541]=e("h4",{id:"维度三-通信层面-服务间通信模式",tabindex:"-1"},[r("维度三：通信层面 - 服务间通信模式 "),e("a",{class:"header-anchor",href:"#维度三-通信层面-服务间通信模式","aria-label":'Permalink to "维度三：通信层面 - 服务间通信模式"'},"​")],-1)),a[542]||(a[542]=e("p",null,[e("strong",null,"同步通信（直接调用）")],-1)),a[543]||(a[543]=e("ul",null,[e("li",null,[e("strong",null,"RESTful HTTP"),r("：零部件系统调用PDT系统的接口获取零件数据，这是典型的"),e("strong",null,"同步跨系统调用"),r("。")]),e("li",null,[e("strong",null,"Feign/RestTemplate"),r("：在采购微服务架构内部，服务A通过HTTP客户端（如OpenFeign）调用服务B的接口。")])],-1)),a[544]||(a[544]=e("p",null,[e("strong",null,"异步通信（消息驱动）")],-1)),a[545]||(a[545]=e("ul",null,[e("li",null,[e("strong",null,"RabbitMQ的应用"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"零部件系统"),r("：用"),e("strong",null,"延时队列+死信队列"),r("实现报价超时自动关闭。这是一个经典的"),e("strong",null,"基于事件的异步处理"),r("模式，将时间触发的逻辑从业务代码中解耦出来。")]),e("li",null,[e("strong",null,"采购系统"),r("：服务间通过发布/订阅消息来通知业务事件的发生，实现"),e("strong",null,"服务解耦"),r("。一个服务完成工作后，不必知道也不关心有多少个其他服务需要感知这个事件。")])])])],-1)),a[546]||(a[546]=e("hr",null,null,-1)),a[547]||(a[547]=e("h4",{id:"维度四-容错与弹性层面",tabindex:"-1"},[r("维度四：容错与弹性层面 "),e("a",{class:"header-anchor",href:"#维度四-容错与弹性层面","aria-label":'Permalink to "维度四：容错与弹性层面"'},"​")],-1)),a[548]||(a[548]=e("p",null,[e("strong",null,"服务降级与熔断")],-1)),a[549]||(a[549]=e("ul",null,[e("li",null,[r("当零部件系统调用PDT系统接口时，如果PDT系统响应缓慢或不可用，可以通过"),e("strong",null,"熔断器（如Hystrix或Sentinel）"),r(" 快速失败，避免线程被长时间占用，导致自身系统也被拖垮。并可以返回"),e("strong",null,"降级数据"),r("（如默认配置或缓存中的旧数据），保证核心流程的可用性。")])],-1)),a[550]||(a[550]=e("p",null,[e("strong",null,"负载均衡")],-1)),a[551]||(a[551]=e("ul",null,[e("li",null,[r("在微服务架构中，一个服务通常有多个实例。服务消费者（如Spring Cloud LoadBalancer）会从Nacos获取所有健康的实例列表，并通过"),e("strong",null,"负载均衡算法"),r("（如轮询、随机）选择一个实例进行调用，从而实现"),e("strong",null,"流量分发"),r("和"),e("strong",null,"高可用"),r("。")])],-1)),a[552]||(a[552]=e("hr",null,null,-1)),a[553]||(a[553]=e("h4",{id:"面试专业回答话术-1",tabindex:"-1"},[r("面试专业回答话术 "),e("a",{class:"header-anchor",href:"#面试专业回答话术-1","aria-label":'Permalink to "面试专业回答话术"'},"​")],-1)),a[554]||(a[554]=e("p",null,"你可以这样综合阐述：",-1)),a[555]||(a[555]=e("blockquote",null,[e("p",null,'"这两个项目从不同维度完整地体现了分布式系统的核心思想。'),e("p",null,[e("strong",null,"首先，在架构上"),r("，采购系统是典型的"),e("strong",null,"微服务架构"),r("，通过Nacos实现了服务的注册发现和配置集中管理；而零部件系统则体现了"),e("strong",null,"系统间的分布式"),r("，通过与PDT、物流等外部系统对接，形成了更大的分布式生态。")]),e("p",null,[e("strong",null,"其次，在数据层"),r("，我们都使用了"),e("strong",null,"Redis作为分布式缓存"),r("来解决会话共享和热点数据问题，并且在大数据场景下采用了"),e("strong",null,"分库分表和读写分离"),r("，这是数据分布式的直接体现。")]),e("p",null,[e("strong",null,"最关键的是在通信模式上"),r("，我们混合使用了"),e("strong",null,"同步的HTTP调用"),r("和"),e("strong",null,"异步的消息驱动"),r("。特别是用RabbitMQ实现的’报价超时自动关闭’功能，完美展现了如何通过消息队列来实现系统解耦和基于事件的最终一致性。")]),e("p",null,[e("strong",null,"最后，在容错方面"),r("，我们通过熔断、降级、负载均衡等机制，来保证在部分依赖不可用时，整个分布式系统依然能保持弹性和可用性。")]),e("p",null,'可以说，从服务治理、数据分布、通信模式到故障处理，这两个项目覆盖了构建一个成熟分布式系统所需要考虑的核心方面。"')],-1)),a[556]||(a[556]=e("p",null,[r("这样的回答，展现了你对分布式系统"),e("strong",null,"全局的、深度的理解"),r("，而不仅仅是停留在技术组件的简单使用上，能够给面试官留下深刻的印象。")],-1)),a[557]||(a[557]=e("hr",null,null,-1)),a[558]||(a[558]=e("h3",{id:"q-oom-与内存溢出区别",tabindex:"-1"},[r("Q：OOM 与内存溢出区别 "),e("a",{class:"header-anchor",href:"#q-oom-与内存溢出区别","aria-label":'Permalink to "Q：OOM 与内存溢出区别"'},"​")],-1)),a[559]||(a[559]=e("p",null,[r("简单来说，它们的关系是："),e("strong",null,"OOM是一个广泛的概念，而Java内存溢出是OOM在Java平台上的具体体现和细分。")],-1)),a[560]||(a[560]=e("h4",{id:"_1-oom-广义的系统级概念",tabindex:"-1"},[r("1. OOM - 广义的系统级概念 "),e("a",{class:"header-anchor",href:"#_1-oom-广义的系统级概念","aria-label":'Permalink to "1. OOM - 广义的系统级概念"'},"​")],-1)),a[561]||(a[561]=e("p",null,[e("strong",null,"OOM"),r(" 是 "),e("strong",null,"Out Of Memory"),r(" 的缩写，意为“内存耗尽”。这是一个通用术语，适用于任何计算环境（操作系统、应用程序、编程语言等）。")],-1)),a[562]||(a[562]=e("ul",null,[e("li",null,[e("strong",null,"范围："),r(" 整个系统或单个进程。")]),e("li",null,[e("strong",null,"根本原因："),r(" 程序或系统申请的内存总量，超过了物理内存（RAM）和交换空间（Swap）所能提供的最大容量。")]),e("li",null,[e("strong",null,"触发者："),r(" 通常是操作系统内核的内存管理子系统。")]),e("li",null,[e("strong",null,"结果："),e("ul",null,[e("li",null,[r("在类Linux系统中，内核的 "),e("strong",null,"OOM Killer"),r(" 进程会被触发。它会根据一套复杂的算法（参考 "),e("code",null,"oom_score"),r("）选择一个或多个“罪魁祸首”进程并将其强制杀死，从而释放内存，保全系统的稳定性。")]),e("li",null,"在Windows等系统中，可能会看到“系统资源不足”的提示，或者应用程序被直接终止。")])])],-1)),a[563]||(a[563]=e("p",null,[e("strong",null,"例子："),r(" 你同时打开了浏览器（很多标签页）、IDE、虚拟机、数据库，这些程序占用的总内存超过了你的8GB物理内存+8GB交换空间。此时，Linux系统可能会选择杀死你的MySQL进程，并报告一个OOM错误。")],-1)),a[564]||(a[564]=e("hr",null,null,-1)),a[565]||(a[565]=e("h4",{id:"_2-java内存溢出-具体的jvm平台概念",tabindex:"-1"},[r("2. Java内存溢出 - 具体的JVM平台概念 "),e("a",{class:"header-anchor",href:"#_2-java内存溢出-具体的jvm平台概念","aria-label":'Permalink to "2. Java内存溢出 - 具体的JVM平台概念"'},"​")],-1)),a[566]||(a[566]=e("p",null,[e("strong",null,"Java内存溢出"),r(" 特指在Java虚拟机中发生的内存耗尽情况。它发生在JVM这个“沙箱”内部。")],-1)),a[567]||(a[567]=e("ul",null,[e("li",null,[e("strong",null,"范围："),r(" JVM进程内部。")]),e("li",null,[e("strong",null,"根本原因："),r(" Java应用程序申请的内存，超过了 "),e("strong",null,"JVM内存模型（运行时数据区）"),r(" 中某个特定区域（如堆、元空间等）的最大容量。")]),e("li",null,[e("strong",null,"触发者："),r(" JVM自身。")]),e("li",null,[e("strong",null,"结果："),r(" JVM会抛出 "),e("code",null,"java.lang.OutOfMemoryError"),r(" 这个错误（注意，是 "),e("code",null,"Error"),r("，不是 "),e("code",null,"Exception"),r("），并通常会附带一个详细的错误信息来说明是哪个区域溢出了。"),e("strong",null,"JVM进程本身可能还在运行"),r("，但抛出错误的那个线程通常会终止。")])],-1)),a[568]||(a[568]=e("h5",{id:"java内存溢出的细分类型-非常重要",tabindex:"-1"},[r("Java内存溢出的细分类型（非常重要） "),e("a",{class:"header-anchor",href:"#java内存溢出的细分类型-非常重要","aria-label":'Permalink to "Java内存溢出的细分类型（非常重要）"'},"​")],-1)),a[569]||(a[569]=e("p",null,[r("由于JVM内存模型划分了不同的区域，所以 "),e("code",null,"OutOfMemoryError"),r(" 也有不同的类型，这有助于我们精准定位问题：")],-1)),a[570]||(a[570]=e("ol",null,[e("li",null,[e("strong",null,[e("code",null,"Java heap space"),r(" （堆空间溢出）")]),e("ul",null,[e("li",null,[e("strong",null,"原因："),r(" 这是最常见的OOM。对象实例主要在堆上分配。当创建了大量对象，并且有无法被垃圾回收的引用（即"),e("strong",null,"内存泄漏"),r("）时，就会发生堆溢出。")]),e("li",null,[e("strong",null,"错误信息："),r(),e("code",null,"java.lang.OutOfMemoryError: Java heap space")]),e("li",null,[e("strong",null,"典型场景："),r(" 内存泄漏、过大的集合类缓存、加载了大量数据到内存等。")])])]),e("li",null,[e("strong",null,[e("code",null,"GC overhead limit exceeded"),r(" （GC开销超出限制）")]),e("ul",null,[e("li",null,[e("strong",null,"原因："),r(" JVM花费了太多时间（默认超过98%）在进行垃圾回收，但每次回收的效果极差（默认回收不到2%的堆空间）。这本质上是堆空间问题的另一种表现，意味着堆快被“撑满”了，GC在徒劳地工作。")]),e("li",null,[e("strong",null,"错误信息："),r(),e("code",null,"java.lang.OutOfMemoryError: GC overhead limit exceeded")])])]),e("li",null,[e("strong",null,[e("code",null,"Metaspace"),r(" （元空间溢出）")]),e("ul",null,[e("li",null,[e("strong",null,"原因："),r(" 加载的类太多（如大量使用动态代理、反射、JSP），或类加载器泄漏，导致存储类元数据的元空间（Java 8+，取代了永久代）被占满。")]),e("li",null,[e("strong",null,"错误信息："),r(),e("code",null,"java.lang.OutOfMemoryError: Metaspace")])])]),e("li",null,[e("strong",null,[e("code",null,"Unable to create new native thread"),r(" （无法创建本地线程）")]),e("ul",null,[e("li",null,[e("strong",null,"原因："),r(" 这严格来说不是JVM内存模型的溢出，而是操作系统资源限制。JVM为每个线程分配栈内存（通常是操作系统本地内存，而非JVM堆）。创建了太多线程，耗尽了进程的地址空间或系统线程资源。")]),e("li",null,[e("strong",null,"错误信息："),r(),e("code",null,"java.lang.OutOfMemoryError: unable to create new native thread")])])]),e("li",null,[e("strong",null,[e("code",null,"Requested array size exceeds VM limit"),r(" （请求的数组大小超过VM限制）")]),e("ul",null,[e("li",null,[e("strong",null,"原因："),r(" 应用程序尝试分配一个大于堆大小的数组（例如，在32位JVM上尝试分配1GB的数组）。")]),e("li",null,[e("strong",null,"错误信息："),r(),e("code",null,"java.lang.OutOfMemoryError: Requested array size exceeds VM limit")])])])],-1)),a[571]||(a[571]=e("hr",null,null,-1)),a[572]||(a[572]=e("h4",{id:"核心区别对比表",tabindex:"-1"},[r("核心区别对比表 "),e("a",{class:"header-anchor",href:"#核心区别对比表","aria-label":'Permalink to "核心区别对比表"'},"​")],-1)),a[573]||(a[573]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"特性"),e("th",{style:{"text-align":"left"}},"OOM （广义）"),e("th",{style:{"text-align":"left"}},"Java内存溢出 （具体）")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"范围")]),e("td",{style:{"text-align":"left"}},"整个操作系统或任意进程"),e("td",{style:{"text-align":"left"}},"JVM进程内部")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"触发机制")]),e("td",{style:{"text-align":"left"}},"操作系统内核（如OOM Killer）"),e("td",{style:{"text-align":"left"}},"JVM自身")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"表现形式")]),e("td",{style:{"text-align":"left"}},"进程被强制杀死、系统卡顿"),e("td",{style:{"text-align":"left"}},[r("抛出 "),e("code",null,"OutOfMemoryError"),r(" 错误")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"错误信息")]),e("td",{style:{"text-align":"left"}},[r("系统日志（如 "),e("code",null,"dmesg"),r("）")]),e("td",{style:{"text-align":"left"}},"JVM日志或异常堆栈，信息详细且分类")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"根本原因")]),e("td",{style:{"text-align":"left"}},"系统总内存不足"),e("td",{style:{"text-align":"left"}},"JVM特定内存区域（堆、元空间等）不足")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"影响范围")]),e("td",{style:{"text-align":"left"}},"可能导致任何进程被杀"),e("td",{style:{"text-align":"left"}},"通常只影响抛出错误的JVM进程")])])],-1)),a[574]||(a[574]=e("h4",{id:"联系与总结",tabindex:"-1"},[r("联系与总结 "),e("a",{class:"header-anchor",href:"#联系与总结","aria-label":'Permalink to "联系与总结"'},"​")],-1)),a[575]||(a[575]=e("ul",null,[e("li",null,[e("strong",null,"包含关系："),r(" Java内存溢出是OOM的一种特定场景。当Java应用发生内存溢出时，从操作系统的视角看，就是这个JVM进程消耗了大量内存，它本身就可能成为系统级OOM Killer的目标。")]),e("li",null,[e("strong",null,"视角不同："),e("ul",null,[e("li",null,[r("系统管理员更关心"),e("strong",null,"广义OOM"),r("，因为它会影响整个服务器的稳定性。")]),e("li",null,[r("Java开发者更关心"),e("strong",null,"Java内存溢出"),r("，因为 "),e("code",null,"OutOfMemoryError"),r(" 的错误类型能直接指导我们进行代码优化、JVM参数调优（如 "),e("code",null,"-Xmx"),r(", "),e("code",null,"-XX:MaxMetaspaceSize"),r("）和问题排查（如使用MAT分析堆转储）。")])])])],-1)),a[576]||(a[576]=e("p",null,[e("strong",null,"简单比喻：")],-1)),a[577]||(a[577]=e("ul",null,[e("li",null,[e("strong",null,"广义OOM"),r(" 就像一座城市的电力系统超负荷，导致整个区域大停电。")]),e("li",null,[e("strong",null,"Java内存溢出"),r(" 就像你家里的一个特定电器（比如空调）因为功率过高，跳了家里的空气开关，但邻居家不受影响。"),e("code",null,"OutOfMemoryError"),r(" 的错误信息会告诉你，是空调跳闸了，还是电热水器跳闸了。")])],-1)),a[578]||(a[578]=e("hr",null,null,-1)),a[579]||(a[579]=e("h3",{id:"q-java内存溢出与内存泄漏的区别",tabindex:"-1"},[r("Q：Java内存溢出与内存泄漏的区别 "),e("a",{class:"header-anchor",href:"#q-java内存溢出与内存泄漏的区别","aria-label":'Permalink to "Q：Java内存溢出与内存泄漏的区别"'},"​")],-1)),a[580]||(a[580]=e("h4",{id:"什么是内存泄漏",tabindex:"-1"},[r("什么是内存泄漏？ "),e("a",{class:"header-anchor",href:"#什么是内存泄漏","aria-label":'Permalink to "什么是内存泄漏？"'},"​")],-1)),a[581]||(a[581]=e("p",null,"在理论上，Java有自动垃圾回收（GC），当一个对象不再被任何地方引用时，GC会自动回收它占用的内存。这似乎应该杜绝内存泄漏。",-1)),a[582]||(a[582]=e("p",null,[r("但实际情况是："),e("strong",null,"内存泄漏在Java中指的是“无意中持有的、不再需要的对象引用，导致这些对象无法被GC回收，从而造成内存的持续消耗”。")],-1)),a[583]||(a[583]=e("p",null,[e("strong",null,"核心思想："),r(" 对象已经不再被"),e("strong",null,"应用逻辑"),r("所需要，但因为某些原因，仍然被"),e("strong",null,"GC Roots"),r(" 引用着，从而变得“该死却没死”。")],-1)),a[584]||(a[584]=e("hr",null,null,-1)),a[585]||(a[585]=e("h4",{id:"一个简单的比喻",tabindex:"-1"},[r("一个简单的比喻 "),e("a",{class:"header-anchor",href:"#一个简单的比喻","aria-label":'Permalink to "一个简单的比喻"'},"​")],-1)),a[586]||(a[586]=e("ul",null,[e("li",null,[e("strong",null,"内存使用正常："),r(" 你从书架上拿了一本书阅读，读完后放回书架。")]),e("li",null,[e("strong",null,"内存泄漏："),r(" 你拿了一本书阅读，读完后用一个大夹子把它夹在了书架上（这个夹子就是一个意外的引用）。你永远不会再读这本书，但它也永远无法被放回书箱（被GC回收）。你读的书越多，被夹住的书就越多，最终书架被塞满（内存溢出）。")])],-1)),a[587]||(a[587]=e("hr",null,null,-1)),a[588]||(a[588]=e("h4",{id:"java中典型的内存泄漏场景",tabindex:"-1"},[r("Java中典型的内存泄漏场景 "),e("a",{class:"header-anchor",href:"#java中典型的内存泄漏场景","aria-label":'Permalink to "Java中典型的内存泄漏场景"'},"​")],-1)),a[589]||(a[589]=e("p",null,"以下是一些在Java开发中常见的内存泄漏场景：",-1)),a[590]||(a[590]=e("h5",{id:"_1-静态集合类滥用",tabindex:"-1"},[r("1. 静态集合类滥用 "),e("a",{class:"header-anchor",href:"#_1-静态集合类滥用","aria-label":'Permalink to "1. 静态集合类滥用"'},"​")],-1)),a[591]||(a[591]=e("p",null,[r("静态集合（如 "),e("code",null,"static HashMap"),r(", "),e("code",null,"static List"),r("）的生命周期与整个应用程序一致（JVM进程）。")],-1)),a[592]||(a[592]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MemoryLeak"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> staticList "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ArrayList<>();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," addToStaticList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"obj"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        staticList."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"add"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(obj); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 一旦加入，除非显式移除，否则对象将永远存在")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[593]||(a[593]=e("p",null,[r("即使你不再需要 "),e("code",null,"obj"),r("，它也因为被 "),e("code",null,"staticList"),r(" 引用而无法被回收。")],-1)),a[594]||(a[594]=e("h5",{id:"_2-未关闭的资源-连接、流等",tabindex:"-1"},[r("2. 未关闭的资源（连接、流等） "),e("a",{class:"header-anchor",href:"#_2-未关闭的资源-连接、流等","aria-label":'Permalink to "2. 未关闭的资源（连接、流等）"'},"​")],-1)),a[595]||(a[595]=e("p",null,"数据库连接、网络连接、文件流等底层资源使用了 native memory（本地内存）或服务器资源。如果不关闭，不仅可能造成JVM内存压力，还可能拖垮整个服务。",-1)),a[596]||(a[596]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Connection conn "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dataSource."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getConnection"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ... 业务逻辑")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 忘记调用 conn.close();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (SQLException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"printStackTrace"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[597]||(a[597]=e("p",null,[e("strong",null,[r("现代最佳实践是使用 "),e("code",null,"try-with-resources"),r(" 语法自动关闭。")])],-1)),a[598]||(a[598]=e("h5",{id:"_3-监听器和回调未注销",tabindex:"-1"},[r("3. 监听器和回调未注销 "),e("a",{class:"header-anchor",href:"#_3-监听器和回调未注销","aria-label":'Permalink to "3. 监听器和回调未注销"'},"​")],-1)),a[599]||(a[599]=e("p",null,"当你向一个全局的管理器注册了监听器（Listener）或回调（Callback），如果在对象不再使用时没有注销，那么管理器会一直持有该对象的引用。",-1)),a[600]||(a[600]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MyService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," register"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        SomeManager."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInstance"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addListener"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 注册")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 缺少 unregister 方法")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[601]||(a[601]=e("h5",{id:"_4-内部类持有外部类引用",tabindex:"-1"},[r("4. 内部类持有外部类引用 "),e("a",{class:"header-anchor",href:"#_4-内部类持有外部类引用","aria-label":'Permalink to "4. 内部类持有外部类引用"'},"​")],-1)),a[602]||(a[602]=e("p",null,"非静态内部类（包括匿名内部类）会隐式地持有其外部类的引用。如果这个内部类的生命周期长于外部类（例如，被放入一个全局的线程池或队列），就会导致外部类实例也无法被回收。",-1)),a[603]||(a[603]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," OuterClass"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," byte"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] data "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," byte"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1024"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1024"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 占用大量内存")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," createInnerClass"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        InnerClass inner "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," InnerClass"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 如果 inner 被一个长生命周期的线程持有，那么 OuterClass.this 也无法被回收")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        SomeGlobalThreadPool."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"submit"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(inner);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," InnerClass"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Runnable"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," run"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 这里可以隐式访问 OuterClass.this.data")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[604]||(a[604]=e("h5",{id:"_5-缓存管理不当",tabindex:"-1"},[r("5. 缓存管理不当 "),e("a",{class:"header-anchor",href:"#_5-缓存管理不当","aria-label":'Permalink to "5. 缓存管理不当"'},"​")],-1)),a[605]||(a[605]=e("p",null,"使用缓存而不设置大小、过期时间或淘汰策略（如LRU），会导致缓存无限增长，最终引发OOM。",-1)),a[606]||(a[606]=e("p",null,[e("strong",null,"解决方案："),r(" 使用弱引用（"),e("code",null,"WeakHashMap"),r("）或专业的缓存库（如Guava Cache, Caffeine），它们内置了大小和过期策略。")],-1)),a[607]||(a[607]=e("h5",{id:"_6-线程局部变量-threadlocal-误用",tabindex:"-1"},[r("6. 线程局部变量（ThreadLocal）误用 "),e("a",{class:"header-anchor",href:"#_6-线程局部变量-threadlocal-误用","aria-label":'Permalink to "6. 线程局部变量（ThreadLocal）误用"'},"​")],-1)),a[608]||(a[608]=e("p",null,[e("code",null,"ThreadLocal"),r(" 为每个线程提供了一个独立的变量副本。但如果线程是线程池复用的（如Web容器的请求处理线程），那么线程的整个生命周期会非常长。如果在使用完 "),e("code",null,"ThreadLocal"),r(" 后没有调用 "),e("code",null,"remove()"),r(" 方法，那么其中存储的对象就会一直存在于线程的 "),e("code",null,"ThreadLocalMap"),r(" 中，造成泄漏。")],-1)),a[609]||(a[609]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadLocal<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"User"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> userThreadLocal "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadLocal<>();")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," handleRequest"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Request request) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    userThreadLocal."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getUserFromSession"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // ... 业务逻辑")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 必须清理！")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        userThreadLocal."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"remove"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 如果没有这行，就会发生内存泄漏")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[610]||(a[610]=e("hr",null,null,-1)),a[611]||(a[611]=e("h4",{id:"内存泄漏、内存溢出与oom的关系",tabindex:"-1"},[r("内存泄漏、内存溢出与OOM的关系 "),e("a",{class:"header-anchor",href:"#内存泄漏、内存溢出与oom的关系","aria-label":'Permalink to "内存泄漏、内存溢出与OOM的关系"'},"​")],-1)),a[612]||(a[612]=e("p",null,"这三者构成了一个清晰的因果链：",-1)),a[613]||(a[613]=e("ol",null,[e("li",null,[e("strong",null,"原因：内存泄漏（Memory Leak）"),e("ul",null,[e("li",null,"由于代码缺陷，导致无用对象无法被GC回收。"),e("li",null,[r("这是一个 "),e("strong",null,"过程"),r("，是问题的根源。")])])]),e("li",null,[e("strong",null,"结果：内存溢出（OutOfMemoryError）"),e("ul",null,[e("li",null,"内存泄漏的持续积累（或其他原因，如一次性加载过多数据），导致JVM的堆内存被耗尽。"),e("li",null,[r("当JVM无法再分配所需内存时，就会抛出 "),e("code",null,"OutOfMemoryError: Java heap space"),r("。")]),e("li",null,[r("这是一个 "),e("strong",null,"事件"),r("，是问题的最终表现。")])])]),e("li",null,[e("strong",null,"范畴：OOM"),e("ul",null,[e("li",null,"OOM是包含内存溢出在内的一个更广泛的概念。")])])],-1)),a[614]||(a[614]=e("p",null,[e("strong",null,"关系图："),e("code",null,"代码缺陷（如未释放引用）"),r(" → "),e("code",null,"内存泄漏（对象堆积）"),r(" → "),e("code",null,"JVM堆内存耗尽"),r(" → "),e("code",null,"内存溢出（抛出OutOfMemoryError）")],-1)),a[615]||(a[615]=e("h4",{id:"如何排查内存泄漏",tabindex:"-1"},[r("如何排查内存泄漏？ "),e("a",{class:"header-anchor",href:"#如何排查内存泄漏","aria-label":'Permalink to "如何排查内存泄漏？"'},"​")],-1)),a[616]||(a[616]=e("ol",null,[e("li",null,[e("strong",null,"启用GC日志："),r(" 使用JVM参数 "),e("code",null,"-XX:+PrintGCDetails -Xloggc:<file-path>"),r(" 观察GC行为。如果看到Full GC越来越频繁，且每次回收后老年代可用内存越来越少，基本可以断定有内存泄漏。")]),e("li",null,[e("strong",null,"使用分析工具："),e("ul",null,[e("li",null,[e("strong",null,"JConsole / JVisualVM："),r(" 实时监控堆内存使用情况，观察内存曲线是否呈“锯齿向上”的趋势。")]),e("li",null,[e("strong",null,"生成堆转储（Heap Dump）："),r(" 在OOM时自动生成（"),e("code",null,"-XX:+HeapDumpOnOutOfMemoryError"),r("）或使用工具手动生成。")]),e("li",null,[e("strong",null,"使用专业工具分析堆转储："),r(" 如 "),e("strong",null,"Eclipse Memory Analyzer Tool (MAT)"),r("。MAT可以精确定位到是哪个类的哪个对象占用了最大内存，以及是什么GC Roots在引用它们，这是定位内存泄漏的“杀手锏”。")])])])],-1)),a[617]||(a[617]=e("p",null,[e("strong",null,"总结："),e("strong",null,"内存泄漏是病根，Java内存溢出是病症。"),r(" 作为一名Java开发者，我们的主要工作就是通过代码审查、测试和工具分析，找到并根除内存泄漏这个“病根”，从而避免内存溢出这个“病症”的发生。")],-1)),a[618]||(a[618]=e("hr",null,null,-1)),a[619]||(a[619]=e("h3",{id:"q-主流mq的区别",tabindex:"-1"},[r("Q：主流MQ的区别 "),e("a",{class:"header-anchor",href:"#q-主流mq的区别","aria-label":'Permalink to "Q：主流MQ的区别"'},"​")],-1)),a[620]||(a[620]=e("p",null,"为了帮助你在项目中选择合适的消息队列，下面这个表格从多个核心维度梳理了目前几款主流消息队列的主要区别。",-1)),a[621]||(a[621]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},[e("strong",null,"特性维度")]),e("th",{style:{"text-align":"left"}},[e("strong",null,"Kafka")]),e("th",{style:{"text-align":"left"}},[e("strong",null,"RocketMQ")]),e("th",{style:{"text-align":"left"}},[e("strong",null,"RabbitMQ")]),e("th",{style:{"text-align":"left"}},[e("strong",null,"ActiveMQ")])])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"核心定位")]),e("td",{style:{"text-align":"left"}},"高吞吐的分布式流处理平台"),e("td",{style:{"text-align":"left"}},"兼具高性能与事务能力的全能型选手"),e("td",{style:{"text-align":"left"}},"灵活、易用的消息代理"),e("td",{style:{"text-align":"left"}},"功能丰富的传统消息中间件")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"吞吐量")]),e("td",{style:{"text-align":"left"}},[r("⭐⭐⭐⭐⭐ "),e("strong",null,"极高"),r(" (百万级/秒)")]),e("td",{style:{"text-align":"left"}},[r("⭐⭐⭐⭐ "),e("strong",null,"高"),r(" (十万级/秒)")]),e("td",{style:{"text-align":"left"}},[r("⭐⭐⭐ "),e("strong",null,"中"),r(" (万级/秒)")]),e("td",{style:{"text-align":"left"}},[r("⭐⭐ "),e("strong",null,"中低"),r(" (万级/秒)")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"消息可靠性")]),e("td",{style:{"text-align":"left"}},"非常高（通过副本机制保证）"),e("td",{style:{"text-align":"left"}},"非常高（基于事务保证）"),e("td",{style:{"text-align":"left"}},"最高（AMQP协议保证）"),e("td",{style:{"text-align":"left"}},"有较低概率丢失数据")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"消息顺序性")]),e("td",{style:{"text-align":"left"}},"单分区内有序"),e("td",{style:{"text-align":"left"}},"单队列（queue）内有序"),e("td",{style:{"text-align":"left"}},"单队列内有序（需避免使用高级功能）"),e("td",{style:{"text-align":"left"}},"支持")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"延迟")]),e("td",{style:{"text-align":"left"}},"毫秒级"),e("td",{style:{"text-align":"left"}},"毫秒级"),e("td",{style:{"text-align":"left"}},[e("strong",null,"微秒级")]),e("td",{style:{"text-align":"left"}},"毫秒级")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"主要优势")]),e("td",{style:{"text-align":"left"}},"极致吞吐、生态完善、堆积能力强"),e("td",{style:{"text-align":"left"}},"高性能、强事务消息、顺序消息"),e("td",{style:{"text-align":"left"}},"灵活的路由、低延迟、多协议支持"),e("td",{style:{"text-align":"left"}},"功能完备、支持多种协议")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"典型场景")]),e("td",{style:{"text-align":"left"}},"日志采集、流式数据处理、实时数据管道"),e("td",{style:{"text-align":"left"}},"电商交易、金融业务、分布式事务"),e("td",{style:{"text-align":"left"}},"企业级应用、复杂路由、实时通信"),e("td",{style:{"text-align":"left"}},"中小型企业业务系统、多协议集成")])])],-1)),a[622]||(a[622]=e("h4",{id:"💡-各款消息队列的深入解析",tabindex:"-1"},[r("💡 各款消息队列的深入解析 "),e("a",{class:"header-anchor",href:"#💡-各款消息队列的深入解析","aria-label":'Permalink to "💡 各款消息队列的深入解析"'},"​")],-1)),a[623]||(a[623]=e("p",null,"在表格的基础上，以下是关于这几款消息队列更详细的解读，以帮助你进一步理解它们的特性。",-1)),a[624]||(a[624]=e("ul",null,[e("li",null,[e("strong",null,"Apache Kafka"),r(" Kafka专为"),e("strong",null,"高吞吐"),r("和"),e("strong",null,"大规模实时数据流处理"),r("而设计。它采用分区和副本机制，非常适合日志采集、监控数据和构建实时数据管道等场景。不过，它的运维相对复杂，且默认配置下延迟相对较高。")]),e("li",null,[e("strong",null,"Apache RocketMQ"),r(" RocketMQ在"),e("strong",null,"高吞吐"),r("和"),e("strong",null,"低延迟"),r("之间取得了很好的平衡，并原生支持"),e("strong",null,"分布式事务消息"),r('。在电商、金融等对数据一致性要求极高的业务场景（如秒杀、订单处理）中表现出色。其架构源自阿里，经历过"双十一"等超大规模流量考验。')]),e("li",null,[e("strong",null,"RabbitMQ"),r(" 基于"),e("strong",null,"AMQP协议"),r("，RabbitMQ的核心优势在于其"),e("strong",null,"强大的消息路由能力"),r("和"),e("strong",null,"极低的延迟"),r("。通过交换机、绑定键和队列的组合，可以实现非常灵活的消息分发逻辑。它部署简单，文档完善，非常适合业务逻辑复杂但吞吐量要求不是极端的中小型项目。")]),e("li",null,[e("strong",null,"ActiveMQ"),r(" 作为一款老牌的消息中间件，ActiveMQ对"),e("strong",null,"JMS规范"),r("支持完善，并支持多种协议。其功能全面，但性能上限相对较低，在高并发、高吞吐场景下可能成为瓶颈，且社区活跃度相对不如前三者。")])],-1)),a[625]||(a[625]=e("h4",{id:"🎯-如何根据场景选择",tabindex:"-1"},[r("🎯 如何根据场景选择 "),e("a",{class:"header-anchor",href:"#🎯-如何根据场景选择","aria-label":'Permalink to "🎯 如何根据场景选择"'},"​")],-1)),a[626]||(a[626]=e("p",null,"没有最好的消息队列，只有最合适的。你可以根据以下思路进行选择：",-1)),a[627]||(a[627]=e("ul",null,[e("li",null,[e("strong",null,"选择 Kafka"),r("：当你的首要任务是处理"),e("strong",null,"海量数据"),r("（如日志、指标、用户行为流），并且需要极高的吞吐量用于"),e("strong",null,"实时计算或流处理"),r("时，Kafka是业内标准。")]),e("li",null,[e("strong",null,"选择 RocketMQ"),r("：如果你的业务处于"),e("strong",null,"金融、电商"),r("等领域，需要同时应对高并发流量和保证"),e("strong",null,"分布式事务"),r("（如下单扣库存）的强一致性，RocketMQ是更优的选择。")]),e("li",null,[e("strong",null,"选择 RabbitMQ"),r("：当你的业务需要复杂的"),e("strong",null,"消息路由"),r("（如根据不同规则分发消息），或者对"),e("strong",null,"响应延迟非常敏感"),r("（如实时通知），且总吞吐量在十万级以下时，RabbitMQ非常合适。")]),e("li",null,[e("strong",null,"选择 ActiveMQ"),r("：在"),e("strong",null,"中小型企业"),r("的系统中，需要进行"),e("strong",null,"多协议集成"),r("或对"),e("strong",null,"JMS"),r("有强依赖，且对性能要求不极致的场景下，可以考虑使用ActiveMQ。")])],-1)),a[628]||(a[628]=e("p",null,"希望这份详细的分析能帮助你做出明智的选择。如果你的项目有更具体的技术指标或业务场景，我很乐意提供更具针对性的分析。",-1)),a[629]||(a[629]=e("hr",null,null,-1)),a[630]||(a[630]=e("h2",{id:"面经三-紫川软件-平安产险",tabindex:"-1"},[e("strong",null,"面经三"),r("：紫川软件 - 平安产险 "),e("a",{class:"header-anchor",href:"#面经三-紫川软件-平安产险","aria-label":'Permalink to "**面经三**：紫川软件 - 平安产险"'},"​")],-1)),a[631]||(a[631]=e("hr",null,null,-1)),a[632]||(a[632]=e("h3",{id:"q-redis如何保证缓存数据一致性",tabindex:"-1"},[r("Q：Redis如何保证缓存数据一致性？ "),e("a",{class:"header-anchor",href:"#q-redis如何保证缓存数据一致性","aria-label":'Permalink to "Q：Redis如何保证缓存数据一致性？"'},"​")],-1)),a[633]||(a[633]=e("p",null,"好的，这是一个非常核心的面试题和实际问题。Redis 作为缓存，其核心目的是为了提升性能，但随之而来的就是与底层数据库（如 MySQL）的数据一致性问题。",-1)),a[634]||(a[634]=e("p",null,[r("首先，要明确一个核心观点："),e("strong",null,"在分布式系统下，无法做到绝对的、实时的缓存数据一致性，我们追求的是最终一致性。"),r(" 我们的目标是尽可能缩短不一致的时间窗口，并保证数据最终是正确的。")],-1)),a[635]||(a[635]=e("p",null,"下面我们来详细讲解几种主流的保证缓存数据一致性的方案，从常见到最优。",-1)),a[636]||(a[636]=e("hr",null,null,-1)),a[637]||(a[637]=e("h4",{id:"_1-缓存更新策略",tabindex:"-1"},[r("1. 缓存更新策略 "),e("a",{class:"header-anchor",href:"#_1-缓存更新策略","aria-label":'Permalink to "1. 缓存更新策略"'},"​")],-1)),a[638]||(a[638]=e("p",null,"这是最基础的决策，即何时、如何更新缓存和数据库。",-1)),a[639]||(a[639]=e("h5",{id:"_1-1-cache-aside-旁路缓存策略",tabindex:"-1"},[r("1.1 Cache-Aside (旁路缓存策略) "),e("a",{class:"header-anchor",href:"#_1-1-cache-aside-旁路缓存策略","aria-label":'Permalink to "1.1 Cache-Aside (旁路缓存策略)"'},"​")],-1)),a[640]||(a[640]=e("p",null,"这是最常用、最经典的策略。应用代码直接负责与缓存和数据库交互。",-1)),a[641]||(a[641]=e("ul",null,[e("li",null,[e("strong",null,"读流程 (Lazy Loading)"),r("： "),e("ol",null,[e("li",null,"接收读请求。"),e("li",null,"首先查询 Redis 缓存。"),e("li",null,"如果缓存命中，直接返回数据。"),e("li",null,"如果缓存未命中，则查询数据库。"),e("li",null,"将数据库查询的结果写入 Redis 缓存，然后返回数据。")])]),e("li",null,[e("strong",null,"写流程"),r("： "),e("ol",null,[e("li",null,"接收写请求。"),e("li",null,[e("strong",null,"更新数据库"),r("。")]),e("li",null,[e("strong",null,"删除 Redis 中的缓存数据。")])])])],-1)),a[642]||(a[642]=e("p",null,[e("strong",null,"为什么是删除缓存，而不是更新缓存？"),r(" 这是关键点！如果采用更新缓存，在并发写场景下可能会出现数据不一致。")],-1)),a[643]||(a[643]=e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：线程 A 和线程 B 按顺序更新同一条数据。 "),e("ol",null,[e("li",null,"线程 A 更新数据库 (value=1)"),e("li",null,"线程 B 更新数据库 (value=2)"),e("li",null,"线程 B 更新缓存 (value=2)"),e("li",null,"线程 A 更新缓存 (value=1) // 此时缓存中是旧数据1，与数据库的新数据2不一致。")])]),e("li",null,[e("strong",null,"删除缓存"),r("可以避免这个问题，它使缓存失效，下次读取时自然会从数据库加载最新值。")])],-1)),a[644]||(a[644]=e("p",null,[e("strong",null,"优点"),r("：简单、高效，是业界最通用的方案。 "),e("strong",null,"缺点"),r("：在特定并发场景下，仍会出现短时间的不一致。")],-1)),a[645]||(a[645]=e("hr",null,null,-1)),a[646]||(a[646]=e("h4",{id:"_2-应对并发场景的进阶方案",tabindex:"-1"},[r("2. 应对并发场景的进阶方案 "),e("a",{class:"header-anchor",href:"#_2-应对并发场景的进阶方案","aria-label":'Permalink to "2. 应对并发场景的进阶方案"'},"​")],-1)),a[647]||(a[647]=e("p",null,"Cache-Aside 策略在并发读写时，可能会因为执行顺序问题导致不一致。",-1)),a[648]||(a[648]=e("h5",{id:"场景-先删缓存-后更新数据库-并发读写",tabindex:"-1"},[r("场景：先删缓存，后更新数据库 (并发读写) "),e("a",{class:"header-anchor",href:"#场景-先删缓存-后更新数据库-并发读写","aria-label":'Permalink to "场景：先删缓存，后更新数据库 (并发读写)"'},"​")],-1)),a[649]||(a[649]=e("ol",null,[e("li",null,[r("线程 A (写)： "),e("ul",null,[e("li",null,"删除缓存。"),e("li",null,"（此时，由于网络或CPU调度，A暂停）")])]),e("li",null,[r("线程 B (读)： "),e("ul",null,[e("li",null,"发现缓存不存在。"),e("li",null,[r("从数据库读取"),e("strong",null,"旧值"),r("。")]),e("li",null,[r("将"),e("strong",null,"旧值"),r("写入缓存。")])])]),e("li",null,[r("线程 A (写)： "),e("ul",null,[e("li",null,[r("更新数据库为"),e("strong",null,"新值"),r("。")])])])],-1)),a[650]||(a[650]=e("p",null,[e("strong",null,"结果"),r("：缓存中是被线程B写入的旧值，数据库是新值，发生了不一致。")],-1)),a[651]||(a[651]=e("h5",{id:"解决方案-1-延迟双删",tabindex:"-1"},[r("解决方案 1：延迟双删 "),e("a",{class:"header-anchor",href:"#解决方案-1-延迟双删","aria-label":'Permalink to "解决方案 1：延迟双删"'},"​")],-1)),a[652]||(a[652]=e("p",null,"为了解决上述问题，可以在更新数据库后，再执行一次缓存删除，并给予一定的延迟。",-1)),a[653]||(a[653]=e("ol",null,[e("li",null,"删除缓存。"),e("li",null,"更新数据库。"),e("li",null,[e("strong",null,"睡眠一段时间 (如 500ms - 1s，具体时间需要根据业务读写耗时评估)。")]),e("li",null,"再次删除缓存。")],-1)),a[654]||(a[654]=e("p",null,[e("strong",null,"第二次删除"),r("的目的是为了清除在“更新数据库”这个时间窗口内，可能被其他读请求加载到缓存中的旧数据。 "),e("strong",null,"睡眠"),r("是为了确保读请求已经完成了“读数据库 -> 写旧数据到缓存”这个操作。")],-1)),a[655]||(a[655]=e("p",null,[e("strong",null,"优点"),r("：通过增加一次删除操作，大大降低了不一致的概率。 "),e("strong",null,"缺点"),r("：不优雅，需要预估延迟时间，降低了吞吐量。")],-1)),a[656]||(a[656]=e("h5",{id:"解决方案-2-异步重试-推荐",tabindex:"-1"},[r("解决方案 2：异步重试（推荐） "),e("a",{class:"header-anchor",href:"#解决方案-2-异步重试-推荐","aria-label":'Permalink to "解决方案 2：异步重试（推荐）"'},"​")],-1)),a[657]||(a[657]=e("p",null,"核心思想是：将第二次删除操作通过异步消息的方式执行，确保它最终能成功。",-1)),a[658]||(a[658]=e("p",null,[e("strong",null,"a. 使用消息队列")],-1)),a[659]||(a[659]=e("ol",null,[e("li",null,"应用服务在更新数据库后，向消息队列发送一条删除缓存的消息。"),e("li",null,"一个独立的消费者服务消费该消息，执行删除缓存的操作。"),e("li",null,"如果删除失败，消息会被重试，直到成功。")],-1)),a[660]||(a[660]=e("p",null,[e("strong",null,"b. 利用数据库 Binlog（最优解）"),r(" 这是大型互联网公司最常用的方案，将缓存层完全作为数据库的从库。")],-1)),a[661]||(a[661]=e("ol",null,[e("li",null,"应用服务：更新数据库。"),e("li",null,[r("一个独立的中间件（如 Canal、Debezium）"),e("strong",null,"订阅数据库的 Binlog"),r("（二进制日志，记录了所有数据变更）。")]),e("li",null,"中间件解析 Binlog，获取变更的数据和操作。"),e("li",null,[r("中间件根据变更，调用 Redis 的接口"),e("strong",null,"删除"),r("或更新对应的缓存。")])],-1)),a[662]||(a[662]=e("p",null,[e("strong",null,"优点"),r("：")],-1)),a[663]||(a[663]=e("ul",null,[e("li",null,[e("strong",null,"彻底解耦"),r("：应用服务只关心写数据库，完全不知道缓存的存在。")]),e("li",null,[e("strong",null,"保证最终一致性"),r("：只要数据库更新了，Binlog 就能被解析，缓存最终会被删除。")]),e("li",null,[e("strong",null,"高性能"),r("：对主业务链路无侵入。")])],-1)),a[664]||(a[664]=e("p",null,[e("strong",null,"缺点"),r("：架构复杂，需要维护额外的中间件。")],-1)),a[665]||(a[665]=e("hr",null,null,-1)),a[666]||(a[666]=e("h4",{id:"_3-其他缓存策略",tabindex:"-1"},[r("3. 其他缓存策略 "),e("a",{class:"header-anchor",href:"#_3-其他缓存策略","aria-label":'Permalink to "3. 其他缓存策略"'},"​")],-1)),a[667]||(a[667]=e("p",null,"除了 Cache-Aside，还有一些其他策略，但各有适用场景。",-1)),a[668]||(a[668]=e("h5",{id:"_3-1-write-through-穿透写",tabindex:"-1"},[r("3.1 Write-Through (穿透写) "),e("a",{class:"header-anchor",href:"#_3-1-write-through-穿透写","aria-label":'Permalink to "3.1 Write-Through (穿透写)"'},"​")],-1)),a[669]||(a[669]=e("p",null,"应用服务将缓存作为主要数据存储。写操作时：",-1)),a[670]||(a[670]=e("ol",null,[e("li",null,"先更新缓存。"),e("li",null,"缓存组件自己负责将数据同步到数据库。")],-1)),a[671]||(a[671]=e("p",null,[e("strong",null,"优点"),r("：能保证缓存和数据库的强一致性。 "),e("strong",null,"缺点"),r("：写延迟高，因为需要等待两个写操作都完成。对缓存稳定性要求极高。")],-1)),a[672]||(a[672]=e("h5",{id:"_3-2-write-behind-异步写",tabindex:"-1"},[r("3.2 Write-Behind (异步写) "),e("a",{class:"header-anchor",href:"#_3-2-write-behind-异步写","aria-label":'Permalink to "3.2 Write-Behind (异步写)"'},"​")],-1)),a[673]||(a[673]=e("p",null,"Write-Through 的异步版本。写操作时：",-1)),a[674]||(a[674]=e("ol",null,[e("li",null,"只更新缓存。"),e("li",null,"缓存组件在后台异步、批量地将数据更新到数据库。")],-1)),a[675]||(a[675]=e("p",null,[e("strong",null,"优点"),r("：写性能极高。 "),e("strong",null,"缺点"),r("：有数据丢失风险（缓存宕机），只能保证最终一致性。")],-1)),a[676]||(a[676]=e("hr",null,null,-1)),a[677]||(a[677]=e("h4",{id:"总结与最佳实践",tabindex:"-1"},[r("总结与最佳实践 "),e("a",{class:"header-anchor",href:"#总结与最佳实践","aria-label":'Permalink to "总结与最佳实践"'},"​")],-1)),a[678]||(a[678]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"方案"),e("th",{style:{"text-align":"left"}},"操作顺序"),e("th",{style:{"text-align":"left"}},"优点"),e("th",{style:{"text-align":"left"}},"缺点"),e("th",{style:{"text-align":"left"}},"适用场景")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"Cache-Aside")]),e("td",{style:{"text-align":"left"}},"读：缓存->DB->回填 写：更新DB->删除缓存"),e("td",{style:{"text-align":"left"}},"简单、通用"),e("td",{style:{"text-align":"left"}},"并发下有短时不一致风险"),e("td",{style:{"text-align":"left"}},[e("strong",null,"绝大多数业务场景")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"延迟双删")]),e("td",{style:{"text-align":"left"}},"删除缓存->更新DB->睡眠->再删缓存"),e("td",{style:{"text-align":"left"}},"降低不一致概率"),e("td",{style:{"text-align":"left"}},"不优雅，需估时，性能差"),e("td",{style:{"text-align":"left"}},"对一致性要求稍高，且无法引入复杂架构的场景")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"异步重试 (MQ)")]),e("td",{style:{"text-align":"left"}},"更新DB->发MQ->消费者删缓存"),e("td",{style:{"text-align":"left"}},"解耦，保证最终一致"),e("td",{style:{"text-align":"left"}},"架构稍复杂，需维护MQ"),e("td",{style:{"text-align":"left"}},"中大型项目，对一致性要求高")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"订阅 Binlog")]),e("td",{style:{"text-align":"left"}},"更新DB->中间件解析Binlog->删缓存"),e("td",{style:{"text-align":"left"}},[e("strong",null,"彻底解耦，强保证")]),e("td",{style:{"text-align":"left"}},"架构复杂，技术门槛高"),e("td",{style:{"text-align":"left"}},[e("strong",null,"大型、高并发项目"),r("的最佳实践")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"Write-Through")]),e("td",{style:{"text-align":"left"}},"更新缓存->缓存同步更新DB"),e("td",{style:{"text-align":"left"}},"强一致性"),e("td",{style:{"text-align":"left"}},"写性能差，缓存依赖重"),e("td",{style:{"text-align":"left"}},"缓存即数据库的场景，较少用")])])],-1)),a[679]||(a[679]=e("p",null,[e("strong",null,"给出现代架构下的通用建议：")],-1)),a[680]||(a[680]=e("ol",null,[e("li",null,[e("strong",null,"首选基础方案"),r("：对于大多数应用，使用 "),e("strong",null,"Cache-Aside + 删除缓存"),r(" 就已经足够。可以容忍极短时间（毫秒级）的不一致。")]),e("li",null,[e("strong",null,"升级到可靠方案"),r("：如果对一致性要求很高，并且团队有技术能力，"),e("strong",null,"强烈推荐使用「订阅数据库 Binlog」"),r(" 的方案。这是目前最可靠、最优雅的解决方案。")]),e("li",null,[e("strong",null,"设置缓存过期时间"),r("：无论使用哪种方案，都"),e("strong",null,"务必给缓存数据设置一个合理的过期时间 (TTL)"),r("。这是一个兜底方案，即使同步逻辑出现问题，缓存最终也会自动失效，从数据库加载最新数据，保证最终一致性。")]),e("li",null,[e("strong",null,"避免复杂逻辑"),r("：尽量避免“更新缓存”的逻辑，坚持使用“删除缓存”，让下一次读请求来触发缓存重建，这样逻辑更简单，更不容易出错。")])],-1)),a[681]||(a[681]=e("p",null,[r("简单来说，"),e("strong",null,"“更新数据库，删除缓存”是基础，而“通过 Binlog 异步删除缓存”是追求极致一致性的终极答案。")],-1)),a[682]||(a[682]=e("hr",null,null,-1)),a[683]||(a[683]=e("h3",{id:"q-项目中优化日志打印大对象的具体实现",tabindex:"-1"},[r("Q：项目中优化日志打印大对象的具体实现 "),e("a",{class:"header-anchor",href:"#q-项目中优化日志打印大对象的具体实现","aria-label":'Permalink to "Q：项目中优化日志打印大对象的具体实现"'},"​")],-1)),a[684]||(a[684]=e("h4",{id:"核心问题阐述",tabindex:"-1"},[r("核心问题阐述 "),e("a",{class:"header-anchor",href:"#核心问题阐述","aria-label":'Permalink to "核心问题阐述"'},"​")],-1)),a[685]||(a[685]=e("p",null,"首先，一句话点明问题的严重性：",-1)),a[686]||(a[686]=e("blockquote",null,[e("p",null,[r('"在项目中，我们遇到一个典型的性能陷阱：'),e("strong",null,"在DEBUG或INFO级别日志中，直接打印了完整的大对象（如包含几十个字段的供应商对象、查询结果列表等）。"),r(" 这带来了三个严重后果：")]),e("ol",null,[e("li",null,[e("strong",null,"日志磁盘爆炸"),r("：单条日志可能达到几百KB甚至几MB，迅速写满磁盘。")]),e("li",null,[e("strong",null,"CPU资源耗尽"),r("：序列化大对象为字符串的"),e("code",null,"toString()"),r("方法非常消耗CPU。")]),e("li",null,[e("strong",null,"最危险的：可能诱发OOM"),r('。尤其是在使用异步日志框架（如Logback的AsyncAppender）时，如果日志生产速度超过消费速度，大量待写日志的大对象会堆积在内存队列中，直接导致内存溢出。"')])])],-1)),a[687]||(a[687]=e("hr",null,null,-1)),a[688]||(a[688]=e("h4",{id:"具体实现方案-分层讲解",tabindex:"-1"},[r("具体实现方案（分层讲解） "),e("a",{class:"header-anchor",href:"#具体实现方案-分层讲解","aria-label":'Permalink to "具体实现方案（分层讲解）"'},"​")],-1)),a[689]||(a[689]=e("p",null,'你可以按照从"最简单"到"最优雅"的顺序来介绍你的解决方案，这能体现你思考的层次。',-1)),a[690]||(a[690]=e("h5",{id:"方案一-最直接的方法-重写-tostring-方法",tabindex:"-1"},[r("方案一：最直接的方法 - 重写 "),e("code",null,"toString()"),r(" 方法 "),e("a",{class:"header-anchor",href:"#方案一-最直接的方法-重写-tostring-方法","aria-label":'Permalink to "方案一：最直接的方法 - 重写 `toString()` 方法"'},"​")],-1)),a[691]||(a[691]=e("p",null,[e("strong",null,"做法："),r(" 禁止在实体类中使用Lombok的"),e("code",null,"@Data"),r("注解自动生成"),e("code",null,"toString()"),r("，而是手动重写，只包含核心ID和名称等关键字段。")],-1)),a[692]||(a[692]=e("p",null,[e("strong",null,"示例代码对比：")],-1)),a[693]||(a[693]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 【优化前 - 危险的写法】")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Data")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Long id;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String name;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String address;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ... 还有30多个字段")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ContactPerson"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> contactList; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 关联对象，更大！")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'// 打印日志：log.debug("Processing supplier: {}", supplier);')]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 输出：Supplier(id=1, name=XX公司, address=XX路..., contactList=[...])"),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // 巨大！")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 【优化后 - 安全的写法】")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Data")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Long id;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String name;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String address;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ... 其他字段")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toString"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Supplier{"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'                "id="'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," id "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'                ", name=\'"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," name "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," '"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\'"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"                '}'"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 只打印核心标识字段")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[694]||(a[694]=e("p",null,[e("strong",null,"评价：")],-1)),a[695]||(a[695]=e("blockquote",null,[e("p",null,[r('"这是最基础、最快速的修复方式，能立即解决大部分问题。但它的缺点是'),e("strong",null,"侵入性强"),r('，需要在每个实体类中手动维护，而且团队开发中容易遗漏。"')])],-1)),a[696]||(a[696]=e("h5",{id:"方案二-更优雅的方法-使用自定义工具类与注解",tabindex:"-1"},[r("方案二：更优雅的方法 - 使用自定义工具类与注解 "),e("a",{class:"header-anchor",href:"#方案二-更优雅的方法-使用自定义工具类与注解","aria-label":'Permalink to "方案二：更优雅的方法 - 使用自定义工具类与注解"'},"​")],-1)),a[697]||(a[697]=e("p",null,[e("strong",null,"做法："),r(" 创建一个"),e("code",null,"LogUtil"),r('工具类，利用反射或预定义的规则，在需要打印日志时，动态生成一个只包含关键信息的"安全视图"对象。')],-1)),a[698]||(a[698]=e("p",null,[e("strong",null,"示例代码：")],-1)),a[699]||(a[699]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 定义一个注解，标记需要日志打印的字段")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Target"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ElementType.FIELD)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Retention"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(RetentionPolicy.RUNTIME)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"interface"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," LogField"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 2. 在实体类中标记")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Data")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Supplier"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"LogField")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Long id;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"LogField")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String name;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String address; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 这个不会被打印")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ...")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 3. 创建日志工具类")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," LogUtil"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Object "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toSafeLogObject"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Object "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"obj"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (obj "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 这里可以通过反射读取@LogField注解，构建一个Map或JSON字符串")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 或者简单点：如果是集合，只返回大小；如果是大对象，返回其ID。")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (obj "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Collection) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Collection(size="'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((Collection) obj)."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ")"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (obj "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"instanceof"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," BaseEntity) { "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 假设你的实体有统一基类")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," obj."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getClass"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSimpleName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "(id="'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ((BaseEntity) obj)."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ")"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 对于其他复杂对象，调用其安全的toString()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," obj."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toString"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 4. 使用方式")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"debug"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Processing supplier: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", LogUtil."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toSafeLogObject"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplier));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 输出：Processing supplier: Supplier(id=1, name=XX公司)")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[700]||(a[700]=e("p",null,[e("strong",null,"评价：")],-1)),a[701]||(a[701]=e("blockquote",null,[e("p",null,[r('"这种方式更加优雅和集中，'),e("strong",null,"将日志安全的逻辑收敛到了一处"),r('，降低了业务代码的侵入性。我们可以根据不同类型对象定制化其’安全视图’。"')])],-1)),a[702]||(a[702]=e("h5",{id:"方案三-最根本的方法-使用日志占位符并前置判断",tabindex:"-1"},[r("方案三：最根本的方法 - 使用日志占位符并前置判断 "),e("a",{class:"header-anchor",href:"#方案三-最根本的方法-使用日志占位符并前置判断","aria-label":'Permalink to "方案三：最根本的方法 - 使用日志占位符并前置判断"'},"​")],-1)),a[703]||(a[703]=e("p",null,[e("strong",null,"做法："),r(" 在打印DEBUG/TRACE等低级别日志前，先使用"),e("code",null,"isDebugEnabled()"),r("进行判断，避免不必要的字符串拼接和对象序列化。")],-1)),a[704]||(a[704]=e("p",null,[e("strong",null,"示例代码：")],-1)),a[705]||(a[705]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 【优化前 - 即使日志级别为ERROR，这行代码也会执行toString()】")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"debug"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Processing supplier: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", supplier);")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 【优化后 - 只有启用DEBUG时，才会进行参数计算】")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isDebugEnabled"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"debug"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Processing supplier: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", LogUtil."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toSafeLogObject"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(supplier));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[706]||(a[706]=e("p",null,[e("strong",null,"评价：")],-1)),a[707]||(a[707]=e("blockquote",null,[e("p",null,[r('"这是'),e("strong",null,"性能最高"),r("的写法。它从根本上避免了在不需要日志时，任何不必要的计算开销。我们将其作为代码规范在团队中推广，并结合前面的"),e("code",null,"LogUtil"),r('，形成了最佳实践。"')])],-1)),a[708]||(a[708]=e("hr",null,null,-1)),a[709]||(a[709]=e("h4",{id:"面试完整话术模板",tabindex:"-1"},[r("面试完整话术模板 "),e("a",{class:"header-anchor",href:"#面试完整话术模板","aria-label":'Permalink to "面试完整话术模板"'},"​")],-1)),a[710]||(a[710]=e("p",null,"你可以这样连贯地讲述：",-1)),a[711]||(a[711]=e("blockquote",null,[e("p",null,[r('"在采购服务项目中，我们曾遇到一个由'),e("strong",null,"日志打印大对象"),r("引发的严重性能问题。直接打印完整的供应商或评估模板对象，会导致单条日志过大，不仅撑爆磁盘、消耗CPU，更危险的是可能压垮异步日志框架的内存队列，导致OOM。")]),e("p",null,"我的优化是分三步走的："),e("ol",null,[e("li",null,[e("strong",null,"首先，我制定了代码规范"),r("，禁止使用Lombok的默认"),e("code",null,"toString()"),r("，要求所有实体类重写该方法，只输出核心ID和名称。")]),e("li",null,[e("strong",null,"其次，为了更优雅地统一处理"),r("，我设计了一个"),e("code",null,"LogUtil"),r("工具类。它利用反射和自定义注解，能够为任何对象生成一个只包含关键信息的’安全视图’，从根本上避免了敏感数据和超大对象的输出。")]),e("li",null,[e("strong",null,"最后，结合性能最佳实践"),r("，我们要求在打印DEBUG/TRACE日志前，必须使用"),e("code",null,"isDebugEnabled()"),r("进行判断，避免不必要的日志对象构建开销。")])]),e("p",null,[r("通过这些组合措施，我们"),e("strong",null,"将单条日志的平均大小降低了90%以上"),r('，并且再未发生过因日志打印导致的内存或CPU问题，系统的稳定性和可观测性都得到了显著提升。"')])],-1)),a[712]||(a[712]=e("p",null,[r("这样回答，你不仅给出了解决方案，还体现了你从"),e("strong",null,"问题识别 -> 临时修复 -> 架构优化 -> 规范建立"),r("的完整系统性思考能力，非常加分。")],-1)),a[713]||(a[713]=e("hr",null,null,-1)),a[714]||(a[714]=e("h2",{id:"面经四-软通-华为项目",tabindex:"-1"},[r("面经四：软通 - 华为项目 "),e("a",{class:"header-anchor",href:"#面经四-软通-华为项目","aria-label":'Permalink to "面经四：软通 - 华为项目"'},"​")],-1)),a[715]||(a[715]=e("hr",null,null,-1)),a[716]||(a[716]=e("h3",{id:"q-cas中aba问题",tabindex:"-1"},[r("Q：CAS中ABA问题 "),e("a",{class:"header-anchor",href:"#q-cas中aba问题","aria-label":'Permalink to "Q：CAS中ABA问题"'},"​")],-1)),a[717]||(a[717]=e("h4",{id:"_1-什么是cas",tabindex:"-1"},[r("1. 什么是CAS？ "),e("a",{class:"header-anchor",href:"#_1-什么是cas","aria-label":'Permalink to "1. 什么是CAS？"'},"​")],-1)),a[718]||(a[718]=e("p",null,"在深入ABA问题之前，我们必须先理解CAS本身。",-1)),a[719]||(a[719]=e("p",null,[e("strong",null,"CAS（Compare-And-Swap）"),r(" 是一种"),e("strong",null,"无锁编程"),r("的核心原子操作。它用于实现多线程环境下的同步，而无需使用传统的互斥锁。")],-1)),a[720]||(a[720]=e("p",null,"一个CAS操作包含三个操作数：",-1)),a[721]||(a[721]=e("ol",null,[e("li",null,[e("strong",null,"内存位置（V）")]),e("li",null,[e("strong",null,"期望的原始值（A）")]),e("li",null,[e("strong",null,"新值（B）")])],-1)),a[722]||(a[722]=e("p",null,[e("strong",null,"CAS的操作逻辑是：")],-1)),a[723]||(a[723]=e("blockquote",null,[e("p",null,"“我认为内存位置V的值应该是A。如果是，那么请将V的值更新为B；否则，不要修改它，但要告诉我当前的实际值是什么。”")],-1)),a[724]||(a[724]=e("p",null,[r("这个操作是作为"),e("strong",null,"一条单独的原子指令"),r("由CPU提供的（例如，在x86架构上是 "),e("code",null,"CMPXCHG"),r(" 指令）。这意味着在整个比较和交换的过程中，不会有其他线程插入来修改这个内存值。")],-1)),a[725]||(a[725]=e("p",null,[e("strong",null,"CAS的典型应用：")],-1)),a[726]||(a[726]=e("ul",null,[e("li",null,[r("实现原子类（如 "),e("code",null,"java.util.concurrent.atomic"),r(" 包下的 "),e("code",null,"AtomicInteger"),r("）。")]),e("li",null,"实现自旋锁。"),e("li",null,"实现无锁数据结构（如队列、栈）。")],-1)),a[727]||(a[727]=e("hr",null,null,-1)),a[728]||(a[728]=e("h4",{id:"_2-aba问题的定义与产生场景",tabindex:"-1"},[r("2. ABA问题的定义与产生场景 "),e("a",{class:"header-anchor",href:"#_2-aba问题的定义与产生场景","aria-label":'Permalink to "2. ABA问题的定义与产生场景"'},"​")],-1)),a[729]||(a[729]=e("p",null,"ABA问题是CAS操作中一个经典且隐蔽的陷阱。",-1)),a[730]||(a[730]=e("p",null,[e("strong",null,"定义："),r(" ABA问题是指，一个线程在执行CAS操作时，发现内存位置V的值确实是它期望的A，于是它认为这个值没有被修改过，并成功地将它更新为B。然而，"),e("strong",null,"在它读取A和进行CAS操作的这段时间内，内存值可能已经经历了一个变化循环：从A变为B，然后又变回A"),r("。")],-1)),a[731]||(a[731]=e("p",null,"这个“A -> ? -> A”的过程，使得第一个线程的CAS操作在逻辑上变得不再安全，因为它所基于的假设（“值没变，所以状态也没变”）是错误的。",-1)),a[732]||(a[732]=e("h5",{id:"一个生动的比喻-栈的aba问题",tabindex:"-1"},[r("一个生动的比喻（栈的ABA问题） "),e("a",{class:"header-anchor",href:"#一个生动的比喻-栈的aba问题","aria-label":'Permalink to "一个生动的比喻（栈的ABA问题）"'},"​")],-1)),a[733]||(a[733]=e("p",null,[r("假设有一个无锁栈，栈顶元素是 "),e("code",null,"A"),r("。")],-1)),a[734]||(a[734]=e("ol",null,[e("li",null,[e("strong",null,"线程1"),r(" 准备执行一个出栈操作。它读取到栈顶为 "),e("code",null,"A"),r("，然后它被操作系统挂起。 "),e("ul",null,[e("li",null,[r("线程1的期望值："),e("code",null,"A")]),e("li",null,[r("线程1想要做：将栈顶从 "),e("code",null,"A"),r(" 设置为 "),e("code",null,"A.next"),r("（假设为 "),e("code",null,"null"),r("）。")])])]),e("li",null,[e("strong",null,"线程2"),r(" 在此期间开始运行并执行了一系列操作： "),e("ul",null,[e("li",null,[e("strong",null,"步骤1（A->B）"),r("： 线程2执行出栈，成功将栈顶从 "),e("code",null,"A"),r(" 改为 "),e("code",null,"B"),r("。")]),e("li",null,[e("strong",null,"步骤2（B->A）"),r("： 线程2又执行入栈，将 "),e("code",null,"A"),r(" 再次压入栈中。此时栈顶又变回了 "),e("code",null,"A"),r("。"),e("strong",null,[r("注意：虽然栈顶的值还是 "),e("code",null,"A"),r("，但整个栈的状态已经发生了变化！")]),r(" 比如，"),e("code",null,"A.next"),r(" 可能已经不再是之前的 "),e("code",null,"null"),r("，或者栈中的其他元素已经变了。")])])]),e("li",null,[e("strong",null,"线程1"),r(" 恢复运行，开始执行CAS操作。它检查栈顶：“嗯，还是 "),e("code",null,"A"),r("，和我离开时一样”。于是CAS成功，将栈顶设置为 "),e("code",null,"A.next"),r("（即 "),e("code",null,"null"),r("）。")])],-1)),a[735]||(a[735]=e("p",null,[e("strong",null,"结果："),r(" 线程2入栈的 "),e("code",null,"A"),r(" 被线程1的CAS操作无情地丢弃了，栈顶直接变成了 "),e("code",null,"null"),r("。这导致数据丢失，破坏了栈的完整性。")],-1)),a[736]||(a[736]=e("hr",null,null,-1)),a[737]||(a[737]=e("h4",{id:"_3-aba问题的根本原因与危害",tabindex:"-1"},[r("3. ABA问题的根本原因与危害 "),e("a",{class:"header-anchor",href:"#_3-aba问题的根本原因与危害","aria-label":'Permalink to "3. ABA问题的根本原因与危害"'},"​")],-1)),a[738]||(a[738]=e("p",null,[e("strong",null,"根本原因："),r(" CAS操作只关注"),e("strong",null,"值的相等性"),r("，而忽略了"),e("strong",null,"状态的变化历史"),r("。它无法感知到值在中间过程中是否发生过变化。")],-1)),a[739]||(a[739]=e("p",null,[e("strong",null,"危害：")],-1)),a[740]||(a[740]=e("ol",null,[e("li",null,[e("strong",null,"数据不一致"),r("： 如上例所示，会导致数据丢失或数据结构被破坏。")]),e("li",null,[e("strong",null,"逻辑错误"),r("： 程序的业务逻辑可能依赖于“值未被改变”这一强假设。ABA的发生使得这个假设不成立，从而导致难以复现和调试的逻辑错误。")]),e("li",null,[e("strong",null,"隐蔽性强"),r("： ABA问题在高并发场景下发生的概率相对较低，且难以通过常规测试发现，通常需要在极大压力下长时间运行才会暴露，因此非常危险。")])],-1)),a[741]||(a[741]=e("hr",null,null,-1)),a[742]||(a[742]=e("h4",{id:"_4-解决方案",tabindex:"-1"},[r("4. 解决方案 "),e("a",{class:"header-anchor",href:"#_4-解决方案","aria-label":'Permalink to "4. 解决方案"'},"​")],-1)),a[743]||(a[743]=e("p",null,[r("解决ABA问题的核心思想是："),e("strong",null,"让CAS操作不仅关心值，还要关心版本号或状态标识"),r("。")],-1)),a[744]||(a[744]=e("h5",{id:"方案1-原子引用-版本号-stamp",tabindex:"-1"},[r("方案1：原子引用+版本号（Stamp） "),e("a",{class:"header-anchor",href:"#方案1-原子引用-版本号-stamp","aria-label":'Permalink to "方案1：原子引用+版本号（Stamp）"'},"​")],-1)),a[745]||(a[745]=e("p",null,"这是最常用、最经典的解决方案。",-1)),a[746]||(a[746]=e("p",null,[e("strong",null,"原理："),r(" 不再仅仅比较一个值，而是比较一个 "),e("code",null,"(值， 版本号)"),r(" 对。每次更新值，版本号都递增（或改变）。这样，即使值从A变回A，版本号也早已不同。")],-1)),a[747]||(a[747]=e("p",null,[r("在Java中，可以使用 "),e("code",null,"AtomicStampedReference<V>"),r(" 类。")],-1)),a[748]||(a[748]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.util.concurrent.atomic.AtomicStampedReference;")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ABASolution"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," AtomicStampedReference<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> atomicStampedRef "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," AtomicStampedReference<>("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"A"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'// 初始值"A"，初始版本号0')]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," main"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[] "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"args"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," InterruptedException {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String initialRef "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getReference"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," initialStamp "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 线程1：模拟ABA场景")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Thread t1 "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Thread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 模拟线程1在读取后暂停")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Thread."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sleep"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (InterruptedException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"printStackTrace"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'            // 尝试CAS，期望值是"A"，期望版本号是0，新值是"B"，新版本号是1')]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            boolean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," success "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'                "A"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"B"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", initialStamp, initialStamp "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            System.out."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Thread 1 CAS: "'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," success); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 输出 false! 因为版本号变了")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        });")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 线程2：执行 A -> B -> A 的操作，并修改版本号")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Thread t2 "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Thread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // A -> B，版本号 0 -> 1")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"A"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"B"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", initialStamp, initialStamp "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            System.out."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Thread 2: A -> B. Stamp: "'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // B -> A，版本号 1 -> 2")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"compareAndSet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"B"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"A"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            System.out."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Thread 2: B -> A. Stamp: "'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicStampedRef."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getStamp"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        });")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        t1."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"start"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        t2."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"start"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        t1."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"join"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        t2."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"join"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[749]||(a[749]=e("h5",{id:"方案2-原子标记引用-atomicmarkablereference",tabindex:"-1"},[r("方案2：原子标记引用（AtomicMarkableReference） "),e("a",{class:"header-anchor",href:"#方案2-原子标记引用-atomicmarkablereference","aria-label":'Permalink to "方案2：原子标记引用（AtomicMarkableReference）"'},"​")],-1)),a[750]||(a[750]=e("p",null,[r("这个方案是版本号的一个简化版。它不使用数字版本号，而是使用一个 "),e("code",null,"boolean"),r(" 标记位。每次修改时，翻转这个标记位。")],-1)),a[751]||(a[751]=e("p",null,"它适用于“这个值是否被修改过”这种二元状态判断，不如版本号精确，但开销更小。",-1)),a[752]||(a[752]=e("h5",{id:"方案3-使用具有唯一性的对象",tabindex:"-1"},[r("方案3：使用具有唯一性的对象 "),e("a",{class:"header-anchor",href:"#方案3-使用具有唯一性的对象","aria-label":'Permalink to "方案3：使用具有唯一性的对象"'},"​")],-1)),a[753]||(a[753]=e("p",null,"确保要CAS的引用指向的对象是“一次性”的。一旦被修改，就创建一个新的对象，而不是复用旧对象。",-1)),a[754]||(a[754]=e("p",null,[r("例如，在上面的栈例子中，我们可以规定每次入栈的节点都必须是新创建的 "),e("code",null,"Node"),r(" 对象。这样，即使线程2将 "),e("code",null,"A"),r(" 再次入栈，它也是一个新的 "),e("code",null,"Node"),r(" 实例（内存地址不同），线程1在CAS时发现期望的引用（旧的A对象地址）和当前栈顶的引用（新的A对象地址）不同，CAS就会失败。")],-1)),a[755]||(a[755]=e("p",null,[r("在Java中，可以使用 "),e("code",null,"AtomicReference<V>"),r("，但必须保证不重用对象。")],-1)),a[756]||(a[756]=e("hr",null,null,-1)),a[757]||(a[757]=e("h4",{id:"总结-3",tabindex:"-1"},[r("总结 "),e("a",{class:"header-anchor",href:"#总结-3","aria-label":'Permalink to "总结"'},"​")],-1)),a[758]||(a[758]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"方面"),e("th",{style:{"text-align":"left"}},"描述")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"问题本质")]),e("td",{style:{"text-align":"left"}},[r("CAS只校验"),e("strong",null,"值"),r("的同一性，不校验"),e("strong",null,"状态"),r("的连续性。")])]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"产生条件")]),e("td",{style:{"text-align":"left"}},"一个值被改为其他值后又改回原值。")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"核心危害")]),e("td",{style:{"text-align":"left"}},"导致数据结构的完整性和业务逻辑的正确性被破坏，且问题隐蔽。")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"解决方案")]),e("td",{style:{"text-align":"left"}},[r("引入"),e("strong",null,"版本号"),r("（"),e("code",null,"AtomicStampedReference"),r("）或"),e("strong",null,"唯一标识"),r("，让CAS从“比较值”升级为“比较状态”。")])])])],-1)),a[759]||(a[759]=e("p",null,[r("在实际开发中，如果您的应用场景存在值被循环修改的可能，并且状态的连续性对业务逻辑至关重要，那么"),e("strong",null,"必须使用带版本号的原子引用"),r("来规避ABA问题。对于简单的计数器等场景，普通的CAS操作通常是安全的。")],-1)),a[760]||(a[760]=e("hr",null,null,-1)),a[761]||(a[761]=e("h3",{id:"q-在项目中有用到线程池吗-如果有-如何应用线程池",tabindex:"-1"},[r("Q：在项目中有用到线程池吗，如果有，如何应用线程池？ "),e("a",{class:"header-anchor",href:"#q-在项目中有用到线程池吗-如果有-如何应用线程池","aria-label":'Permalink to "Q：在项目中有用到线程池吗，如果有，如何应用线程池？"'},"​")],-1)),a[762]||(a[762]=e("p",null,"当然有使用，线程池是这类企业级系统中提升性能的核心组件。下面我将详细说明在项目中如何专业地应用线程池。",-1)),a[763]||(a[763]=e("h4",{id:"线程池在项目中的核心应用场景",tabindex:"-1"},[r("线程池在项目中的核心应用场景 "),e("a",{class:"header-anchor",href:"#线程池在项目中的核心应用场景","aria-label":'Permalink to "线程池在项目中的核心应用场景"'},"​")],-1)),a[764]||(a[764]=e("h5",{id:"_1-excel数据导入-主要应用场景",tabindex:"-1"},[r("1. "),e("strong",null,"Excel数据导入 - 主要应用场景"),r(),e("a",{class:"header-anchor",href:"#_1-excel数据导入-主要应用场景","aria-label":'Permalink to "1. **Excel数据导入 - 主要应用场景**"'},"​")],-1)),a[765]||(a[765]=e("p",null,"这是你职责中明确提到的，也是线程池最经典的应用。",-1)),a[766]||(a[766]=e("p",null,[e("strong",null,"问题背景：")],-1)),a[767]||(a[767]=e("ul",null,[e("li",null,[r("需要导入的零部件数据可能包含"),e("strong",null,"数万行")]),e("li",null,"每行数据需要：数据校验 → 格式转换 → 业务规则验证 → 数据库写入"),e("li",null,[r("单线程串行处理需要"),e("strong",null,"5分钟以上"),r("，用户体验极差")])],-1)),a[768]||(a[768]=e("p",null,[e("strong",null,"线程池解决方案：")],-1)),a[769]||(a[769]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 1. 创建专用的线程池")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"excelImportExecutor"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolTaskExecutor "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"excelImportExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ThreadPoolTaskExecutor executor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ThreadPoolTaskExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCorePoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");     "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 核心线程数")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMaxPoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");     "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 最大线程数  ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setQueueCapacity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");  "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 队列容量")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setThreadNamePrefix"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"excel-import-"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 线程名前缀，便于监控")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setRejectedExecutionHandler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolExecutor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"CallerRunsPolicy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 拒绝策略")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"initialize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," executor;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 2. 使用CompletableFuture进行并行处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," importParts"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(List"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"PartData"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," partDataList) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 将大数据列表拆分成小批次（如每批100条）")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    List<List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> batches "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Lists."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"partition"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(partDataList, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 为每个批次创建异步任务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    List<CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Void"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> futures "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batches."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"map"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(batch "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            processBatch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(batch); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 处理单个批次")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }, excelImportExecutor)) "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 指定使用自定义线程池")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"collect"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Collectors."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 等待所有任务完成")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"allOf"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toArray"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," CompletableFuture"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"["),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]))."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"join"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[770]||(a[770]=e("p",null,[e("strong",null,"技术要点：")],-1)),a[771]||(a[771]=e("ul",null,[e("li",null,[e("strong",null,"分批处理"),r("：避免创建过多线程，控制资源消耗")]),e("li",null,[e("strong",null,[r("使用"),e("code",null,"CallerRunsPolicy")]),r("：当队列满时，由调用线程执行，保证任务不丢失")]),e("li",null,[e("strong",null,"线程命名"),r("：便于在日志和监控中定位问题")])],-1)),a[772]||(a[772]=e("h5",{id:"_2-供应商报价超时检查-异步任务调度",tabindex:"-1"},[r("2. "),e("strong",null,"供应商报价超时检查 - 异步任务调度"),r(),e("a",{class:"header-anchor",href:"#_2-供应商报价超时检查-异步任务调度","aria-label":'Permalink to "2. **供应商报价超时检查 - 异步任务调度**"'},"​")],-1)),a[773]||(a[773]=e("p",null,"虽然你用了RabbitMQ的延时队列，但线程池也可以用于类似的周期性检查任务。",-1)),a[774]||(a[774]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 使用Spring的@Scheduled和线程池执行定时任务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Scheduled"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fixedRate"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 300000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 每5分钟执行一次")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," checkQuoteTimeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 查询即将超时的报价单")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Quote"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> expiringQuotes "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," quoteService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"findExpiringQuotes"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 使用线程池并行处理超时逻辑")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    expiringQuotes."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"forEach"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(quote "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            quoteTimeoutService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"processTimeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(quote);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }, taskExecutor));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[775]||(a[775]=e("h5",{id:"_3-数据导出与报表生成",tabindex:"-1"},[r("3. "),e("strong",null,"数据导出与报表生成"),r(),e("a",{class:"header-anchor",href:"#_3-数据导出与报表生成","aria-label":'Permalink to "3. **数据导出与报表生成**"'},"​")],-1)),a[776]||(a[776]=e("p",null,"与导入类似，大数据量的Excel导出也需要并行处理。",-1)),a[777]||(a[777]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ExportResult"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," exportQuotationReport"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ExportRequest request) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1. 查询数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"QuoteData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> data "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," quoteRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"findByCriteria"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 2. 生成Excel文件")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," excelGenerator."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"generateReport"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }, reportExportExecutor); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 使用专门的报表导出线程池")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[778]||(a[778]=e("h5",{id:"_4-外部系统数据同步",tabindex:"-1"},[r("4. "),e("strong",null,"外部系统数据同步"),r(),e("a",{class:"header-anchor",href:"#_4-外部系统数据同步","aria-label":'Permalink to "4. **外部系统数据同步**"'},"​")],-1)),a[779]||(a[779]=e("p",null,"与PDT系统、物流系统等的数据同步可以使用线程池实现异步非阻塞调用。",-1)),a[780]||(a[780]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," syncPartDataToLogisticsSystem"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Long partId) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            logisticsSystemClient."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"syncPartInfo"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(partId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"同步零件数据到物流系统失败, partId: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", partId, e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 记录失败，后续重试")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            retryService."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"recordSyncFailure"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(partId, "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"LOGISTICS"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }, externalSyncExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[781]||(a[781]=e("hr",null,null,-1)),a[782]||(a[782]=e("h4",{id:"线程池配置的考量因素",tabindex:"-1"},[r("线程池配置的考量因素 "),e("a",{class:"header-anchor",href:"#线程池配置的考量因素","aria-label":'Permalink to "线程池配置的考量因素"'},"​")],-1)),a[783]||(a[783]=e("p",null,[e("strong",null,"为什么需要自定义线程池而不是使用默认的？")],-1)),a[784]||(a[784]=e("ol",null,[e("li",null,[e("strong",null,"资源隔离"),r("： "),e("ul",null,[e("li",null,[e("code",null,"excel-import"),r("：CPU密集型，线程数 ≈ CPU核心数")]),e("li",null,[e("code",null,"external-sync"),r("：IO密集型，线程数可以更多")]),e("li",null,[e("code",null,"report-export"),r("：内存密集型，需要限制并发数")])])]),e("li",null,[e("strong",null,"避免相互影响"),r("： "),e("ul",null,[e("li",null,"一个耗时的Excel导入任务不应该阻塞紧急的价格计算请求"),e("li",null,"通过不同的线程池实现业务隔离")])])],-1)),a[785]||(a[785]=e("p",null,[e("strong",null,"典型配置示例：")],-1)),a[786]||(a[786]=e("div",{class:"language-yaml max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"yaml"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# application.yml")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"async"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  task"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    execution"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      excel-import"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        core-pool-size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"4")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        max-pool-size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        queue-capacity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"50")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      external-sync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        core-pool-size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        max-pool-size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        queue-capacity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      report-export"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        core-pool-size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        max-pool-size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"4")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        queue-capacity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[787]||(a[787]=e("hr",null,null,-1)),a[788]||(a[788]=e("h4",{id:"面试回答话术",tabindex:"-1"},[r("面试回答话术 "),e("a",{class:"header-anchor",href:"#面试回答话术","aria-label":'Permalink to "面试回答话术"'},"​")],-1)),a[789]||(a[789]=e("p",null,"你可以这样专业地阐述：",-1)),a[790]||(a[790]=e("blockquote",null,[e("p",null,[r('"在线程池的应用上，我们主要围绕'),e("strong",null,"性能瓶颈的并行化"),r("和"),e("strong",null,"异步化处理"),r("两个目标。")]),e("p",null,[e("strong",null,"最典型的案例就是您看到的Excel导入优化。"),r(" 之前单线程处理数万行数据需要5分钟，我通过：")]),e("ol",null,[e("li",null,[e("strong",null,"自定义线程池"),r("，根据服务器CPU核心数和任务特性配置合适的参数。")]),e("li",null,[r("采用 "),e("strong",null,"CompletableFuture + 分批处理"),r(" 的模式，将大数据列表拆分成小批次并行处理。")]),e("li",null,[r("为不同业务场景配置"),e("strong",null,"隔离的线程池"),r("，比如Excel导入、外部系统同步、报表生成都有各自的线程池，避免相互阻塞。")])]),e("p",null,[r("通过这套方案，我们将导入时间从"),e("strong",null,"5分钟优化到了10秒内"),r("，并且通过合理的拒绝策略和线程池监控，保证了系统在高并发导入时的稳定性。")]),e("p",null,'此外，在供应商报价超时检查、大数据报表导出等场景也都广泛应用了线程池技术，实现了系统性能的全面提升。"')],-1)),a[791]||(a[791]=e("p",null,[r("这样回答既体现了你的"),e("strong",null,"技术深度"),r("（线程池参数调优、资源隔离），又展示了"),e("strong",null,"业务价值"),r("（性能提升数据），还体现了"),e("strong",null,"系统设计思维"),r("（不同场景的不同策略），是一个全面而专业的回答。")],-1)),a[792]||(a[792]=e("hr",null,null,-1)),a[793]||(a[793]=e("h3",{id:"q-索引失效与最左前缀匹配原则",tabindex:"-1"},[r("Q：索引失效与最左前缀匹配原则 "),e("a",{class:"header-anchor",href:"#q-索引失效与最左前缀匹配原则","aria-label":'Permalink to "Q：索引失效与最左前缀匹配原则"'},"​")],-1)),a[794]||(a[794]=e("hr",null,null,-1)),a[795]||(a[795]=e("h3",{id:"q-联合索引-abc-a-等于-b大于-c等于-是否用到了索引",tabindex:"-1"},[r("Q：联合索引（ABC，A 等于，B大于，C等于）是否用到了索引？ "),e("a",{class:"header-anchor",href:"#q-联合索引-abc-a-等于-b大于-c等于-是否用到了索引","aria-label":'Permalink to "Q：联合索引（ABC，A 等于，B大于，C等于）是否用到了索引？"'},"​")],-1)),a[796]||(a[796]=e("hr",null,null,-1)),a[797]||(a[797]=e("h2",{id:"面经五-欧肯信息科技-香港项目",tabindex:"-1"},[r("面经五：欧肯信息科技－香港项目 "),e("a",{class:"header-anchor",href:"#面经五-欧肯信息科技-香港项目","aria-label":'Permalink to "面经五：欧肯信息科技－香港项目"'},"​")],-1)),a[798]||(a[798]=e("hr",null,null,-1)),a[799]||(a[799]=e("h3",{id:"q-arraylist-与-linkedlist-的区别",tabindex:"-1"},[r("Q：ArrayList 与 LinkedList 的区别 "),e("a",{class:"header-anchor",href:"#q-arraylist-与-linkedlist-的区别","aria-label":'Permalink to "Q：ArrayList 与 LinkedList 的区别"'},"​")],-1)),a[800]||(a[800]=e("h3",{id:"q-spring-ioc-原理",tabindex:"-1"},[r("Q：Spring IOC 原理 "),e("a",{class:"header-anchor",href:"#q-spring-ioc-原理","aria-label":'Permalink to "Q：Spring IOC 原理"'},"​")],-1)),a[801]||(a[801]=e("h3",{id:"q-spring-mvc-如何进行异常处理",tabindex:"-1"},[r("Q：Spring MVC 如何进行异常处理？ "),e("a",{class:"header-anchor",href:"#q-spring-mvc-如何进行异常处理","aria-label":'Permalink to "Q：Spring MVC 如何进行异常处理？"'},"​")],-1)),a[802]||(a[802]=e("h3",{id:"q-如何保证幂等性",tabindex:"-1"},[r("Q：如何保证幂等性？ "),e("a",{class:"header-anchor",href:"#q-如何保证幂等性","aria-label":'Permalink to "Q：如何保证幂等性？"'},"​")],-1)),a[803]||(a[803]=e("h3",{id:"q-completablefuture-在项目中如何实现",tabindex:"-1"},[r("Q：CompletableFuture 在项目中如何实现？ "),e("a",{class:"header-anchor",href:"#q-completablefuture-在项目中如何实现","aria-label":'Permalink to "Q：CompletableFuture 在项目中如何实现？"'},"​")],-1)),a[804]||(a[804]=e("h3",{id:"q-completablefuture-中如何处理异常",tabindex:"-1"},[r("Q：CompletableFuture 中如何处理异常？ "),e("a",{class:"header-anchor",href:"#q-completablefuture-中如何处理异常","aria-label":'Permalink to "Q：CompletableFuture 中如何处理异常？"'},"​")],-1)),a[805]||(a[805]=e("h3",{id:"q-java8的新垃圾回收器对比之前有什么大的变化",tabindex:"-1"},[r("Q： Java8的新垃圾回收器对比之前有什么大的变化？ "),e("a",{class:"header-anchor",href:"#q-java8的新垃圾回收器对比之前有什么大的变化","aria-label":'Permalink to "Q： Java8的新垃圾回收器对比之前有什么大的变化？"'},"​")],-1)),a[806]||(a[806]=e("hr",null,null,-1)),a[807]||(a[807]=e("h2",{id:"面经六-京北方-珠海工行",tabindex:"-1"},[r("面经六：京北方 - 珠海工行 "),e("a",{class:"header-anchor",href:"#面经六-京北方-珠海工行","aria-label":'Permalink to "面经六：京北方 - 珠海工行"'},"​")],-1)),a[808]||(a[808]=e("hr",null,null,-1)),a[809]||(a[809]=e("h3",{id:"q-项目问到并发导入数据最后出现异常如何处理",tabindex:"-1"},[r("Q：项目问到并发导入数据最后出现异常如何处理？ "),e("a",{class:"header-anchor",href:"#q-项目问到并发导入数据最后出现异常如何处理","aria-label":'Permalink to "Q：项目问到并发导入数据最后出现异常如何处理？"'},"​")],-1)),a[810]||(a[810]=e("h4",{id:"异常处理的核心原则",tabindex:"-1"},[r("异常处理的核心原则 "),e("a",{class:"header-anchor",href:"#异常处理的核心原则","aria-label":'Permalink to "异常处理的核心原则"'},"​")],-1)),a[811]||(a[811]=e("ol",null,[e("li",null,[e("strong",null,"用户体验第一"),r("：给用户明确、友好的反馈，告知成功/失败情况。")]),e("li",null,[e("strong",null,"数据一致性"),r("：确保数据不丢、不重、不错。")]),e("li",null,[e("strong",null,"系统可用性"),r("：局部失败不应导致整个系统崩溃。")]),e("li",null,[e("strong",null,"可追溯性"),r("：任何异常都必须有迹可循，便于排查。")])],-1)),a[812]||(a[812]=e("hr",null,null,-1)),a[813]||(a[813]=e("h4",{id:"具体异常场景与处理方案",tabindex:"-1"},[r("具体异常场景与处理方案 "),e("a",{class:"header-anchor",href:"#具体异常场景与处理方案","aria-label":'Permalink to "具体异常场景与处理方案"'},"​")],-1)),a[814]||(a[814]=e("h5",{id:"场景一-数据导入过程中的异常",tabindex:"-1"},[r("场景一：数据导入过程中的异常 "),e("a",{class:"header-anchor",href:"#场景一-数据导入过程中的异常","aria-label":'Permalink to "场景一：数据导入过程中的异常"'},"​")],-1)),a[815]||(a[815]=e("p",null,[e("strong",null,"可能异常"),r("：")],-1)),a[816]||(a[816]=e("ul",null,[e("li",null,[e("strong",null,"单条数据格式错误"),r("（如日期格式不对、数字解析失败）")]),e("li",null,[e("strong",null,"业务逻辑校验失败"),r("（如供应商不存在、零件编号重复）")]),e("li",null,[e("strong",null,"数据库约束冲突"),r("（唯一键冲突、外键不存在）")]),e("li",null,[e("strong",null,"系统级错误"),r("（数据库连接中断、Redis超时、网络抖动）")])],-1)),a[817]||(a[817]=e("p",null,[e("strong",null,"处理策略：")],-1)),a[818]||(a[818]=e("ol",null,[e("li",null,[e("strong",null,'采用 "部分成功，部分失败" 策略'),e("ul",null,[e("li",null,"不能因为单条记录的失败而回滚整个导入任务。"),e("li",null,[r("实现一个"),e("strong",null,'批量操作的"柔性事务"'),r("。")])])]),e("li",null,[e("strong",null,"实现方案：")])],-1)),a[819]||(a[819]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DataImportService"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ImportResult "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"concurrentImport"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"dataList"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1. 数据预处理与分批")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> batches "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Lists."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"partition"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dataList, "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        List<CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BatchResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> futures "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ArrayList<>();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 2. 为每个批次创建异步任务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; i "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batches."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); i"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            final"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batchIndex "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," i;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PartData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> batch "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batches."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(i);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            CompletableFuture<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"BatchResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> future "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"supplyAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                BatchResult batchResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," BatchResult"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (PartData data "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batch) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 3. 单条记录事务处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                        processSingleRecord"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        batchResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addSuccess"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (DataValidationException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 业务校验异常 - 记录但继续处理其他数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        batchResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addFailed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data, "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"数据校验失败: "'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (DuplicateKeyException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 唯一键冲突 - 记录但继续处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        batchResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addFailed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data, "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"数据重复: "'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 系统级异常 - 记录并可能终止当前批次")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        batchResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addFailed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data, "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"系统错误: "'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"处理数据异常, data: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", data, e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," batchResult;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }, importExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            futures."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"add"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(future);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 4. 汇总所有批次结果")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," aggregateResults"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(futures);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"propagation"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Propagation.REQUIRES_NEW) "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 每条记录独立事务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processSingleRecord"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(PartData "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"data"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 数据校验")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        validateData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 业务逻辑处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        processBusinessLogic"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 数据持久化")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        saveToDatabase"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[820]||(a[820]=e("p",null,[e("strong",null,"关键技术点：")],-1)),a[821]||(a[821]=e("ul",null,[e("li",null,[e("strong",null,[e("code",null,"@Transactional(propagation = Propagation.REQUIRES_NEW)")]),r("：为每条记录创建独立事务，确保单条失败不影响其他记录。")]),e("li",null,[e("strong",null,"异常分类处理"),r("：区分业务异常和系统异常，采取不同策略。")]),e("li",null,[e("strong",null,"结果聚合"),r("：最终生成详细的导入报告。")])],-1)),a[822]||(a[822]=e("h5",{id:"场景二-数据导出过程中的异常",tabindex:"-1"},[r("场景二：数据导出过程中的异常 "),e("a",{class:"header-anchor",href:"#场景二-数据导出过程中的异常","aria-label":'Permalink to "场景二：数据导出过程中的异常"'},"​")],-1)),a[823]||(a[823]=e("p",null,[e("strong",null,"可能异常"),r("：")],-1)),a[824]||(a[824]=e("ul",null,[e("li",null,[e("strong",null,"查询超时"),r("（数据量太大，SQL执行慢）")]),e("li",null,[e("strong",null,"内存溢出"),r("（OOM，数据量超出JVM堆内存）")]),e("li",null,[e("strong",null,"文件生成失败"),r("（磁盘空间不足、Excel格式错误）")]),e("li",null,[e("strong",null,"网络中断"),r("（下载过程中客户端断开连接）")])],-1)),a[825]||(a[825]=e("p",null,[e("strong",null,"处理策略：")],-1)),a[826]||(a[826]=e("ol",null,[e("li",null,[e("strong",null,"流式查询 + 分页生成"),e("ul",null,[e("li",null,"避免一次性加载所有数据到内存。")])])],-1)),a[827]||(a[827]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," exportQuotationData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ExportRequest request, HttpServletResponse response) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String taskId "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," generateTaskId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 1. 立即响应，异步处理")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        response."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setHeader"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"X-Task-Id"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", taskId);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        writeInitialResponse"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(response, "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"导出任务已开始"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 2. 异步执行导出")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        CompletableFuture."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 3. 使用游标或分页流式查询")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Cursor<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"QuotationData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> cursor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," quotationRepository."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"streamByCriteria"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(request)) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ExcelWriter excelWriter "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," EasyExcel."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getOutputStream"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(taskId))")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"head"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(QuotationData.class)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," rowCount "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    List<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"QuotationData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> batch "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ArrayList<>("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    for"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (QuotationData data "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cursor) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        batch."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"add"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        rowCount"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"++"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 每1000条刷新一次到磁盘，避免内存堆积")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (batch."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1000"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            excelWriter."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(batch, EasyExcel."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"writerSheet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价数据"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                            batch."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"clear"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                        // 定期更新进度")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (rowCount "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"%"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5000"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," =="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                            updateProgress"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(taskId, rowCount);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                    // 写入剩余数据")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"batch."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isEmpty"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        excelWriter."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(batch, EasyExcel."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"writerSheet"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"报价数据"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"build"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    excelWriter."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"finish"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    markTaskAsCompleted"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(taskId, rowCount);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"导出任务失败, taskId: {}"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", taskId, e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                markTaskAsFailed"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(taskId, e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }, exportExecutor);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"创建导出任务失败"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", e);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ExportException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"创建导出任务失败: "'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[828]||(a[828]=e("p",null,[e("strong",null,"关键技术点：")],-1)),a[829]||(a[829]=e("ul",null,[e("li",null,[e("strong",null,"异步处理"),r("：避免HTTP请求超时。")]),e("li",null,[e("strong",null,"游标查询"),r("：使用Spring Data JPA的Streamable或MyBatis的Cursor进行流式查询。")]),e("li",null,[e("strong",null,"分批写入"),r("：避免一次性生成超大Excel文件导致OOM。")]),e("li",null,[e("strong",null,"进度跟踪"),r("：通过Redis或数据库记录任务状态，支持进度查询。")])],-1)),a[830]||(a[830]=e("h5",{id:"场景三-系统级并发异常",tabindex:"-1"},[r("场景三：系统级并发异常 "),e("a",{class:"header-anchor",href:"#场景三-系统级并发异常","aria-label":'Permalink to "场景三：系统级并发异常"'},"​")],-1)),a[831]||(a[831]=e("p",null,[e("strong",null,"可能异常"),r("：")],-1)),a[832]||(a[832]=e("ul",null,[e("li",null,[e("strong",null,"数据库连接池耗尽")]),e("li",null,[e("strong",null,"死锁"),r("（多个导入任务同时操作相同资源）")]),e("li",null,[e("strong",null,"资源竞争"),r("（多个线程同时处理相同供应商的数据）")])],-1)),a[833]||(a[833]=e("p",null,[e("strong",null,"处理策略：")],-1)),a[834]||(a[834]=e("ol",null,[e("li",null,[e("strong",null,"资源隔离与限流")])],-1)),a[835]||(a[835]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"importExecutor"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolTaskExecutor "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"importExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ThreadPoolTaskExecutor executor "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ThreadPoolTaskExecutor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCorePoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");  "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//  intentionally small")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMaxPoolSize"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"4"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setQueueCapacity"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setRejectedExecutionHandler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ThreadPoolExecutor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"CallerRunsPolicy"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    executor."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setThreadNamePrefix"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"import-"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," executor;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[836]||(a[836]=e("ol",null,[e("li",null,[e("strong",null,"分布式锁防止资源竞争")])],-1)),a[837]||(a[837]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processSingleRecord"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(PartData data) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String lockKey "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "import:supplier:"'),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," data."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSupplierId"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    RLock lock "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," redissonClient."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getLock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(lockKey);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 尝试获取锁，等待5秒，锁有效期30秒")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tryLock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.SECONDS)) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 处理同一供应商的数据，避免并发问题")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            processSupplierData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(data);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ConcurrentAccessException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"系统繁忙，请稍后重试"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isHeldByCurrentThread"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            lock."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"unlock"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[838]||(a[838]=e("hr",null,null,-1)),a[839]||(a[839]=e("h4",{id:"完整的异常处理架构",tabindex:"-1"},[r("完整的异常处理架构 "),e("a",{class:"header-anchor",href:"#完整的异常处理架构","aria-label":'Permalink to "完整的异常处理架构"'},"​")],-1)),a[840]||(a[840]=e("p",null,[e("strong",null,"1. 统一的异常处理框架")],-1)),a[841]||(a[841]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ControllerAdvice")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," GlobalExceptionHandler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ExceptionHandler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(DataImportException.class)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ApiResponse"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"handleImportException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(DataImportException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 返回结构化的错误信息")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"status"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(HttpStatus.BAD_REQUEST)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"body"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ApiResponse."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getErrorCode"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getFailedRecords"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ExceptionHandler"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ExportException.class)  ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ApiResponse"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"handleExportException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ExportException "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"status"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(HttpStatus.INTERNAL_SERVER_ERROR)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                ."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"body"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ApiResponse."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"EXPORT_ERROR"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", e."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMessage"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()));")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[842]||(a[842]=e("p",null,[e("strong",null,"2. 完善的监控与告警")],-1)),a[843]||(a[843]=e("ul",null,[e("li",null,"通过Micrometer监控线程池状态、数据库连接池使用率"),e("li",null,"关键异常通过钉钉/邮件告警"),e("li",null,"通过ELK收集和分析异常日志")],-1)),a[844]||(a[844]=e("hr",null,null,-1)),a[845]||(a[845]=e("h4",{id:"面试回答话术-1",tabindex:"-1"},[r("面试回答话术 "),e("a",{class:"header-anchor",href:"#面试回答话术-1","aria-label":'Permalink to "面试回答话术"'},"​")],-1)),a[846]||(a[846]=e("p",null,"你可以这样总结：",-1)),a[847]||(a[847]=e("blockquote",null,[e("p",null,'"在并发导入导出场景下，我们的异常处理是分层、分场景的：'),e("p",null,[e("strong",null,"对于导入异常"),r("，我们采用’部分成功’策略。通过为每条记录创建独立事务，结合精细的异常分类捕获，确保单条数据的失败不会影响整体导入流程，同时为用户提供详细的失败报告。")]),e("p",null,[e("strong",null,"对于导出异常"),r("，核心是防患于未然。我们通过流式查询、分批写入的技术，从根本上避免了OOM和超时问题。同时采用异步任务机制，让用户能够跟踪导出进度，并在失败时获得明确反馈。")]),e("p",null,[e("strong",null,"在系统层面"),r("，我们通过线程池隔离、分布式锁、限流等手段，预防并发带来的系统性风险，确保局部异常不会扩散。")]),e("p",null,'这套方案让我们在面对日均数十万的导入导出请求时，仍能保证99.5%以上的任务成功率和良好的用户体验。"')],-1)),a[848]||(a[848]=e("p",null,[r("这样的回答体现了你从"),e("strong",null,"具体技术实现"),r("到"),e("strong",null,"架构设计思想"),r("的全面思考，展现了处理复杂问题的能力。")],-1)),a[849]||(a[849]=e("hr",null,null,-1)),a[850]||(a[850]=e("h3",{id:"q-rabbitmq-工作模式",tabindex:"-1"},[r("Q：RabbitMQ 工作模式 "),e("a",{class:"header-anchor",href:"#q-rabbitmq-工作模式","aria-label":'Permalink to "Q：RabbitMQ 工作模式"'},"​")],-1)),a[851]||(a[851]=e("h4",{id:"_1-简单模式-hello-world",tabindex:"-1"},[r("1. 简单模式 / Hello World "),e("a",{class:"header-anchor",href:"#_1-简单模式-hello-world","aria-label":'Permalink to "1. 简单模式 / Hello World"'},"​")],-1)),a[852]||(a[852]=e("p",null,"这是最基础的模式，它甚至不需要显式地声明交换器。",-1)),a[853]||(a[853]=e("ul",null,[e("li",null,[e("strong",null,"核心组件"),r("：一个生产者、一个队列、一个消费者。")]),e("li",null,[e("strong",null,"交换器"),r("：使用默认的匿名交换器（"),e("code",null,'""'),r("）。生产者将消息直接发送到队列。")]),e("li",null,[e("strong",null,"路由逻辑"),r("：消息直接进入指定的队列。")]),e("li",null,[e("strong",null,"应用场景"),r("：最简单的任务分发，一对一通信。")])],-1)),a[854]||(a[854]=e("p",null,[e("strong",null,"流程图"),r("： "),e("code",null,"生产者"),r(" —> "),e("code",null,"(默认交换器)"),r(" —> "),e("code",null,"队列"),r(" —> "),e("code",null,"消费者")],-1)),a[855]||(a[855]=e("hr",null,null,-1)),a[856]||(a[856]=e("h4",{id:"_2-工作队列模式-work-queue",tabindex:"-1"},[r("2. 工作队列模式 / Work Queue "),e("a",{class:"header-anchor",href:"#_2-工作队列模式-work-queue","aria-label":'Permalink to "2. 工作队列模式 / Work Queue"'},"​")],-1)),a[857]||(a[857]=e("p",null,"用于在多个消费者之间分发耗时的任务。",-1)),a[858]||(a[858]=e("ul",null,[e("li",null,[e("strong",null,"核心组件"),r("：一个生产者、一个队列、"),e("strong",null,"多个"),r("消费者。")]),e("li",null,[e("strong",null,"交换器"),r("：同样使用默认交换器。")]),e("li",null,[e("strong",null,"路由逻辑"),r("：消息进入一个队列，但由多个消费者共同处理。RabbitMQ 会以"),e("strong",null,"轮询"),r(" 的方式将消息依次分发给不同的消费者。")]),e("li",null,[e("strong",null,"关键特性"),r("： "),e("ul",null,[e("li",null,[e("strong",null,"消息确认"),r("：消费者处理完消息后必须发送一个确认信号，否则RabbitMQ会认为消息处理失败，并将其重新投递给其他消费者。")]),e("li",null,[e("strong",null,"公平分发"),r("：可以设置 "),e("code",null,"prefetch_count=1"),r("，告诉RabbitMQ一次只给一个消费者发一条消息，避免能力强的消费者空闲，而能力弱的消费者积压任务。")])])]),e("li",null,[e("strong",null,"应用场景"),r("：处理图片、视频转码，发送大量邮件等耗时任务。")])],-1)),a[859]||(a[859]=e("p",null,[e("strong",null,"流程图"),r("：")],-1)),a[860]||(a[860]=e("div",{class:"language-tcl max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"tcl"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           |--\x3e 消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"生产者 --\x3e 队列 --\x3e 消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           |--\x3e 消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[861]||(a[861]=e("p",null,"（消息 m1, m3, m5 发给消费者1；m2, m4, m6 发给消费者2…）",-1)),a[862]||(a[862]=e("hr",null,null,-1)),a[863]||(a[863]=e("h4",{id:"_3-发布-订阅模式-publish-subscribe",tabindex:"-1"},[r("3. 发布/订阅模式 / Publish/Subscribe "),e("a",{class:"header-anchor",href:"#_3-发布-订阅模式-publish-subscribe","aria-label":'Permalink to "3. 发布/订阅模式 / Publish/Subscribe"'},"​")],-1)),a[864]||(a[864]=e("p",null,[r("将一条消息广播给"),e("strong",null,"所有"),r("绑定到该交换器的队列。")],-1)),a[865]||(a[865]=e("ul",null,[e("li",null,[e("strong",null,"核心组件"),r("：一个生产者、一个 "),e("strong",null,"Fanout"),r(" 类型的交换器、"),e("strong",null,"多个"),r("队列、多个消费者。")]),e("li",null,[e("strong",null,"交换器类型"),r("："),e("strong",null,"Fanout"),r("。它会将收到的所有消息"),e("strong",null,"广播"),r("到所有与之绑定的队列中。")]),e("li",null,[e("strong",null,"路由逻辑"),r("：消息发送到 Fanout 交换器，交换器将其复制并转发到每一个绑定的队列。")]),e("li",null,[e("strong",null,"应用场景"),r("：系统广播、新闻推送、事件通知（需要让多个不同服务同时知道某个事件发生）。")])],-1)),a[866]||(a[866]=e("p",null,[e("strong",null,"流程图"),r("：")],-1)),a[867]||(a[867]=e("div",{class:"language-tcl max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"tcl"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           |--\x3e 队列"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," --\x3e 消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"生产者 --\x3e (Fanout交换器) --\x3e 队列"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," --\x3e 消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           |--\x3e 队列"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," --\x3e 消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[868]||(a[868]=e("p",null,"（同一条消息会被所有三个消费者收到）",-1)),a[869]||(a[869]=e("hr",null,null,-1)),a[870]||(a[870]=e("h4",{id:"_4-路由模式-routing",tabindex:"-1"},[r("4. 路由模式 / Routing "),e("a",{class:"header-anchor",href:"#_4-路由模式-routing","aria-label":'Permalink to "4. 路由模式 / Routing"'},"​")],-1)),a[871]||(a[871]=e("p",null,[r("根据消息的"),e("strong",null,"路由键"),r(" 有选择地接收消息。")],-1)),a[872]||(a[872]=e("ul",null,[e("li",null,[e("strong",null,"核心组件"),r("：一个生产者、一个 "),e("strong",null,"Direct"),r(" 类型的交换器、多个队列、多个消费者。")]),e("li",null,[e("strong",null,"交换器类型"),r("："),e("strong",null,"Direct"),r("。它会将消息的"),e("strong",null,"路由键"),r(" 与队列和交换器绑定时使用的 "),e("strong",null,"绑定键"),r(" 进行"),e("strong",null,"精确匹配"),r("。只有匹配成功，消息才会被路由到该队列。")]),e("li",null,[e("strong",null,"路由逻辑"),r("：队列在绑定到交换器时，需要指定一个绑定键（例如："),e("code",null,"error"),r(", "),e("code",null,"info"),r(", "),e("code",null,"warning"),r("）。生产者发送消息时也指定一个路由键。交换器会精确匹配这两个键。")]),e("li",null,[e("strong",null,"应用场景"),r("：日志系统，让消费者只接收特定级别的日志（例如，一个消费者只接收 "),e("code",null,"error"),r(" 日志，另一个接收所有日志）。")])],-1)),a[873]||(a[873]=e("p",null,[e("strong",null,"流程图"),r("：")],-1)),a[874]||(a[874]=e("div",{class:"language-tcl max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"tcl"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"生产者 --(消息路由键: error)--\x3e (Direct交换器)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                               /"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     |"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"     \\")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                      (绑定键:error) (绑定键:info) (绑定键:warning)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                            /"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"          |"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"           \\")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    队列[错误日志]  队列[信息日志]  队列[警告日志]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                         |"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"             |"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"             |")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                     消费者A        消费者B        消费者C")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[875]||(a[875]=e("p",null,[r("（只有消费者A会收到这条 "),e("code",null,"error"),r(" 消息）")],-1)),a[876]||(a[876]=e("hr",null,null,-1)),a[877]||(a[877]=e("h4",{id:"_5-主题模式-topics",tabindex:"-1"},[r("5. 主题模式 / Topics "),e("a",{class:"header-anchor",href:"#_5-主题模式-topics","aria-label":'Permalink to "5. 主题模式 / Topics"'},"​")],-1)),a[878]||(a[878]=e("p",null,"路由模式的增强版，允许使用通配符进行模糊匹配。",-1)),a[879]||(a[879]=e("ul",null,[e("li",null,[e("strong",null,"核心组件"),r("：一个生产者、一个 "),e("strong",null,"Topic"),r(" 类型的交换器、多个队列、多个消费者。")]),e("li",null,[e("strong",null,"交换器类型"),r("："),e("strong",null,"Topic"),r("。")]),e("li",null,[e("strong",null,"路由逻辑"),r("： "),e("ul",null,[e("li",null,[r("绑定键是一个包含通配符的字符串，用点号"),e("code",null,"."),r("分隔。")]),e("li",null,[e("code",null,"*"),r(" (星号)：匹配一个单词。")]),e("li",null,[e("code",null,"#"),r(" (井号)：匹配零个或多个单词。")]),e("li",null,"生产者发送带路由键的消息，交换器根据绑定键的模式进行匹配。")])]),e("li",null,[e("strong",null,"应用场景"),r("：非常灵活的消息筛选。例如： "),e("ul",null,[e("li",null,[r("绑定键 "),e("code",null,"usa.news"),r("：只接收美国新闻。")]),e("li",null,[r("绑定键 "),e("code",null,"usa.weather"),r("：只接收美国天气。")]),e("li",null,[r("绑定键 "),e("code",null,"*.news"),r("：接收所有国家的新闻。")]),e("li",null,[r("绑定键 "),e("code",null,"#.news"),r("：同上。")]),e("li",null,[r("绑定键 "),e("code",null,"usa.#"),r("：接收美国的所有消息。")])])])],-1)),a[880]||(a[880]=e("p",null,[e("strong",null,"流程图"),r("：")],-1)),a[881]||(a[881]=e("div",{class:"language-tcl max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"tcl"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"生产者 --(路由键: quick.orange.rabbit)--\x3e (Topic交换器)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                        /"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"       |"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"       \\")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                          (绑定键: *.orange.*) (*.rabbit) (lazy.#)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                                  /"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"             |"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"           \\")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        队列A[橙色的动物]   队列B[兔子]   队列C[懒惰的一切]")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                              |"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"               |"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"             |")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                          消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       消费者"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[882]||(a[882]=e("p",null,[r("（这条消息会匹配到 "),e("code",null,"*.orange.*"),r(" 和 "),e("code",null,"lazy.#"),r("，所以会被投递到队列A和队列C）")],-1)),a[883]||(a[883]=e("hr",null,null,-1)),a[884]||(a[884]=e("h4",{id:"_6-头部模式-headers",tabindex:"-1"},[r("6. 头部模式 / Headers "),e("a",{class:"header-anchor",href:"#_6-头部模式-headers","aria-label":'Permalink to "6. 头部模式 / Headers"'},"​")],-1)),a[885]||(a[885]=e("p",null,[r("一种不依赖于路由键，而是根据消息的"),e("strong",null,"头部属性"),r("来路由的模式。它不常用。")],-1)),a[886]||(a[886]=e("ul",null,[e("li",null,[e("strong",null,"交换器类型"),r("："),e("strong",null,"Headers"),r("。")]),e("li",null,[e("strong",null,"路由逻辑"),r("：队列在绑定时会指定一组键值对参数。生产者发送消息时，也在头部附带一组键值对。交换器会检查消息的头部是否与绑定的参数"),e("strong",null,"匹配"),r("。匹配规则可以是 "),e("code",null,"all"),r("（全部匹配）或 "),e("code",null,"any"),r("（匹配任意一个）。")]),e("li",null,[e("strong",null,"应用场景"),r("：当路由条件非常复杂，无法用简单的路由键表示时。")])],-1)),a[887]||(a[887]=e("hr",null,null,-1)),a[888]||(a[888]=e("h4",{id:"_7-rpc-模式",tabindex:"-1"},[r("7. RPC 模式 "),e("a",{class:"header-anchor",href:"#_7-rpc-模式","aria-label":'Permalink to "7. RPC 模式"'},"​")],-1)),a[889]||(a[889]=e("p",null,"严格来说，这不是一种交换器类型，而是一种应用模式。它允许客户端发送请求消息，服务端回复响应消息，实现远程过程调用。",-1)),a[890]||(a[890]=e("ul",null,[e("li",null,[e("strong",null,"核心机制"),r("： "),e("ol",null,[e("li",null,[r("客户端发送一条消息，其中包含一个唯一的 "),e("code",null,"correlation_id"),r(" 和一个用于回复的 "),e("code",null,"reply_to"),r(" 队列名。")]),e("li",null,[r("服务端处理请求，然后将结果发送到 "),e("code",null,"reply_to"),r(" 队列，并带上相同的 "),e("code",null,"correlation_id"),r("。")]),e("li",null,[r("客户端监听 "),e("code",null,"reply_to"),r(" 队列，通过 "),e("code",null,"correlation_id"),r(" 来匹配响应和请求。")])])])],-1)),a[891]||(a[891]=e("hr",null,null,-1)),a[892]||(a[892]=e("h4",{id:"总结对比",tabindex:"-1"},[r("总结对比 "),e("a",{class:"header-anchor",href:"#总结对比","aria-label":'Permalink to "总结对比"'},"​")],-1)),a[893]||(a[893]=e("table",null,[e("thead",null,[e("tr",null,[e("th",{style:{"text-align":"left"}},"模式名称"),e("th",{style:{"text-align":"left"}},"交换器类型"),e("th",{style:{"text-align":"left"}},"路由规则"),e("th",{style:{"text-align":"left"}},"核心应用")])]),e("tbody",null,[e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"简单模式")]),e("td",{style:{"text-align":"left"}},"(默认)"),e("td",{style:{"text-align":"left"}},"直接指定队列"),e("td",{style:{"text-align":"left"}},"一对一简单通信")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"工作队列")]),e("td",{style:{"text-align":"left"}},"(默认)"),e("td",{style:{"text-align":"left"}},"轮询分发"),e("td",{style:{"text-align":"left"}},"多消费者任务分发")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"发布/订阅")]),e("td",{style:{"text-align":"left"}},[e("code",null,"Fanout")]),e("td",{style:{"text-align":"left"}},"广播"),e("td",{style:{"text-align":"left"}},"一对多消息广播")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"路由模式")]),e("td",{style:{"text-align":"left"}},[e("code",null,"Direct")]),e("td",{style:{"text-align":"left"}},"精确匹配路由键"),e("td",{style:{"text-align":"left"}},"有选择性地接收消息（如日志级别）")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"主题模式")]),e("td",{style:{"text-align":"left"}},[e("code",null,"Topic")]),e("td",{style:{"text-align":"left"}},"通配符匹配路由键"),e("td",{style:{"text-align":"left"}},"灵活地、多维度地筛选消息")]),e("tr",null,[e("td",{style:{"text-align":"left"}},[e("strong",null,"头部模式")]),e("td",{style:{"text-align":"left"}},[e("code",null,"Headers")]),e("td",{style:{"text-align":"left"}},"匹配消息头属性"),e("td",{style:{"text-align":"left"}},"复杂条件路由（不常用）")])])],-1)),a[894]||(a[894]=e("p",null,[r("理解这些模式的关键在于理解"),e("strong",null,"交换器类型"),r("及其"),e("strong",null,"路由逻辑"),r("。选择哪种模式取决于你的业务场景中，消息需要如何被分发给不同的消费者。")],-1)),a[895]||(a[895]=e("hr",null,null,-1)),a[896]||(a[896]=e("h3",{id:"q-nacos如何监控服务宕机-分几步来对宕机的服务进行交互",tabindex:"-1"},[r("Q：Nacos如何监控服务宕机，分几步来对宕机的服务进行交互 "),e("a",{class:"header-anchor",href:"#q-nacos如何监控服务宕机-分几步来对宕机的服务进行交互","aria-label":'Permalink to "Q：Nacos如何监控服务宕机，分几步来对宕机的服务进行交互"'},"​")],-1)),a[897]||(a[897]=e("p",null,"好的，这是一个非常核心的微服务问题。Nacos 对服务宕机的监控和处理是一个典型的“主动探测 + 客户端心跳”模式，其交互流程可以清晰地分为几个步骤。",-1)),a[898]||(a[898]=e("p",null,"下面我将分两部分详细阐述：",-1)),a[899]||(a[899]=e("ol",null,[e("li",null,[e("strong",null,"Nacos 如何监控服务宕机（服务发现与健康检查机制）")]),e("li",null,[e("strong",null,"服务宕机后的交互步骤")])],-1)),a[900]||(a[900]=e("hr",null,null,-1)),a[901]||(a[901]=e("h4",{id:"第一部分-nacos-如何监控服务宕机",tabindex:"-1"},[r("第一部分：Nacos 如何监控服务宕机 "),e("a",{class:"header-anchor",href:"#第一部分-nacos-如何监控服务宕机","aria-label":'Permalink to "第一部分：Nacos 如何监控服务宕机"'},"​")],-1)),a[902]||(a[902]=e("p",null,"Nacos 主要通过两种方式来检测服务实例是否存活：",-1)),a[903]||(a[903]=e("h5",{id:"_1-客户端主动上报心跳-默认模式-ap-模式",tabindex:"-1"},[r("1. 客户端主动上报心跳（默认模式 - AP 模式） "),e("a",{class:"header-anchor",href:"#_1-客户端主动上报心跳-默认模式-ap-模式","aria-label":'Permalink to "1. 客户端主动上报心跳（默认模式 - AP 模式）"'},"​")],-1)),a[904]||(a[904]=e("p",null,"这是 Nacos 默认的、基于 Distro 协议的 AP 模式下的健康检查方式。",-1)),a[905]||(a[905]=e("ul",null,[e("li",null,[e("strong",null,"原理"),r("：服务实例在注册到 Nacos 后，会作为一个"),e("strong",null,"客户端"),r("，定期（例如每5秒）向 Nacos 服务器发送一个"),e("strong",null,"心跳"),r("。这个心跳本质上是一个周期性的健康报告，告诉服务器：“我还活着”。")]),e("li",null,[e("strong",null,"关键配置"),r("： "),e("ul",null,[e("li",null,[e("code",null,"心跳间隔"),r("：客户端发送心跳的频率。")]),e("li",null,[e("code",null,"超时时间"),r("：Nacos 服务器在多久没收到心跳后，会认为该实例不健康。")]),e("li",null,[e("code",null,"删除超时"),r("：在不健康状态持续多久后，直接从服务列表中删除该实例。")])])]),e("li",null,[e("strong",null,"工作模式"),r("：这种方式将健康检查的压力分散到了各个客户端，服务器端主要是记录和判断，非常适合大规模集群。")])],-1)),a[906]||(a[906]=e("h5",{id:"_2-服务器端主动健康检查-cp-模式",tabindex:"-1"},[r("2. 服务器端主动健康检查（CP 模式） "),e("a",{class:"header-anchor",href:"#_2-服务器端主动健康检查-cp-模式","aria-label":'Permalink to "2. 服务器端主动健康检查（CP 模式）"'},"​")],-1)),a[907]||(a[907]=e("p",null,[r("当使用 Nacos 的基于 Raft 协议的 CP 模式时，或者用户显式配置了 "),e("code",null,"ephemeral=false"),r(" 注册临时实例时，Nacos 服务器会主动对服务实例进行健康检查。")],-1)),a[908]||(a[908]=e("ul",null,[e("li",null,[e("strong",null,"原理"),r("：Nacos 服务器会定期（例如每20秒）主动向配置好的服务实例"),e("strong",null,"健康检查端点"),r("（如 "),e("code",null,"/health"),r("）发起请求（如 HTTP 请求或 TCP 端口探测）。")]),e("li",null,[e("strong",null,"关键配置"),r("： "),e("ul",null,[e("li",null,[e("code",null,"检查间隔"),r("：服务器发起检查的频率。")]),e("li",null,[e("code",null,"超时时间"),r("：等待服务响应的超时时间。")]),e("li",null,[e("code",null,"健康路径"),r("：健康检查的 URL 路径。")])])]),e("li",null,[e("strong",null,"工作模式"),r("：这种方式由服务器主动发起，对网络和服务器的压力更大，但控制权在服务器端。")])],-1)),a[909]||(a[909]=e("p",null,[e("strong",null,"总结"),r("：在绝大多数 Spring Cloud Alibaba 等场景下，我们使用的是"),e("strong",null,"默认的临时实例和客户端心跳模式"),r("。因此，下面的交互步骤将基于这种模式展开。")],-1)),a[910]||(a[910]=e("hr",null,null,-1)),a[911]||(a[911]=e("h4",{id:"第二部分-服务宕机后的交互步骤-基于客户端心跳模式",tabindex:"-1"},[r("第二部分：服务宕机后的交互步骤（基于客户端心跳模式） "),e("a",{class:"header-anchor",href:"#第二部分-服务宕机后的交互步骤-基于客户端心跳模式","aria-label":'Permalink to "第二部分：服务宕机后的交互步骤（基于客户端心跳模式）"'},"​")],-1)),a[912]||(a[912]=e("p",null,[r("假设我们有一个 "),e("strong",null,"UserService"),r(" 实例，它已经注册到了 Nacos 服务器。现在我们模拟该实例突然宕机（如进程被杀掉）。")],-1)),a[913]||(a[913]=e("p",null,"整个交互流程可以分为以下几步：",-1)),E(n,p({code:"Zmxvd2NoYXJ0IFREDQogICAgQVtVc2VyU2VydmljZeWunuS-i-Wuleacul0gLS0-IEJb5b-D6Lez5YGc5q2iLeacquaUtuWIsOW_g-i3s10NCiAgICBCIC0tPiBDe-i2heaXtjE156eSP30NCiAgICBDIC0tPnzlkKZ8IEINCiAgICBDIC0tPnzmmK98IERb5qCH6K6w5a6e5L6L5Li65LiN5YGl5bq3XQ0KICAgIEQgLS0-IEVb5o6o6YCB5pu05paw57uZ5raI6LS56ICFXQ0KICAgIEUgLS0-IEZb5raI6LS56ICF5pu05paw5pyN5Yqh5YiX6KGoXQ0KICAgIEYgLS0-IEd76LaF5pe2MzDnp5I_fQ0KICAgIEcgLS0-fOWQpnwgRg0KICAgIEcgLS0-fOaYr3wgSFvku47ms6jlhozkuK3lv4PliKDpmaRd"},{}),null,16),a[914]||(a[914]=e("h5",{id:"第1步-心跳停止",tabindex:"-1"},[r("第1步：心跳停止 "),e("a",{class:"header-anchor",href:"#第1步-心跳停止","aria-label":'Permalink to "第1步：心跳停止"'},"​")],-1)),a[915]||(a[915]=e("ul",null,[e("li",null,[e("strong",null,"动作"),r("：UserService 实例由于宕机，停止了向 Nacos Server 发送周期性的心跳包。")]),e("li",null,[e("strong",null,"状态"),r("：Nacos Server 的注册中心里，该实例的“最后心跳时间”停止更新。")])],-1)),a[916]||(a[916]=e("h5",{id:"第2步-标记为不健康",tabindex:"-1"},[r("第2步：标记为不健康 "),e("a",{class:"header-anchor",href:"#第2步-标记为不健康","aria-label":'Permalink to "第2步：标记为不健康"'},"​")],-1)),a[917]||(a[917]=e("ul",null,[e("li",null,[e("strong",null,"动作"),r("：Nacos Server 内部有一个健康检查线程，它会扫描所有实例的“最后心跳时间”。如果发现当前时间减去“最后心跳时间”超过了预设的"),e("strong",null,"超时时间（默认15秒）"),r("，它会将该实例的"),e("strong",null,"健康状态"),r("设置为 "),e("code",null,"false"),r("。")]),e("li",null,[e("strong",null,"状态"),r("：在 Nacos 控制台上，你可以看到该实例的“健康实例数”减少，“不健康实例数”增加。这个实例仍然在服务列表中，但已经被标记为不健康。")])],-1)),a[918]||(a[918]=e("h5",{id:"第3步-服务列表更新与推送",tabindex:"-1"},[r("第3步：服务列表更新与推送 "),e("a",{class:"header-anchor",href:"#第3步-服务列表更新与推送","aria-label":'Permalink to "第3步：服务列表更新与推送"'},"​")],-1)),a[919]||(a[919]=e("ul",null,[e("li",null,[e("strong",null,"动作"),r("： "),e("ul",null,[e("li",null,"Nacos Server 意识到 UserService 的服务列表发生了变更（有实例变为不健康）。"),e("li",null,[e("strong",null,"推送机制"),r("：Nacos Server 会立即向"),e("strong",null,"所有订阅了 UserService 的消费者"),r("（如 Gateway、其他微服务）推送一条消息，通知它们服务列表已变更。")])])]),e("li",null,[e("strong",null,"交互"),r("：这是一个 "),e("strong",null,"Server Push"),r(" 模型，非常及时，消费者几乎在秒级就能感知到变化，而不需要等待下一次主动拉取。")])],-1)),a[920]||(a[920]=e("h5",{id:"第4步-消费者更新本地缓存",tabindex:"-1"},[r("第4步：消费者更新本地缓存 "),e("a",{class:"header-anchor",href:"#第4步-消费者更新本地缓存","aria-label":'Permalink to "第4步：消费者更新本地缓存"'},"​")],-1)),a[921]||(a[921]=e("ul",null,[e("li",null,[e("strong",null,"动作"),r("：消费者（如 OrderService）收到 Nacos Server 的推送后，会立即从服务器拉取最新的 UserService 实例列表。在拉取到的列表中，那个被标记为不健康的实例已经被过滤掉（或者消费者本地在收到列表后，会主动剔除不健康实例）。")]),e("li",null,[e("strong",null,"结果"),r("：从此以后，OrderService 发起的对于 UserService 的负载均衡调用（如通过 Spring Cloud LoadBalancer 或 Ribbon），将"),e("strong",null,"不会再被路由到那个已经宕机的实例上"),r("。这就实现了服务的自动熔断和故障隔离。")])],-1)),a[922]||(a[922]=e("h5",{id:"第5步-彻底删除实例",tabindex:"-1"},[r("第5步：彻底删除实例 "),e("a",{class:"header-anchor",href:"#第5步-彻底删除实例","aria-label":'Permalink to "第5步：彻底删除实例"'},"​")],-1)),a[923]||(a[923]=e("ul",null,[e("li",null,[e("strong",null,"动作"),r("：如果那个宕机的实例在接下来的一个更长的时间窗口内（"),e("strong",null,"删除超时时间，默认30秒"),r("）一直没有恢复心跳，Nacos Server 会最终将这个实例从注册列表中"),e("strong",null,"彻底删除"),r("。")]),e("li",null,[e("strong",null,"状态"),r("：在 Nacos 控制台上，该实例会完全消失。")]),e("li",null,[e("strong",null,"注意"),r("：删除后，同样会通过第3步的推送机制通知所有消费者。")])],-1)),a[924]||(a[924]=e("hr",null,null,-1)),a[925]||(a[925]=e("h4",{id:"关键配置参数-spring-cloud-alibaba",tabindex:"-1"},[r("关键配置参数（Spring Cloud Alibaba） "),e("a",{class:"header-anchor",href:"#关键配置参数-spring-cloud-alibaba","aria-label":'Permalink to "关键配置参数（Spring Cloud Alibaba）"'},"​")],-1)),a[926]||(a[926]=e("p",null,[r("在你的 "),e("code",null,"application.yml"),r(" 中，可以通过以下配置调整这些行为：")],-1)),a[927]||(a[927]=e("div",{class:"language-yaml max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"yaml"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"spring"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  cloud"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    nacos"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      discovery"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # Nacos 服务器地址")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        server-addr"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"localhost:8848")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # 心跳间隔 (默认5秒) - 客户端->服务端")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        heart-beat-interval"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5000")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # 心跳超时 (默认15秒) - 服务端判断下线")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        heart-beat-timeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"15000")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # 删除实例超时 (默认30秒) - 服务端彻底删除")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        ip-delete-timeout"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30000")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # 实例是否为临时实例 (true: 用心跳, false: 用服务器端检查)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        ephemeral"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[928]||(a[928]=e("h4",{id:"总结-4",tabindex:"-1"},[r("总结 "),e("a",{class:"header-anchor",href:"#总结-4","aria-label":'Permalink to "总结"'},"​")],-1)),a[929]||(a[929]=e("p",null,[r("Nacos 通过 "),e("strong",null,"“客户端心跳 + 服务器端超时判断 + 实时推送”"),r(" 这一套组合拳，高效地实现了服务宕机的监控和自动处理。其核心交互步骤可以概括为：")],-1)),a[930]||(a[930]=e("ol",null,[e("li",null,[e("strong",null,"检测"),r("：通过心跳超时检测到不健康实例。")]),e("li",null,[e("strong",null,"标记"),r("：在服务器端将其标记为不健康。")]),e("li",null,[e("strong",null,"通知"),r("：立即推送变更给所有相关消费者。")]),e("li",null,[e("strong",null,"隔离"),r("：消费者更新本地列表，实现流量隔离。")]),e("li",null,[e("strong",null,"清理"),r("：最终清理长时间宕机的实例。")])],-1)),a[931]||(a[931]=e("p",null,"这套机制保证了微服务架构的高可用性和自愈能力。",-1)),a[932]||(a[932]=e("hr",null,null,-1)),a[933]||(a[933]=e("h3",{id:"q-了节省成本-开发测试生产用的一个服务器-nacos如何区分环境",tabindex:"-1"},[r("Q：了节省成本，开发测试生产用的一个服务器，Nacos如何区分环境 "),e("a",{class:"header-anchor",href:"#q-了节省成本-开发测试生产用的一个服务器-nacos如何区分环境","aria-label":'Permalink to "Q：了节省成本，开发测试生产用的一个服务器，Nacos如何区分环境"'},"​")],-1)),a[934]||(a[934]=e("hr",null,null,-1)),a[935]||(a[935]=e("h3",{id:"q-sql-查询语句的执行顺序了解吗",tabindex:"-1"},[r("Q：SQL 查询语句的执行顺序了解吗？ "),e("a",{class:"header-anchor",href:"#q-sql-查询语句的执行顺序了解吗","aria-label":'Permalink to "Q：SQL 查询语句的执行顺序了解吗？"'},"​")],-1)),a[936]||(a[936]=e("p",null,"先执行 FROM 确定主表，再执行 JOIN 连接，然后 WHERE 进行过滤，接着 GROUP BY 进行分组，HAVING 过滤聚合结果，SELECT 选择最终列，ORDER BY 排序，最后 LIMIT 限制返回行数。",-1)),a[937]||(a[937]=e("p",null,"WHERE 先执行是为了减少数据量，HAVING 只能过滤聚合数据，ORDER BY 必须在 SELECT 之后排序最终结果，LIMIT 最后执行以减少数据传输。",-1)),a[938]||(a[938]=e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/mysql-20250306153200.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),a[939]||(a[939]=e("table",null,[e("thead",null,[e("tr",null,[e("th",null,"执行顺序"),e("th",null,"SQL 关键字"),e("th",null,"作用")])]),e("tbody",null,[e("tr",null,[e("td",null,"①"),e("td",null,"FROM"),e("td",null,"确定主表，准备数据")]),e("tr",null,[e("td",null,"②"),e("td",null,"ON"),e("td",null,"连接多个表的条件")]),e("tr",null,[e("td",null,"③"),e("td",null,"JOIN"),e("td",null,"执行 INNER JOIN / LEFT JOIN 等")]),e("tr",null,[e("td",null,"④"),e("td",null,"WHERE"),e("td",null,"过滤行数据（提高效率）")]),e("tr",null,[e("td",null,"⑤"),e("td",null,"GROUP BY"),e("td",null,"进行分组")]),e("tr",null,[e("td",null,"⑥"),e("td",null,"HAVING"),e("td",null,"过滤聚合后的数据")]),e("tr",null,[e("td",null,"⑦"),e("td",null,"SELECT"),e("td",null,"选择最终返回的列")]),e("tr",null,[e("td",null,"⑧"),e("td",null,"DISTINCT"),e("td",null,"进行去重")]),e("tr",null,[e("td",null,"⑨"),e("td",null,"ORDER BY"),e("td",null,"对最终结果排序")]),e("tr",null,[e("td",null,"⑩"),e("td",null,"LIMIT"),e("td",null,"限制返回行数")])])],-1)),a[940]||(a[940]=e("p",null,"这个执行顺序与编写 SQL 语句的顺序不同，这也是为什么有时候在 SELECT 子句中定义的别名不能在 WHERE 子句中使用得原因，因为 WHERE 是在 SELECT 之前执行的。",-1)),a[941]||(a[941]=e("h4",{id:"limit-为什么在最后执行",tabindex:"-1"},[r("LIMIT 为什么在最后执行？ "),e("a",{class:"header-anchor",href:"#limit-为什么在最后执行","aria-label":'Permalink to "LIMIT 为什么在最后执行？"'},"​")],-1)),a[942]||(a[942]=e("p",null,"因为 LIMIT 是在最终结果集上执行的，如果在 WHERE 之前执行 LIMIT，那么就会先返回所有行，然后再进行 LIMIT 限制，这样会增加数据传输的开销。",-1)),a[943]||(a[943]=e("h4",{id:"order-by-为什么在-select-之后执行",tabindex:"-1"},[r("ORDER BY 为什么在 SELECT 之后执行？ "),e("a",{class:"header-anchor",href:"#order-by-为什么在-select-之后执行","aria-label":'Permalink to "ORDER BY 为什么在 SELECT 之后执行？"'},"​")],-1)),a[944]||(a[944]=e("p",null,[r("因为排序需要基于最终返回的列，如果 ORDER BY 早于 SELECT 执行，计算 "),e("code",null,"COUNT(*)"),r(" 之类的聚合函数就会出问题。")],-1)),a[945]||(a[945]=e("div",{class:"language-sql max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"sql"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SELECT"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," name"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"COUNT"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"AS"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," order_count")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"FROM"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," orders")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"GROUP BY"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," name")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ORDER BY"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," order_count "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"DESC"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[946]||(a[946]=e("hr",null,null,-1)),a[947]||(a[947]=e("h3",{id:"q-spring事务失效场景",tabindex:"-1"},[r("Q：spring事务失效场景 "),e("a",{class:"header-anchor",href:"#q-spring事务失效场景","aria-label":'Permalink to "Q：spring事务失效场景"'},"​")],-1)),a[948]||(a[948]=e("h4",{id:"一、代理机制问题",tabindex:"-1"},[r("一、代理机制问题 "),e("a",{class:"header-anchor",href:"#一、代理机制问题","aria-label":'Permalink to "一、代理机制问题"'},"​")],-1)),a[949]||(a[949]=e("h5",{id:"_1-方法非public修饰",tabindex:"-1"},[r("1. "),e("strong",null,[r("方法非"),e("code",null,"public"),r("修饰")]),r(),e("a",{class:"header-anchor",href:"#_1-方法非public修饰","aria-label":'Permalink to "1. **方法非`public`修饰**"'},"​")],-1)),a[950]||(a[950]=e("p",null,[e("strong",null,"原因"),r("：Spring默认使用CGLIB代理，非public方法无法被代理。")],-1)),a[951]||(a[951]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," privateMethod"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() { "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 事务失效")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ...")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[952]||(a[952]=e("p",null,[e("strong",null,"解决"),r("：改为"),e("code",null,"public"),r("方法。")],-1)),a[953]||(a[953]=e("h5",{id:"_2-自调用-同一类内方法调用",tabindex:"-1"},[r("2. "),e("strong",null,"自调用（同一类内方法调用）"),r(),e("a",{class:"header-anchor",href:"#_2-自调用-同一类内方法调用","aria-label":'Permalink to "2. **自调用（同一类内方法调用）**"'},"​")],-1)),a[954]||(a[954]=e("p",null,[e("strong",null,"原因"),r("：自调用绕过代理对象，直接调用目标方法。")],-1)),a[955]||(a[955]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," methodA"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    methodB"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 事务失效")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," methodB"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ...")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[956]||(a[956]=e("p",null,[e("strong",null,"解决"),r("：")],-1)),a[957]||(a[957]=e("ul",null,[e("li",null,[r("注入自身代理对象："),e("code",null,"@Autowired private MyService self;")]),e("li",null,"使用AspectJ模式（编译时织入）。")],-1)),a[958]||(a[958]=e("hr",null,null,-1)),a[959]||(a[959]=e("h4",{id:"二、异常处理不当",tabindex:"-1"},[r("二、异常处理不当 "),e("a",{class:"header-anchor",href:"#二、异常处理不当","aria-label":'Permalink to "二、异常处理不当"'},"​")],-1)),a[960]||(a[960]=e("h5",{id:"_3-异常被捕获未抛出",tabindex:"-1"},[r("3. "),e("strong",null,"异常被捕获未抛出"),r(),e("a",{class:"header-anchor",href:"#_3-异常被捕获未抛出","aria-label":'Permalink to "3. **异常被捕获未抛出**"'},"​")],-1)),a[961]||(a[961]=e("p",null,[e("strong",null,"原因"),r("：事务仅对未处理的"),e("code",null,"RuntimeException"),r("和"),e("code",null,"Error"),r("回滚（默认配置）。")],-1)),a[962]||(a[962]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," method"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // ...")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),e("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 未抛出异常，事务不会回滚")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[963]||(a[963]=e("p",null,[e("strong",null,"解决"),r("：在catch块中抛出"),e("code",null,"RuntimeException"),r("或使用"),e("code",null,"TransactionAspectSupport.currentTransactionStatus().setRollbackOnly()"),r("。")],-1)),a[964]||(a[964]=e("h5",{id:"_4-错误配置rollbackfor",tabindex:"-1"},[r("4. "),e("strong",null,[r("错误配置"),e("code",null,"rollbackFor")]),r(),e("a",{class:"header-anchor",href:"#_4-错误配置rollbackfor","aria-label":'Permalink to "4. **错误配置`rollbackFor`**"'},"​")],-1)),a[965]||(a[965]=e("p",null,[e("strong",null,"原因"),r("：默认只回滚"),e("code",null,"RuntimeException"),r("和"),e("code",null,"Error"),r("， checked异常不回滚。")],-1)),a[966]||(a[966]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," method"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() throws IOException {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    throw"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," IOException"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 事务不会回滚")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[967]||(a[967]=e("p",null,[e("strong",null,"解决"),r("：明确指定回滚异常类型：")],-1)),a[968]||(a[968]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"rollbackFor"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Exception.class)")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[969]||(a[969]=e("hr",null,null,-1)),a[970]||(a[970]=e("h4",{id:"三、事务传播行为配置错误",tabindex:"-1"},[r("三、事务传播行为配置错误 "),e("a",{class:"header-anchor",href:"#三、事务传播行为配置错误","aria-label":'Permalink to "三、事务传播行为配置错误"'},"​")],-1)),a[971]||(a[971]=e("h5",{id:"_5-嵌套事务传播行为不当",tabindex:"-1"},[r("5. "),e("strong",null,"嵌套事务传播行为不当"),r(),e("a",{class:"header-anchor",href:"#_5-嵌套事务传播行为不当","aria-label":'Permalink to "5. **嵌套事务传播行为不当**"'},"​")],-1)),a[972]||(a[972]=e("p",null,[e("strong",null,"原因"),r("："),e("code",null,"PROPAGATION_SUPPORTS"),r("等方法在无事务时不开启新事务。")],-1)),a[973]||(a[973]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"propagation"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Propagation.SUPPORTS)")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," method"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 若外部无事务，此处不会开启事务")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[974]||(a[974]=e("p",null,[e("strong",null,"解决"),r("：根据业务需求选择合适的传播行为（如"),e("code",null,"REQUIRED"),r("）。")],-1)),a[975]||(a[975]=e("hr",null,null,-1)),a[976]||(a[976]=e("h4",{id:"四、数据库与引擎支持",tabindex:"-1"},[r("四、数据库与引擎支持 "),e("a",{class:"header-anchor",href:"#四、数据库与引擎支持","aria-label":'Permalink to "四、数据库与引擎支持"'},"​")],-1)),a[977]||(a[977]=e("h5",{id:"_6-数据库引擎不支持事务",tabindex:"-1"},[r("6. "),e("strong",null,"数据库引擎不支持事务"),r(),e("a",{class:"header-anchor",href:"#_6-数据库引擎不支持事务","aria-label":'Permalink to "6. **数据库引擎不支持事务**"'},"​")],-1)),a[978]||(a[978]=e("p",null,[e("strong",null,"原因"),r("：如MySQL的MyISAM引擎不支持事务。 "),e("strong",null,"解决"),r("：改用InnoDB引擎。")],-1)),a[979]||(a[979]=e("h5",{id:"_7-数据源未配置事务管理器",tabindex:"-1"},[r("7. "),e("strong",null,"数据源未配置事务管理器"),r(),e("a",{class:"header-anchor",href:"#_7-数据源未配置事务管理器","aria-label":'Permalink to "7. **数据源未配置事务管理器**"'},"​")],-1)),a[980]||(a[980]=e("p",null,[e("strong",null,"原因"),r("：未配置"),e("code",null,"PlatformTransactionManager"),r("。")],-1)),a[981]||(a[981]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," PlatformTransactionManager "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"transactionManager"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(DataSource dataSource) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DataSourceTransactionManager"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dataSource);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[982]||(a[982]=e("hr",null,null,-1)),a[983]||(a[983]=e("h4",{id:"五、其他配置问题",tabindex:"-1"},[r("五、其他配置问题 "),e("a",{class:"header-anchor",href:"#五、其他配置问题","aria-label":'Permalink to "五、其他配置问题"'},"​")],-1)),a[984]||(a[984]=e("h5",{id:"_8-注解被错误覆盖",tabindex:"-1"},[r("8. "),e("strong",null,"注解被错误覆盖"),r(),e("a",{class:"header-anchor",href:"#_8-注解被错误覆盖","aria-label":'Permalink to "8. **注解被错误覆盖**"'},"​")],-1)),a[985]||(a[985]=e("p",null,[e("strong",null,"原因"),r("：子类/实现类覆盖父类方法时未添加"),e("code",null,"@Transactional"),r("。")],-1)),a[986]||(a[986]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Parent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," method"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() { "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/* ... */"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),r("\n"),e("span",{class:"line"}),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Child"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Parent"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," method"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() { "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 事务失效")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // ...")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[987]||(a[987]=e("p",null,[e("strong",null,"解决"),r("：在子类方法上显式添加注解。")],-1)),a[988]||(a[988]=e("h5",{id:"_9-多数据源未指定事务管理器",tabindex:"-1"},[r("9. "),e("strong",null,"多数据源未指定事务管理器"),r(),e("a",{class:"header-anchor",href:"#_9-多数据源未指定事务管理器","aria-label":'Permalink to "9. **多数据源未指定事务管理器**"'},"​")],-1)),a[989]||(a[989]=e("p",null,[e("strong",null,"原因"),r("：多数据源环境下未指定"),e("code",null,"transactionManager"),r("。")],-1)),a[990]||(a[990]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Transactional"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"specificTransactionManager"'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[991]||(a[991]=e("h5",{id:"_10-spring-boot自动配置未生效",tabindex:"-1"},[r("10. "),e("strong",null,"Spring Boot自动配置未生效"),r(),e("a",{class:"header-anchor",href:"#_10-spring-boot自动配置未生效","aria-label":'Permalink to "10. **Spring Boot自动配置未生效**"'},"​")],-1)),a[992]||(a[992]=e("p",null,[e("strong",null,"原因"),r("：排除数据源自动配置或手动配置冲突。")],-1)),a[993]||(a[993]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SpringBootApplication"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"exclude"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { DataSourceAutoConfiguration.class })")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[994]||(a[994]=e("hr",null,null,-1)),a[995]||(a[995]=e("h4",{id:"六、排查工具与技巧",tabindex:"-1"},[r("六、排查工具与技巧 "),e("a",{class:"header-anchor",href:"#六、排查工具与技巧","aria-label":'Permalink to "六、排查工具与技巧"'},"​")],-1)),a[996]||(a[996]=e("ol",null,[e("li",null,[e("p",null,[e("strong",null,"开启调试日志"),r("：")]),e("div",{class:"language-properties max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"properties"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"logging.level.org.springframework.transaction.interceptor"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=TRACE")])])]),e("button",{class:"code-block-unfold-btn"})])]),e("li",null,[e("p",null,[e("strong",null,"检查事务状态"),r("：")]),e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"TransactionSynchronizationManager."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isActualTransactionActive"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),e("button",{class:"code-block-unfold-btn"})])]),e("li",null,[e("p",null,[e("strong",null,"验证代理对象"),r("：")]),e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 检查是否为代理对象")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"System.out."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getClass"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getName"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")])])]),e("button",{class:"code-block-unfold-btn"})])])],-1)),a[997]||(a[997]=e("hr",null,null,-1)),a[998]||(a[998]=e("h4",{id:"总结-5",tabindex:"-1"},[r("总结 "),e("a",{class:"header-anchor",href:"#总结-5","aria-label":'Permalink to "总结"'},"​")],-1)),a[999]||(a[999]=e("p",null,"Spring事务失效的核心原因可归纳为：",-1)),a[1e3]||(a[1e3]=e("ul",null,[e("li",null,[e("strong",null,"代理机制"),r("：非public方法、自调用。")]),e("li",null,[e("strong",null,"异常处理"),r("：捕获未抛出、回滚配置错误。")]),e("li",null,[e("strong",null,"配置问题"),r("：传播行为、数据源、事务管理器。")]),e("li",null,[e("strong",null,"环境支持"),r("：数据库引擎、注解覆盖。")])],-1)),a[1001]||(a[1001]=e("p",null,"通过理解代理原理、合理配置事务属性及排查工具使用，可有效避免事务失效问题。",-1)),a[1002]||(a[1002]=e("hr",null,null,-1)),a[1003]||(a[1003]=e("h3",{id:"q-缓存穿透解决方案",tabindex:"-1"},[r("Q：缓存穿透解决方案 "),e("a",{class:"header-anchor",href:"#q-缓存穿透解决方案","aria-label":'Permalink to "Q：缓存穿透解决方案"'},"​")],-1)),a[1004]||(a[1004]=e("p",null,"缓存穿透是指查询的数据在缓存中没有命中，因为数据压根不存在，所以请求会直接落到数据库上。如果这种查询非常频繁，就会给数据库造成很大的压力。",-1)),a[1005]||(a[1005]=e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/redis-20250519082725.png",alt:"fengkui.net：缓存穿透",loading:"lazy",decoding:"async",class:"lazy"})],-1)),a[1006]||(a[1006]=e("p",null,"缓存击穿是因为单个热点数据缓存失效导致的，而缓存穿透是因为查询的数据不存在，原因可能是自身的业务代码有问题，或者是恶意攻击造成的，比如爬虫。",-1)),a[1007]||(a[1007]=e("p",null,"常用的解决方案有两种：第一种是布隆过滤器，它是一种空间效率很高的数据结构，可以用来判断一个元素是否在集合中。",-1)),a[1008]||(a[1008]=e("p",null,"我们可以将所有可能存在的数据哈希到布隆过滤器中，查询时先检查布隆过滤器，如果布隆过滤器认为该数据不存在，就直接返回空；否则再去查询缓存，这样就可以避免无效的缓存查询。",-1)),a[1009]||(a[1009]=e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/redis-20250519085312.png",alt:"酒剑仙：布隆过滤器解决缓存穿透",loading:"lazy",decoding:"async",class:"lazy"})],-1)),a[1010]||(a[1010]=e("p",null,"代码示例：",-1)),a[1011]||(a[1011]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String key) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 缓存中不存在该key")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String cacheResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (cacheResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cacheResult;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 布隆过滤器判断key是否可能存在")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"bloomFilter."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mightContain"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key)) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 一定不存在，直接返回")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 可能存在，查询数据库")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String dbResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," db."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"query"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 将结果放入缓存，包括空值")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    cache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, dbResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dbResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", expireTime);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dbResult;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[1012]||(a[1012]=e("p",null,"布隆过滤器存在误判，即可能会认为某个数据存在，但实际上并不存在。但绝不会漏判，即如果布隆过滤器认为某个数据不存在，那它一定不存在。因此它可以有效拦截不存在的数据查询，减轻数据库压力。",-1)),a[1013]||(a[1013]=e("p",null,"第二种是缓存空值。对于不存在的数据，我们将空值写入缓存，并设置一个合理的过期时间。这样下次相同的查询就能直接从缓存返回，而不再访问数据库。",-1)),a[1014]||(a[1014]=e("figure",null,[e("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/redis-288af5a2-ae5a-427a-95e9-b4a658b01386.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),a[1015]||(a[1015]=e("p",null,"代码示例：",-1)),a[1016]||(a[1016]=e("div",{class:"language-java max-h-300px"},[e("button",{title:"Copy code",class:"copy"}),e("span",{class:"lang"},"java"),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String "),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getData"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String key) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String cacheResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 缓存命中，包括空值")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (cacheResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 特殊值表示空结果")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (cacheResult."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'""'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) {")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cacheResult;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 缓存未命中，查询数据库")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String dbResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," db."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"query"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 写入缓存，空值也缓存，但设置较短的过期时间")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," expireTime "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dbResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," EMPTY_EXPIRE_TIME "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," NORMAL_EXPIRE_TIME;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    cache."),e("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, dbResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),e("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ?"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dbResult "),e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),e("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", expireTime);")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," dbResult;")]),r("\n"),e("span",{class:"line"},[e("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),e("button",{class:"code-block-unfold-btn"})],-1)),a[1017]||(a[1017]=e("p",null,"缓存空值的方法实现起来比较简单，但需要给空值设置一个合理的过期时间，以免数据库中新增了这些数据后，缓存仍然返回空值。",-1)),a[1018]||(a[1018]=e("p",null,"在实际的项目当中，还需要在接口层面做一些处理，比如说对参数进行校验，拦截明显不合理的请求；或者对疑似攻击的 IP 进行限流和封禁。",-1)),a[1019]||(a[1019]=e("hr",null,null,-1)),a[1020]||(a[1020]=e("h3",{id:"q-并发调用接口仅用缓存能否做到性能优化",tabindex:"-1"},[r("Q：并发调用接口仅用缓存能否做到性能优化 "),e("a",{class:"header-anchor",href:"#q-并发调用接口仅用缓存能否做到性能优化","aria-label":'Permalink to "Q：并发调用接口仅用缓存能否做到性能优化"'},"​")],-1)),a[1021]||(a[1021]=e("p",null,[r("这是一个非常专业且深入的问题。简短回答是："),e("strong",null,"仅用缓存是远远不够的，它只是性能优化体系中的一个重要环节，而不是全部。")],-1)),a[1022]||(a[1022]=e("p",null,"下面我将从多个维度详细分析这个问题。",-1)),a[1023]||(a[1023]=e("hr",null,null,-1)),a[1024]||(a[1024]=e("h4",{id:"缓存能解决什么问题-缓存的作用",tabindex:"-1"},[r("缓存能解决什么问题？（缓存的作用） "),e("a",{class:"header-anchor",href:"#缓存能解决什么问题-缓存的作用","aria-label":'Permalink to "缓存能解决什么问题？（缓存的作用）"'},"​")],-1)),a[1025]||(a[1025]=e("p",null,"在你的零部件询报价系统中，缓存确实能在以下场景提供显著的性能提升：",-1)),a[1026]||(a[1026]=e("ol",null,[e("li",null,[e("strong",null,"热点数据读取"),e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：频繁查询的零部件基础信息、供应商信息、系统配置等。")]),e("li",null,[e("strong",null,"实现"),r("：使用Redis缓存这些数据，避免每次请求都查询数据库。")]),e("li",null,[e("strong",null,"效果"),r("：将响应时间从几十毫秒降低到几毫秒。")])])]),e("li",null,[e("strong",null,"计算结果的缓存"),e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：复杂的报价计算、供应商评估得分、历史价格趋势分析。")]),e("li",null,[e("strong",null,"实现"),r("：将计算结果缓存一段时间，相同参数的请求直接返回缓存结果。")]),e("li",null,[e("strong",null,"效果"),r("：避免重复的复杂计算，极大降低CPU负载。")])])]),e("li",null,[e("strong",null,"会话和状态共享"),e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：用户登录状态、导入导出任务进度、临时表单数据。")]),e("li",null,[e("strong",null,"实现"),r("：使用Redis存储分布式会话。")]),e("li",null,[e("strong",null,"效果"),r("：支持应用集群部署，任何节点都能识别用户状态。")])])])],-1)),a[1027]||(a[1027]=e("hr",null,null,-1)),a[1028]||(a[1028]=e("h4",{id:"仅用缓存的局限性在哪里",tabindex:"-1"},[r("仅用缓存的局限性在哪里？ "),e("a",{class:"header-anchor",href:"#仅用缓存的局限性在哪里","aria-label":'Permalink to "仅用缓存的局限性在哪里？"'},"​")],-1)),a[1029]||(a[1029]=e("p",null,[r("缓存主要优化的是"),e("strong",null,"读操作"),r("，但在高并发接口调用中，你面临的是更复杂的场景：")],-1)),a[1030]||(a[1030]=e("h5",{id:"_1-写操作的瓶颈",tabindex:"-1"},[r("1. "),e("strong",null,"写操作的瓶颈"),r(),e("a",{class:"header-anchor",href:"#_1-写操作的瓶颈","aria-label":'Permalink to "1. **写操作的瓶颈**"'},"​")],-1)),a[1031]||(a[1031]=e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：多个采购员同时为同一零件创建询价单；供应商同时报价。")]),e("li",null,[e("strong",null,"问题"),r("：缓存无法解决数据库写竞争。即使有缓存，最终数据还是要写入数据库。高并发写会导致： "),e("ul",null,[e("li",null,[e("strong",null,"数据库锁竞争")]),e("li",null,[e("strong",null,"事务冲突")]),e("li",null,[e("strong",null,"数据不一致")])])])],-1)),a[1032]||(a[1032]=e("h5",{id:"_2-复杂查询的挑战",tabindex:"-1"},[r("2. "),e("strong",null,"复杂查询的挑战"),r(),e("a",{class:"header-anchor",href:"#_2-复杂查询的挑战","aria-label":'Permalink to "2. **复杂查询的挑战**"'},"​")],-1)),a[1033]||(a[1033]=e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：根据多条件（零件类型、供应商地区、价格区间、交期）组合筛选询价单。")]),e("li",null,[e("strong",null,"问题"),r("：这种查询条件千变万化，无法为所有组合建立缓存键。缓存命中率极低，压力仍然在数据库。")])],-1)),a[1034]||(a[1034]=e("h5",{id:"_3-数据一致性问题",tabindex:"-1"},[r("3. "),e("strong",null,"数据一致性问题"),r(),e("a",{class:"header-anchor",href:"#_3-数据一致性问题","aria-label":'Permalink to "3. **数据一致性问题**"'},"​")],-1)),a[1035]||(a[1035]=e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：缓存了零件信息，但后台管理更新了该零件的基础数据。")]),e("li",null,[e("strong",null,"问题"),r("：需要维护缓存与数据库的一致性，在分布式环境下这是个难题。如果处理不当，会返回脏数据。")])],-1)),a[1036]||(a[1036]=e("h5",{id:"_4-缓存自身成为瓶颈",tabindex:"-1"},[r("4. "),e("strong",null,"缓存自身成为瓶颈"),r(),e("a",{class:"header-anchor",href:"#_4-缓存自身成为瓶颈","aria-label":'Permalink to "4. **缓存自身成为瓶颈**"'},"​")],-1)),a[1037]||(a[1037]=e("ul",null,[e("li",null,[e("strong",null,"场景"),r("：极端高并发下，大量请求访问Redis。")]),e("li",null,[e("strong",null,"问题"),r("： "),e("ul",null,[e("li",null,"Redis连接数不够"),e("li",null,"缓存击穿（热点Key失效）"),e("li",null,"缓存雪崩（大量Key同时失效）"),e("li",null,"缓存穿透（查询不存在的数据）")])])],-1)),a[1038]||(a[1038]=e("hr",null,null,-1)),a[1039]||(a[1039]=e("h4",{id:"完整的性能优化体系-超越缓存",tabindex:"-1"},[r("完整的性能优化体系（超越缓存） "),e("a",{class:"header-anchor",href:"#完整的性能优化体系-超越缓存","aria-label":'Permalink to "完整的性能优化体系（超越缓存）"'},"​")],-1)),a[1040]||(a[1040]=e("p",null,"基于你的项目经验，一个完整的性能优化应该包含以下层面：",-1)),a[1041]||(a[1041]=e("h5",{id:"_1-应用层优化-你已经做得很好的部分",tabindex:"-1"},[r("1. "),e("strong",null,"应用层优化"),r("（你已经做得很好的部分） "),e("a",{class:"header-anchor",href:"#_1-应用层优化-你已经做得很好的部分","aria-label":'Permalink to "1. **应用层优化**（你已经做得很好的部分）"'},"​")],-1)),a[1042]||(a[1042]=e("ul",null,[e("li",null,[e("strong",null,"线程池与异步处理"),r("：使用"),e("code",null,"CompletableFuture"),r("并行处理导入任务。")]),e("li",null,[e("strong",null,"连接池优化"),r("：配置合适的数据库连接池（HikariCP）、Redis连接池参数。")]),e("li",null,[e("strong",null,"SQL优化"),r("：分析执行计划、避免N+1查询、优化索引。")])],-1)),a[1043]||(a[1043]=e("h5",{id:"_2-数据库层优化",tabindex:"-1"},[r("2. "),e("strong",null,"数据库层优化"),r(),e("a",{class:"header-anchor",href:"#_2-数据库层优化","aria-label":'Permalink to "2. **数据库层优化**"'},"​")],-1)),a[1044]||(a[1044]=e("ul",null,[e("li",null,[e("strong",null,"读写分离"),r("：将读请求路由到从库，写请求到主库。")]),e("li",null,[e("strong",null,"分库分表"),r("：对大数据表（如报价历史表）按时间或业务维度拆分。")]),e("li",null,[e("strong",null,"查询分离"),r("：将复杂查询所需的字段单独建表，避免"),e("code",null,"SELECT *"),r("。")])],-1)),a[1045]||(a[1045]=e("h5",{id:"_3-架构层优化",tabindex:"-1"},[r("3. "),e("strong",null,"架构层优化"),r(),e("a",{class:"header-anchor",href:"#_3-架构层优化","aria-label":'Permalink to "3. **架构层优化**"'},"​")],-1)),a[1046]||(a[1046]=e("ul",null,[e("li",null,[e("strong",null,"服务拆分"),r("：将系统拆分为独立的微服务（零件服务、报价服务、供应商服务），避免单点压力。")]),e("li",null,[e("strong",null,"消息队列异步化"),r("：将非实时操作（如通知供应商、生成报表）通过MQ异步处理。")]),e("li",null,[e("strong",null,"限流与降级"),r("：在网关层对接口进行限流，在系统压力大时降级非核心功能。")])],-1)),a[1047]||(a[1047]=e("h5",{id:"_4-缓存策略优化",tabindex:"-1"},[r("4. "),e("strong",null,"缓存策略优化"),r(),e("a",{class:"header-anchor",href:"#_4-缓存策略优化","aria-label":'Permalink to "4. **缓存策略优化**"'},"​")],-1)),a[1048]||(a[1048]=e("ul",null,[e("li",null,[e("strong",null,"多级缓存"),r("："),e("code",null,"Guava Cache/Local Cache"),r("（应用层） + "),e("code",null,"Redis"),r("（分布式层）。")]),e("li",null,[e("strong",null,"缓存模式"),r("：采用"),e("code",null,"Cache-Aside"),r("模式，先读缓存，不存在则读DB并回写缓存。")]),e("li",null,[e("strong",null,"过期策略"),r("：合理设置TTL，结合被动失效和主动更新。")])],-1)),a[1049]||(a[1049]=e("hr",null,null,-1)),a[1050]||(a[1050]=e("h4",{id:"具体到零部件询报价系统的优化方案",tabindex:"-1"},[r("具体到零部件询报价系统的优化方案 "),e("a",{class:"header-anchor",href:"#具体到零部件询报价系统的优化方案","aria-label":'Permalink to "具体到零部件询报价系统的优化方案"'},"​")],-1)),E(n,p({code:"Z3JhcGggVEINCiAgICBBW-WuouaIt-err-ivt-axgl0gLS0-IEJbQVBJ572R5YWzL-mZkOa1gV0NCiAgICBCIC0tPiBDMVvnur_nqIvmsaDpmpTnprtdDQogICAgQiAtLT4gQzJb5byC5q2l5aSE55CGXSANCiAgICBCIC0tPiBDM1vmnKzlnLDnvJPlrZhdDQogICAgDQogICAgQzEgLS0-IER76K-35rGC57G75Z6LfQ0KICAgIEMyIC0tPiBEDQogICAgQzMgLS0-IEQNCiAgICANCiAgICBEIC0tPnzor7vor7fmsYJ8IEUxW-eDreeCueaVsOaNrl0NCiAgICBEIC0tPnzor7vor7fmsYJ8IEUyW-iuoeeul-e7k-aenF0NCiAgICBEIC0tPnzor7vor7fmsYJ8IEUzW-S8muivneeKtuaAgV0NCiAgICBEIC0tPnzlhpnor7fmsYJ8IEZb5pWw5o2u5bqT5YaZ5bqTXQ0KICAgIA0KICAgIEYgLS0-IEdb5pWw5o2u5bqT5Li75bqTXQ0KICAgIEcgLS0-IEhb5pWw5o2u5bqT5LuO5bqTXQ0KICAgIA0KICAgIEUxIC0tPiBJW-aVsOaNruW6k-S7juW6k10NCiAgICBFMiAtLT4gSQ0KICAgIEUzIC0tPiBJDQogICAgDQogICAgSlvmtojmga_pmJ_liJddIC0tPiBDMg0KICAgIEMyIC0tPiBKDQogICAgDQogICAgY2xhc3MgRTEsRTIsRTMgY2FjaGVTdHlsZQ0KICAgIGNsYXNzIEYgd3JpdGVTdHlsZQ0KICAgIA0KICAgIGNsYXNzRGVmIGNhY2hlU3R5bGUgZmlsbDojZTFmNWZlDQogICAgY2xhc3NEZWYgd3JpdGVTdHlsZSBmaWxsOiNmZmViZWU"},{}),null,16),a[1051]||(a[1051]=e("p",null,[e("strong",null,"读请求优化路径"),r("：")],-1)),a[1052]||(a[1052]=e("ol",null,[e("li",null,"请求先查询缓存"),e("li",null,"缓存命中直接返回"),e("li",null,"缓存未命中查询从库"),e("li",null,"回写缓存")],-1)),a[1053]||(a[1053]=e("p",null,[e("strong",null,"写请求优化路径"),r("：")],-1)),a[1054]||(a[1054]=e("ol",null,[e("li",null,"写入主库"),e("li",null,"使相关缓存失效"),e("li",null,"通过MQ异步更新衍生数据")],-1)),a[1055]||(a[1055]=e("hr",null,null,-1)),a[1056]||(a[1056]=e("h4",{id:"面试专业回答话术-2",tabindex:"-1"},[r("面试专业回答话术 "),e("a",{class:"header-anchor",href:"#面试专业回答话术-2","aria-label":'Permalink to "面试专业回答话术"'},"​")],-1)),a[1057]||(a[1057]=e("p",null,"你可以这样回答：",-1)),a[1058]||(a[1058]=e("blockquote",null,[e("p",null,[r('"在零部件询报价系统中，缓存确实是性能优化的'),e("strong",null,"重要手段"),r("，但"),e("strong",null,"不能仅依赖缓存"),r("来解决所有并发性能问题。")]),e("p",null,[e("strong",null,"缓存主要解决的是读多写少场景下的性能瓶颈"),r("，比如我们可以缓存热点零件数据、供应商信息、计算好的报价分析结果，这能显著降低数据库压力，将响应时间从数据库的几十毫秒优化到Redis的几毫秒。")]),e("p",null,[e("strong",null,"但是，我们系统中有大量的写操作"),r("，比如供应商并发报价、采购员创建询价单，这些场景下缓存就无能为力了，压力最终会落到数据库上。")]),e("p",null,[e("strong",null,"因此，我们建立了一个完整的性能优化体系：")]),e("ol",null,[e("li",null,[e("strong",null,"对于读操作"),r("：采用"),e("strong",null,"多级缓存"),r("（Guava + Redis）和"),e("strong",null,"读写分离"),r("来分担压力。")]),e("li",null,[e("strong",null,"对于写操作"),r("：通过"),e("strong",null,"数据库连接池优化、SQL优化、分库分表"),r("来提升写入能力，对非实时任务使用"),e("strong",null,"消息队列异步化"),r("。")]),e("li",null,[e("strong",null,"对于复杂查询"),r("：采用"),e("strong",null,"查询分离"),r("和"),e("strong",null,"ES搜索引擎"),r("来应对多条件组合查询。")]),e("li",null,[e("strong",null,"系统保护"),r("：通过"),e("strong",null,"线程池隔离、限流降级"),r("防止系统被突发流量冲垮。")])]),e("p",null,'在我的项目中，通过这套组合方案，我们在日均10万+的并发调用下，依然能保证核心接口的响应时间在200ms以内。所以，缓存是关键一环，但必须与其他优化手段协同工作。"')],-1)),a[1059]||(a[1059]=e("p",null,"这样的回答既肯定了缓存的价值，又展示了你在性能优化方面的系统化思维和实战经验，会给人留下深刻的印象。",-1))]),"main-header":t(()=>[k(l.$slots,"main-header")]),"main-header-after":t(()=>[k(l.$slots,"main-header-after")]),"main-nav":t(()=>[k(l.$slots,"main-nav")]),"main-content-before":t(()=>[k(l.$slots,"main-content-before")]),"main-content":t(()=>[k(l.$slots,"main-content")]),"main-content-after":t(()=>[k(l.$slots,"main-content-after")]),"main-nav-before":t(()=>[k(l.$slots,"main-nav-before")]),"main-nav-after":t(()=>[k(l.$slots,"main-nav-after")]),comment:t(()=>[k(l.$slots,"comment")]),footer:t(()=>[k(l.$slots,"footer")]),aside:t(()=>[k(l.$slots,"aside")]),"aside-custom":t(()=>[k(l.$slots,"aside-custom")]),default:t(()=>[k(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{o as default,u as usePageData};
