import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BOb0xH-1.js";import"./chunks/@vueuse/motion.BrTBiDBP.js";import{d as s,a as l,u as a}from"./chunks/vue-router.iuc03XPI.js";import{a1 as h,a3 as t,a4 as k,a5 as n,a6 as e,a7 as E,F as p,a2 as r,Z as d}from"./framework.CSpzLJwA.js";import"./app.DxsXqPDj.js";import"./chunks/dayjs.Dto65haK.js";import"./chunks/vue-i18n.C5QQbedb.js";import"./chunks/pinia.CKttsWmm.js";import"./chunks/nprogress.BEPa78Un.js";/* empty css                    */import"./YunComment.vue_vue_type_style_index_0_lang.IawhXP3l.js";import"./index.TQnGKZgq.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.DIveis5r.js";import"./post.BWOv1eSm.js";const g=s("/posts/EMQ",async i=>JSON.parse('{"title":"物联网亿万级通信一站式解决方案EMQ","description":"","frontmatter":{"title":"物联网亿万级通信一站式解决方案EMQ","author":"imklaus","tags":["EMQ"],"categories":["物联网","中间件"],"date":"2025/12/13 21:01:00","outline":"deep","postTitleClass":"text-#02b579","excerpt_type":"html","end":false},"headers":[],"relativePath":"pages/posts/EMQ.md","lastUpdated":null}'),{lazy:(i,s)=>i.name===s.name}),y={__name:"EMQ",setup(s,{expose:y}){const{data:c}=g(),o=a(),u=l(),F=Object.assign(u.meta.frontmatter||{},c.value?.frontmatter||{});o.currentRoute.value.data=c.value,d("valaxy:frontmatter",F),globalThis.$frontmatter=F;return y({frontmatter:{title:"物联网亿万级通信一站式解决方案EMQ",author:"imklaus",tags:["EMQ"],categories:["物联网","中间件"],date:"2025/12/13 21:01:00",outline:"deep",postTitleClass:"text-#02b579",excerpt_type:"html",end:!1}}),(s,l)=>{const a=i;return r(),h(a,{frontmatter:p(F)},{"main-content-md":t(()=>[l[0]||(l[0]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/2f85f4ebf7f70733a6110af3551300b1.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[1]||(l[1]=n("p",null,[n("strong",null,"目录指引"),E("：")],-1)),l[2]||(l[2]=n("nav",{class:"table-of-contents"},[n("ul",null,[n("li",null,[n("a",{href:"#_1-mqtt"},"1. MQTT"),n("ul",null,[n("li",null,[n("a",{href:"#_1-1-mqtt简介"},"1.1 MQTT简介")]),n("li",null,[n("a",{href:"#_1-2-mqtt协议相关概念"},"1.2 MQTT协议相关概念")]),n("li",null,[n("a",{href:"#_1-3-消息服务质量qos"},"1.3 消息服务质量QoS")]),n("li",null,[n("a",{href:"#_1-4-topic通配符匹配规则"},"1.4 Topic通配符匹配规则")])])]),n("li",null,[n("a",{href:"#_2-emqx"},"2. EMQX"),n("ul",null,[n("li",null,[n("a",{href:"#_2-1-emq-x简介"},"2.1 EMQ X简介")]),n("li",null,[n("a",{href:"#_2-2-环境搭建与配置"},"2.2 环境搭建与配置")]),n("li",null,[n("a",{href:"#_2-3-dashboard"},"2.3 Dashboard")]),n("li",null,[n("a",{href:"#_2-4-客户端调试工具mqttx"},"2.4 客户端调试工具MQTTX")])])]),n("li",null,[n("a",{href:"#_3-延迟发布"},"3.延迟发布"),n("ul",null,[n("li",null,[n("a",{href:"#_3-1-简介"},"3.1 简介")]),n("li",null,[n("a",{href:"#_3-2-演示"},"3.2 演示")])])]),n("li",null,[n("a",{href:"#_4-共享订阅"},"4.共享订阅"),n("ul",null,[n("li",null,[n("a",{href:"#_4-1-不带群组的共享订阅"},"4.1 不带群组的共享订阅")]),n("li",null,[n("a",{href:"#_4-2-带群组的共享订阅"},"4.2 带群组的共享订阅")])])]),n("li",null,[n("a",{href:"#_5-代理订阅"},"5.代理订阅"),n("ul",null,[n("li",null,[n("a",{href:"#_5-1-代理订阅应用场景"},"5.1 代理订阅应用场景")]),n("li",null,[n("a",{href:"#_5-2-代理订阅配置"},"5.2 代理订阅配置")])])]),n("li",null,[n("a",{href:"#_6-保留消息"},"6. 保留消息"),n("ul",null,[n("li",null,[n("a",{href:"#_6-1-保留消息应用场景"},"6.1 保留消息应用场景")]),n("li",null,[n("a",{href:"#_6-2-保留消息配置"},"6.2 保留消息配置")])])]),n("li",null,[n("a",{href:"#_7-认证"},"7.认证"),n("ul",null,[n("li",null,[n("a",{href:"#_7-1-认证简介"},"7.1 认证简介")]),n("li",null,[n("a",{href:"#_7-2-http认证"},"7.2 HTTP认证")])])]),n("li",null,[n("a",{href:"#_8-acl"},"8.ACL"),n("ul",null,[n("li",null,[n("a",{href:"#_8-1-acl简介"},"8.1 ACL简介")]),n("li",null,[n("a",{href:"#_8-2-http-acl"},"8.2 HTTP ACL")]),n("li",null,[n("a",{href:"#_8-3-acl代码实现"},"8.3 ACL代码实现")])])]),n("li",null,[n("a",{href:"#_9-微服务集成emq"},"9.微服务集成EMQ"),n("ul",null,[n("li",null,[n("a",{href:"#_9-1-mqtt客户端-paho"},"9.1 MQTT客户端- Paho")]),n("li",null,[n("a",{href:"#_9-2-基于paho的代码实现"},"9.2 基于Paho的代码实现")]),n("li",null,[n("a",{href:"#_9-3-消息分发处理架构"},"9.3 消息分发处理架构")]),n("li",null,[n("a",{href:"#_9-4-集成emq-x"},"9.4 集成EMQ X")]),n("li",null,[n("a",{href:"#_9-5-消息协议封装"},"9.5 消息协议封装")])])])])],-1)),l[3]||(l[3]=n("h2",{id:"_1-mqtt",tabindex:"-1"},[E("1. MQTT "),n("a",{class:"header-anchor",href:"#_1-mqtt","aria-label":'Permalink to "1. MQTT"'},"​")],-1)),l[4]||(l[4]=n("h3",{id:"_1-1-mqtt简介",tabindex:"-1"},[E("1.1 MQTT简介 "),n("a",{class:"header-anchor",href:"#_1-1-mqtt简介","aria-label":'Permalink to "1.1 MQTT简介"'},"​")],-1)),l[5]||(l[5]=n("h4",{id:"_1-1-1-什么是mqtt",tabindex:"-1"},[E("1.1.1 什么是MQTT "),n("a",{class:"header-anchor",href:"#_1-1-1-什么是mqtt","aria-label":'Permalink to "1.1.1 什么是MQTT"'},"​")],-1)),l[6]||(l[6]=n("p",null,'​ MQTT（Message Queuing Telemetry Transport，消息队列遥测传输协议），是一种基于发布/订阅（publish/subscribe）模式的"轻量级"通讯协议，该协议构建于TCP/IP协议上，由IBM在1999年发布。MQTT最大优点在于，可以以极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息服务。作为一种低开销、低带宽占用的即时通讯协议，使其在物联网、小型设备、移动应用等方面有较广泛的应用。',-1)),e(" more "),l[7]||(l[7]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/1-1.png",alt:"img",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[8]||(l[8]=n("p",null,"一个使用MQTT协议的应用程序或者设备，它总是建立到服务器的网络连接。客户端可以：",-1)),l[9]||(l[9]=n("ul",null,[n("li",null,"（1）发布其他客户端可能会订阅的信息；"),n("li",null,"（2）订阅其它客户端发布的消息；"),n("li",null,"（3）退订或删除应用程序的消息；"),n("li",null,"（4）断开与服务器连接。")],-1)),l[10]||(l[10]=n("p",null,'MQTT服务器以称为"消息代理"（Broker），可以是一个应用程序或一台设备。它是位于消息发布者和订阅者之间，它可以：',-1)),l[11]||(l[11]=n("ul",null,[n("li",null,"（1）接受来自客户的网络连接；"),n("li",null,"（2）接受客户发布的应用信息；"),n("li",null,"（3）处理来自客户端的订阅和退订请求；"),n("li",null,"（4）向订阅的客户转发应用程序消息。")],-1)),l[12]||(l[12]=n("h4",{id:"_1-1-2-设计原则",tabindex:"-1"},[E("1.1.2 设计原则 "),n("a",{class:"header-anchor",href:"#_1-1-2-设计原则","aria-label":'Permalink to "1.1.2 设计原则"'},"​")],-1)),l[13]||(l[13]=n("p",null,"由于物联网的环境是非常特别的，所以MQTT遵循以下设计原则：",-1)),l[14]||(l[14]=n("ul",null,[n("li",null,[n("p",null,"（1）精简，不添加可有可无的功能；")]),n("li",null,[n("p",null,"（2）发布/订阅（Pub/Sub）模式，方便消息在传感器之间传递，解耦Client/Server模式，带来的好处在于不必预先知道对方的存在（ip/port），不必同时运行；")]),n("li",null,[n("p",null,"（3）允许用户动态创建主题（不需要预先创建主题），零运维成本；")]),n("li",null,[n("p",null,"（4）把传输量降到最低以提高传输效率；")]),n("li",null,[n("p",null,"（5）把低带宽、高延迟、不稳定的网络等因素考虑在内；")]),n("li",null,[n("p",null,"（6）支持连续的会话保持和控制（心跳）；")]),n("li",null,[n("p",null,"（7）理解客户端计算能力可能很低；")]),n("li",null,[n("p",null,[E("（8）提供服务质量（ "),n("em",null,"quality of service level"),E("：QoS）管理")])]),n("li",null,[n("p",null,"（9）不强求传输数据的类型与格式，保持灵活性（指的是应用层业务数据）。")])],-1)),l[15]||(l[15]=n("h4",{id:"_1-1-3-应用领域",tabindex:"-1"},[E("1.1.3 应用领域 "),n("a",{class:"header-anchor",href:"#_1-1-3-应用领域","aria-label":'Permalink to "1.1.3 应用领域"'},"​")],-1)),l[16]||(l[16]=n("p",null,"MQTT协议广泛应用于物联网、移动互联网、智能硬件、车联网、电力能源等领域。",-1)),l[17]||(l[17]=n("ul",null,[n("li",null,"物联网M2M通信，物联网大数据采集"),n("li",null,"Android消息推送，WEB消息推送"),n("li",null,"移动即时消息，例如Facebook Messenger"),n("li",null,"智能硬件、智能家居、智能电器"),n("li",null,"车联网通信，电动车站桩采集"),n("li",null,"智慧城市、远程医疗、远程教育"),n("li",null,"电力、石油与能源等行业市场")],-1)),l[18]||(l[18]=n("h3",{id:"_1-2-mqtt协议相关概念",tabindex:"-1"},[E("1.2 MQTT协议相关概念 "),n("a",{class:"header-anchor",href:"#_1-2-mqtt协议相关概念","aria-label":'Permalink to "1.2 MQTT协议相关概念"'},"​")],-1)),l[19]||(l[19]=n("h4",{id:"_1-2-1-mqtt协议实现方式",tabindex:"-1"},[E("1.2.1 MQTT协议实现方式 "),n("a",{class:"header-anchor",href:"#_1-2-1-mqtt协议实现方式","aria-label":'Permalink to "1.2.1 MQTT协议实现方式"'},"​")],-1)),l[20]||(l[20]=n("p",null,"实现MQTT协议需要客户端和服务器端通讯完成，在通讯过程中，MQTT协议中有三种身份：发布者（Publisher）、代理（Broker）（服务器）、订阅者（Subscriber）。其中，消息的发布者和订阅者都是客户端，消息代理是服务器，消息发布者可以同时是订阅者。",-1)),l[21]||(l[21]=n("p",null,"MQTT传输的消息分为：主题（Topic）和负载（payload）两部分：",-1)),l[22]||(l[22]=n("ul",null,[n("li",null,"（1）Topic，可以理解为消息的类型，订阅者订阅（Subscribe）后，就会收到该主题的消息内容（payload）；"),n("li",null,"（2）payload，可以理解为消息的内容，是指订阅者具体要使用的内容。")],-1)),l[23]||(l[23]=n("h4",{id:"_1-2-2-mqtt协议中的方法",tabindex:"-1"},[E("1.2.2 MQTT协议中的方法 "),n("a",{class:"header-anchor",href:"#_1-2-2-mqtt协议中的方法","aria-label":'Permalink to "1.2.2 MQTT协议中的方法"'},"​")],-1)),l[24]||(l[24]=n("p",null,"MQTT协议中定义了一些方法（也被称为动作），来于表示对确定资源所进行操作。这个资源可以代表预先存在的数据或动态生成数据，这取决于服务器的实现。通常来说，资源指服务器上的文件或输出。主要方法有：",-1)),l[25]||(l[25]=n("ul",null,[n("li",null,[E("（1）"),n("strong",null,"CONNECT"),E("：客户端连接到服务器")]),n("li",null,"（2）CONNACK：连接确认"),n("li",null,[E("（3）"),n("strong",null,"PUBLISH"),E("：发布消息")]),n("li",null,"（4）PUBACK：发布确认"),n("li",null,"（5）PUBREC：发布的消息已接收"),n("li",null,"（6）PUBREL：发布的消息已释放"),n("li",null,"（7）PUBCOMP：发布完成"),n("li",null,[E("（8）"),n("strong",null,"SUBSCRIBE"),E("：订阅请求")]),n("li",null,"（9）SUBACK：订阅确认"),n("li",null,"（10）UNSUBSCRIBE：取消订阅"),n("li",null,"（11）UNSUBACK：取消订阅确认"),n("li",null,"（12）PINGREQ：客户端发送心跳"),n("li",null,"（13）PINGRESP：服务端心跳响应"),n("li",null,[E("（14）"),n("strong",null,"DISCONNECT"),E("：断开连接")]),n("li",null,"（15）AUTH：认证")],-1)),l[26]||(l[26]=n("h3",{id:"_1-3-消息服务质量qos",tabindex:"-1"},[E("1.3 消息服务质量QoS "),n("a",{class:"header-anchor",href:"#_1-3-消息服务质量qos","aria-label":'Permalink to "1.3 消息服务质量QoS"'},"​")],-1)),l[27]||(l[27]=n("p",null,"MQTT 协议中规定了消息服务质量（Quality of Service），它保证了在不同的网络环境下消息传递的可靠性，QoS 的设计是 MQTT 协议里的重点。作为专为物联网场景设计的协议，MQTT 的运行场景不仅仅是 PC，而是更广泛的窄带宽网络和低功耗设备，如果能在协议层解决传输质量的问题，将为物联网应用的开发提供极大便利。",-1)),l[28]||(l[28]=n("h4",{id:"_1-3-1-消息服务质量qos三个等级",tabindex:"-1"},[E("1.3.1 消息服务质量QoS三个等级 "),n("a",{class:"header-anchor",href:"#_1-3-1-消息服务质量qos三个等级","aria-label":'Permalink to "1.3.1 消息服务质量QoS三个等级"'},"​")],-1)),l[29]||(l[29]=n("p",null,"MQTT 设计了 3 个 QoS 等级。",-1)),l[30]||(l[30]=n("ul",null,[n("li",null,[n("p",null,"QoS 0：消息最多传递一次，如果当时客户端不可用，则会丢失该消息。")]),n("li",null,[n("p",null,"QoS 1：消息传递至少 1 次。")]),n("li",null,[n("p",null,"QoS 2：消息仅传送一次。"),n("p",null,'QoS0："至多一次"，消息发布完全依赖底层TCP/IP网络。会发生消息丢失或重复。这一级别可用于如下情况，环境传感器数据，丢失一次读记录无所谓，因为不久后还会有第二次发送。这一种方式主要普通APP的推送，倘若你的智能设备在消息推送时未联网，推送过去没收到，再次联网也就收不到了。')])],-1)),l[31]||(l[31]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/4.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[32]||(l[32]=n("p",null,'QoS1："至少一次"，确保消息到达，但消息重复可能会发生。',-1)),l[33]||(l[33]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/5.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[34]||(l[34]=n("p",null,'QoS2："只有一次"，确保消息到达一次。在一些要求比较严格的计费系统中，可以使用此级别。在计费系统中，消息重复或丢失会导致不正确的结果。这种最高质量的消息发布服务还可以用于即时通讯类的APP的推送，确保用户收到且只会收到一次。',-1)),l[35]||(l[35]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/6.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[36]||(l[36]=n("h4",{id:"_1-3-2-发布与订阅qos",tabindex:"-1"},[E("1.3.2 发布与订阅QoS "),n("a",{class:"header-anchor",href:"#_1-3-2-发布与订阅qos","aria-label":'Permalink to "1.3.2 发布与订阅QoS"'},"​")],-1)),l[37]||(l[37]=n("p",null,"MQTT 发布与订阅操作中的 QoS 代表了不同的含义，发布时的 QoS 表示消息发送到服务端时使用的 QoS，订阅时的 QoS 表示服务端向自己转发消息时可以使用的最大 QoS。",-1)),l[38]||(l[38]=n("ul",null,[n("li",null,"当客户端 A 的发布 QoS 大于客户端 B 的订阅 QoS 时，服务端向客户端 B 转发消息时使用的 QoS 为客户端 B 的订阅 QoS。"),n("li",null,"当客户端 A 的发布 QoS 小于客户端 B 的订阅 QoS 时，服务端向客户端 B 转发消息时使用的 QoS 为客户端 A 的发布 QoS。")],-1)),l[39]||(l[39]=n("p",null,"不同情况下客户端收到的消息 QoS 可参考下表：",-1)),l[40]||(l[40]=n("table",null,[n("thead",null,[n("tr",null,[n("th",null,"发布消息的 QoS"),n("th",null,"主题订阅的 QoS"),n("th",null,"接收消息的 QoS")])]),n("tbody",null,[n("tr",null,[n("td",null,"0"),n("td",null,"0"),n("td",null,"0")]),n("tr",null,[n("td",null,"0"),n("td",null,"1"),n("td",null,"0")]),n("tr",null,[n("td",null,"0"),n("td",null,"2"),n("td",null,"0")]),n("tr",null,[n("td",null,"1"),n("td",null,"0"),n("td",null,"0")]),n("tr",null,[n("td",null,"1"),n("td",null,"1"),n("td",null,"1")]),n("tr",null,[n("td",null,"1"),n("td",null,"2"),n("td",null,"1")]),n("tr",null,[n("td",null,"2"),n("td",null,"0"),n("td",null,"0")]),n("tr",null,[n("td",null,"2"),n("td",null,"1"),n("td",null,"1")]),n("tr",null,[n("td",null,"2"),n("td",null,"2"),n("td",null,"2")])])],-1)),l[41]||(l[41]=n("h3",{id:"_1-4-topic通配符匹配规则",tabindex:"-1"},[E("1.4 Topic通配符匹配规则 "),n("a",{class:"header-anchor",href:"#_1-4-topic通配符匹配规则","aria-label":'Permalink to "1.4 Topic通配符匹配规则"'},"​")],-1)),l[42]||(l[42]=n("p",null,[E("层级分隔符："),n("code",null,"/")],-1)),l[43]||(l[43]=n("blockquote",null,[n("p",null,[n("strong",null,"/ 用来分割主题树的每一层，并给主题空间提供分等级的结构。当两个通配符在一个主题中出现的时候，主题层次分隔符的使用是很重要的。")])],-1)),l[44]||(l[44]=n("div",{class:"language-toml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"toml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"示例：")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"love/you/with/all/my/heart")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[45]||(l[45]=n("p",null,[E("多层通配符："),n("code",null,"#")],-1)),l[46]||(l[46]=n("blockquote",null,[n("p",null,[n("strong",null,[E("多层通配符有可以表示大于等于0的层次。因此，"),n("code",null,"love/#"),E("也可匹配到单独的love，此时#代表0层。")])])],-1)),l[47]||(l[47]=n("blockquote",null,[n("p",null,[n("strong",null,[E("多层通配符一定要是主题树的最后一个字符。比如说，"),n("code",null,"love/#"),E("是有效的，但是"),n("code",null,"love/#/with"),E("是无效的。")])])],-1)),l[48]||(l[48]=n("div",{class:"language-toml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"toml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"love/you/#\t可匹配如下内容（包括但不限于）")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"love/you")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"love/you/with")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"love/you/with/all")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"love/you/with/all/my/heart")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"love/you/with/all/my/hearts")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[49]||(l[49]=n("p",null,[E("单层通配符："),n("code",null,"+")],-1)),l[50]||(l[50]=n("blockquote",null,[n("p",null,[n("strong",null,"只匹配主题的一层。")])],-1)),l[51]||(l[51]=n("div",{class:"language-toml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"toml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"1. love/you/+  :匹配love/you/with和love/you/and，但是不匹配love/you/with/all/my/heart。")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"2. 单层通配符只匹配1层，love/+不匹配love。")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"3. 单层通配符可以被用于主题树的任意层级，连带多层通配符。它必须被用在主题层级分隔符/的右边，除非它是指定自己。因此，+和love/+都是有效的，但是love+无效。单层通配符可以用在主题树的末端，也可以用在中间。比如说，love/+和love/+/with都是有效。")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[52]||(l[52]=n("p",null,"注意事项",-1)),l[53]||(l[53]=n("div",{class:"language-toml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"toml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"1.主题层次分隔符被用来在主题中引入层次。多层的通配符和单层通配符可以被使用，但他们不能被使用来做发布者的消息。")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"2.Topic命名尽量见名知意，符合规范，主题名字是大小写敏感的。比如说，love和LOVE是两个不同的主题。")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},'3.以/开头会产生一个不同的主题。比如说，/love与love不同。/love匹配"+/+"和/+,但不匹配+')]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"4.不要在任何主题中包含null（Unicode \\x0000）字符。")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"5.在主题树中，长度被限制于64k内但是在这以内没有限制层级的数目 。")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#B31D28","--shiki-light-font-style":"italic","--shiki-dark":"#FDAEB7","--shiki-dark-font-style":"italic"}},"6.可以有任意数目的根节点；也就是说，可以有任意数目的主题树。")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[54]||(l[54]=n("hr",null,null,-1)),l[55]||(l[55]=n("h2",{id:"_2-emqx",tabindex:"-1"},[E("2. EMQX "),n("a",{class:"header-anchor",href:"#_2-emqx","aria-label":'Permalink to "2. EMQX"'},"​")],-1)),l[56]||(l[56]=n("h3",{id:"_2-1-emq-x简介",tabindex:"-1"},[E("2.1 EMQ X简介 "),n("a",{class:"header-anchor",href:"#_2-1-emq-x简介","aria-label":'Permalink to "2.1 EMQ X简介"'},"​")],-1)),l[57]||(l[57]=n("p",null,"EMQ X 是开源社区中最流行的 MQTT 消息服务器。",-1)),l[58]||(l[58]=n("p",null,[E("EMQ官网："),n("a",{href:"https://www.emqx.cn/",target:"_blank",rel:"noreferrer"},"https://www.emqx.cn/")],-1)),l[59]||(l[59]=n("p",null,"EMQ X 公司主要提供三个版本：开源版、企业版、平台版 可在官网首页产品导航查看每一种产品；主要体现在支持的连接数量、产品功能和商业服务等方面的区别。",-1)),l[60]||(l[60]=n("p",null,[n("strong",null,"为什么选择EMQ X"),E("?从支持 MQTT5.0、稳定性、扩展性、集群能力等方面考虑，EMQX 的表现应该是最好的。")],-1)),l[61]||(l[61]=n("p",null,"EMQ X 是开源百万级分布式 MQTT 消息服务器（MQTT Messaging Broker），用于支持各种接入标准 MQTT 协议的设备，实现从设备端到服务器端的消息传递，以及从服务器端到设备端的设备控制消息转发。从而实现物联网设备的数据采集，和对设备的操作和控制。",-1)),l[62]||(l[62]=n("p",null,[E("与别的MQTT服务器相比"),n("strong",null,"EMQ X 主要有以下的特点：")],-1)),l[63]||(l[63]=n("ul",null,[n("li",null,[n("p",null,"经过100+版本的迭代，EMQ X 目前为开源社区中最流行的 MQTT 消息中间件，在各种客户严格的生产环境上经受了严苛的考验；")]),n("li",null,[n("p",null,"EMQ X 支持丰富的物联网协议，包括 MQTT、MQTT-SN、CoAP、 LwM2M、LoRaWAN 和 WebSocket 等；")]),n("li",null,[n("p",null,"优化的架构设计，支持超大规模的设备连接。企业版单机能支持百万的 MQTT 连接；集群能支持千万级别的 MQTT 连接；")]),n("li",null,[n("p",null,"易于安装和使用；")]),n("li",null,[n("p",null,"灵活的扩展性，支持企业的一些定制场景；")]),n("li",null,[n("p",null,"中国本地的技术支持服务，通过微信、QQ等线上渠道快速响应客户需求；")]),n("li",null,[n("p",null,[E("基于 Apache 2.0 协议许可，完全开源。EMQ X 的代码都放在 "),n("a",{href:"https://github.com/emqx/emqx",target:"_blank",rel:"noreferrer"},"Github"),E(" 中，用户可以查看所有源代码。")])]),n("li",null,[n("p",null,"EMQ X 3.0 支持 MQTT 5.0 协议，是开源社区中第一个支持 5.0协议规范的消息服务器，并且完全兼容 MQTT V3.1 和 V3.1.1 协议。除了 MQTT 协议之外，EMQ X 还支持别的一些物联网协议")]),n("li",null,[n("p",null,"单机支持百万连接，集群支持千万级连接；毫秒级消息转发。EMQ X 中应用了多种技术以实现上述功能，"),n("ul",null,[n("li",null,"利用 Erlang/OTP 平台的软实时、高并发和容错（电信领域久经考验的语言）"),n("li",null,"全异步架构"),n("li",null,"连接、会话、路由、集群的分层设计"),n("li",null,"消息平面和控制平面的分离等")])]),n("li",null,[n("p",null,"扩展模块和插件，EMQ X 提供了灵活的扩展机制，可以实现私有协议、认证鉴权、数据持久化、桥接转发和管理控制台等的扩展")]),n("li",null,[n("p",null,"桥接：EMQ X 可以跟别的消息系统进行对接，比如 EMQ X Enterprise 版本中可以支持将消息转发到 Kafka、RabbitMQ 或者别的 EMQ 节点等")]),n("li",null,[n("p",null,"共享订阅：共享订阅支持通过负载均衡的方式在多个订阅者之间来分发 MQTT 消息。比如针对物联网等数据采集场景，会有比较多的设备在发送数据，通过共享订阅的方式可以在订阅端设置多个订阅者来实现这几个订阅者之间的工作负载均衡")])],-1)),l[64]||(l[64]=n("h3",{id:"_2-2-环境搭建与配置",tabindex:"-1"},[E("2.2 环境搭建与配置 "),n("a",{class:"header-anchor",href:"#_2-2-环境搭建与配置","aria-label":'Permalink to "2.2 环境搭建与配置"'},"​")],-1)),l[65]||(l[65]=n("h4",{id:"_2-2-1-安装",tabindex:"-1"},[E("2.2.1 安装 "),n("a",{class:"header-anchor",href:"#_2-2-1-安装","aria-label":'Permalink to "2.2.1 安装"'},"​")],-1)),l[66]||(l[66]=n("p",null,"安装的方式有很多种，可供自由选择：",-1)),l[67]||(l[67]=n("p",null,"Shell脚本安装、包管理器安装、二进制包安装、ZIP压缩包安装、Homebrew安装、Docker运行安装、Helm安装、源码编译安装",-1)),l[68]||(l[68]=n("p",null,[n("strong",null,"Docker运行安装")],-1)),l[69]||(l[69]=n("p",null,"在EMQ X Broker下载页面直接提供的有基于docker的安装命令",-1)),l[70]||(l[70]=n("p",null,"1：首先拉取emqx的镜像",-1)),l[71]||(l[71]=n("div",{class:"language-shell max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"shell"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@docker emqx]# docker pull emqx/emqx:v4.1.0")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[72]||(l[72]=n("p",null,"2：使用docker命令运行得到docker容器",-1)),l[73]||(l[73]=n("div",{class:"language-shell max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"shell"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[root@docker emqx]# docker run -tid --name emqx -p 1883:1883 -p 8083:8083 -p 8081:8081 -p 8883:8883 -p 8084:8084 -p 18083:18083  emqx/emqx:v4.1.0")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[74]||(l[74]=n("p",null,"EMQ X broker提供了Dashboard 以方便用户管理设备与监控相关指标，启动后我们通过访问服务端18083端口",-1)),l[75]||(l[75]=n("p",null,[E("地址："),n("code",null,"http://192.168.200.128:18083")],-1)),l[76]||(l[76]=n("p",null,"访问Dashboard 查看启动效果!",-1)),l[77]||(l[77]=n("h4",{id:"_2-2-2-目录结构",tabindex:"-1"},[E("2.2.2 目录结构 "),n("a",{class:"header-anchor",href:"#_2-2-2-目录结构","aria-label":'Permalink to "2.2.2 目录结构"'},"​")],-1)),l[78]||(l[78]=n("p",null,"不同安装方式得到的 EMQ X 其目录结构会有所不同，具体如下:",-1)),l[79]||(l[79]=n("table",null,[n("thead",null,[n("tr",null,[n("th",null,"描述"),n("th",null,"使用 ZIP 压缩包安装(同docker)"),n("th",null,"使用二进制包安装")])]),n("tbody",null,[n("tr",null,[n("td",null,"可执行文件目录"),n("td",null,"./bin"),n("td",null,"/usr/lib/emqx/bin")]),n("tr",null,[n("td",null,"数据文件"),n("td",null,"./data"),n("td",null,"/var/lib/emqx/data")]),n("tr",null,[n("td",null,"Erlang 虚拟机文件"),n("td",null,"./erts-*"),n("td",null,"/usr/lib/emqx/erts-*")]),n("tr",null,[n("td",null,"配置文件目录"),n("td",null,"./etc"),n("td",null,"/etc/emqx")]),n("tr",null,[n("td",null,"依赖项目录"),n("td",null,"./lib"),n("td",null,"/usr/lib/emqx/lib")]),n("tr",null,[n("td",null,"日志文件"),n("td",null,"./log"),n("td",null,"/var/log/emqx")]),n("tr",null,[n("td",null,"启动相关的脚本、schema 文件"),n("td",null,"./releases"),n("td",null,"/usr/lib/emqx/releases")])])],-1)),l[80]||(l[80]=n("p",null,[E("以上目录中，用户经常接触与使用的是 "),n("code",null,"bin"),E("、"),n("code",null,"etc"),E("、"),n("code",null,"data"),E("、"),n("code",null,"log"),E(" 目录。")],-1)),l[81]||(l[81]=n("p",null,[n("strong",null,"bin 目录")],-1)),l[82]||(l[82]=n("p",null,[n("em",null,"emqx、emqx.cmd"),E("：EMQ X 的可执行文件")],-1)),l[83]||(l[83]=n("p",null,[n("em",null,"emqx_ctl、emqx_ctl.cmd"),E("：EMQ X 管理命令的可执行文件")],-1)),l[84]||(l[84]=n("p",null,[n("strong",null,"etc 目录")],-1)),l[85]||(l[85]=n("p",null,[E("EMQ X 通过 "),n("code",null,"etc"),E(" 目录下配置文件进行设置，主要配置文件包括:")],-1)),l[86]||(l[86]=n("table",null,[n("thead",null,[n("tr",null,[n("th",null,"配置文件"),n("th",null,"说明")])]),n("tbody",null,[n("tr",null,[n("td",null,"emqx.conf"),n("td",null,"EMQ X 配置文件")]),n("tr",null,[n("td",null,"acl.conf"),n("td",null,"EMQ X 默认 ACL 规则配置文件")]),n("tr",null,[n("td",null,"plugins/*.conf"),n("td",null,"EMQ X 各类插件配置文件")]),n("tr",null,[n("td",null,"certs/*"),n("td",null,"EMQ X SSL 证书文件")]),n("tr",null,[n("td",null,"emqx.lic"),n("td",null,"License 文件仅限 EMQ X Enterprise")])])],-1)),l[87]||(l[87]=n("p",null,[n("strong",null,"data 目录")],-1)),l[88]||(l[88]=n("p",null,[E("EMQ X 将运行数据存储在 "),n("code",null,"data"),E(" 目录下，主要的文件包括:")],-1)),l[89]||(l[89]=n("p",null,[n("code",null,"*configs/app.\\*.config*")],-1)),l[90]||(l[90]=n("p",null,[E("EMQ X 读取 "),n("code",null,"etc/emqx.conf"),E(" 和 "),n("code",null,"etc/plugins/*.conf"),E(" 中的配置后，转换为 Erlang 原生配置文件格式，并在运行时读取其中的配置。")],-1)),l[91]||(l[91]=n("p",null,[n("em",null,"loaded_plugins")],-1)),l[92]||(l[92]=n("p",null,[n("code",null,"loaded_plugins"),E(" 文件记录了 EMQ X 默认启动的插件列表，可以修改此文件以增删默认启动的插件。")],-1)),l[93]||(l[93]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ cat loaded_plugins")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"emqx_management.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"emqx_recon.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"emqx_retainer.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"emqx_dashboard.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"emqx_rule_engine.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"emqx_web_hook.")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[94]||(l[94]=n("p",null,[n("em",null,"mnesia")],-1)),l[95]||(l[95]=n("p",null,"Mnesia 数据库是 Erlang 内置的一个分布式 DBMS，可以直接存储 Erlang 的各种数据结构。",-1)),l[96]||(l[96]=n("p",null,[E("EMQ X 使用 Mnesia 数据库存储自身运行数据，例如告警记录、规则引擎已创建的资源和规则、Dashbaord 用户信息等数据，这些数据都将被存储在 "),n("code",null,"mnesia"),E(" 目录下，因此一旦删除该目录，将导致 EMQ X 丢失所有业务数据。")],-1)),l[97]||(l[97]=n("h3",{id:"_2-3-dashboard",tabindex:"-1"},[E("2.3 Dashboard "),n("a",{class:"header-anchor",href:"#_2-3-dashboard","aria-label":'Permalink to "2.3 Dashboard"'},"​")],-1)),l[98]||(l[98]=n("h4",{id:"_2-3-1-功能简介",tabindex:"-1"},[E("2.3.1 功能简介 "),n("a",{class:"header-anchor",href:"#_2-3-1-功能简介","aria-label":'Permalink to "2.3.1 功能简介"'},"​")],-1)),l[99]||(l[99]=n("p",null,"EMQ X 提供了 Dashboard 以方便用户管理设备与监控相关指标。通过 Dashboard可以查看服务器基本信息、负载情况和统计数据，可以查看某个客户端的连接状态等信息甚至断开其连接，也可以动态加载和卸载指定插件。除此之外，EMQ X Dashboard 还提供了规则引擎的可视化操作界面，同时集成了一个简易的 MQTT 客户端工具供用户测试使用。",-1)),l[100]||(l[100]=n("p",null,"EMQ X Dashboard 是一个 Web 应用程序，你可以直接通过浏览器来访问它，无需安装任何其他软件。",-1)),l[101]||(l[101]=n("p",null,[E("当 EMQ X 成功运行在你的本地计算机上且 EMQ X Dashboard 被默认启用时，通过访问 "),n("code",null,"http://localhost:18083"),E(" 来查看Dashboard，默认用户名是 "),n("code",null,"admin"),E("，密码是 "),n("code",null,"public"),E("。")],-1)),l[102]||(l[102]=n("p",null,"为了使用户在操作和浏览中可以快速地定位和切换当前位置，EMQ X Dashboard 采用了侧边导航的模式，默认情况下 Dashboard 包含以下一级导航项目：",-1)),l[103]||(l[103]=n("blockquote",null,[n("p",null,"最新版本EMQ X Broker的Dashboard界面布局略有不同，增加了些导航，但基本都差不多")],-1)),l[104]||(l[104]=n("table",null,[n("thead",null,[n("tr",null,[n("th",null,"导航项目"),n("th",null,"说明")])]),n("tbody",null,[n("tr",null,[n("td",null,"Monitor"),n("td",null,"提供了服务端与客户端监控信息的展示页面")]),n("tr",null,[n("td",null,"RULE ENGINE"),n("td",null,"提供了规则引擎的可视化操作页面")]),n("tr",null,[n("td",null,"MANAGEMENT"),n("td",null,"提供了扩展插件与应用的管理页面")]),n("tr",null,[n("td",null,"TOOLS"),n("td",null,"提供了 WebSocket 客户端工具以及 HTTP API 速查页面")]),n("tr",null,[n("td",null,"ADMIN"),n("td",null,"提供了 Dashboard 用户管理和显示设置等页面")])])],-1)),l[105]||(l[105]=n("h4",{id:"_2-3-2-websocket发布订阅测试",tabindex:"-1"},[E("2.3.2 Websocket发布订阅测试 "),n("a",{class:"header-anchor",href:"#_2-3-2-websocket发布订阅测试","aria-label":'Permalink to "2.3.2 Websocket发布订阅测试"'},"​")],-1)),l[106]||(l[106]=n("h3",{id:"_2-4-客户端调试工具mqttx",tabindex:"-1"},[E("2.4 客户端调试工具MQTTX "),n("a",{class:"header-anchor",href:"#_2-4-客户端调试工具mqttx","aria-label":'Permalink to "2.4 客户端调试工具MQTTX"'},"​")],-1)),l[107]||(l[107]=n("p",null,[n("a",{href:"https://mqttx.app/cn",target:"_blank",rel:"noreferrer"},"MQTT X"),E(" 是 "),n("a",{href:"http://emqx.cn/",target:"_blank",rel:"noreferrer"},"EMQ"),E(" 开源的一款优雅的跨平台 MQTT 5.0 桌面客户端，它支持 macOS, Linux, Windows。")],-1)),l[108]||(l[108]=n("p",null,[n("a",{href:"https://mqttx.app/cn",target:"_blank",rel:"noreferrer"},"MQTT X"),E(" 的 "),n("code",null,"UI"),E(" 采用了聊天界面形式，简化了页面操作逻辑，用户可以快速创建连接，允许保存多个客户端，方便用户快速测试 "),n("code",null,"MQTT/MQTTS"),E(" 连接，及 "),n("code",null,"MQTT"),E(" 消息的订阅和发布。")],-1)),l[109]||(l[109]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/mqttx-gif.gif",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[110]||(l[110]=n("p",null,[n("a",{href:"https://mqttx.app/cn",target:"_blank",rel:"noreferrer"},"https://mqttx.app/cn")],-1)),l[111]||(l[111]=n("hr",null,null,-1)),l[112]||(l[112]=n("h2",{id:"_3-延迟发布",tabindex:"-1"},[E("3.延迟发布 "),n("a",{class:"header-anchor",href:"#_3-延迟发布","aria-label":'Permalink to "3.延迟发布"'},"​")],-1)),l[113]||(l[113]=n("h3",{id:"_3-1-简介",tabindex:"-1"},[E("3.1 简介 "),n("a",{class:"header-anchor",href:"#_3-1-简介","aria-label":'Permalink to "3.1 简介"'},"​")],-1)),l[114]||(l[114]=n("p",null,[E("EMQ X 的延迟发布功能可以实现按照用户配置的时间间隔延迟发布 PUBLISH 报文的功能。当客户端使用特殊主题前缀 "),n("code",null,"$delayed/{DelayInteval}"),E(" 发布消息到 EMQ X 时，将触发延迟发布功能。延迟发布的功能是针对消息发布者而言的，订阅方只需要按照正常的主题订阅即可。")],-1)),l[115]||(l[115]=n("blockquote",null,[n("p",null,"应用场景举例说明："),n("p",null,"某智能售货机平台在双十一当天要对设备中所有商品做5折销售，双十一过去之后要立马恢复原价，为了满足这样的场景，我们可以在双十一0点给所有设备发送两条消息，一条消息是通过正常的主题发送，消息内容打5折；第二条消息延迟消息，延迟24小时，消息内容是恢复原价。这样在一个实现中可以完成两个业务场景。")],-1)),l[116]||(l[116]=n("p",null,"延迟发布主题的具体格式如下：",-1)),l[117]||(l[117]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$delayed/{DelayInterval}/{TopicName}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[118]||(l[118]=n("ul",null,[n("li",null,[n("code",null,"$delayed"),E(": 使用 "),n("code",null,"$delayed"),E(" 作为主题前缀的消息都将被视为需要延迟发布的消息。延迟间隔由下一主题层级中的内容决定。")]),n("li",null,[n("code",null,"{DelayInterval}"),E(": 指定该 MQTT 消息延迟发布的时间间隔，单位是秒，允许的最大间隔是 4294967 秒。如果 "),n("code",null,"{DelayInterval}"),E(" 无法被解析为一个整型数字，EMQ X 将丢弃该消息，客户端不会收到任何信息。")]),n("li",null,[n("code",null,"{TopicName}"),E(": MQTT 消息的主题名称。")])],-1)),l[119]||(l[119]=n("blockquote",null,[n("p",null,"例如:"),n("p",null,[n("code",null,"$delayed/15/x/y"),E(": 15 秒后将 MQTT 消息发布到主题 "),n("code",null,"x/y"),E("。")]),n("p",null,[n("code",null,"$delayed/60/a/b"),E(": 1 分钟后将 MQTT 消息发布到 "),n("code",null,"a/b"),E("。")]),n("p",null,[n("code",null,"$delayed/3600/mytopic"),E(": 1 小时后将 MQTT 消息发布到 "),n("code",null,"mytopic"),E("。")])],-1)),l[120]||(l[120]=n("p",null,[n("strong",null,[E("此功能由 "),n("code",null,"emqx_mod_delayed"),E(" 模块提供，需要开启模块后才能使用此功能。")])],-1)),l[121]||(l[121]=n("h3",{id:"_3-2-演示",tabindex:"-1"},[E("3.2 演示 "),n("a",{class:"header-anchor",href:"#_3-2-演示","aria-label":'Permalink to "3.2 演示"'},"​")],-1)),l[122]||(l[122]=n("ol",null,[n("li",null,[E("直接在Dashboard上订阅主题："),n("code",null,"t2/a")])],-1)),l[123]||(l[123]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/4-20.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[124]||(l[124]=n("ol",{start:"2"},[n("li",null,[E("然后在Dashboard上向主题："),n("code",null,"$delayed/10/t2/a"),E("发送消息")])],-1)),l[125]||(l[125]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/4-10.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[126]||(l[126]=n("hr",null,null,-1)),l[127]||(l[127]=n("h2",{id:"_4-共享订阅",tabindex:"-1"},[E("4.共享订阅 "),n("a",{class:"header-anchor",href:"#_4-共享订阅","aria-label":'Permalink to "4.共享订阅"'},"​")],-1)),l[128]||(l[128]=n("p",null,"共享订阅是在多个订阅者之间实现负载均衡的订阅方式：",-1)),l[129]||(l[129]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/4-1.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[130]||(l[130]=n("p",null,[E("上图中，3 个 subscriber 用共享订阅的方式订阅了同一个主题 "),n("code",null,"$share/g/topic"),E("，其中"),n("code",null,"topic"),E(" 才是它们订阅的真实主题名，而 "),n("code",null,"$share/g/"),E(" 只是共享订阅前缀。")],-1)),l[131]||(l[131]=n("p",null,"EMQ X 支持两种格式的共享订阅前缀：",-1)),l[132]||(l[132]=n("table",null,[n("thead",null,[n("tr",null,[n("th",null,"示例"),n("th",null,"前缀"),n("th",null,"真实主题名")])]),n("tbody",null,[n("tr",null,[n("td",null,[n("code",null,"$queue/t/1")]),n("td",null,[n("code",null,"$queue/")]),n("td",null,"t/1")]),n("tr",null,[n("td",null,[n("code",null,"$share/abc/t/1")]),n("td",null,[n("code",null,"$share/abc")]),n("td",null,"t/1")])])],-1)),l[133]||(l[133]=n("p",null,[E("注意：共享订阅的主题格式是针对订阅端来指定的，例如："),n("code",null,"$share/g/t/a"),E("；而消息的发布方是向主题："),n("code",null,"t/a"),E("发布消息。这样在订阅方才能达到负载均衡的效果。")],-1)),l[134]||(l[134]=n("p",null,[n("strong",null,"应用场景举例说明：")],-1)),l[135]||(l[135]=n("p",null,"某智能售货机平台下在全国有50万台售货机设备，在实际运营过程中平均每秒中会收到5万台设备上报过来的出货结果数据，假如用普通主题订阅来处理的话，消息的消费节点会有5万的并发，极有可能会导致该节点宕机，造成出货数据的丢失，对后续结算等业务操作造成极大困扰；如果只是简单增加消费节点的话也无法解决该问题，因为每个节点都会收到所有同样的数据，在这种业务场景下我们，我们希望通过增加消费节点并且节点之间是分摊消息的消费，以此来增强整个系统的负载能力和可用性，那我们就可以通过共享订阅来满足这种业务场景。",-1)),l[136]||(l[136]=n("h3",{id:"_4-1-不带群组的共享订阅",tabindex:"-1"},[E("4.1 不带群组的共享订阅 "),n("a",{class:"header-anchor",href:"#_4-1-不带群组的共享订阅","aria-label":'Permalink to "4.1 不带群组的共享订阅"'},"​")],-1)),l[137]||(l[137]=n("p",null,[n("strong",null,[E("以 "),n("code",null,"$queue/"),E(" 为前缀的共享订阅是不带群组的共享订阅")])],-1)),l[138]||(l[138]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/4-6.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[139]||(l[139]=n("p",null,[n("strong",null,"演示：")],-1)),l[140]||(l[140]=n("p",null,"我们还是在Dashboard的Websocket工具里发布消息：",-1)),l[141]||(l[141]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/4-15.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[142]||(l[142]=n("p",null,"查看客户端消息的接收情况",-1)),l[143]||(l[143]=n("p",null,[E("EMQ X 的共享订阅支持均衡策略配置："),n("code",null,"etc/emqx.conf")],-1)),l[144]||(l[144]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 均衡策略")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Dispatch strategy for shared subscription")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##                   ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: Enum")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## - random                                ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## - round_robin")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## - sticky   ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## - hash                                                             ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"broker.shared_subscription_strategy"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = random")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[145]||(l[145]=n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"left"}},"均衡策略"),n("th",{style:{"text-align":"left"}},"描述")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"left"}},"random"),n("td",{style:{"text-align":"left"}},"在所有订阅者中随机选择")]),n("tr",null,[n("td",{style:{"text-align":"left"}},"round_robin"),n("td",{style:{"text-align":"left"}},"按照订阅顺序轮询")]),n("tr",null,[n("td",{style:{"text-align":"left"}},"sticky"),n("td",{style:{"text-align":"left"}},"一直发往上次选取的订阅者")]),n("tr",null,[n("td",{style:{"text-align":"left"}},"hash"),n("td",{style:{"text-align":"left"}},"按照发布者 ClientID 的哈希值")])])],-1)),l[146]||(l[146]=n("h3",{id:"_4-2-带群组的共享订阅",tabindex:"-1"},[E("4.2 带群组的共享订阅 "),n("a",{class:"header-anchor",href:"#_4-2-带群组的共享订阅","aria-label":'Permalink to "4.2 带群组的共享订阅"'},"​")],-1)),l[147]||(l[147]=n("p",null,[n("strong",null,[E("以 "),n("code",null,"$share/<group-name>"),E(" 为前缀的共享订阅是带群组的共享订阅")])],-1)),l[148]||(l[148]=n("p",null,"group-name 可以为任意字符串，属于同一个群组内部的订阅者将以负载均衡接收消息，但 EMQ X 会向不同群组广播消息。",-1)),l[149]||(l[149]=n("p",null,"例如，假设订阅者 s1，s2，s3 属于群组 g1，订阅者 s4，s5 属于群组 g2。那么当 EMQ X 向这个主题发布消息 msg1 的时候：",-1)),l[150]||(l[150]=n("ul",null,[n("li",null,"EMQ X 会向两个群组 g1 和 g2 同时发送 msg1"),n("li",null,"s1，s2，s3 中只有一个会收到 msg1"),n("li",null,"s4，s5 中只有一个会收到 msg1")],-1)),l[151]||(l[151]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/4-2.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[152]||(l[152]=n("p",null,[n("strong",null,"案例演示：")],-1)),l[153]||(l[153]=n("p",null,"通过MQTTX 客户端工具新增五个连接，分别是s1、s2、s3、s4、s5",-1)),l[154]||(l[154]=n("p",null,[E("s1、s2、s3 以群组方式订阅主题 "),n("code",null,"$share/g1/topic")],-1)),l[155]||(l[155]=n("p",null,[E("s4、s5 以群组方式订阅主题 "),n("code",null,"$share/g2/topic")],-1)),l[156]||(l[156]=n("p",null,"通过emq的websocket工具发送消息到主题 topic，此时g1和g2分别会有一个订阅者会收到消息。",-1)),l[157]||(l[157]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/0-1.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[158]||(l[158]=n("hr",null,null,-1)),l[159]||(l[159]=n("h2",{id:"_5-代理订阅",tabindex:"-1"},[E("5.代理订阅 "),n("a",{class:"header-anchor",href:"#_5-代理订阅","aria-label":'Permalink to "5.代理订阅"'},"​")],-1)),l[160]||(l[160]=n("h3",{id:"_5-1-代理订阅应用场景",tabindex:"-1"},[E("5.1 代理订阅应用场景 "),n("a",{class:"header-anchor",href:"#_5-1-代理订阅应用场景","aria-label":'Permalink to "5.1 代理订阅应用场景"'},"​")],-1)),l[161]||(l[161]=n("p",null,[n("strong",null,"EMQ X 的代理订阅功能使得客户端在连接建立时，不需要发送额外的 SUBSCRIBE 报文，便能自动建立用户预设的订阅关系。")],-1)),l[162]||(l[162]=n("blockquote",null,[n("p",null,"应用场景举例说明："),n("p",null,"某冷链平台下有大量的冷链运输车，前期车上只配备了温度传感器，将车内的温度数据通过物联网终端经过EMQ定期上报给指标采集系统，由该系统将相关数据透传到一个大数据分析平台，用来分析这些温度数据，后来车上又配置了湿度传感器，这些湿度信息也会上报到EMQ，大数据平台也需要分析这些湿度信息，此时我们的指标采集系统就需要再单独开发一套订阅湿度信息的代码，如果我们采用代理订阅的话就无需再开发这块代码，只需经过简单的配置就可以增加这个功能了。")],-1)),l[163]||(l[163]=n("h3",{id:"_5-2-代理订阅配置",tabindex:"-1"},[E("5.2 代理订阅配置 "),n("a",{class:"header-anchor",href:"#_5-2-代理订阅配置","aria-label":'Permalink to "5.2 代理订阅配置"'},"​")],-1)),l[164]||(l[164]=n("p",null,"EMQ X 通过内置代理订阅模块就可以通过配置文件来指定代理订阅规则从而实现代理订阅，适用于有规律可循的静态的代理订阅需求。",-1)),l[165]||(l[165]=n("p",null,"默认是关闭的，我们需要开启该模块",-1)),l[166]||(l[166]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/0-2.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[167]||(l[167]=n("p",null,[E("仅仅开启并不意味代理订阅已经工作，你还需要配置相应的规则，EMQ X 的代理订阅规则支持用户自行配置，用户可以自行添加多条代理订阅规则，每条代理订阅规则都需要指定 Topic 和 QoS，规则的数量没有限制，在 "),n("code",null,"etc/emqx.conf"),E(" 文件中添代理订阅规则的格式如下：")],-1)),l[168]||(l[168]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"module.subscription.<number>."),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = <topic>")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"module.subscription.<number>."),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"qos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = <qos>")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[169]||(l[169]=n("p",null,[E("在配置代理订阅的主题时，EMQ X 提供了 "),n("code",null,"%c"),E(" 和 "),n("code",null,"%u"),E(" 两个占位符供用户使用，EMQ X 会在执行代理订阅时将配置中的 "),n("code",null,"%c"),E(" 和 "),n("code",null,"%u"),E(" 分别替换为客户端的 "),n("code",null,"Client ID"),E(" 和 "),n("code",null,"Username"),E("，需要注意的是，"),n("code",null,"%c"),E(" 和 "),n("code",null,"%u"),E(" 必须占用一整个主题层级。")],-1)),l[170]||(l[170]=n("p",null,[E("例如，在 "),n("code",null,"etc/emqx.conf"),E(" 文件中添加以下代理订阅规则：")],-1)),l[171]||(l[171]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"module.subscription.1.topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = client/%c    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"module.subscription.1.qos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = 1")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"module.subscription.2.topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = user/%u    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"module.subscription.2.qos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = 2")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"module.subscription.3.topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = testtopic/"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"module.subscription.3.qos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = 2")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[172]||(l[172]=n("p",null,[E("当一个客户端连接 EMQ X 的时候，假设客户端的 "),n("code",null,"Client ID"),E(" 为 "),n("code",null,"testclient"),E("，"),n("code",null,"Username"),E(" 为 "),n("code",null,"tester"),E("，根据上文的配置规则，代理订阅功能会主动帮客户端订阅 QoS 为 1 的 "),n("code",null,"client/testclient"),E(" 和 QoS 为 2 的 "),n("code",null,"user/tester"),E(" 这两个主题。")],-1)),l[173]||(l[173]=n("p",null,[E("这些配置都是基于配置文件实现的"),n("strong",null,"静态代理订阅"),E("，开源版本的EMQ X目前只支持这种静态代理订阅，收费的 EMQ X Enterprise 版本中支持"),n("strong",null,"动态代理订阅"),E("，通过外部数据库设置主题列表在设备连接时读取列表实现代理订阅。")],-1)),l[174]||(l[174]=n("hr",null,null,-1)),l[175]||(l[175]=n("h2",{id:"_6-保留消息",tabindex:"-1"},[E("6. 保留消息 "),n("a",{class:"header-anchor",href:"#_6-保留消息","aria-label":'Permalink to "6. 保留消息"'},"​")],-1)),l[176]||(l[176]=n("h3",{id:"_6-1-保留消息应用场景",tabindex:"-1"},[E("6.1 保留消息应用场景 "),n("a",{class:"header-anchor",href:"#_6-1-保留消息应用场景","aria-label":'Permalink to "6.1 保留消息应用场景"'},"​")],-1)),l[177]||(l[177]=n("p",null,"服务端收到 Retain 标志为 1 的 PUBLISH 报文时，会将该报文视为保留消息，除了被正常转发以外，保留消息会被存储在服务端，每个主题下只能存在一份保留消息，因此如果已经存在相同主题的保留消息，则该保留消息被替换。",-1)),l[178]||(l[178]=n("p",null,"当客户端建立订阅时，如果服务端存在主题匹配的保留消息，则这些保留消息将被立即发送给该客户端。借助保留消息，新的订阅者能够立即获取最近的状态，而不需要等待无法预期的时间，这在很多场景下非常重要的。",-1)),l[179]||(l[179]=n("p",null,[E("EMQ X 默认开启保留消息的功能，可以在 "),n("code",null,"etc/emqx.conf"),E(" 中修改 "),n("code",null,"mqtt.retain_available"),E(" 为 "),n("code",null,"false"),E(" 以禁用保留消息功能。如果 EMQ X 在保留消息功能被禁用的情况下依然收到了保留消息，那么将返回原因码为 0x9A（不支持保留消息）的 DISCONNECT 报文。")],-1)),l[180]||(l[180]=n("p",null,[n("strong",null,"应用场景举例：")],-1)),l[181]||(l[181]=n("p",null,"某车联网项目，车辆出租公司会实时监控所有车辆的GPS地理位置信息，这些信息是通过每个车辆每10分钟定时上报的GPS信息，这些信息需要展示在某调度系统的大屏上，该调度系统因为其他模块升级需要重新部署，升级后也需要去订阅获取所有车辆的GPS信息，上线完成后刚好错过了车辆最近一次上报的GPS信息，如果这些消息不是保留消息，该调度系统大屏上是空白的，必须等10分钟后才能调度这些车辆，10分钟内无法做出任何操作，用户体验非常差，但是如果这些信息是保留消息，该系统上线后立即就会收到最近所有车辆的位置信息，立即就可以展示然后进行调度。",-1)),l[182]||(l[182]=n("h3",{id:"_6-2-保留消息配置",tabindex:"-1"},[E("6.2 保留消息配置 "),n("a",{class:"header-anchor",href:"#_6-2-保留消息配置","aria-label":'Permalink to "6.2 保留消息配置"'},"​")],-1)),l[183]||(l[183]=n("p",null,[E("EMQ X 的保留消息功能是由 "),n("code",null,"emqx_retainer"),E(" 插件实现，该插件默认开启，通过修改 "),n("code",null,"emqx_retainer"),E(" 插件的配置，可以调整 EMQ X 储存保留消息的位置，限制接收保留消息数量和 Payload 最大长度，以及调整保留消息的过期时间。")],-1)),l[184]||(l[184]=n("p",null,[n("code",null,"emqx_retainer"),E(" 插件默认开启，插件的配置路径为 "),n("code",null,"etc/plugins/emqx_retainer.conf"),E("。")],-1)),l[185]||(l[185]=n("table",null,[n("thead",null,[n("tr",null,[n("th",null,"配置项"),n("th",null,"类型"),n("th",null,"可取值"),n("th",null,"默认值"),n("th",null,"说明")])]),n("tbody",null,[n("tr",null,[n("td",null,"retainer.storage_type"),n("td",null,"enum"),n("td",null,[n("code",null,"ram"),E(", "),n("code",null,"disc"),E(", "),n("code",null,"disc_only")]),n("td",null,"ram"),n("td",null,"ram：仅储存在内存中；disc：储存在内存和硬盘中；disc_only：仅储存在硬盘中。")]),n("tr",null,[n("td",null,"retainer.max_retained_messages"),n("td",null,"integer"),n("td",null,[n("code",null,">= 0")]),n("td",null,"0"),n("td",null,"保留消息的最大数量，0 表示没有限制。保留消息数量超出最大值限制后，可以替换已存在的保留消息，但不能为新的主题储存保留消息。")]),n("tr",null,[n("td",null,"retainer.max_payload_size"),n("td",null,"bytesize"),n("td"),n("td",null,"1MB"),n("td",null,"保留消息的最大 Payload 值。Payload 大小超出最大值后 EMQ Ｘ 消息服务器会把收到的保留消息作为普通消息处理。")]),n("tr",null,[n("td",null,"retainer.expiry_interval"),n("td",null,"duration"),n("td"),n("td",null,"０"),n("td",null,"保留消息的过期时间，0 表示永不过期。如果 PUBLISH 报文中设置了消息过期间隔，那么以 PUBLISH 报文中的消息过期间隔为准。单位：毫秒")])])],-1)),l[186]||(l[186]=n("p",null,"EMQ X Enterprise 中可将保留消息存储到多种外部数据库。",-1)),l[187]||(l[187]=n("hr",null,null,-1)),l[188]||(l[188]=n("h2",{id:"_7-认证",tabindex:"-1"},[E("7.认证 "),n("a",{class:"header-anchor",href:"#_7-认证","aria-label":'Permalink to "7.认证"'},"​")],-1)),l[189]||(l[189]=n("h3",{id:"_7-1-认证简介",tabindex:"-1"},[E("7.1 认证简介 "),n("a",{class:"header-anchor",href:"#_7-1-认证简介","aria-label":'Permalink to "7.1 认证简介"'},"​")],-1)),l[190]||(l[190]=n("p",null,"​ 身份认证是大多数应用的重要组成部分，MQTT 协议支持用户名密码认证，启用身份认证能有效阻止非法客户端的连接。EMQ X 中的认证指的是当一个客户端连接到 EMQ X 的时候，通过服务器端的配置来控制客户端连接服务器的权限。",-1)),l[191]||(l[191]=n("p",null,"​ EMQ X 支持使用内置数据源（文件、内置数据库）、JWT、外部主流数据库和自定义 HTTP API 作为身份认证数据源。连接数据源、进行认证逻辑通过插件实现的，每个插件对应一种认证方式，使用前需要启用相应的插件。",-1)),l[192]||(l[192]=n("p",null,"​ 客户端连接时插件通过检查其 username/clientid 和 password 是否与指定数据源的信息一致来实现对客户端的身份认证。",-1)),l[193]||(l[193]=n("h4",{id:"_7-1-1-认证方式",tabindex:"-1"},[E("7.1.1 认证方式 "),n("a",{class:"header-anchor",href:"#_7-1-1-认证方式","aria-label":'Permalink to "7.1.1 认证方式"'},"​")],-1)),l[194]||(l[194]=n("p",null,"EMQ X 支持的认证方式：",-1)),l[195]||(l[195]=n("p",null,[n("em",null,"内置数据源")],-1)),l[196]||(l[196]=n("ul",null,[n("li",null,"Username 认证（即将废弃）"),n("li",null,"Cliend ID 认证（即将废弃）")],-1)),l[197]||(l[197]=n("p",null,"使用配置文件与 EMQ X 内置数据库提供认证数据源，通过 HTTP API 进行管理，足够简单轻量。",-1)),l[198]||(l[198]=n("p",null,[n("em",null,"外部数据库")],-1)),l[199]||(l[199]=n("ul",null,[n("li",null,"LDAP 认证"),n("li",null,"MySQL 认证"),n("li",null,"PostgreSQL 认证"),n("li",null,"Redis 认证"),n("li",null,"MongoDB 认证")],-1)),l[200]||(l[200]=n("p",null,"外部数据库可以存储大量数据，同时方便与外部设备管理系统集成。",-1)),l[201]||(l[201]=n("p",null,[n("em",null,"其他")],-1)),l[202]||(l[202]=n("ul",null,[n("li",null,"HTTP 认证"),n("li",null,"JWT 认证")],-1)),l[203]||(l[203]=n("p",null,"JWT 认证可以批量签发认证信息，HTTP 认证能够实现复杂的认证鉴权逻辑。",-1)),l[204]||(l[204]=n("p",null,"更改插件配置后需要重启插件才能生效，部分认证鉴权插件包含 ACL 功能",-1)),l[205]||(l[205]=n("h4",{id:"_7-1-2-认证结果与匿名认证",tabindex:"-1"},[E("7.1.2 认证结果与匿名认证 "),n("a",{class:"header-anchor",href:"#_7-1-2-认证结果与匿名认证","aria-label":'Permalink to "7.1.2 认证结果与匿名认证"'},"​")],-1)),l[206]||(l[206]=n("p",null,[n("strong",null,"认证结果")],-1)),l[207]||(l[207]=n("p",null,"任何一种认证方式最终都会返回一个结果：",-1)),l[208]||(l[208]=n("ul",null,[n("li",null,"认证成功：经过比对客户端认证成功"),n("li",null,"认证失败：经过比对客户端认证失败，数据源中密码与当前密码不一致"),n("li",null,"忽略认证（ignore）：当前认证方式中未查找到认证数据，无法显式判断结果是成功还是失败，交由认证链下一认证方式或匿名认证来判断")],-1)),l[209]||(l[209]=n("p",null,[n("strong",null,"匿名认证")],-1)),l[210]||(l[210]=n("p",null,"EMQ X 默认配置中启用了匿名认证，任何客户端都能接入 EMQ X。没有启用认证插件或认证插件没有显式允许/拒绝（ignore）连接请求时，EMQ X 将根据匿名认证启用情况决定是否允许客户端连接。",-1)),l[211]||(l[211]=n("p",null,"配置匿名认证开关：",-1)),l[212]||(l[212]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# etc/emqx.conf")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: true | false")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"allow_anonymous"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = true")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[213]||(l[213]=n("p",null,"生产环境中请禁用匿名认证。",-1)),l[214]||(l[214]=n("p",null,"注意：我们需要进入到容器内部修改该配置，然后重启EMQ X服务",-1)),l[215]||(l[215]=n("h3",{id:"_7-2-http认证",tabindex:"-1"},[E("7.2 HTTP认证 "),n("a",{class:"header-anchor",href:"#_7-2-http认证","aria-label":'Permalink to "7.2 HTTP认证"'},"​")],-1)),l[216]||(l[216]=n("p",null,[E("HTTP 认证使用外部自建 HTTP 应用认证数据源，根据 HTTP API 返回的数据判定认证结果，能够实现复杂的认证鉴权逻辑。启用该功能需要将"),n("code",null,"emqx_auth_http"),E("插件启用，并且修改该插件的配置文件，在里面指定HTTP认证接口的url。"),n("code",null,"emqx_auth_http"),E("插件同时还包含了ACL的功能。")],-1)),l[217]||(l[217]=n("p",null,[E("EMQ X 在设备连接事件中使用当前客户端相关信息作为参数，向用户自定义的认证服务发起请求查询权限，通过返回的 HTTP "),n("strong",null,"响应状态码"),E(" (HTTP statusCode) 来处理认证请求。")],-1)),l[218]||(l[218]=n("ul",null,[n("li",null,"认证失败：API 返回 4xx 状态码"),n("li",null,"认证成功：API 返回 200 状态码"),n("li",null,"忽略认证：API 返回 200 状态码且消息体 ignore")],-1)),l[219]||(l[219]=n("h4",{id:"_7-2-1-认证请求配置",tabindex:"-1"},[E("7.2.1 认证请求配置 "),n("a",{class:"header-anchor",href:"#_7-2-1-认证请求配置","aria-label":'Permalink to "7.2.1 认证请求配置"'},"​")],-1)),l[220]||(l[220]=n("p",null,"进行身份认证时，EMQ X 将使用当前客户端信息填充并发起用户配置的认证查询请求，查询出该客户端在 HTTP 服务器端的认证数据。",-1)),l[221]||(l[221]=n("p",null,[E("打开"),n("code",null,"etc/plugins/emqx_auth_http.conf"),E("配置文件，通过修改如下内容：修改完成后需要重启EMQX服务")],-1)),l[222]||(l[222]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# etc/plugins/emqx_auth_http.conf")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 请求地址")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.auth_req"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = http://192.168.200.0:8991/mqtt/auth")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## HTTP 请求方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: post | get | put")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.auth_req.method"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = post")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 请求参数")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.auth_req.params"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%c,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%u,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"password"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%P")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[223]||(l[223]=n("p",null,"HTTP 请求方法为 GET 时，请求参数将以 URL 查询字符串的形式传递；POST、PUT 请求则将请求参数以普通表单形式提交（content-type 为 x-www-form-urlencoded）。",-1)),l[224]||(l[224]=n("p",null,"你可以在认证请求中使用以下占位符，请求时 EMQ X 将自动填充为客户端信息：",-1)),l[225]||(l[225]=n("ul",null,[n("li",null,[n("code",null,"%u"),E("：用户名")]),n("li",null,[n("code",null,"%c"),E("：Client ID")]),n("li",null,[n("code",null,"%a"),E("：客户端 IP 地址")]),n("li",null,[n("code",null,"%r"),E("：客户端接入协议")]),n("li",null,[n("code",null,"%P"),E("：明文密码")]),n("li",null,[n("code",null,"%p"),E("：客户端端口")]),n("li",null,[n("code",null,"%C"),E("：TLS 证书公用名（证书的域名或子域名），仅当 TLS 连接时有效")]),n("li",null,[n("code",null,"%d"),E("：TLS 证书 subject，仅当 TLS 连接时有效")])],-1)),l[226]||(l[226]=n("p",null,"推荐使用 POST 与 PUT 方法，使用 GET 方法时明文密码可能会随 URL 被记录到传输过程中的服务器日志中。",-1)),l[227]||(l[227]=n("h4",{id:"_7-2-2-认证服务开发",tabindex:"-1"},[E("7.2.2 认证服务开发 "),n("a",{class:"header-anchor",href:"#_7-2-2-认证服务开发","aria-label":'Permalink to "7.2.2 认证服务开发"'},"​")],-1)),l[228]||(l[228]=n("p",null,[E("创建基于springboot的应用程序："),n("code",null,"emq-demo")],-1)),l[229]||(l[229]=n("p",null,"1：相关坐标如下：",-1)),l[230]||(l[230]=n("div",{class:"language-xml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"xml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"parent"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.springframework.boot</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">spring-boot-starter-parent</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">2.3.0.RELEASE</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"relativePath"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/> "),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"\x3c!-- lookup parent from repository --\x3e")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"parent"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">com.itheima</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">emq-demo</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">0.0.1-SNAPSHOT</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">emq-demo</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"description"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">emq demo演示</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"description"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"properties"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"java.version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">1.8</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"java.version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"properties"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependencies"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.springframework.boot</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">spring-boot-starter-web</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.springframework.boot</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">spring-boot-devtools</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scope"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">runtime</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scope"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"optional"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">true</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"optional"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.springframework.boot</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">spring-boot-configuration-processor</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"optional"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">true</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"optional"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.springframework.boot</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">spring-boot-starter-test</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scope"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">test</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"scope"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"exclusions"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"exclusion"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.junit.vintage</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">junit-vintage-engine</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"exclusion"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"exclusions"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependencies"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"build"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"plugins"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"plugin"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.springframework.boot</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">spring-boot-maven-plugin</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"plugin"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"plugins"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"build"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[231]||(l[231]=n("p",null,"2：创建application.yml配置文件并配置",-1)),l[232]||(l[232]=n("div",{class:"language-yaml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"yaml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"server"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  port"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8991")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"spring"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  application"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    name"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"emq-demo")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[233]||(l[233]=n("p",null,"3：创建Controller：com.itheima.controller.mqtt.AuthController；编写如下",-1)),l[234]||(l[234]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * Created by 传智播客*黑马程序员.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RestController")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/mqtt"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AuthController"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Logger log "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," LoggerFactory."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getLogger"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(AuthController.class);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Map<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> users;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostConstruct")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," init"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        users "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HashMap<>();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"user"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"123456"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//实际的密码应该是密文,mqtt的http认证组件传输过来的密码是明文，我们需要自己进行加密验证")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq-client2"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"123456"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq-client3"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"123456"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/auth"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"auth"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"clientid"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                  @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"username"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                  @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"password"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"password"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emqx认证组件调用自定义的认证服务开始认证,clientid={},username={},password={}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",clientid,username,password);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //在此处可以进行复杂也的认证逻辑,但是我们为了演示方便做一个固定操作")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String value "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(username);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(StringUtils."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isEmpty"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(value)){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(HttpStatus.UNAUTHORIZED);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"value."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(password)){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(HttpStatus.UNAUTHORIZED);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[235]||(l[235]=n("hr",null,null,-1)),l[236]||(l[236]=n("h2",{id:"_8-acl",tabindex:"-1"},[E("8.ACL "),n("a",{class:"header-anchor",href:"#_8-acl","aria-label":'Permalink to "8.ACL"'},"​")],-1)),l[237]||(l[237]=n("h3",{id:"_8-1-acl简介",tabindex:"-1"},[E("8.1 ACL简介 "),n("a",{class:"header-anchor",href:"#_8-1-acl简介","aria-label":'Permalink to "8.1 ACL简介"'},"​")],-1)),l[238]||(l[238]=n("p",null,[E("ACL是指对发布(publish)/订阅(subscribe)操作的权限控制。例如拒绝用户"),n("code",null,"emq-demo"),E("向"),n("code",null,"testTopic/a"),E("主题发布消息。 EMQ X 支持通过客户端发布订阅 ACL 进行客户端权限的管理。")],-1)),l[239]||(l[239]=n("blockquote",null,[n("p",null,"在真实的生产环境中，EMQ是可以公网访问连接的。如果不进行访问控制，任何设备或终端都可以连接EMQ进行通讯，那必然会有很大的安全隐患。"),n("p",null,[n("em",null,"ACL"),E(" 即访问控制列表（(Access Control Lists），是EMQ提供的安全解决方案。通过开启ACL插件，可以实现连接的认证、超级用户的判断以及对发布订阅控制。")])],-1)),l[240]||(l[240]=n("h4",{id:"_8-1-1-acl-插件",tabindex:"-1"},[E("8.1.1 ACL 插件 "),n("a",{class:"header-anchor",href:"#_8-1-1-acl-插件","aria-label":'Permalink to "8.1.1 ACL 插件"'},"​")],-1)),l[241]||(l[241]=n("p",null,"EMQ X 支持使用配置文件、外部主流数据库和自定义 HTTP API 作为 ACL 数据源。",-1)),l[242]||(l[242]=n("p",null,"连接数据源、进行访问控制功能是通过插件实现的，使用前需要启用相应的插件。",-1)),l[243]||(l[243]=n("p",null,"客户端订阅主题、发布消息时插件通过检查目标主题（Topic）是否在指定数据源允许/禁止列表内来实现对客户端的发布、订阅权限管理。",-1)),l[244]||(l[244]=n("p",null,[n("strong",null,"配置文件")],-1)),l[245]||(l[245]=n("ul",null,[n("li",null,"内置 ACL")],-1)),l[246]||(l[246]=n("p",null,"使用配置文件提供认证数据源，适用于变动较小的 ACL 管理。",-1)),l[247]||(l[247]=n("p",null,[n("strong",null,"外部数据库")],-1)),l[248]||(l[248]=n("ul",null,[n("li",null,"MySQL ACL"),n("li",null,"PostgreSQL ACL"),n("li",null,"Redis ACL"),n("li",null,"MongoDB ACL")],-1)),l[249]||(l[249]=n("p",null,"外部数据库可以存储大量数据、动态管理 ACL，方便与外部设备管理系统集成。",-1)),l[250]||(l[250]=n("p",null,[n("strong",null,"其他")],-1)),l[251]||(l[251]=n("ul",null,[n("li",null,"HTTP ACL")],-1)),l[252]||(l[252]=n("p",null,[E("HTTP ACL 能够实现复杂的 ACL 管理。ACL 功能包含在认证鉴权插件中，更改插件配置后需要"),n("strong",null,"重启插件"),E("才能生效，在EMQ中找到emqx_auth_http 插件将其开启")],-1)),l[253]||(l[253]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/9-2.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[254]||(l[254]=n("blockquote",null,[n("p",null,[E("ACL 功能包含在认证鉴权插件中，更改插件配置后需要"),n("strong",null,"重启插件"),E("才能生效，")])],-1)),l[255]||(l[255]=n("h4",{id:"_8-1-2-授权结果与全局配置",tabindex:"-1"},[E("8.1.2 授权结果与全局配置 "),n("a",{class:"header-anchor",href:"#_8-1-2-授权结果与全局配置","aria-label":'Permalink to "8.1.2 授权结果与全局配置"'},"​")],-1)),l[256]||(l[256]=n("p",null,"任何一次 ACL 授权最终都会返回一个结果：",-1)),l[257]||(l[257]=n("ul",null,[n("li",null,"允许：经过检查允许客户端进行操作"),n("li",null,"禁止：经过检查禁止客户端操作"),n("li",null,"忽略（ignore）：未查找到 ACL 权限信息（no match），无法显式判断结果是允许还是禁止，交由下一 ACL 插件或默认 ACL 规则来判断")],-1)),l[258]||(l[258]=n("p",null,[E("默认配置中 ACL 是开放授权的，即授权结果为"),n("strong",null,[E("忽略（ignore）"),n("strong",null,"时"),E("允许")]),E("客户端通过授权。")],-1)),l[259]||(l[259]=n("p",null,[E("通过 "),n("code",null,"etc/emqx.conf"),E(" 中的 ACL 配置可以更改该属性：")],-1)),l[260]||(l[260]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# etc/emqx.conf")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## ACL 未匹配时默认授权")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: allow | deny")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"acl_nomatch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = allow")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[261]||(l[261]=n("p",null,[E("在生产环境我们需要修改全局配置文件中关于acl的配置，将"),n("code",null,"acl_nomatch"),E("配置项的值改为："),n("code",null,"deny")],-1)),l[262]||(l[262]=n("p",null,[E("完成配置后使用"),n("code",null,"emqx restart"),E("重启emqx broker服务")],-1)),l[263]||(l[263]=n("h4",{id:"_8-1-3-acl-鉴权链",tabindex:"-1"},[E("8.1.3 ACL 鉴权链 "),n("a",{class:"header-anchor",href:"#_8-1-3-acl-鉴权链","aria-label":'Permalink to "8.1.3 ACL 鉴权链"'},"​")],-1)),l[264]||(l[264]=n("p",null,"当同时启用多个 ACL 插件时，EMQ X 将按照插件开启先后顺序进行链式鉴权：",-1)),l[265]||(l[265]=n("ul",null,[n("li",null,[n("p",null,"一通过授权，终止链并允许客户端通过验证")]),n("li",null,[n("p",null,"一旦授权失败，终止链并禁止客户端通过验证")]),n("li",null,[n("p",null,[E("直到最后一个 ACL 插件仍未通过，根据"),n("strong",null,"默认授权"),E("配置判定")]),n("ul",null,[n("li",null,"默认授权为允许时，允许客户端通过验证")])]),n("li",null,[n("p",null,"默认授权为禁止时，禁止客户端通过验证")])],-1)),l[266]||(l[266]=n("figure",null,[n("img",{src:"https://gcore.jsdelivr.net/gh/imLKlauS/blog-picture@main/blogs/9-3.png",alt:"",loading:"lazy",decoding:"async",class:"lazy"})],-1)),l[267]||(l[267]=n("p",null,"同时只启用一个 ACL 插件可以提高客户端 ACL 检查性能。",-1)),l[268]||(l[268]=n("h4",{id:"_8-1-4-acl-缓存",tabindex:"-1"},[E("8.1.4 ACL 缓存 "),n("a",{class:"header-anchor",href:"#_8-1-4-acl-缓存","aria-label":'Permalink to "8.1.4 ACL 缓存"'},"​")],-1)),l[269]||(l[269]=n("p",null,[E("ACL 缓存允许客户端在命中某条 ACL 规则后，便将其缓存至内存中，以便下次直接使用，客户端发布、订阅频率较高的情况下开启 ACL 缓存可以提高 ACL 检查性能。 在 "),n("code",null,"etc/emqx.conf"),E(" 可以配置 ACL 缓存大小与缓存时间：")],-1)),l[270]||(l[270]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 是否启用")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"enable_acl_cache"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = on")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 单个客户端最大缓存规则数量")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"acl_cache_max_size"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = 32")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 缓存失效时间，超时后缓存将被清除")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"acl_cache_ttl"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = 1m")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[271]||(l[271]=n("h4",{id:"_8-1-5-超级用户",tabindex:"-1"},[E("8.1.5 超级用户 "),n("a",{class:"header-anchor",href:"#_8-1-5-超级用户","aria-label":'Permalink to "8.1.5 超级用户"'},"​")],-1)),l[272]||(l[272]=n("p",null,"客户端在进行认证的时候客户端可拥有“超级用户”身份，超级用户拥有最高权限不受 ACL 限制。",-1)),l[273]||(l[273]=n("ul",null,[n("li",null,"认证鉴权插件启用超级用户功能后，发布订阅时 EMQ X 将优先检查客户端超级用户身份"),n("li",null,"客户端为超级用户时，通过授权并跳过后续 ACL 检查")],-1)),l[274]||(l[274]=n("h3",{id:"_8-2-http-acl",tabindex:"-1"},[E("8.2 HTTP ACL "),n("a",{class:"header-anchor",href:"#_8-2-http-acl","aria-label":'Permalink to "8.2 HTTP ACL"'},"​")],-1)),l[275]||(l[275]=n("p",null,"HTTP 认证使用外部自建 HTTP 应用认证授权数据源，根据 HTTP API 返回的数据判定授权结果，能够实现复杂的 ACL 校验逻辑。",-1)),l[276]||(l[276]=n("p",null,"插件：",-1)),l[277]||(l[277]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"emqx_auth_http")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[278]||(l[278]=n("blockquote",null,[n("p",null,"注意：emqx_auth_http 插件同时包含认证功能，可通过注释禁用。")],-1)),l[279]||(l[279]=n("p",null,[E("EMQ X 在设备发布、订阅事件中使用当前客户端相关信息作为参数，向用户自定义的认证服务发起请求权限，通过返回的 HTTP "),n("strong",null,"响应状态码"),E(" (HTTP statusCode) 来处理 ACL 授权请求。")],-1)),l[280]||(l[280]=n("ul",null,[n("li",null,"无权限：API 返回 4xx 状态码"),n("li",null,"授权成功：API 返回 200 状态码"),n("li",null,"忽略授权：API 返回 200 状态码且消息体 ignore")],-1)),l[281]||(l[281]=n("h4",{id:"_8-2-1-acl配置",tabindex:"-1"},[E("8.2.1 ACL配置 "),n("a",{class:"header-anchor",href:"#_8-2-1-acl配置","aria-label":'Permalink to "8.2.1 ACL配置"'},"​")],-1)),l[282]||(l[282]=n("p",null,"首先查询客户端是否为超级用户，客户端为超级用户时将跳过 ACL 查询。",-1)),l[283]||(l[283]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# etc/plugins/emqx_auth_http.conf")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"####使用vi编辑该配置，修改URL请求地址")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##--------------------------------------------------------------------")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Superuser request.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Variables:")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %u: username")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %c: clientid")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %a: ipaddress")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %r: protocol")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %P: password")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %p: sockport of server accepted")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %C: common name of client TLS cert")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %d: subject of client TLS cert")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: URL 请求地址")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.super_req"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = http://192.168.200.1:8991/mqtt/superuser")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: post | get | put 请求方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.super_req.method"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = post")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: Params 请求参数")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.super_req.params"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%c,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%u")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[284]||(l[284]=n("p",null,"ACL请求的配置",-1)),l[285]||(l[285]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# etc/plugins/emqx_auth_http.conf")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"####使用vi编辑该配置，修改URL请求地址以及请求方式")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##--------------------------------------------------------------------")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## ACL request.")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Variables:")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %A: 1 | 2, 1 = sub, 2 = pub")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %u: username")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %c: clientid")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %a: ipaddress")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %r: protocol")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %m: mountpoint")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##  - %t: topic")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: URL")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.acl_req"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = http://192.168.200.1:8991/mqtt/acl")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: post | get | put")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.acl_req.method"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = post")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: Params")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.acl_req.params"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"access"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%A,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%u,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%c,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ipaddr"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%a,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%t,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mountpoint"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%m")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[286]||(l[286]=n("p",null,[n("strong",null,"请求说明")],-1)),l[287]||(l[287]=n("p",null,"HTTP 请求方法为 GET 时，请求参数将以 URL 查询字符串的形式传递；POST、PUT 请求则将请求参数以普通表单形式提交（content-type 为 x-www-form-urlencoded）。",-1)),l[288]||(l[288]=n("p",null,"你可以在认证请求中使用以下占位符，请求时 EMQ X 将自动填充为客户端信息：",-1)),l[289]||(l[289]=n("ul",null,[n("li",null,[n("code",null,"%u"),E("：用户名")]),n("li",null,[n("code",null,"%c"),E("：Client ID")]),n("li",null,[n("code",null,"%a"),E("：客户端 IP 地址")]),n("li",null,[n("code",null,"%r"),E("：客户端接入协议")]),n("li",null,[n("code",null,"%P"),E("：明文密码")]),n("li",null,[n("code",null,"%p"),E("：客户端端口")]),n("li",null,[n("code",null,"%C"),E("：TLS 证书公用名（证书的域名或子域名），仅当 TLS 连接时有效")]),n("li",null,[n("code",null,"%d"),E("：TLS 证书 subject，仅当 TLS 连接时有效")]),n("li",null,[n("code",null,"%m"),E("：topic的安装点，是桥接的连接属性")])],-1)),l[290]||(l[290]=n("p",null,"推荐使用 POST 与 PUT 方法，使用 GET 方法时明文密码可能会随 URL 被记录到传输过程中的服务器日志中。",-1)),l[291]||(l[291]=n("h4",{id:"_8-2-2-http-acl接口开发",tabindex:"-1"},[E("8.2.2 HTTP ACL接口开发 "),n("a",{class:"header-anchor",href:"#_8-2-2-http-acl接口开发","aria-label":'Permalink to "8.2.2 HTTP ACL接口开发"'},"​")],-1)),l[292]||(l[292]=n("p",null,[E("在原有的项目"),n("code",null,"emq-demo"),E("中我们已经开发了基于HTTP API的认证Controller："),n("code",null,"AuthController"),E("，按照我们的请求URL配置，我们需要在该Controller中添加两个接口方法，一个是用于查询superuser的，一个是用于进行ACL授权查询的，这两个方法分别如下：")],-1)),l[293]||(l[293]=n("p",null,"1：查询客户端是否为超级用户，",-1)),l[294]||(l[294]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/superuser"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?>"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," superUser"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"clientid"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String clientid,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                   @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"username"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String username){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emqx 查询是否是超级用户,clientid={},username={}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",clientid,username);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"contains"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"admin"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," username."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"contains"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"admin"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"用户{}是超级用户"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",username);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //是超级用户")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"         log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"用户{}不是超级用户"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",username);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //不是超级用户")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Object"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">(HttpStatus.UNAUTHORIZED);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[295]||(l[295]=n("p",null,"注意，我们在初始化方法init中添加一个超级用户：admin/admin",-1)),l[296]||(l[296]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostConstruct")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," init"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    users "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," HashMap<>();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"user"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"123456"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq-client2"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"123456"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq-client3"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"123456"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    users."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"admin"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"admin"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[297]||(l[297]=n("p",null,"同理：API返回200状态码代表是超级用户，API返回4XX状态码则不是超级用户",-1)),l[298]||(l[298]=n("p",null,"2：ACL 授权查询请求",-1)),l[299]||(l[299]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/acl"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"acl"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"access"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," access,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                          @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"username"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")String username,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                          @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"clientid"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")String clientid,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                          @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ipaddr"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")String ipaddr,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                          @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"topic"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")String topic,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                          @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mountpoint"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")String mountpoint){")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"EMQX发起客户端操作授权查询请求,access={},username={},clientid={},ipaddr={},topic={},mountpoint={}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"             access,username,clientid,ipaddr,topic,mountpoint);")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(username."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq-client2"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," topic."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"testtopic/#"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," access "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"客户端{}有权限订阅{}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",username,topic);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>(HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(username."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq-client3"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," topic."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"testtopic/123"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," access "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"客户端{}有权限向{}发布消息"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",username,topic);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"客户端{},username={},没有权限对主题{}进行{}操作"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",clientid,username,topic,access"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"订阅"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"发布"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ResponseEntity"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(HttpStatus.UNAUTHORIZED);"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//无权限")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[300]||(l[300]=n("p",null,"在这个方法中我们设置了：",-1)),l[301]||(l[301]=n("p",null,[E("只有用户名为"),n("code",null,"emq-client2"),E("的客户端能够去订阅"),n("code",null,"testtopic/#"),E("的权限其他客户端都不可以")],-1)),l[302]||(l[302]=n("p",null,[E("只有用户名为"),n("code",null,"emq-client3"),E("的客户端能够向"),n("code",null,"testtopic/123"),E("发布消息的权限其他都没有")],-1)),l[303]||(l[303]=n("h3",{id:"_8-3-acl代码实现",tabindex:"-1"},[E("8.3 ACL代码实现 "),n("a",{class:"header-anchor",href:"#_8-3-acl代码实现","aria-label":'Permalink to "8.3 ACL代码实现"'},"​")],-1)),l[304]||(l[304]=n("h4",{id:"_8-3-1-连接认证",tabindex:"-1"},[E("8.3.1 连接认证 "),n("a",{class:"header-anchor",href:"#_8-3-1-连接认证","aria-label":'Permalink to "8.3.1 连接认证"'},"​")],-1)),l[305]||(l[305]=n("p",null,"（1）在 lkd_vms_service 工程com.lkd.http.controller 包下新建AclController",-1)),l[306]||(l[306]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.http.controller;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.entity.VendingMachineEntity;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.feignService.StatusService;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.service.VendingMachineService;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.RequiredArgsConstructor;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.elasticsearch.common.Strings;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.http.HttpStatus;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.http.ResponseEntity;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.web.bind.annotation."),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RestController")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/acl"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequiredArgsConstructor")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AclController"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," VendingMachineService vmService;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 连接控制")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," username")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," password")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," clientid")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@return")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/auth"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"auth"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"value"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "username"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"required"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"defaultValue"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                  @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"value"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "password"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"required"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"defaultValue"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"password"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                                  @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"value"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "clientid"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"required"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"defaultValue"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' ""'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Strings."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isNullOrEmpty"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid)){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.BAD_REQUEST);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"startsWith"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mqtt"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"client request connect,clientId:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"clientid);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //服务器端连接")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"startsWith"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"monitor"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        var"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," qw "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," LambdaQueryWrapper<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"VendingMachineEntity"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        qw."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"eq"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(VendingMachineEntity"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"getClientId,clientid);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        var"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vm "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vmService."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getOne"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(qw);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(vm "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.BAD_REQUEST);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[307]||(l[307]=n("p",null,"（2）etc/plugins/emqx_auth_http.conf 文件中修改",-1)),l[308]||(l[308]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"##")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: HTTP认证接口的URL")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.auth_req"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = http://192.168.200.1:9007/vm-service/acl/auth")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## HTTP 请求方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: post | get | put")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.auth_req.method"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = post")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 请求参数")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.auth_req.params"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%c,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%u,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"password"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%P")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[309]||(l[309]=n("p",null,"（3）网关的配置中添加对以下地址的放行",-1)),l[310]||(l[310]=n("div",{class:"language-http max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"http"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/vm-service/acl/auth")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[311]||(l[311]=n("h4",{id:"_8-3-2-超级用户判断",tabindex:"-1"},[E("8.3.2 超级用户判断 "),n("a",{class:"header-anchor",href:"#_8-3-2-超级用户判断","aria-label":'Permalink to "8.3.2 超级用户判断"'},"​")],-1)),l[312]||(l[312]=n("p",null,"客户端可拥有“超级用户”身份，超级用户拥有最高权限不受 ACL 限制。",-1)),l[313]||(l[313]=n("ul",null,[n("li",null,"认证鉴权插件启用超级用户功能后，发布订阅时 EMQ X 将优先检查客户端超级用户身份"),n("li",null,"客户端为超级用户时，通过授权并跳过后续 ACL 检查")],-1)),l[314]||(l[314]=n("p",null,"（1）AclController新增方法",-1)),l[315]||(l[315]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 判断是否是超级用户")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," clientid")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," username")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@return")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/superuser"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?>"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," superuser"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String clientid,@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String username){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"超级用户认证"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"startsWith"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"monitor"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"是超级用户!!!!"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"startsWith"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mqtt"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"是超级用户!!!!"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"不是超级用户!!!!"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.BAD_REQUEST);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[316]||(l[316]=n("p",null,"（2）etc/plugins/emqx_auth_http.conf 文件中修改",-1)),l[317]||(l[317]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: 超级用户认证的URL")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.super_req"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = http://192.168.200.1:9007/vm-service/acl/superuser")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## HTTP 请求方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: post | get | put")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.super_req.method"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = post")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 请求参数")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.super_req.params"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%c,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%u")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[318]||(l[318]=n("p",null,"（3）网关的配置中添加对以下地址的放行",-1)),l[319]||(l[319]=n("div",{class:"language-http max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"http"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/vm-service/acl/superuser")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[320]||(l[320]=n("h4",{id:"_8-3-3-发布订阅控制",tabindex:"-1"},[E("8.3.3 发布订阅控制 "),n("a",{class:"header-anchor",href:"#_8-3-3-发布订阅控制","aria-label":'Permalink to "8.3.3 发布订阅控制"'},"​")],-1)),l[321]||(l[321]=n("p",null,"（1）AclController新增方法",-1)),l[322]||(l[322]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 发布订阅控制")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," clientid")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," topic")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," access"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," 动作2：publish、1：subscribe")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," username")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@return")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostMapping"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/pubsub"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?>"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," pubsub"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String clientid,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                             @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String topic,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                             @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," access,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                             @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String username,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                             @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String ipaddr,")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                             @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RequestParam"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String mountpoint){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    System.out."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"acl clientid:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"clientid"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" username:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"username"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" ipaddr:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ipaddr"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" topic:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"topic"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" access:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"access"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" mountpoint:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"mountpoint);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"pubsub!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Strings."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isNullOrEmpty"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid)){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.BAD_REQUEST);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," qw "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," LambdaQueryWrapper<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"VendingMachineEntity"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    qw."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"eq"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(VendingMachineEntity"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"::"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"getClientId,clientid);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vm "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vmService."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getOne"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(qw);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(vm "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.BAD_REQUEST);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(access "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," topic."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"server/"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"vm."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInnerCode"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(access "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," topic."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"equals"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"vm/"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"vm."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInnerCode"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.OK);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(clientid"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"不能发布或订阅消息!!!!"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ResponseEntity<>("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", HttpStatus.BAD_REQUEST);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[323]||(l[323]=n("p",null,"（2）etc/plugins/emqx_auth_http.conf 文件中修改",-1)),l[324]||(l[324]=n("div",{class:"language-properties max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"properties"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: 发布订阅控制的URL")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.acl_req"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = http://192.168.200.1:9007/vm-service/acl/pubsub")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## HTTP 请求方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Value: post | get | put")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.acl_req.method"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = post")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 请求参数")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"auth.http.acl_req.params"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," = "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"access"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%A,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%u,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"clientid"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%c,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ipaddr"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%a,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%t,"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mountpoint"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"=%m")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[325]||(l[325]=n("p",null,"（3）网关的配置中添加对以下地址的放行",-1)),l[326]||(l[326]=n("div",{class:"language-http max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"http"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"acl/pubsub")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[327]||(l[327]=n("hr",null,null,-1)),l[328]||(l[328]=n("h2",{id:"_9-微服务集成emq",tabindex:"-1"},[E("9.微服务集成EMQ "),n("a",{class:"header-anchor",href:"#_9-微服务集成emq","aria-label":'Permalink to "9.微服务集成EMQ"'},"​")],-1)),l[329]||(l[329]=n("h3",{id:"_9-1-mqtt客户端-paho",tabindex:"-1"},[E("9.1 MQTT客户端- Paho "),n("a",{class:"header-anchor",href:"#_9-1-mqtt客户端-paho","aria-label":'Permalink to "9.1 MQTT客户端- Paho"'},"​")],-1)),l[330]||(l[330]=n("p",null,"Paho Java客户端是用Java编写的MQTT客户端库，用于开发在JVM或其他Java兼容平台（例如Android）上运行的应用程序。",-1)),l[331]||(l[331]=n("p",null,"Paho不仅可以对接EMQ X Broker，还可以对接满足符合MQTT协议规范的消息代理服务端。",-1)),l[332]||(l[332]=n("h3",{id:"_9-2-基于paho的代码实现",tabindex:"-1"},[E("9.2 基于Paho的代码实现 "),n("a",{class:"header-anchor",href:"#_9-2-基于paho的代码实现","aria-label":'Permalink to "9.2 基于Paho的代码实现"'},"​")],-1)),l[333]||(l[333]=n("h4",{id:"_9-2-1-消息发布到emq",tabindex:"-1"},[E("9.2.1 消息发布到EMQ "),n("a",{class:"header-anchor",href:"#_9-2-1-消息发布到emq","aria-label":'Permalink to "9.2.1 消息发布到EMQ"'},"​")],-1)),l[334]||(l[334]=n("p",null,[E("（1）在项目"),n("code",null,"service_common"),E("中，添加坐标依赖")],-1)),l[335]||(l[335]=n("div",{class:"language-xml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"xml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.eclipse.paho</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.eclipse.paho.client.mqttv3</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">1.2.5</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[336]||(l[336]=n("p",null,"（2）配置文件中添加配置",-1)),l[337]||(l[337]=n("div",{class:"language-yaml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"yaml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mqtt"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  client"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"admin")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    password"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"public")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    serverURI"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"tcp://192.168.200.128:1883")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    clientId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"monitor.task.${random.int[1000,9999]}")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    keepAliveInterval"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #连接保持检查周期")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    connectionTimeout"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #连接超时时间")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  producer"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    defaultQos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #消息质量")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    defaultRetained"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #是否是保留消息")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    defaultTopic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"topic/test1"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #默认主题")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[338]||(l[338]=n("p",null,[E("（3）在"),n("code",null,"service_common"),E("项目中新建"),n("code",null,"emq"),E("包，添加EMQ客户端配置类，该类里面封装了EMQ的连接配置和客户端对象：")],-1)),l[339]||(l[339]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.Data;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3."),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Value;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.boot.context.properties.ConfigurationProperties;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.context.annotation.Bean;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.context.annotation.Configuration;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.stereotype.Component;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.util.List;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Configuration")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Data")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttConfig"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.client.username}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String username;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.client.password}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String password;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.client.serverURI}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String serverURI;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.client.clientId}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String clientId;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.client.keepAliveInterval}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," keepAliveInterval;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.client.connectionTimeout}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," connectionTimeout;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttClient "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            MqttClientPersistence persistence "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," mqttClientPersistence"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            MqttClient client "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(serverURI, clientId, persistence);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            client."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setManualAcks"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            client."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"connect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mqttConnectOptions"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," client;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq connect error"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttConnectOptions "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mqttConnectOptions"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        MqttConnectOptions options "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttConnectOptions"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        options."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setUserName"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(username);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        options."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setPassword"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(password."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toCharArray"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        options."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCleanSession"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        options."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setAutomaticReconnect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        options."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setConnectionTimeout"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(connectionTimeout);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        options."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setKeepAliveInterval"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(keepAliveInterval);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        options."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMqttVersion"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(MqttConnectOptions.MQTT_VERSION_3_1_1);")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," options;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttClientPersistence "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mqttClientPersistence"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MemoryPersistence"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[340]||(l[340]=n("p",null,"（4）service_common工程下新建emq包，包下创建mqtt生产者类",-1)),l[341]||(l[341]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.fasterxml.jackson.core.JsonProcessingException;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.utils.JsonUtil;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3.MqttClient;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3.MqttException;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Value;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.stereotype.Component;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttProducer"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.producer.defaultQos}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," defaultProducerQos;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.producer.defaultRetained}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," defaultRetained;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.producer.defaultTopic}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String defaultTopic;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttClient mqttClient;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"payload"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(defaultTopic, payload);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"payload"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(topic, defaultProducerQos, payload);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," qos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"payload"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(topic, qos, defaultRetained, payload);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," qos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," retained"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"payload"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"publish"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(topic, payload."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getBytes"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(), qos, retained);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"publish msg error."'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," <"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"T"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," Object"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," qos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", T "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"msg"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," JsonProcessingException {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String payload "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," JsonUtil."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"serialize"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msg);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(topic,qos,payload);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[342]||(l[342]=n("p",null,"（5）编写单元测试代码",-1)),l[343]||(l[343]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"RunWith"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(SpringRunner.class)")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"SpringBootTest")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," TestEMQ"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttProducer mqttProducer;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Test")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," publish"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        mqttProducer."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"send"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"lkdtest"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"{'name':'abc'}\""),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[344]||(l[344]=n("h4",{id:"_9-2-2-emq消息订阅",tabindex:"-1"},[E("9.2.2 EMQ消息订阅 "),n("a",{class:"header-anchor",href:"#_9-2-2-emq消息订阅","aria-label":'Permalink to "9.2.2 EMQ消息订阅"'},"​")],-1)),l[345]||(l[345]=n("p",null,"（1）修改配置文件，添加订阅主题的配置",-1)),l[346]||(l[346]=n("div",{class:"language-yaml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"yaml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mqtt"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  client"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    username"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"admin")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    password"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"public")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    serverURI"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"tcp://192.168.200.128:1883")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    clientId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"monitor.vms.${random.int[1000,9999]}")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    keepAliveInterval"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #连接保持检查周期")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    connectionTimeout"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #连接超时时间")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  producer"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    defaultQos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #消息质量")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    defaultRetained"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," #非保留消息")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    defaultTopic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"topic/test1")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  consumer"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    consumerTopics"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"$queue/server/task/supply,$share/task/server/status")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[347]||(l[347]=n("p",null,"（2）在相同包下MQTT消息回调类，用来解析处理收到的mqtt消息和根据配置订阅关心的主题：",-1)),l[348]||(l[348]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3."),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Value;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.stereotype.Component;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.util.List;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttCallback"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttCallbackExtended"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    //需要订阅的topic配置")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"${mqtt.consumer.consumerTopics}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," List<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> consumerTopics;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttService mqttService;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttClient mqttClient;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," connectionLost"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Throwable "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"throwable"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq error."'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",throwable);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," messageArrived"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", MqttMessage "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"message"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Exception {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //处理消息")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        mqttService."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"processMessage"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(topic, message);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //处理成功后确认消息")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"messageArrivedComplete"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(message."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),message."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getQos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," deliveryComplete"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(IMqttDeliveryToken "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"iMqttDeliveryToken"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"deliveryComplete---------"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," iMqttDeliveryToken."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isComplete"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," connectComplete"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"s"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //和EMQ连接成功后根据配置自动订阅topic")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(consumerTopics "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," consumerTopics."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"size"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            consumerTopics."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"forEach"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(t"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'">>>>>>>>>>>>>>subscribe topic:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"t);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"subscribe"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(t, "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq connect error"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            });")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," setMqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(MqttClient "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"mqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".mqttClient "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," mqttClient;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[349]||(l[349]=n("p",null,"（3）修改MqttConfig类，添加回调类",-1)),l[350]||(l[350]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttCallback mqttCallback;"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//添加这句")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Bean")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttClient "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            MqttClientPersistence persistence "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," mqttClientPersistence"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            MqttClient client "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(serverURI, clientId, persistence);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            client."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setManualAcks"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttCallback."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setMqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(client);"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//添加这句")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            client."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCallback"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(mqttCallback);"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//添加这句")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            client."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"connect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mqttConnectOptions"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," client;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq connect error"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[351]||(l[351]=n("h3",{id:"_9-3-消息分发处理架构",tabindex:"-1"},[E("9.3 消息分发处理架构 "),n("a",{class:"header-anchor",href:"#_9-3-消息分发处理架构","aria-label":'Permalink to "9.3 消息分发处理架构"'},"​")],-1)),l[352]||(l[352]=n("p",null,"基于我们现有的架构 ，每一个需要处理消息的类只需要添加@ProcessType注解，并实现MsgHandler接口即可。@ProcessType是一个自定义注解，用于指定消息协议名称（关于消息协议我们在第1章有讲解）",-1)),l[353]||(l[353]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 处理商品配置请求")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ProcessType"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"value"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "skuCfgReq"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SkuCfgMsgHandler"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MsgHandler"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," process"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"jsonMsg"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," IOException {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //.......")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[354]||(l[354]=n("p",null,"@ProcessType注解和消息处理接口MsgHandler在立可得1.0版本就已经存在，这里做到了兼容。",-1)),l[355]||(l[355]=n("p",null,"原理解析：",-1)),l[356]||(l[356]=n("p",null,"消息处理接口MsgHandler",-1)),l[357]||(l[357]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 消息处理接口")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," interface"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MsgHandler"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," process"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"jsonMsg"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," IOException;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[358]||(l[358]=n("p",null,"自定义注解ProcessType用于指定消息处理类协议名称",-1)),l[359]||(l[359]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.annotations;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.lang.annotation."),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * 协议处理类型注解")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Documented")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Retention"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(RetentionPolicy.RUNTIME)")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Target"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({ElementType.TYPE})")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"interface"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ProcessType"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[360]||(l[360]=n("p",null,"MsgHandlerContextImp实现了ApplicationContextAware接口，在微服务启动的时候扫描所有MsgHandler接口的实现类，并提取其ProcessType注解中定义的值（协议名称），将这些类加载到map集合中，以协议名称作为key，以类的对象作为值。",-1)),l[361]||(l[361]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ApplicationContext ctx;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Map<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"MsgHandler"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> handlerMap "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Maps."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"newHashMap"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," setApplicationContext"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ApplicationContext applicationContext) throws BeansException {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ctx "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," applicationContext;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Map<"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"String"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"MsgHandler"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> map "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ctx."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getBeansOfType"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(MsgHandler.class);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    map."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"values"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"stream"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"forEach"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(v"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String msgType "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," v."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getClass"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getAnnotation"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ProcessType.class)."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"value"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        handlerMap."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"put"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msgType,v);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    });")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[362]||(l[362]=n("p",null,"这样我们就可以通过getMsgHandler方法，根据协议找到MsgHandler的实现类。getMsgHandler方法是MsgHandlerContext接口定义的",-1)),l[363]||(l[363]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MsgHandler "),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMsgHandler"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String msgType){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," handlerMap."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msgType);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[364]||(l[364]=n("p",null,[E("在"),n("code",null,"emq"),E("包下添加具体的消息处理接口定义：")],-1)),l[365]||(l[365]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3.MqttMessage;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," interface"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttService"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processMessage"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", MqttMessage "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"message"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[366]||(l[366]=n("p",null,"同时添加接口实现类：",-1)),l[367]||(l[367]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.google.common.base.Strings;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.business.MsgHandler;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.business.MsgHandlerContext;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.utils.JsonUtil;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3.MqttMessage;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.stereotype.Component;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.io.IOException;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttServiceImpl"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttService"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MsgHandlerContext msgHandlerContext;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * mqtt消息处理")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," topic")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," message")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processMessage"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", MqttMessage "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"message"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        String msgContent "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," String"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(message."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getPayload"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"接收到消息:"'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"msgContent);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            String msgType "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," JsonUtil."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getValueByNodeName"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"msgType"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",msgContent);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Strings."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isNullOrEmpty"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msgType)) "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            MsgHandler msgHandler "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," msgHandlerContext."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMsgHandler"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msgType);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msgHandler "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            msgHandler."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"process"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msgContent);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (IOException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"process msg error,msg is: "'),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"msgContent,e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[368]||(l[368]=n("p",null,[E("在该实现类中调用了"),n("code",null,"MsgHandlerContext"),E("将消息转发具体的消息处理实现类中，具体的消息实现类分布在各个微服务项目中，每一个具体的消息处理类就是一个"),n("code",null,"MsgHandler"),E("接口的实现，该架构方式沿用了立可得1.0里的架构设计。")],-1)),l[369]||(l[369]=n("h3",{id:"_9-4-集成emq-x",tabindex:"-1"},[E("9.4 集成EMQ X "),n("a",{class:"header-anchor",href:"#_9-4-集成emq-x","aria-label":'Permalink to "9.4 集成EMQ X"'},"​")],-1)),l[370]||(l[370]=n("p",null,"（1）在lkd_client工程pom.xml 加入",-1)),l[371]||(l[371]=n("div",{class:"language-xml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"xml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.springframework.boot</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">spring-boot-configuration-processor</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"optional"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">true</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"optional"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     \x3c!--emq 客户端包--\x3e")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.eclipse.paho</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.eclipse.paho.client.mqttv3</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">1.2.2</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">commons-io</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">commons-io</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">2.8.0</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">org.apache.commons</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"groupId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">commons-lang3</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"artifactId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            <"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">3.11</"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"version"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        </"),n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"dependency"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[372]||(l[372]=n("p",null,"（2）在lkd_client 的application.yml中添加",-1)),l[373]||(l[373]=n("div",{class:"language-yaml max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"yaml"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#emq 访问端口")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"emq"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  mqttServerUrl"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"tcp://192.168.200.128:1883")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  mqttPassword"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"123456")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  innerCode"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"01000001"'),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  #当前设备编号")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  publisTopicPrefix"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"server/${emq.innerCode}/"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  #发送消息消息")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  clientId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1234501000001")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  subscribeTopic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"vm/tovm/${emq.innerCode}"),n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"   #监听服务器通知队列")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[374]||(l[374]=n("p",null,"（3）com.lkd.client.config包下新建EmqConfig 类",-1)),l[375]||(l[375]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.config;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.Data;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.boot.context.properties.ConfigurationProperties;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.context.annotation.Configuration;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Data")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Configuration")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"ConfigurationProperties"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EmqConfig"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String mqttServerUrl;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String mqttPassword;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String innerCode;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String publisTopicPrefix;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String clientId;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String subscribeTopic;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[376]||(l[376]=n("p",null,"（4）com.lkd.client.emq下新建EmqClient",-1)),l[377]||(l[377]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.config.EmqConfig;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3."),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.scheduling.annotation.Async;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.stereotype.Component;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EmqClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," EmqConfig emqConfig;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttClient mqttClient;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 连接mqtt borker")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," connect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(MqttCallback "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"callback"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        MemoryPersistence persistence "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MemoryPersistence"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttClient "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttClient"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(emqConfig."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMqttServerUrl"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),emqConfig."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getClientId"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),persistence);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mqtt creat error"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        MqttConnectOptions connOpts "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttConnectOptions"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        connOpts."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setAutomaticReconnect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        connOpts."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setUserName"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"monitor"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        connOpts."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setPassword"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(emqConfig."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getMqttPassword"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"toCharArray"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        connOpts."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCleanSession"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCallback"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(callback);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"connect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(connOpts);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mqtt creat error"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 订阅及回调方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," topicFilter")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@throws"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttException")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," subscribe"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topicFilter"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",MqttCallback "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"callBack"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MqttException     {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"subscribe----------- {}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",topicFilter);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"subscribe"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(topicFilter,"),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setCallback"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(callBack);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"   /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 发布消息")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," msgType")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@param"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," msg")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Async")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," publish"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"msgType"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"msg"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            MqttMessage mqttMessage "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttMessage"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(msg."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getBytes"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttMessage."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setQos"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttMessage."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"setRetained"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"publish topic {}"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",emqConfig."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getPublisTopicPrefix"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"msgType);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            mqttClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTopic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(emqConfig."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getPublisTopicPrefix"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"msgType)."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"publish"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(mqttMessage);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"error"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mqtt publish msg error"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[378]||(l[378]=n("p",null,"（5）新建回调处理类EmqMsgCallback",-1)),l[379]||(l[379]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.alibaba.fastjson.JSON;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.alibaba.fastjson.JSONPath;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.config.EmqConfig;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.config.MsgType;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.emq.msg."),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.mapper.VersionMapper;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.pojo.Version;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.service.DataProcessService;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.eclipse.paho.client.mqttv3."),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"*"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.stereotype.Component;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.util.concurrent.CompletableFuture;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.util.concurrent.TimeUnit;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"/**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," * emq回调类")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Component")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EmqMsgCallback"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MqttCallbackExtended"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," EmqClient emqClient;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  EmqConfig config;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," connectionLost"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Throwable "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"throwable"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"emq connect lost"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",throwable);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           TimeUnit.SECONDS."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sleep"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"           //连接中断，从新建立连接")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"           emqClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"connect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"           //订阅服务器通知topic")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            emqClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"subscribe"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(config."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSubscribeTopic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),"),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"          log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"订阅失败"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    //接受服务器通知")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," messageArrived"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"topic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", MqttMessage "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"mqttMessage"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Exception {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"       CompletableFuture."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"runAsync"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(()"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            System.out."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(topic);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            String payload "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," String"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(mqttMessage."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getPayload"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            String msgType "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (String) JSONPath."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"read"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(payload, "),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"$.msgType"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"************msgType {} payload {}*************"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", msgType,payload);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        });")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  ")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    //发送消息完成后本地回调方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," deliveryComplete"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(IMqttDeliveryToken "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"iMqttDeliveryToken"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    //连接服务器成功后本地回调方法")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," connectComplete"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"boolean"),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," connectComplete"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"s"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"connectComplete){")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //连接成功后，订阅服务器topic")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        try"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"connectComplete subscribe {} "'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",config."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSubscribeTopic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            emqClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"subscribe"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(config."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSubscribeTopic"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(),"),n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        } "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (MqttException "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            log."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"info"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"connectComplete"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",e);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[380]||(l[380]=n("p",null,"（6）建立EmqInitServcie 初始化程序",-1)),l[381]||(l[381]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.emq;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.alibaba.fastjson.JSON;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.config.ApplicationContextRegister;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.config.EmqConfig;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.emq.msg.VersionReq;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.mapper.VersionMapper;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.pojo.Version;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.extern.slf4j.Slf4j;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.beans.factory.annotation.Autowired;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.boot.autoconfigure.AutoConfigureAfter;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.core.io.Resource;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.jdbc.datasource.init.ScriptUtils;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.springframework.stereotype.Service;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," javax.annotation.PostConstruct;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Slf4j")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Service")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EmqInitServcie"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," EmqMsgCallback emqMsgCallback;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Autowired")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," EmqClient emqClient;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"PostConstruct")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," init"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"throws"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Exception {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        //建立mqtt连接")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        emqClient."),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"connect"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(emqMsgCallback);")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[382]||(l[382]=n("p",null,"（7）测试",-1)),l[383]||(l[383]=n("p",null,"使用测试工具发布消息 主题 vm/tovm/01000001 客户端工具输入",-1)),l[384]||(l[384]=n("p",null,"可以监听到服务器返回信息",-1)),l[385]||(l[385]=n("h3",{id:"_9-5-消息协议封装",tabindex:"-1"},[E("9.5 消息协议封装 "),n("a",{class:"header-anchor",href:"#_9-5-消息协议封装","aria-label":'Permalink to "9.5 消息协议封装"'},"​")],-1)),l[386]||(l[386]=n("p",null,"（1）封装了各种协议的枚举对象",-1)),l[387]||(l[387]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.config;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.Getter;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Getter")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," enum"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MsgType"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    versionCfg"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"versionCfg"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"同步基础信息"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    channelCfg"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"channelCfg"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"同步货道信息"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    skuCfg"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"skuCfgResp"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"同步商品信息"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    skuPrice"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"skuPrice"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"价格变动"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    supplyResp"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"supplyResp"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"价格变动"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    vendoutReq"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"vendoutReq"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"出货通知"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    vendoutResp"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"vendoutResp"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},","),n("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"出货上报"'),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String type;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String desc;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    MsgType"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"type"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", String "),n("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"desc"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".type "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," type;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        this"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".desc "),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," desc;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[388]||(l[388]=n("p",null,"（2）各种协议的数据封装对象，从emq/msg包下拷贝所有类",-1)),l[389]||(l[389]=n("p",null,"BaseData是父类",-1)),l[390]||(l[390]=n("div",{class:"language-java max-h-300px"},[n("button",{title:"Copy code",class:"copy"}),n("span",{class:"lang"},"java"),n("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[n("code",{"v-pre":""},[n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"package"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.lkd.client.emq.msg;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lombok.Data;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," java.io.Serializable;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Data")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," BaseData"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),n("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Serializable"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"{")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 消息类型")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String msgType;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * sn码 唯一标识")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," sn;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 售货机编码")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String innerCode;")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 是否需要回传确认")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," needResp;")]),E("\n"),n("span",{class:"line"}),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),n("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," long"),n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," versionId; ")]),E("\n"),n("span",{class:"line"},[n("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),n("button",{class:"code-block-unfold-btn"})],-1)),l[391]||(l[391]=n("p",null,"其他类继承自BaseData",-1))]),"main-header":t(()=>[k(s.$slots,"main-header")]),"main-header-after":t(()=>[k(s.$slots,"main-header-after")]),"main-nav":t(()=>[k(s.$slots,"main-nav")]),"main-content-before":t(()=>[k(s.$slots,"main-content-before")]),"main-content":t(()=>[k(s.$slots,"main-content")]),"main-content-after":t(()=>[k(s.$slots,"main-content-after")]),"main-nav-before":t(()=>[k(s.$slots,"main-nav-before")]),"main-nav-after":t(()=>[k(s.$slots,"main-nav-after")]),comment:t(()=>[k(s.$slots,"comment")]),footer:t(()=>[k(s.$slots,"footer")]),aside:t(()=>[k(s.$slots,"aside")]),"aside-custom":t(()=>[k(s.$slots,"aside-custom")]),default:t(()=>[k(s.$slots,"default")]),_:3},8,["frontmatter"])}}};export{y as default,g as usePageData};
